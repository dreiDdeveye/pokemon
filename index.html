<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PumpFighters - Memecoin Battle Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ================================
           CSS VARIABLES & RESET
           ================================ */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        :root {
            --primary: #ffd93d;
            --bg: #0a0a0f;
            --bg-card: #12121a;
            --text: #ffffff;
            --text-muted: #888;
            --border: #2a2a3a;
            --green: #22c55e;
            --red: #ef4444;
            --blue: #3b82f6;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ================================
           ANIMATED BACKGROUND
           ================================ */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(255, 95, 95, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 30%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 80%, rgba(255, 217, 61, 0.12) 0%, transparent 50%),
                linear-gradient(180deg, 
                    #0a0a1a 0%,
                    #1a1a3a 25%,
                    #0d1f3c 50%,
                    #1a0a2e 75%,
                    #0a0a1a 100%
                );
        }

        /* Retro Scanlines */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15) 0px,
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 100;
            opacity: 0.5;
        }

        /* CRT Glow Effect */
        .crt-glow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            box-shadow: inset 0 0 150px rgba(255, 217, 61, 0.03);
            pointer-events: none;
        }

        /* Pixel Stars */
        .pixel-stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background: #fff;
            animation: twinkle 2s ease-in-out infinite;
            image-rendering: pixelated;
        }

        .star.small { width: 2px; height: 2px; }
        .star.medium { width: 3px; height: 3px; box-shadow: 0 0 8px #fff, 0 0 12px rgba(255,255,255,0.5); }
        .star.large { width: 4px; height: 4px; box-shadow: 0 0 12px #ffd93d, 0 0 24px #ffd93d, 0 0 36px rgba(255,217,61,0.3); }

        .star:nth-child(1) { left: 5%; top: 10%; animation-delay: 0s; }
        .star:nth-child(2) { left: 15%; top: 25%; animation-delay: 0.3s; }
        .star:nth-child(3) { left: 25%; top: 8%; animation-delay: 0.6s; }
        .star:nth-child(4) { left: 35%; top: 30%; animation-delay: 0.9s; }
        .star:nth-child(5) { left: 45%; top: 15%; animation-delay: 1.2s; }
        .star:nth-child(6) { left: 55%; top: 5%; animation-delay: 0.2s; }
        .star:nth-child(7) { left: 65%; top: 20%; animation-delay: 0.5s; }
        .star:nth-child(8) { left: 75%; top: 12%; animation-delay: 0.8s; }
        .star:nth-child(9) { left: 85%; top: 28%; animation-delay: 1.1s; }
        .star:nth-child(10) { left: 95%; top: 8%; animation-delay: 1.4s; }
        .star:nth-child(11) { left: 10%; top: 45%; animation-delay: 0.4s; }
        .star:nth-child(12) { left: 30%; top: 55%; animation-delay: 0.7s; }
        .star:nth-child(13) { left: 50%; top: 40%; animation-delay: 1s; }
        .star:nth-child(14) { left: 70%; top: 50%; animation-delay: 1.3s; }
        .star:nth-child(15) { left: 90%; top: 45%; animation-delay: 0.1s; }
        .star:nth-child(16) { left: 20%; top: 70%; animation-delay: 0.6s; }
        .star:nth-child(17) { left: 40%; top: 75%; animation-delay: 0.9s; }
        .star:nth-child(18) { left: 60%; top: 65%; animation-delay: 1.2s; }
        .star:nth-child(19) { left: 80%; top: 72%; animation-delay: 0.3s; }
        .star:nth-child(20) { left: 8%; top: 85%; animation-delay: 0.8s; }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.8); }
        }

        /* Pokemon Type Energy Orbs */
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.5;
            animation: orbFloat 20s ease-in-out infinite;
        }

        .orb-1 {
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, 
                rgba(255, 95, 95, 0.8) 0%, 
                rgba(255, 60, 0, 0.5) 30%,
                rgba(255, 165, 0, 0.3) 50%,
                transparent 70%
            );
            top: -200px;
            left: -200px;
            animation-delay: 0s;
        }

        .orb-2 {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, 
                rgba(59, 130, 246, 0.8) 0%, 
                rgba(37, 99, 235, 0.5) 30%,
                rgba(96, 165, 250, 0.3) 50%,
                transparent 70%
            );
            top: 35%;
            right: -150px;
            animation-delay: -5s;
        }

        .orb-3 {
            width: 550px;
            height: 550px;
            background: radial-gradient(circle, 
                rgba(255, 217, 61, 0.9) 0%, 
                rgba(250, 204, 21, 0.5) 30%,
                rgba(253, 224, 71, 0.3) 50%,
                transparent 70%
            );
            bottom: -200px;
            left: 15%;
            animation-delay: -10s;
        }

        .orb-4 {
            width: 450px;
            height: 450px;
            background: radial-gradient(circle, 
                rgba(168, 85, 247, 0.8) 0%, 
                rgba(139, 92, 246, 0.5) 30%,
                rgba(192, 132, 252, 0.3) 50%,
                transparent 70%
            );
            top: 55%;
            left: 55%;
            animation-delay: -15s;
        }

        .orb-5 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, 
                rgba(34, 197, 94, 0.7) 0%, 
                rgba(22, 163, 74, 0.4) 30%,
                rgba(74, 222, 128, 0.2) 50%,
                transparent 70%
            );
            top: 20%;
            left: 40%;
            animation-delay: -8s;
            animation-duration: 25s;
        }

        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.4; }
            25% { transform: translate(40px, -50px) scale(1.15); opacity: 0.6; }
            50% { transform: translate(-30px, 30px) scale(0.9); opacity: 0.35; }
            75% { transform: translate(35px, 25px) scale(1.1); opacity: 0.55; }
        }

        /* Pixel Grid Pattern */
        .grid-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255,217,61,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,217,61,0.03) 1px, transparent 1px);
            background-size: 32px 32px;
            opacity: 0.6;
        }

        /* Floating Pokeballs */
        .pokeball-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .pokeball {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(180deg, 
                #ff5f5f 0%, #ff5f5f 45%, 
                #2a2a3e 45%, #2a2a3e 55%, 
                #fff 55%, #fff 100%
            );
            opacity: 0.12;
            animation: floatPokeball 25s linear infinite;
            box-shadow: 0 0 10px rgba(255, 95, 95, 0.3);
        }

        .pokeball::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: #fff;
            border-radius: 50%;
            border: 2px solid #2a2a3e;
            box-shadow: 0 0 4px rgba(255,255,255,0.5);
        }

        .pokeball:nth-child(1) { left: 5%; animation-delay: 0s; animation-duration: 28s; }
        .pokeball:nth-child(2) { left: 15%; animation-delay: -4s; animation-duration: 24s; width: 18px; height: 18px; }
        .pokeball:nth-child(3) { left: 25%; animation-delay: -8s; animation-duration: 30s; width: 28px; height: 28px; }
        .pokeball:nth-child(4) { left: 35%; animation-delay: -2s; animation-duration: 22s; }
        .pokeball:nth-child(5) { left: 45%; animation-delay: -12s; animation-duration: 26s; width: 20px; height: 20px; }
        .pokeball:nth-child(6) { left: 55%; animation-delay: -6s; animation-duration: 28s; width: 26px; height: 26px; }
        .pokeball:nth-child(7) { left: 65%; animation-delay: -14s; animation-duration: 25s; }
        .pokeball:nth-child(8) { left: 75%; animation-delay: -1s; animation-duration: 30s; width: 18px; height: 18px; }
        .pokeball:nth-child(9) { left: 85%; animation-delay: -10s; animation-duration: 23s; width: 28px; height: 28px; }
        .pokeball:nth-child(10) { left: 92%; animation-delay: -7s; animation-duration: 27s; }

        @keyframes floatPokeball {
            0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
            3% { opacity: 0.12; }
            97% { opacity: 0.12; }
            100% { transform: translateY(-10vh) rotate(1080deg); opacity: 0; }
        }

        /* Battle Energy Sparkles */
        .sparkles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .sparkle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: transparent;
            animation: sparkleAnim 2.5s ease-in-out infinite;
        }

        .sparkle::before,
        .sparkle::after {
            content: '';
            position: absolute;
            background: linear-gradient(90deg, transparent, #ffd93d, transparent);
            border-radius: 2px;
        }

        .sparkle::before {
            width: 100%;
            height: 3px;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
        }

        .sparkle::after {
            width: 3px;
            height: 100%;
            left: 50%;
            top: 0;
            transform: translateX(-50%);
            background: linear-gradient(180deg, transparent, #ffd93d, transparent);
        }

        .sparkle:nth-child(1) { left: 8%; top: 15%; animation-delay: 0s; }
        .sparkle:nth-child(2) { left: 22%; top: 35%; animation-delay: 0.4s; }
        .sparkle:nth-child(3) { left: 38%; top: 18%; animation-delay: 0.8s; }
        .sparkle:nth-child(4) { left: 52%; top: 42%; animation-delay: 1.2s; }
        .sparkle:nth-child(5) { left: 68%; top: 22%; animation-delay: 1.6s; }
        .sparkle:nth-child(6) { left: 82%; top: 38%; animation-delay: 2s; }
        .sparkle:nth-child(7) { left: 12%; top: 58%; animation-delay: 0.2s; }
        .sparkle:nth-child(8) { left: 42%; top: 68%; animation-delay: 0.6s; }
        .sparkle:nth-child(9) { left: 72%; top: 62%; animation-delay: 1s; }
        .sparkle:nth-child(10) { left: 88%; top: 52%; animation-delay: 1.4s; }
        .sparkle:nth-child(11) { left: 18%; top: 82%; animation-delay: 1.8s; }
        .sparkle:nth-child(12) { left: 58%; top: 78%; animation-delay: 0.3s; }

        @keyframes sparkleAnim {
            0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
        }

        /* Type Symbols */
        .type-symbols {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .type-symbol {
            position: absolute;
            font-size: 20px;
            opacity: 0.08;
            animation: floatSymbol 30s linear infinite;
            filter: blur(1px);
        }

        .type-symbol:nth-child(1) { left: 8%; animation-delay: 0s; }
        .type-symbol:nth-child(2) { left: 18%; animation-delay: -5s; }
        .type-symbol:nth-child(3) { left: 28%; animation-delay: -10s; }
        .type-symbol:nth-child(4) { left: 38%; animation-delay: -15s; }
        .type-symbol:nth-child(5) { left: 48%; animation-delay: -20s; }
        .type-symbol:nth-child(6) { left: 58%; animation-delay: -3s; }
        .type-symbol:nth-child(7) { left: 68%; animation-delay: -8s; }
        .type-symbol:nth-child(8) { left: 78%; animation-delay: -13s; }
        .type-symbol:nth-child(9) { left: 88%; animation-delay: -18s; }
        .type-symbol:nth-child(10) { left: 95%; animation-delay: -23s; }

        @keyframes floatSymbol {
            0% { transform: translateY(110vh) rotate(0deg) scale(1); opacity: 0; }
            5% { opacity: 0.08; }
            50% { transform: translateY(50vh) rotate(180deg) scale(1.2); }
            95% { opacity: 0.08; }
            100% { transform: translateY(-10vh) rotate(360deg) scale(1); opacity: 0; }
        }

        /* Energy Wave */
        .energy-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 200px;
            background: linear-gradient(180deg, 
                transparent 0%,
                rgba(153, 69, 255, 0.08) 30%,
                rgba(20, 241, 149, 0.1) 60%,
                rgba(255, 217, 61, 0.08) 100%
            );
            animation: waveMove 12s linear infinite;
        }

        @keyframes waveMove {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        /* Battle Border */
        .battle-border {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            box-shadow: 
                inset 0 0 100px rgba(255, 217, 61, 0.03),
                inset 0 0 200px rgba(139, 92, 246, 0.02);
            animation: borderPulse 4s ease-in-out infinite;
        }

        @keyframes borderPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Floating Character Pills */
        .floating-pills {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 2;
        }

        .floating-pill {
            position: absolute;
            width: 55px;
            height: 55px;
            opacity: 0.2;
            animation: floatPillUp 20s linear infinite;
            filter: drop-shadow(0 0 15px rgba(255, 217, 61, 0.6)) drop-shadow(0 0 30px rgba(139, 92, 246, 0.3));
        }

        .floating-pill img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 50%;
        }

        .floating-pill:nth-child(1) { left: 5%; bottom: -60px; animation-delay: 0s; animation-duration: 25s; }
        .floating-pill:nth-child(2) { left: 15%; bottom: -60px; animation-delay: 3s; animation-duration: 22s; width: 35px; height: 35px; }
        .floating-pill:nth-child(3) { left: 25%; bottom: -60px; animation-delay: 6s; animation-duration: 28s; width: 55px; height: 55px; }
        .floating-pill:nth-child(4) { left: 35%; bottom: -60px; animation-delay: 2s; animation-duration: 24s; }
        .floating-pill:nth-child(5) { left: 45%; bottom: -60px; animation-delay: 8s; animation-duration: 26s; width: 40px; height: 40px; }
        .floating-pill:nth-child(6) { left: 55%; bottom: -60px; animation-delay: 4s; animation-duration: 21s; width: 50px; height: 50px; }
        .floating-pill:nth-child(7) { left: 65%; bottom: -60px; animation-delay: 10s; animation-duration: 27s; }
        .floating-pill:nth-child(8) { left: 75%; bottom: -60px; animation-delay: 1s; animation-duration: 20s; width: 35px; height: 35px; }
        .floating-pill:nth-child(9) { left: 85%; bottom: -60px; animation-delay: 7s; animation-duration: 24s; width: 55px; height: 55px; }

        @keyframes floatPillUp {
            0% { transform: translateY(0) rotate(0deg) scale(0.8); opacity: 0; }
            5% { opacity: 0.25; }
            50% { transform: translateY(-55vh) rotate(180deg) scale(1); }
            95% { opacity: 0.25; }
            100% { transform: translateY(-110vh) rotate(360deg) scale(0.8); opacity: 0; }
        }

        /* ================================
           NAVIGATION
           ================================ */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 16px 24px;
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1001;
        }

        .logo-img {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .logo-text {
            font-family: 'Press Start 2P', cursive;
            font-size: 1rem;
            color: var(--primary);
        }

        /* Hamburger Menu */
        .hamburger {
            display: none;
            flex-direction: column;
            justify-content: center;
            gap: 5px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 10px;
            z-index: 1001;
        }

        .hamburger-line {
            width: 28px;
            height: 3px;
            background: var(--text);
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .hamburger.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }

        .hamburger.active .hamburger-line:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }

        .nav-links {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .nav-links a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .nav-links a:hover { 
            color: var(--text); 
        }

        .music-btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .music-btn:hover {
            border-color: var(--primary);
            transform: scale(1.1);
        }

        .music-btn.playing {
            background: var(--primary);
            color: #000;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 217, 61, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(255, 217, 61, 0); }
        }

        /* ================================
           BUTTONS
           ================================ */
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--primary);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255, 217, 61, 0.3);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
        }

        .btn-wallet {
            background: linear-gradient(135deg, #9945FF 0%, #14F195 100%);
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            padding: 10px 16px;
        }

        .btn-wallet:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(153, 69, 255, 0.4);
        }

        .btn-wallet.connected {
            background: linear-gradient(135deg, #14F195 0%, #9945FF 100%);
        }

        /* ================================
           HERO SECTION
           ================================ */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 100px 24px 60px;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: url('assets/images/hero-bg.png');
            background-size: cover;
            background-position: center 70%;
            background-repeat: no-repeat;
            opacity: 0.60;
            z-index: -2;
        }

        .hero::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(
                180deg,
                rgba(10, 10, 26, 0.85) 0%,
                rgba(10, 10, 26, 0.6) 50%,
                rgba(10, 10, 26, 0.9) 100%
            );
            z-index: -1;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(18, 18, 30, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 50px;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 24px;
        }

        .hero-badge .live { 
            color: var(--green); 
        }

        .hero-title {
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(1.8rem, 5vw, 3rem);
            margin-bottom: 16px;
            line-height: 1.3;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .hero-title .highlight { 
            color: var(--primary); 
            text-shadow: 0 0 30px rgba(255, 217, 61, 0.5); 
        }

        .hero-subtitle {
            font-size: 1.1rem;
            color: var(--text-muted);
            max-width: 500px;
            margin-bottom: 40px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        /* Character Preview */
        .character-preview {
            display: flex;
            gap: 16px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .char-avatar {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            background: rgba(18, 18, 30, 0.8);
            backdrop-filter: blur(5px);
            border: 2px solid var(--border);
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .char-avatar:hover {
            border-color: var(--primary);
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 8px 25px rgba(255, 217, 61, 0.3);
        }

        .char-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cta-buttons {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Contract Address */
        .ca-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 24px;
            padding: 12px 20px;
            background: rgba(18, 18, 30, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 50px;
            font-family: monospace;
            font-size: 0.8rem;
        }

        .ca-label {
            color: var(--primary);
            font-weight: 700;
        }

        .ca-address {
            color: var(--text-muted);
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .ca-copy {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.2s;
        }

        .ca-copy:hover {
            transform: scale(1.2);
        }

        /* ================================
           GAME SECTION
           ================================ */
        .game-wrapper {
            background: transparent;
            position: relative;
            z-index: 50;
        }

        .game-section {
            padding: 60px 24px;
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
        }

        .section-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 40px;
        }

        .section-title .highlight { 
            color: var(--primary); 
        }

        /* Battle Arena */
        .battle-arena {
            background-color: #228B22;
            background-image: url('assets/images/battle-bg.png');
            background-size: cover;
            background-position: center bottom;
            background-repeat: no-repeat;
            border-radius: 16px;
            height: 480px;
            position: relative;
            overflow: hidden;
            margin-bottom: 16px;
            border: 3px solid #1a1a2e;
            image-rendering: pixelated;
        }

        .battle-arena::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, #87CEEB 0%, #87CEEB 45%, #90EE90 65%, #228B22 100%);
            z-index: 0;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .battle-arena.no-bg::before {
            opacity: 1;
        }

        .sun {
            position: absolute;
            top: 20px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            z-index: 2;
            display: none;
        }

        .battle-arena.no-bg .sun {
            display: block;
        }

        /* HP Boxes */
        .hp-box {
            position: absolute;
            background: #fff;
            border-radius: 10px;
            padding: 12px 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            min-width: 200px;
            z-index: 20;
        }

        .hp-box.enemy {
            top: 20px;
            left: 20px;
        }

        .hp-box.player {
            bottom: 20px;
            right: 20px;
        }

        .hp-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .pokemon-name {
            font-weight: 700;
            color: #333;
            font-size: 0.9rem;
        }

        .level {
            background: #333;
            color: #fff;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
        }

        .hp-bar-outer {
            height: 8px;
            background: #e5e5e5;
            border-radius: 4px;
            overflow: hidden;
        }

        .hp-bar-inner {
            height: 100%;
            background: var(--green);
            border-radius: 4px;
            transition: width 0.5s;
        }

        .hp-bar-inner.medium { background: #eab308; }
        .hp-bar-inner.low { background: var(--red); animation: hpPulse 0.5s infinite; }

        @keyframes hpPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .hp-text {
            text-align: right;
            font-size: 0.7rem;
            color: #666;
            margin-top: 4px;
        }

        /* Status Badges */
        .status-container {
            display: flex;
            gap: 4px;
            margin-top: 4px;
        }

        .status-badge {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.4rem;
            padding: 2px 4px;
            border-radius: 3px;
            color: #fff;
        }

        .status-par { background: #eab308; }
        .status-brn { background: #f97316; }
        .status-psn { background: #a855f7; }
        .status-slp { background: #6b7280; }
        .status-frz { background: #06b6d4; }

        /* Sprites */
        .sprite-player {
            display: none;
        }

        .sprite-player-back {
            position: absolute;
            left: -20px;
            bottom: -40px;
            width: 400px;
            height: 400px;
            animation: bounceBack 2.5s ease-in-out infinite;
            z-index: 10;
        }

        .sprite-player-back img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center bottom;
            filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.4));
        }

        @keyframes bounceBack {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .sprite-player-back.attacking {
            animation: attackBack 0.4s ease-out forwards;
        }

        @keyframes attackBack {
            0% { transform: translateX(0) translateY(0); }
            50% { transform: translateX(80px) translateY(-20px) scale(1.1); }
            100% { transform: translateX(0) translateY(0); }
        }

        .sprite-player-back.damaged {
            animation: damagedBack 0.5s ease-out;
        }

        @keyframes damagedBack {
            0%, 100% { transform: translateX(0); opacity: 1; }
            20% { transform: translateX(-15px); opacity: 0.4; filter: brightness(2); }
            40% { transform: translateX(15px); opacity: 0.6; }
            60% { transform: translateX(-8px); opacity: 0.8; }
            80% { transform: translateX(8px); opacity: 0.9; }
        }

        .sprite-enemy {
            position: absolute;
            right: 5%;
            bottom: 80px;
            width: 400px;
            height: 400px;
            animation: bounce 2.5s ease-in-out infinite;
            animation-delay: 0.5s;
            z-index: 5;
        }

        .sprite-enemy img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.35));
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .sprite-enemy.attacking {
            animation: attackEnemy 0.4s ease-out forwards;
        }

        @keyframes attackEnemy {
            0% { transform: translateX(0) translateY(0); }
            50% { transform: translateX(-80px) translateY(10px) scale(1.15); }
            100% { transform: translateX(0) translateY(0); }
        }

        .sprite-enemy.damaged {
            animation: damagedEnemy 0.5s ease-out;
        }

        @keyframes damagedEnemy {
            0%, 100% { transform: translateX(0); opacity: 1; }
            20% { transform: translateX(10px); opacity: 0.4; filter: brightness(2); }
            40% { transform: translateX(-10px); opacity: 0.6; }
            60% { transform: translateX(5px); opacity: 0.8; }
            80% { transform: translateX(-5px); opacity: 0.9; }
        }

        /* Shiny Effect */
        .sprite-player.shiny img,
        .sprite-player-back.shiny img,
        .sprite-enemy.shiny img {
            filter: drop-shadow(0 0 15px #ec4899) drop-shadow(0 8px 16px rgba(0,0,0,0.3)) hue-rotate(30deg);
        }

        /* Turn Indicator */
        .turn-indicator {
            position: absolute;
            bottom: 1%;
            left: 50%;
            transform: translate(-50%);
            font-family: 'Press Start 2P', cursive;
            font-size: 0.65rem;
            background: rgba(0,0,0,0.9);
            color: var(--primary);
            padding: 10px 20px;
            border-radius: 25px;
            border: 2px solid var(--primary);
            z-index: 50;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .turn-indicator.enemy { 
            color: var(--red); 
            border-color: var(--red); 
        }

        /* Damage Numbers */
        .damage-number {
            position: absolute;
            font-family: 'Press Start 2P', cursive;
            font-size: 1.5rem;
            color: #fff;
            text-shadow: 3px 3px 0 #000, -3px -3px 0 #000, 3px -3px 0 #000, -3px 3px 0 #000;
            animation: damageFloat 1.2s ease-out forwards;
            pointer-events: none;
            z-index: 100;
        }

        .damage-number.critical {
            font-size: 2rem;
            color: #fbbf24;
        }

        .damage-number.heal {
            color: #22c55e;
        }

        .damage-number.miss {
            font-size: 1rem;
            color: #888;
        }

        @keyframes damageFloat {
            0% { transform: translateY(0) scale(0.5); opacity: 1; }
            30% { transform: translateY(-30px) scale(1.3); opacity: 1; }
            100% { transform: translateY(-80px) scale(1); opacity: 0; }
        }

        /* Effectiveness Popup */
        .effectiveness-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Press Start 2P', cursive;
            font-size: 0.75rem;
            padding: 10px 20px;
            border-radius: 8px;
            animation: popupShow 1.5s ease-out forwards;
            z-index: 100;
            white-space: nowrap;
        }

        .effectiveness-popup.super { background: var(--green); color: #fff; }
        .effectiveness-popup.not-very { background: #6b7280; color: #fff; }
        .effectiveness-popup.immune { background: #1f2937; color: #fff; }

        @keyframes popupShow {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }

        /* Battle Intro */
        .battle-intro {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            animation: introFade 2.5s ease-out forwards;
        }

        .battle-intro.hide { display: none; }

        .intro-text {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.9rem;
            color: #fff;
            text-align: center;
        }

        .intro-text .shiny-name { color: #ec4899; }

        @keyframes introFade {
            0%, 60% { opacity: 1; }
            100% { opacity: 0; pointer-events: none; }
        }

        /* Battle Menu */
        .battle-menu {
            background: rgba(18, 18, 26, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(42, 42, 58, 0.8);
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }

        .battle-log {
            padding: 16px;
            border-right: 1px solid rgba(42, 42, 58, 0.8);
            background: rgba(0, 0, 0, 0.8);
            min-height: 120px;
            max-height: 150px;
            overflow-y: auto;
        }

        .battle-log::-webkit-scrollbar {
            width: 4px;
        }

        .battle-log::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }

        .log-entry {
            font-size: 0.75rem;
            color: var(--green);
            padding: 3px 0;
            font-family: 'Press Start 2P', monospace;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .log-entry.system { color: var(--primary); }
        .log-entry.enemy { color: var(--red); }
        .log-entry.info { color: var(--blue); }

        .move-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            padding: 12px;
            background: rgba(18, 18, 26, 0.8);
        }

        .move-btn {
            background: rgba(10, 10, 15, 0.8);
            border: 2px solid rgba(42, 42, 58, 0.8);
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            text-align: left;
            backdrop-filter: blur(5px);
            transition: all 0.2s;
        }

        .move-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background: rgba(255, 217, 61, 0.1);
        }

        .move-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Battle Result */
        .battle-result {
            display: none !important;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-card);
            border: 3px solid var(--primary);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            z-index: 500;
        }

        .battle-result.show { display: block !important; }

        .result-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 16px;
        }

        .result-subtitle {
            color: var(--text-muted);
            margin-bottom: 24px;
        }

        .battle-arena.shake {
            animation: screenShake 0.3s ease-out;
        }

        @keyframes screenShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-3px); }
        }

        /* ================================
           HOW IT WORKS SECTION
           ================================ */
        .how-it-works {
            padding: 100px 24px;
            background: transparent;
            position: relative;
            z-index: 10;
        }

        .how-container {
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .steps {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
        }

        .step {
            text-align: center;
            padding: 40px 28px;
            background: rgba(26, 26, 46, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(42, 42, 62, 0.8);
            transition: transform 0.3s, border-color 0.3s;
        }

        .step:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .step-icon {
            font-size: 3.5rem;
            margin-bottom: 24px;
            display: block;
            line-height: 1;
        }

        .step-title {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            margin: 0 0 16px 0;
            color: #fff;
        }

        .step-desc {
            color: var(--text-muted);
            font-size: 0.95rem;
            line-height: 1.7;
            margin: 0;
        }

        /* ================================
           FOOTER
           ================================ */
        footer {
            padding: 32px 24px 24px;
            text-align: center;
            border-top: 1px solid rgba(42, 42, 58, 0.5);
            background: transparent;
            position: relative;
            z-index: 10;
        }

        .footer-content {
            max-width: 700px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 14px;
        }

        .social-links {
            display: flex;
            gap: 16px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .social-links a {
            color: #a0a0a0;
            text-decoration: none;
            padding: 12px 24px;
            border: 1px solid rgba(42, 42, 62, 0.8);
            border-radius: 10px;
            background: rgba(26, 26, 46, 0.6);
            backdrop-filter: blur(5px);
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .social-links a:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-3px);
        }

        /* ================================
           MODALS
           ================================ */
        .modal {
            display: none !important;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            visibility: hidden;
        }

        .modal.show { 
            display: flex !important; 
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 32px;
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.1rem;
            text-align: center;
            margin-bottom: 28px;
            color: var(--primary);
            text-shadow: 0 0 20px rgba(255, 217, 61, 0.3);
        }

        /* Character Grid */
        .character-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .char-card {
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.9) 0%, rgba(18, 18, 30, 0.95) 100%);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .char-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .char-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 217, 61, 0.15);
        }

        .char-card:hover::before {
            opacity: 1;
        }

        .char-card.selected {
            border-color: var(--primary);
            box-shadow: 0 0 30px rgba(255, 217, 61, 0.3), inset 0 0 20px rgba(255, 217, 61, 0.05);
        }

        .char-card.selected::before {
            opacity: 1;
        }

        .char-card img {
            width: 100px;
            height: 100px;
            object-fit: contain;
            border-radius: 12px;
            margin-bottom: 12px;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px;
            transition: transform 0.3s;
        }

        .char-card:hover img {
            transform: scale(1.1);
        }

        .char-card .name {
            font-family: 'Press Start 2P', cursive;
            font-weight: 600;
            font-size: 0.75rem;
            color: var(--primary);
            margin-bottom: 6px;
        }

        .char-card .type-badge {
            display: inline-block;
            font-size: 0.65rem;
            padding: 3px 10px;
            border-radius: 20px;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .char-card .type-badge.water { background: #3b82f6; color: #fff; }
        .char-card .type-badge.electric { background: #fbbf24; color: #000; }
        .char-card .type-badge.fire { background: #ef4444; color: #fff; }
        .char-card .type-badge.normal { background: #a3a3a3; color: #000; }
        .char-card .type-badge.dark { background: #374151; color: #fff; }
        .char-card .type-badge.psychic { background: #ec4899; color: #fff; }
        .char-card .type-badge.grass { background: #22c55e; color: #fff; }

        .char-card .role {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .char-card .description {
            font-size: 0.7rem;
            color: var(--text-muted);
            line-height: 1.4;
            margin-bottom: 12px;
            min-height: 36px;
        }

        .char-card .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
            font-size: 0.6rem;
        }

        .char-card .stat {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 4px 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
        }

        .char-card .stat-label {
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .char-card .stat-value {
            color: var(--text);
            font-weight: 600;
        }

        .char-card .stat-value.high { color: #22c55e; }
        .char-card .stat-value.medium { color: #fbbf24; }
        .char-card .stat-value.low { color: #ef4444; }

        .modal-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
        }

        /* Wallet Modal */
        .wallet-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .wallet-modal.show {
            display: flex;
        }

        .wallet-modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 32px;
            max-width: 400px;
            width: 90%;
            border: 1px solid var(--border);
        }

        .wallet-modal-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: 24px;
            color: var(--primary);
        }

        .wallet-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .wallet-option {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .wallet-option:hover {
            border-color: var(--primary);
            background: rgba(255, 217, 61, 0.05);
        }

        .wallet-option img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
        }

        .wallet-option-info {
            flex: 1;
        }

        .wallet-option-name {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text);
        }

        .wallet-option-desc {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .wallet-option-status {
            font-size: 0.7rem;
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--green);
            color: #000;
        }

        .wallet-option-status.not-installed {
            background: var(--border);
            color: var(--text-muted);
        }

        .wallet-modal-close {
            margin-top: 20px;
            width: 100%;
            padding: 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }

        .wallet-modal-close:hover {
            border-color: var(--red);
            color: var(--red);
        }

        .wallet-address {
            font-family: monospace;
            font-size: 0.8rem;
        }

        .wallet-balance {
            font-size: 0.7rem;
            color: var(--green);
            margin-left: 4px;
        }

        /* ================================
           RESPONSIVE STYLES
           ================================ */
        
        /* Tablet */
        @media (max-width: 900px) {
            .steps {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .character-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Mobile */
        @media (max-width: 768px) {
            /* Show hamburger */
            .hamburger {
                display: flex;
            }

            /* Mobile nav overlay */
            .nav-links {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(10, 10, 15, 0.98);
                flex-direction: column;
                justify-content: center;
                align-items: center;
                gap: 28px;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
                padding: 2rem;
                z-index: 1000;
            }

            .nav-links.active {
                opacity: 1;
                visibility: visible;
            }

            .nav-links a {
                display: block;
                font-size: 1.3rem;
                padding: 10px 20px;
                color: var(--text);
            }

            .nav-links .btn-wallet {
                width: 100%;
                max-width: 240px;
                justify-content: center;
                padding: 14px 24px;
                font-size: 0.9rem;
            }

            .nav-links .btn-primary {
                width: 100%;
                max-width: 240px;
                text-align: center;
                padding: 14px 24px;
                display: block;
            }

            .nav-links .music-btn {
                width: 55px;
                height: 55px;
                font-size: 1.4rem;
            }

            nav {
                padding: 12px 16px;
            }

            .logo-img {
                width: 45px;
                height: 45px;
            }

            .logo-text {
                font-size: 0.75rem;
            }

            /* Hero */
            .hero {
                padding: 90px 20px 50px;
            }

            .hero-title {
                font-size: clamp(1.2rem, 5vw, 1.8rem);
            }

            .hero-subtitle {
                font-size: 0.95rem;
                padding: 0 10px;
            }

            .char-avatar {
                width: 60px;
                height: 60px;
            }

            .ca-container {
                padding: 10px 14px;
                font-size: 0.7rem;
            }

            .ca-address {
                max-width: 120px;
            }

            .cta-buttons {
                flex-direction: column;
                width: 100%;
                max-width: 280px;
            }

            .cta-buttons .btn {
                width: 100%;
            }

            /* Game Section */
            .game-section {
                padding: 40px 16px;
            }

            .section-title {
                font-size: 1rem;
                margin-bottom: 24px;
            }

            .battle-arena {
                height: 360px;
            }

            .sprite-player-back {
                width: 200px;
                height: 200px;
                left: -15px;
                bottom: -25px;
            }

            .sprite-enemy {
                width: 130px;
                height: 130px;
                right: 5%;
                bottom: 70px;
            }

            .hp-box {
                min-width: 120px;
                padding: 8px 10px;
            }

            .hp-box .pokemon-name {
                font-size: 0.7rem;
            }

            .hp-box .level {
                font-size: 0.55rem;
                padding: 2px 5px;
            }

            .hp-box.player {
                bottom: 10px;
                right: 10px;
            }

            .hp-box.enemy {
                top: 10px;
                left: 10px;
            }

            .hp-text {
                font-size: 0.6rem;
            }

            .turn-indicator {
                font-size: 0.5rem;
                padding: 6px 14px;
            }

            .battle-menu {
                grid-template-columns: 1fr;
            }

            .battle-log {
                border-right: none;
                border-bottom: 1px solid rgba(42, 42, 58, 0.8);
                max-height: 80px;
                min-height: 80px;
            }

            .log-entry {
                font-size: 0.6rem;
            }

            .move-grid {
                gap: 6px;
                padding: 10px;
            }

            .move-btn {
                padding: 10px;
            }

            /* How It Works */
            .how-it-works {
                padding: 60px 20px;
            }

            .steps {
                grid-template-columns: 1fr;
                gap: 20px;
                max-width: 400px;
                margin: 0 auto;
            }

            .step {
                padding: 30px 24px;
            }

            .step-icon {
                font-size: 2.5rem;
                margin-bottom: 16px;
            }

            .step-title {
                font-size: 1rem;
            }

            .step-desc {
                font-size: 0.9rem;
            }

            /* Footer */
            footer {
                padding: 24px 16px;
            }

            .social-links {
                flex-direction: column;
                gap: 12px;
                width: 100%;
                max-width: 280px;
            }

            .social-links a {
                width: 100%;
                text-align: center;
                padding: 14px 20px;
            }

            /* Modals */
            .modal-content {
                padding: 20px 16px;
                max-height: 85vh;
                margin: 10px;
            }

            .modal-title {
                font-size: 0.85rem;
                margin-bottom: 20px;
            }

            .character-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .char-card {
                padding: 14px 10px;
            }

            .char-card img {
                width: 70px;
                height: 70px;
            }

            .char-card .name {
                font-size: 0.55rem;
            }

            .char-card .type-badge {
                font-size: 0.5rem;
                padding: 2px 8px;
            }

            .char-card .role {
                font-size: 0.55rem;
            }

            .char-card .description {
                font-size: 0.55rem;
                min-height: 28px;
                margin-bottom: 8px;
            }

            .char-card .stats {
                gap: 4px;
            }

            .char-card .stat {
                padding: 3px 5px;
                font-size: 0.5rem;
            }

            .modal-actions {
                flex-direction: column;
                gap: 10px;
            }

            .modal-actions .btn {
                width: 100%;
            }

            /* Wallet Modal */
            .wallet-modal-content {
                padding: 24px 20px;
                margin: 16px;
            }

            .wallet-modal-title {
                font-size: 0.75rem;
            }

            .wallet-option {
                padding: 12px;
            }

            .wallet-option img {
                width: 32px;
                height: 32px;
            }

            .wallet-option-name {
                font-size: 0.9rem;
            }

            .wallet-option-desc {
                font-size: 0.7rem;
            }

            /* Battle result */
            .battle-result {
                padding: 24px 20px;
                width: 90%;
            }

            .result-title {
                font-size: 1.1rem;
            }

            .result-subtitle {
                font-size: 0.85rem;
            }

            /* Floating elements - reduce on mobile */
            .floating-pill {
                width: 35px;
                height: 35px;
            }

            .orb {
                filter: blur(60px);
                opacity: 0.3;
            }
        }

        /* Extra small phones */
        @media (max-width: 380px) {
            nav {
                padding: 10px 12px;
            }

            .logo-text {
                font-size: 0.6rem;
            }

            .logo-img {
                width: 38px;
                height: 38px;
            }

            .nav-links a {
                font-size: 1.1rem;
            }

            .hero-title {
                font-size: 1rem;
            }

            .hero-subtitle {
                font-size: 0.85rem;
            }

            .char-avatar {
                width: 50px;
                height: 50px;
            }

            .battle-arena {
                height: 320px;
            }

            .sprite-player-back {
                width: 160px;
                height: 160px;
                left: -10px;
                bottom: -20px;
            }

            .sprite-enemy {
                width: 100px;
                height: 100px;
                bottom: 60px;
            }

            .hp-box {
                min-width: 100px;
                padding: 6px 8px;
            }

            .hp-box .pokemon-name {
                font-size: 0.6rem;
            }

            .character-grid {
                grid-template-columns: 1fr;
                max-width: 200px;
                margin: 0 auto 20px;
            }

            .char-card img {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body>
    <!-- Pokemon Style Animated Background -->
    <div class="bg-animation">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="orb orb-4"></div>
        <div class="orb orb-5"></div>
        
        <div class="grid-pattern"></div>
        
        <div class="pixel-stars">
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star large"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star large"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star large"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
        </div>
        
        <div class="pokeball-particles">
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
        </div>
        
        <div class="sparkles">
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
        </div>
        
        <div class="type-symbols">
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
        </div>
        
        <div class="energy-wave"></div>
        <div class="crt-glow"></div>
        <div class="battle-border"></div>
    </div>
    
    <div class="scanlines"></div>

    <!-- Floating Character Pills -->
    <div class="floating-pills">
        <div class="floating-pill"><img src="assets/images/characters/pepe.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/whale.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/cow.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/moodeng.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/catana.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/pepe.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/whale.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/cow.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/moodeng.png" alt="" onerror="this.parentElement.style.display='none'"></div>
    </div>

    <!-- Navigation -->
    <nav>
        <div class="logo">
            <img src="assets/images/logo.png" alt="PumpFighters Logo" class="logo-img" onerror="this.style.display='none'">
            <span class="logo-text">PUMPFIGHTERS</span>
        </div>
        
        <!-- Hamburger Menu Button -->
        <button class="hamburger" id="hamburger" onclick="toggleMobileMenu()" aria-label="Menu">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
        
        <div class="nav-links" id="nav-links">
            <a href="#game">Play</a>
            <a href="#how">How It Works</a>
            <button class="music-btn" id="music-btn" onclick="toggleMusic()"></button>
            <button class="btn btn-wallet" id="wallet-btn" onclick="connectWallet()">
                <span id="wallet-text">Connect Wallet</span>
            </button>
            <a href="#" class="btn btn-primary">Buy $PUMP</a>
        </div>
    </nav>

    <!-- Hero -->
    <section class="hero">
        <div class="hero-badge">
             <span class="live">Live on Solana</span>
        </div>
        
        <h1 class="hero-title">
            Battle Memecoins.<br>
            <span class="highlight">Win $PUMP.</span>
        </h1>
        
        <p class="hero-subtitle">
            Choose your favorite memecoin character and battle in Pokemon-style combat. 
            Every victory earns you $PUMP tokens.
        </p>

        <div class="character-preview">
            <div class="char-avatar" onclick="selectAndPlay('pepe')">
                <img src="assets/images/characters/pepe.png" alt="PEPE">
            </div>
            <div class="char-avatar" onclick="selectAndPlay('whale')">
                <img src="assets/images/characters/whale.png" alt="WHALE">
            </div>
            <div class="char-avatar" onclick="selectAndPlay('cow')">
                <img src="assets/images/characters/cow.png" alt="COW">
            </div>
            <div class="char-avatar" onclick="selectAndPlay('moodeng')">
                <img src="assets/images/characters/moodeng.png" alt="MOODENG">
            </div>
            <div class="char-avatar" onclick="selectAndPlay('catana')">
                <img src="assets/images/characters/catana.png" alt="CATANA">
            </div>
        </div>

        <div class="cta-buttons">
            <button class="btn btn-secondary" onclick="scrollToGame()"> Quick Battle</button>
        </div>
        
        <div class="ca-container">
            <span class="ca-label">CA:</span>
            <span class="ca-address" id="ca-address">awdaXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span>
            <button class="ca-copy" onclick="copyCA()"></button>
        </div>
    </section>

    <!-- Game Section -->
    <div class="game-wrapper">
        <section class="game-section" id="game">
            <h2 class="section-title"> Battle <span class="highlight">Arena</span></h2>
            
            <div class="battle-arena" id="battle-arena">
                <div class="sun"></div>
                
                <div class="turn-indicator" id="turn-indicator">YOUR TURN</div>

                <div class="hp-box enemy">
                    <div class="hp-header">
                        <span class="pokemon-name" id="enemy-name">WHALE</span>
                        <span class="level">Lv<span id="enemy-level">48</span></span>
                    </div>
                    <div class="hp-bar-outer">
                        <div class="hp-bar-inner" id="enemy-hp-bar" style="width: 100%"></div>
                    </div>
                    <div class="status-container" id="enemy-status"></div>
                </div>

                <div class="hp-box player">
                    <div class="hp-header">
                        <span class="pokemon-name" id="player-name">PEPE</span>
                        <span class="level">Lv<span id="player-level">50</span></span>
                    </div>
                    <div class="hp-bar-outer">
                        <div class="hp-bar-inner" id="player-hp-bar" style="width: 100%"></div>
                    </div>
                    <div class="hp-text"><span id="player-hp">100</span>/<span id="player-max-hp">100</span></div>
                    <div class="status-container" id="player-status"></div>
                </div>

                <div class="sprite-player" id="player-sprite">
                    <img id="player-img" src="assets/images/characters/pepe.png" alt="Player">
                </div>

                <div class="sprite-player-back" id="player-sprite-back">
                    <img id="player-img-back" src="assets/images/characters/pepe-back.png" alt="Player Back">
                </div>

                <div class="sprite-enemy" id="enemy-sprite">
                    <img id="enemy-img" src="assets/images/characters/whale.png" alt="Enemy">
                </div>

                <div class="battle-intro" id="battle-intro">
                    <div class="intro-text" id="intro-text">A wild WHALE appeared!</div>
                </div>

                <div class="battle-result" id="battle-result">
                    <div class="result-title" id="result-title">VICTORY!</div>
                    <div class="result-subtitle" id="result-subtitle">You earned 500 $PUMP!</div>
                    <button class="btn btn-primary" onclick="resetBattle()">Battle Again</button>
                </div>
            </div>

            <div class="battle-menu">
                <div class="battle-log" id="battle-log">
                    <div class="log-entry system">Choose a move to attack!</div>
                </div>
                <div class="move-grid" id="move-grid">
                    <!-- Moves will be inserted here -->
                </div>
            </div>
        </section>
    </div>

    <!-- How It Works -->
    <section class="how-it-works" id="how">
        <div class="how-container">
            <h2 class="section-title">How It <span class="highlight">Works</span></h2>
            
            <div class="steps">
                <div class="step">
                    <span class="step-icon"></span>
                    <h3 class="step-title">1. Choose Your Fighter</h3>
                    <p class="step-desc">Pick from 6 iconic memecoin characters, each with unique stats and moves.</p>
                </div>
                <div class="step">
                    <span class="step-icon"></span>
                    <h3 class="step-title">2. Battle Opponents</h3>
                    <p class="step-desc">Fight in turn-based Pokemon-style combat. Use strategy to defeat enemies.</p>
                </div>
                <div class="step">
                    <span class="step-icon"></span>
                    <h3 class="step-title">3. Earn $PUMP</h3>
                    <p class="step-desc">Win battles to earn $PUMP tokens. The more you win, the more you earn.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="social-links">
                <a href="https://twitter.com/yourusername" target="_blank"> Twitter</a>
                <a href="https://yourdocslink.com" target="_blank"> GitHub</a>
            </div>
        </div>
    </footer>

    <!-- Character Selection Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 class="modal-title">Choose Your Fighter</h3>
            <div class="character-grid" id="char-grid">
                <!-- Characters will be inserted here -->
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmSelection()"> Fight!</button>
            </div>
        </div>
    </div>

    <!-- Wallet Connection Modal -->
    <div class="wallet-modal" id="wallet-modal">
        <div class="wallet-modal-content">
            <h3 class="wallet-modal-title">Connect Wallet</h3>
            <div class="wallet-list" id="wallet-list">
                <!-- Wallet options will be inserted here -->
            </div>
            <button class="wallet-modal-close" onclick="closeWalletModal()">Cancel</button>
        </div>
    </div>

    <script>
        /* ================================
           MOBILE MENU
           ================================ */
        function toggleMobileMenu() {
            const hamburger = document.getElementById('hamburger');
            const navLinks = document.getElementById('nav-links');
            
            hamburger.classList.toggle('active');
            navLinks.classList.toggle('active');
            document.body.style.overflow = navLinks.classList.contains('active') ? 'hidden' : '';
        }

        // Close menu when clicking links
        document.querySelectorAll('.nav-links a, .nav-links .btn').forEach(el => {
            el.addEventListener('click', () => {
                document.getElementById('hamburger').classList.remove('active');
                document.getElementById('nav-links').classList.remove('active');
                document.body.style.overflow = '';
            });
        });

        // Auto-close on resize to desktop
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                document.getElementById('hamburger').classList.remove('active');
                document.getElementById('nav-links').classList.remove('active');
                document.body.style.overflow = '';
            }
        });

        /* ================================
           WALLET SYSTEM
           ================================ */
        const WalletSystem = {
            connected: false,
            address: null,
            balance: 0,
            provider: null,
            
            wallets: [
                {
                    name: 'Phantom',
                    icon: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiBmaWxsPSJub25lIj48cmVjdCB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgcng9IjI2IiBmaWxsPSIjQUIwNUY3Ii8+PHBhdGggZD0iTTExMC40NCA2NC43MkgxMDguNUM5NS4wMiA2NC43MiA4NC4xMiA3NS42MiA4NC4xMiA4OS4xYzAgMTAuNjMgNi42NCAxMy4zNiAxMC45IDEzLjM2IDQuNTMgMCA3LjEtMy41NiA3LjEtOC4wOGE4LjA4IDguMDggMCAwIDEgOC4zMi04Ljk2di0yMC43eiIgZmlsbD0idXJsKCNhKSIvPjxwYXRoIGQ9Ik0xMTAuNDQgNjQuNzJIMTA4LjVDOTUuMDIgNjQuNzIgODQuMTIgNzUuNjIgODQuMTIgODkuMWMwIDEwLjYzIDYuNjQgMTMuMzYgMTAuOSAxMy4zNiA0LjUzIDAgNy4xLTMuNTYgNy4xLTguMDhhOC4wOCA4LjA4IDAgMCAxIDguMzItOC45NnYtMjAuN3oiIGZpbGw9InVybCgjYikiIGZpbGwtb3BhY2l0eT0iLjIiLz48cGF0aCBkPSJNOTMuNTIgOTMuNmMtMy4yIDAtNS44LTEuNjQtNS44LTUuODhzNS44LTExLjQgMTIuNi0xMS40IDcuOTIgNS42NCA3LjkyIDExLjI4YzAgNi44LTQuMiAxMS40LTguNzIgMTEuNGE2IDYgMCAwIDEtNi01LjR6IiBmaWxsPSIjZmZmIi8+PHBhdGggZD0iTTM5LjQ4IDU4LjgyYy0uOTYgMy42IDEuMTIgNy4xNiA0LjY0IDcuOTJsNzEuMDQgMTUuMzZjMy42Ljc2IDcuMi0xLjU2IDcuOTYtNS4xNmwuNzYtMy41NmMuOC0zLjY0LTEuNDgtNy4yNC01LjA4LTcuOTZsLTY4LjA0LTEzYy0zLjYtLjY4LTcuMiAxLjY0LTcuOTYgNS4yNGwtMy4zMiAxLjE2eiIgZmlsbD0iI2ZmZiIvPjxwYXRoIGQ9Ik0xOS41MiA5My42aC0xLjk2Yy0xMy40OCAwLTI0LjM4IDEwLjktMjQuMzggMjQuMzggMCAxMC42MyA2LjY0IDEzLjM2IDEwLjkgMTMuMzYgNC41MyAwIDcuMS0zLjU2IDcuMS04LjA4YTguMDggOC4wOCAwIDAgMSA4LjM0LTguOTZ2LTIwLjd6IiBmaWxsPSJ1cmwoI2MpIi8+PHBhdGggZD0iTTE5LjUyIDkzLjZoLTEuOTZjLTEzLjQ4IDAtMjQuMzggMTAuOS0yNC4zOCAyNC4zOCAwIDEwLjYzIDYuNjQgMTMuMzYgMTAuOSAxMy4zNiA0LjUzIDAgNy4xLTMuNTYgNy4xLTguMDhhOC4wOCA4LjA4IDAgMCAxIDguMzQtOC45NnYtMjAuN3oiIGZpbGw9InVybCgjZCkiIGZpbGwtb3BhY2l0eT0iLjIiLz48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIxMDUuMDYiIHkxPSI2NC43MiIgeDI9IjEwNS4wNiIgeTI9IjEwMi40NiIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPjxzdG9wIHN0b3AtY29sb3I9IiNmZmYiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNmZmYiIHN0b3Atb3BhY2l0eT0iMCIvPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJiIiB4MT0iOTEuMTgiIHkxPSI2NC43MiIgeDI9IjkxLjE4IiB5Mj0iMTAyLjQ2IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHN0b3Agc3RvcC1jb2xvcj0iI2ZmZiIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI2ZmZiIgc3RvcC1vcGFjaXR5PSIwIi8+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImMiIHgxPSIxNC4xNCIgeTE9IjkzLjYiIHgyPSIxNC4xNCIgeTI9IjEzMS4zNCIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPjxzdG9wIHN0b3AtY29sb3I9IiNmZmYiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNmZmYiIHN0b3Atb3BhY2l0eT0iMCIvPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJkIiB4MT0iLjI2IiB5MT0iOTMuNiIgeDI9Ii4yNiIgeTI9IjEzMS4zNCIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPjxzdG9wIHN0b3AtY29sb3I9IiNmZmYiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNmZmYiIHN0b3Atb3BhY2l0eT0iMCIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjwvc3ZnPg==',
                    getProvider: () => window.phantom?.solana,
                    downloadUrl: 'https://phantom.app/'
                },
            ],
            
            init() {
                const savedAddress = localStorage.getItem('walletAddress');
                if (savedAddress) {
                    this.checkExistingConnection();
                }
            },
            
            async checkExistingConnection() {
                for (const wallet of this.wallets) {
                    const provider = wallet.getProvider();
                    if (provider?.isConnected) {
                        try {
                            const resp = await provider.connect({ onlyIfTrusted: true });
                            this.handleConnection(resp.publicKey.toString(), provider, wallet.name);
                            return;
                        } catch (e) {}
                    }
                }
            },
            
            openModal() {
                const modal = document.getElementById('wallet-modal');
                const list = document.getElementById('wallet-list');
                
                list.innerHTML = this.wallets.map(wallet => {
                    const provider = wallet.getProvider();
                    const isInstalled = !!provider;
                    
                    return `
                        <div class="wallet-option" onclick="WalletSystem.connectTo('${wallet.name}')">
                            <img src="${wallet.icon}" alt="${wallet.name}">
                            <div class="wallet-option-info">
                                <div class="wallet-option-name">${wallet.name}</div>
                                <div class="wallet-option-desc">${isInstalled ? 'Click to connect' : 'Not installed'}</div>
                            </div>
                            <span class="wallet-option-status ${isInstalled ? '' : 'not-installed'}">
                                ${isInstalled ? 'Detected' : 'Install'}
                            </span>
                        </div>
                    `;
                }).join('');
                
                modal.classList.add('show');
            },
            
            closeModal() {
                document.getElementById('wallet-modal').classList.remove('show');
            },
            
            async connectTo(walletName) {
                const wallet = this.wallets.find(w => w.name === walletName);
                if (!wallet) return;
                
                const provider = wallet.getProvider();
                
                if (!provider) {
                    window.open(wallet.downloadUrl, '_blank');
                    return;
                }
                
                try {
                    const resp = await provider.connect();
                    this.handleConnection(resp.publicKey.toString(), provider, walletName);
                    this.closeModal();
                } catch (err) {
                    console.error('Connection failed:', err);
                    alert('Failed to connect wallet. Please try again.');
                }
            },
            
            handleConnection(address, provider, walletName) {
                this.connected = true;
                this.address = address;
                this.provider = provider;
                
                localStorage.setItem('walletAddress', address);
                localStorage.setItem('walletName', walletName);
                
                this.updateUI();
                this.getBalance();
                
                provider.on('disconnect', () => this.disconnect());
                provider.on('accountChanged', (publicKey) => {
                    if (publicKey) {
                        this.address = publicKey.toString();
                        this.updateUI();
                        this.getBalance();
                    } else {
                        this.disconnect();
                    }
                });
            },
            
            async getBalance() {
                if (!this.address) return;
                
                try {
                    const response = await fetch('https://api.mainnet-beta.solana.com', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            jsonrpc: '2.0',
                            id: 1,
                            method: 'getBalance',
                            params: [this.address]
                        })
                    });
                    
                    const data = await response.json();
                    if (data.result?.value !== undefined) {
                        this.balance = (data.result.value / 1e9).toFixed(4);
                        this.updateUI();
                    }
                } catch (e) {
                    console.log('Failed to get balance:', e);
                }
            },
            
            updateUI() {
                const btn = document.getElementById('wallet-btn');
                const text = document.getElementById('wallet-text');
                
                if (this.connected && this.address) {
                    const shortAddress = this.address.slice(0, 4) + '...' + this.address.slice(-4);
                    text.innerHTML = `
                        <span class="wallet-address">${shortAddress}</span>
                        ${this.balance ? `<span class="wallet-balance">${this.balance} SOL</span>` : ''}
                    `;
                    btn.classList.add('connected');
                    btn.onclick = () => this.showDisconnectOption();
                } else {
                    text.textContent = 'Connect Wallet';
                    btn.classList.remove('connected');
                    btn.onclick = () => connectWallet();
                }
            },
            
            showDisconnectOption() {
                if (confirm('Disconnect wallet?')) {
                    this.disconnect();
                }
            },
            
            disconnect() {
                if (this.provider?.disconnect) {
                    this.provider.disconnect();
                }
                
                this.connected = false;
                this.address = null;
                this.balance = 0;
                this.provider = null;
                
                localStorage.removeItem('walletAddress');
                localStorage.removeItem('walletName');
                
                this.updateUI();
            }
        };

        function connectWallet() {
            if (WalletSystem.connected) {
                WalletSystem.showDisconnectOption();
            } else {
                WalletSystem.openModal();
            }
        }
        
        function copyCA() {
            const ca = document.getElementById('ca-address').textContent;
            navigator.clipboard.writeText(ca);
            
            const btn = document.querySelector('.ca-copy');
            btn.textContent = '';
            setTimeout(() => btn.textContent = '', 1500);
        }

        function closeWalletModal() {
            WalletSystem.closeModal();
        }

        /* ================================
           AUDIO SYSTEM
           ================================ */
        const AudioSystem = {
            music: null,
            battleMusic: null,
            isMusicPlaying: false,
            currentTrack: 'main',
            
            init() {
                this.music = new Audio('assets/audio/main-theme.mp3');
                this.battleMusic = new Audio('assets/audio/battle-theme.mp3');
                this.music.loop = true;
                this.battleMusic.loop = true;
                this.music.volume = 0.4;
                this.battleMusic.volume = 0.5;
            },
            
            toggleMusic() {
                if (this.isMusicPlaying) {
                    this.stopMusic();
                } else {
                    this.playMusic();
                }
            },
            
            playMusic() {
                const track = this.currentTrack === 'battle' ? this.battleMusic : this.music;
                track.play().then(() => {
                    this.isMusicPlaying = true;
                    document.getElementById('music-btn').classList.add('playing');
                    document.getElementById('music-btn').textContent = '';
                }).catch(e => console.log('Audio play failed:', e));
            },
            
            stopMusic() {
                this.music.pause();
                this.battleMusic.pause();
                this.isMusicPlaying = false;
                document.getElementById('music-btn').classList.remove('playing');
                document.getElementById('music-btn').textContent = '';
            },
            
            switchTrack(track) {
                if (this.currentTrack === track) return;
                
                const wasPlaying = this.isMusicPlaying;
                this.music.pause();
                this.battleMusic.pause();
                this.music.currentTime = 0;
                this.battleMusic.currentTime = 0;
                this.currentTrack = track;
                
                if (wasPlaying) {
                    this.playMusic();
                }
            },
            
            playSound(type) {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                switch(type) {
                    case 'hit':
                        oscillator.frequency.setValueAtTime(200, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.1);
                        gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.1);
                        break;
                        
                    case 'critical':
                        oscillator.frequency.setValueAtTime(400, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.1);
                        oscillator.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.2);
                        gainNode.gain.setValueAtTime(0.4, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.2);
                        break;
                        
                    case 'victory':
                        const notes = [523, 659, 784, 1047];
                        notes.forEach((freq, i) => {
                            const osc = ctx.createOscillator();
                            const gain = ctx.createGain();
                            osc.connect(gain);
                            gain.connect(ctx.destination);
                            osc.frequency.value = freq;
                            gain.gain.setValueAtTime(0.2, ctx.currentTime + i * 0.15);
                            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.15 + 0.3);
                            osc.start(ctx.currentTime + i * 0.15);
                            osc.stop(ctx.currentTime + i * 0.15 + 0.3);
                        });
                        break;
                        
                    case 'defeat':
                        oscillator.frequency.setValueAtTime(300, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.5);
                        gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.5);
                        break;
                        
                    case 'select':
                        oscillator.frequency.setValueAtTime(600, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.05);
                        gainNode.gain.setValueAtTime(0.15, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.05);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.05);
                        break;
                        
                    case 'heal':
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(400, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.2);
                        gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.3);
                        break;
                }
            }
        };

        function toggleMusic() {
            AudioSystem.toggleMusic();
        }

        /* ================================
           GAME DATA
           ================================ */
        const TYPE_CHART = {
            water: { fire: 2, water: 0.5, grass: 0.5, electric: 1, normal: 1, psychic: 1, dark: 1 },
            fire: { water: 0.5, fire: 0.5, grass: 2, electric: 1, normal: 1, psychic: 1, dark: 1 },
            grass: { water: 2, fire: 0.5, grass: 0.5, electric: 1, normal: 1, psychic: 1, dark: 1 },
            electric: { water: 2, fire: 1, grass: 0.5, electric: 0.5, normal: 1, psychic: 1, dark: 1 },
            normal: { water: 1, fire: 1, grass: 1, electric: 1, normal: 1, psychic: 1, dark: 1 },
            psychic: { water: 1, fire: 1, grass: 1, electric: 1, normal: 1, psychic: 0.5, dark: 0 },
            dark: { water: 1, fire: 1, grass: 1, electric: 1, normal: 1, psychic: 2, dark: 0.5 }
        };

        const CHARACTERS = {
            pepe: { 
                name: 'PEPE', 
                image: 'pepe.png', 
                hp: 100, 
                attack: 35, 
                defense: 30, 
                speed: 40, 
                type: 'water',
                description: 'The OG memecoin legend. Balanced stats with healing powers.',
                role: 'Balanced'
            },
            whale: { 
                name: 'WHALE', 
                image: 'whale.png', 
                hp: 130, 
                attack: 28, 
                defense: 50, 
                speed: 20, 
                type: 'water',
                description: 'Massive HP pool and crushing defense. Slow but unstoppable.',
                role: 'Tank'
            },
            cow: { 
                name: 'COW', 
                image: 'cow.png', 
                hp: 115, 
                attack: 32, 
                defense: 40, 
                speed: 30, 
                type: 'normal',
                description: 'Sacred bovine with earthquake powers. Well-rounded bruiser.',
                role: 'Bruiser'
            },
            moodeng: { 
                name: 'MOODENG', 
                image: 'moodeng.png', 
                hp: 95, 
                attack: 42, 
                defense: 28, 
                speed: 45, 
                type: 'psychic',
                description: 'Viral hippo with psychic chomps. High attack potential.',
                role: 'Attacker'
            },
            catana: { 
                name: 'CATANA', 
                image: 'catana.png', 
                hp: 82, 
                attack: 48, 
                defense: 22, 
                speed: 58, 
                type: 'dark',
                description: 'Ninja cat assassin. Glass cannon with critical hits.',
                role: 'Assassin'
            }
        };

        const MOVES = {
            pepe: [
                { name: 'WATER GUN', type: 'water', power: 40, accuracy: 100, pp: 25 },
                { name: 'BUBBLE BEAM', type: 'water', power: 65, accuracy: 100, pp: 15, effect: 'speed-down', effectChance: 10 },
                { name: 'MEME MAGIC', type: 'psychic', power: 50, accuracy: 100, pp: 15, effect: 'confuse', effectChance: 10 },
                { name: 'RECOVER', type: 'normal', power: 0, accuracy: 100, pp: 10, heal: 50 }
            ],
            whale: [
                { name: 'SURF', type: 'water', power: 90, accuracy: 100, pp: 15 },
                { name: 'BODY SLAM', type: 'normal', power: 85, accuracy: 100, pp: 15, effect: 'paralyze', effectChance: 30 },
                { name: 'MARKET CRASH', type: 'dark', power: 120, accuracy: 85, pp: 5 },
                { name: 'REST', type: 'normal', power: 0, accuracy: 100, pp: 10, heal: 100, selfSleep: true }
            ],
            cow: [
                { name: 'STOMP', type: 'normal', power: 65, accuracy: 100, pp: 20, effect: 'flinch', effectChance: 30 },
                { name: 'EARTHQUAKE', type: 'normal', power: 100, accuracy: 100, pp: 10 },
                { name: 'MILK DRINK', type: 'normal', power: 0, accuracy: 100, pp: 10, heal: 50 },
                { name: 'ZEN HEADBUTT', type: 'psychic', power: 80, accuracy: 90, pp: 15, effect: 'flinch', effectChance: 20 }
            ],
            moodeng: [
                { name: 'PSYCHIC', type: 'psychic', power: 90, accuracy: 100, pp: 10, effect: 'spdef-down', effectChance: 10 },
                { name: 'CRUNCH', type: 'dark', power: 80, accuracy: 100, pp: 15, effect: 'def-down', effectChance: 20 },
                { name: 'HIPPO CHOMP', type: 'dark', power: 60, accuracy: 100, pp: 25 },
                { name: 'CALM MIND', type: 'psychic', power: 0, accuracy: 100, pp: 20, boost: { attack: 1 } }
            ],
            catana: [
                { name: 'NIGHT SLASH', type: 'dark', power: 70, accuracy: 100, pp: 15, highCrit: true },
                { name: 'SUCKER PUNCH', type: 'dark', power: 70, accuracy: 100, pp: 5, priority: true },
                { name: 'SLASH', type: 'normal', power: 70, accuracy: 100, pp: 20, highCrit: true },
                { name: 'SWORDS DANCE', type: 'normal', power: 0, accuracy: 100, pp: 20, boost: { attack: 2 } }
            ]
        };

        /* ================================
           GAME STATE
           ================================ */
        let gameState = {
            playerKey: 'pepe',
            enemyKey: 'whale',
            playerHP: 100,
            playerMaxHP: 100,
            enemyHP: 130,
            enemyMaxHP: 130,
            playerLevel: 50,
            enemyLevel: 48,
            isPlayerTurn: true,
            selectedChar: 'pepe',
            moves: [],
            playerStatus: null,
            enemyStatus: null,
            playerShiny: false,
            enemyShiny: false,
            playerBoosts: { attack: 0, defense: 0, speed: 0 },
            enemyBoosts: { attack: 0, defense: 0, speed: 0 },
            turnCount: 0
        };

        /* ================================
           GAME FUNCTIONS
           ================================ */
        function checkBattleBackground() {
            const arena = document.getElementById('battle-arena');
            const bgImage = new Image();
            bgImage.src = 'assets/images/battle-bg.png';
            
            bgImage.onload = () => arena.classList.remove('no-bg');
            bgImage.onerror = () => arena.classList.add('no-bg');
            
            setTimeout(() => {
                if (!bgImage.complete || bgImage.naturalWidth === 0) {
                    arena.classList.add('no-bg');
                }
            }, 1000);
        }

        function init() {
            checkBattleBackground();
            renderCharacterGrid();
            initBattle();
        }

        function renderCharacterGrid() {
            const grid = document.getElementById('char-grid');
            grid.innerHTML = '';
            
            Object.entries(CHARACTERS).forEach(([key, char]) => {
                const card = document.createElement('div');
                card.className = `char-card ${key === gameState.selectedChar ? 'selected' : ''}`;
                card.onclick = () => selectChar(key);
                
                const getStatClass = (value, stat) => {
                    if (stat === 'hp') return value >= 110 ? 'high' : value >= 95 ? 'medium' : 'low';
                    if (stat === 'attack') return value >= 42 ? 'high' : value >= 32 ? 'medium' : 'low';
                    if (stat === 'defense') return value >= 40 ? 'high' : value >= 28 ? 'medium' : 'low';
                    if (stat === 'speed') return value >= 45 ? 'high' : value >= 30 ? 'medium' : 'low';
                    return '';
                };
                
                card.innerHTML = `
                    <img src="assets/images/characters/${char.image}" alt="${char.name}">
                    <div class="name">${char.name}</div>
                    <span class="type-badge ${char.type}">${char.type}</span>
                    <div class="role"> ${char.role}</div>
                    <div class="description">${char.description}</div>
                    <div class="stats">
                        <div class="stat">
                            <span class="stat-label">HP</span>
                            <span class="stat-value ${getStatClass(char.hp, 'hp')}">${char.hp}</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">ATK</span>
                            <span class="stat-value ${getStatClass(char.attack, 'attack')}">${char.attack}</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">DEF</span>
                            <span class="stat-value ${getStatClass(char.defense, 'defense')}">${char.defense}</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">SPD</span>
                            <span class="stat-value ${getStatClass(char.speed, 'speed')}">${char.speed}</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function selectChar(key) {
            gameState.selectedChar = key;
            AudioSystem.playSound('select');
            document.querySelectorAll('.char-card').forEach(c => c.classList.remove('selected'));
            document.querySelector(`.char-card:nth-child(${Object.keys(CHARACTERS).indexOf(key) + 1})`).classList.add('selected');
        }

        function selectAndPlay(key) {
            gameState.selectedChar = key;
            gameState.playerKey = key;
            AudioSystem.playSound('select');
            initBattle();
            scrollToGame();
        }

        function initBattle() {
            const playerKey = gameState.playerKey;
            const player = CHARACTERS[playerKey];
            
            const enemyKeys = Object.keys(CHARACTERS).filter(k => k !== playerKey);
            const enemyKey = enemyKeys[Math.floor(Math.random() * enemyKeys.length)];
            const enemy = CHARACTERS[enemyKey];
            
            gameState.enemyKey = enemyKey;
            gameState.playerHP = player.hp;
            gameState.playerMaxHP = player.hp;
            gameState.enemyHP = enemy.hp;
            gameState.enemyMaxHP = enemy.hp;
            gameState.playerLevel = 50;
            gameState.enemyLevel = 45 + Math.floor(Math.random() * 10);
            gameState.moves = MOVES[playerKey].map(m => ({...m, currentPP: m.pp}));
            
            gameState.playerStatus = null;
            gameState.enemyStatus = null;
            gameState.playerBoosts = { attack: 0, defense: 0, speed: 0 };
            gameState.enemyBoosts = { attack: 0, defense: 0, speed: 0 };
            gameState.turnCount = 0;
            
            gameState.playerShiny = Math.random() < 0.05;
            gameState.enemyShiny = Math.random() < 0.05;
            
            gameState.isPlayerTurn = player.speed >= enemy.speed;
            
            document.getElementById('player-name').textContent = player.name + (gameState.playerShiny ? ' ' : '');
            document.getElementById('enemy-name').textContent = enemy.name + (gameState.enemyShiny ? ' ' : '');
            document.getElementById('player-hp').textContent = player.hp;
            document.getElementById('player-max-hp').textContent = player.hp;
            document.getElementById('player-level').textContent = gameState.playerLevel;
            document.getElementById('enemy-level').textContent = gameState.enemyLevel;
            
            document.getElementById('player-img').src = `assets/images/characters/${player.image}`;
            document.getElementById('enemy-img').src = `assets/images/characters/${enemy.image}`;
            
            const backImageName = player.image.replace('.png', '-back.png');
            document.getElementById('player-img-back').src = `assets/images/characters/${backImageName}`;
            document.getElementById('player-img-back').onerror = function() {
                this.src = `assets/images/characters/${player.image}`;
            };
            
            const playerSprite = document.getElementById('player-sprite');
            const playerSpriteBack = document.getElementById('player-sprite-back');
            const enemySprite = document.getElementById('enemy-sprite');
            playerSprite.classList.toggle('shiny', gameState.playerShiny);
            playerSpriteBack.classList.toggle('shiny', gameState.playerShiny);
            enemySprite.classList.toggle('shiny', gameState.enemyShiny);
            
            playerSprite.style.opacity = '1';
            playerSprite.style.transform = '';
            playerSpriteBack.style.opacity = '1';
            playerSpriteBack.style.transform = '';
            enemySprite.style.opacity = '1';
            enemySprite.style.transform = '';
            
            updateHPBars();
            updateStatusDisplay();
            updateTurnIndicator();
            renderMoves();
            clearLog();
            
            showBattleIntro(enemy);
            
            const battleResult = document.getElementById('battle-result');
            battleResult.style.display = 'none';
            battleResult.classList.remove('show');
        }
        
        function showBattleIntro(enemy) {
            const intro = document.getElementById('battle-intro');
            const text = document.getElementById('intro-text');
            
            intro.classList.remove('hide');
            intro.style.animation = 'none';
            intro.offsetHeight;
            intro.style.animation = 'introFade 2.5s ease-out forwards';
            
            const shinyText = gameState.enemyShiny ? '<span class="shiny-name"> SHINY ' + enemy.name + ' </span>' : enemy.name;
            text.innerHTML = `A wild ${shinyText} appeared!`;
            
            setTimeout(() => {
                intro.classList.add('hide');
                addLog(`A wild ${enemy.name} appeared!`, 'system');
                if (gameState.enemyShiny) addLog(`It's shiny! `, 'info');
                addLog(`Go! ${CHARACTERS[gameState.playerKey].name}!`, 'system');
                if (gameState.playerShiny) addLog(`Your ${CHARACTERS[gameState.playerKey].name} is shiny! `, 'info');
                
                if (!gameState.isPlayerTurn) {
                    addLog(`${enemy.name} is faster!`, 'enemy');
                    setTimeout(() => enemyTurn(), 1000);
                }
            }, 2500);
        }
        
        function updateTurnIndicator() {
            const indicator = document.getElementById('turn-indicator');
            indicator.textContent = gameState.isPlayerTurn ? 'YOUR TURN' : 'ENEMY TURN';
            indicator.className = 'turn-indicator' + (gameState.isPlayerTurn ? '' : ' enemy');
        }
        
        function updateStatusDisplay() {
            const playerStatus = document.getElementById('player-status');
            const enemyStatus = document.getElementById('enemy-status');
            
            const statusNames = { par: 'PAR', brn: 'BRN', psn: 'PSN', slp: 'SLP', frz: 'FRZ' };
            
            playerStatus.innerHTML = gameState.playerStatus 
                ? `<span class="status-badge status-${gameState.playerStatus}">${statusNames[gameState.playerStatus]}</span>` 
                : '';
            enemyStatus.innerHTML = gameState.enemyStatus 
                ? `<span class="status-badge status-${gameState.enemyStatus}">${statusNames[gameState.enemyStatus]}</span>` 
                : '';
        }

        function renderMoves() {
            const grid = document.getElementById('move-grid');
            grid.innerHTML = '';
            
            const typeColors = {
                water: '#3b82f6',
                electric: '#fbbf24',
                fire: '#ef4444',
                normal: '#a3a3a3',
                dark: '#374151',
                psychic: '#ec4899',
                grass: '#22c55e'
            };
            
            gameState.moves.forEach((move, i) => {
                const btn = document.createElement('button');
                btn.className = 'move-btn';
                btn.disabled = !gameState.isPlayerTurn || move.currentPP <= 0;
                btn.onclick = () => useMove(i);
                
                const typeColor = typeColors[move.type] || '#a3a3a3';
                const textColor = move.type === 'electric' ? '#000' : '#fff';
                
                btn.innerHTML = `
                    <div style="font-weight: 600; font-size: 0.8rem; margin-bottom: 6px; color: #fff;">${move.name}</div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.6rem; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; font-weight: 600; background: ${typeColor}; color: ${textColor};">${move.type.toUpperCase()}</span>
                        <span style="font-size: 0.7rem; color: #888;">PP ${move.currentPP}/${move.pp}</span>
                    </div>
                `;
                grid.appendChild(btn);
            });
        }

        function useMove(index) {
            if (!gameState.isPlayerTurn) return;
            
            const move = gameState.moves[index];
            if (move.currentPP <= 0) return;
            
            move.currentPP--;
            gameState.isPlayerTurn = false;
            updateTurnIndicator();
            AudioSystem.playSound('select');
            
            const player = CHARACTERS[gameState.playerKey];
            const enemy = CHARACTERS[gameState.enemyKey];
            
            if (gameState.playerStatus === 'par' && Math.random() < 0.25) {
                addLog(`${player.name} is paralyzed! It can't move!`, 'info');
                setTimeout(() => enemyTurn(), 1000);
                return;
            }
            
            if (gameState.playerStatus === 'slp') {
                if (Math.random() < 0.33) {
                    gameState.playerStatus = null;
                    updateStatusDisplay();
                    addLog(`${player.name} woke up!`, 'info');
                } else {
                    addLog(`${player.name} is fast asleep!`, 'info');
                    setTimeout(() => enemyTurn(), 1000);
                    return;
                }
            }
            
            addLog(`${player.name} used ${move.name}!`);
            
            const playerSpriteBack = document.getElementById('player-sprite-back');
            playerSpriteBack.classList.add('attacking');
            setTimeout(() => playerSpriteBack.classList.remove('attacking'), 400);
            
            setTimeout(() => {
                if (move.accuracy && Math.random() * 100 > move.accuracy) {
                    addLog(`${player.name}'s attack missed!`, 'info');
                    AudioSystem.playSound('select');
                    showDamageNumber('MISS', 'enemy', true);
                    setTimeout(() => enemyTurn(), 1000);
                    return;
                }
                
                if (move.heal) {
                    const healAmount = Math.floor(gameState.playerMaxHP * (move.heal / 100));
                    gameState.playerHP = Math.min(gameState.playerMaxHP, gameState.playerHP + healAmount);
                    addLog(`${player.name} recovered ${healAmount} HP!`, 'info');
                    AudioSystem.playSound('heal');
                    showDamageNumber(`+${healAmount}`, 'player', false, true);
                    
                    if (move.selfSleep) {
                        gameState.playerStatus = 'slp';
                        updateStatusDisplay();
                        addLog(`${player.name} fell asleep!`, 'info');
                    }
                    
                    updateHPBars();
                    setTimeout(() => enemyTurn(), 1000);
                    return;
                }
                
                if (move.boost) {
                    Object.entries(move.boost).forEach(([stat, amount]) => {
                        gameState.playerBoosts[stat] = Math.min(6, gameState.playerBoosts[stat] + amount);
                        const sharpText = amount >= 2 ? ' sharply' : '';
                        addLog(`${player.name}'s ${stat} rose${sharpText}!`, 'info');
                    });
                    AudioSystem.playSound('heal');
                    setTimeout(() => enemyTurn(), 1000);
                    return;
                }
                
                const result = calculateDamage(move, player, enemy, true);
                gameState.enemyHP = Math.max(0, gameState.enemyHP - result.damage);
                
                showDamageNumber(result.damage, 'enemy', result.isCritical);
                
                if (result.effectiveness > 1) {
                    addLog("It's super effective!", 'info');
                    showEffectivenessPopup('super');
                    AudioSystem.playSound('critical');
                } else if (result.effectiveness < 1 && result.effectiveness > 0) {
                    addLog("It's not very effective...", 'info');
                    showEffectivenessPopup('not-very');
                } else if (result.effectiveness === 0) {
                    addLog(`It doesn't affect ${enemy.name}...`, 'info');
                    showEffectivenessPopup('immune');
                }
                
                if (result.isCritical) {
                    addLog(`Critical hit! Dealt ${result.damage} damage!`);
                    AudioSystem.playSound('critical');
                    screenShake();
                } else {
                    addLog(`Dealt ${result.damage} damage!`);
                    AudioSystem.playSound('hit');
                }
                
                if (move.effect && move.effectChance && Math.random() * 100 < move.effectChance) {
                    applyStatus('enemy', move.effect);
                }
                
                const enemySprite = document.getElementById('enemy-sprite');
                enemySprite.classList.add('damaged');
                setTimeout(() => enemySprite.classList.remove('damaged'), 400);
                
                updateHPBars();
                renderMoves();
                
                if (gameState.enemyHP <= 0) {
                    endBattle(true);
                } else {
                    setTimeout(enemyTurn, 1000);
                }
            }, 300);
        }

        function enemyTurn() {
            const enemy = CHARACTERS[gameState.enemyKey];
            const player = CHARACTERS[gameState.playerKey];
            const enemyMoves = MOVES[gameState.enemyKey];
            
            gameState.turnCount++;
            
            if (gameState.enemyStatus === 'brn' || gameState.enemyStatus === 'psn') {
                const statusDamage = Math.floor(gameState.enemyMaxHP / 16);
                gameState.enemyHP = Math.max(0, gameState.enemyHP - statusDamage);
                const statusName = gameState.enemyStatus === 'brn' ? 'burn' : 'poison';
                addLog(`${enemy.name} was hurt by ${statusName}!`, 'info');
                updateHPBars();
                
                if (gameState.enemyHP <= 0) {
                    endBattle(true);
                    return;
                }
            }
            
            if (gameState.enemyStatus === 'par' && Math.random() < 0.25) {
                addLog(`${enemy.name} is paralyzed! It can't move!`, 'enemy');
                endEnemyTurn();
                return;
            }
            
            if (gameState.enemyStatus === 'slp') {
                if (Math.random() < 0.33) {
                    gameState.enemyStatus = null;
                    updateStatusDisplay();
                    addLog(`${enemy.name} woke up!`, 'enemy');
                } else {
                    addLog(`${enemy.name} is fast asleep!`, 'enemy');
                    endEnemyTurn();
                    return;
                }
            }
            
            let move;
            if (gameState.playerHP < gameState.playerMaxHP * 0.3) {
                move = enemyMoves.reduce((best, m) => (m.power || 0) > (best.power || 0) ? m : best);
            } else {
                const superMoves = enemyMoves.filter(m => m.power && getTypeEffectiveness(m.type, player.type) > 1);
                if (superMoves.length > 0 && Math.random() < 0.7) {
                    move = superMoves[Math.floor(Math.random() * superMoves.length)];
                } else {
                    move = enemyMoves[Math.floor(Math.random() * enemyMoves.length)];
                }
            }
            
            addLog(`${enemy.name} used ${move.name}!`, 'enemy');
            
            const enemySprite = document.getElementById('enemy-sprite');
            enemySprite.classList.add('attacking');
            setTimeout(() => enemySprite.classList.remove('attacking'), 400);
            
            setTimeout(() => {
                if (move.accuracy && Math.random() * 100 > move.accuracy) {
                    addLog(`${enemy.name}'s attack missed!`, 'enemy');
                    showDamageNumber('MISS', 'player', true);
                    endEnemyTurn();
                    return;
                }
                
                if (move.heal) {
                    const healAmount = Math.floor(gameState.enemyMaxHP * (move.heal / 100));
                    gameState.enemyHP = Math.min(gameState.enemyMaxHP, gameState.enemyHP + healAmount);
                    addLog(`${enemy.name} recovered health!`, 'enemy');
                    AudioSystem.playSound('heal');
                    updateHPBars();
                    endEnemyTurn();
                    return;
                }
                
                if (move.boost) {
                    Object.entries(move.boost).forEach(([stat, amount]) => {
                        gameState.enemyBoosts[stat] = Math.min(6, gameState.enemyBoosts[stat] + amount);
                    });
                    addLog(`${enemy.name}'s stats rose!`, 'enemy');
                    endEnemyTurn();
                    return;
                }
                
                const result = calculateDamage(move, enemy, player, false);
                gameState.playerHP = Math.max(0, gameState.playerHP - result.damage);
                
                showDamageNumber(result.damage, 'player', result.isCritical);
                
                if (result.effectiveness > 1) {
                    addLog("It's super effective!", 'enemy');
                } else if (result.effectiveness < 1 && result.effectiveness > 0) {
                    addLog("It's not very effective...", 'enemy');
                }
                
                if (result.isCritical) {
                    addLog(`Critical hit! Took ${result.damage} damage!`, 'enemy');
                    AudioSystem.playSound('critical');
                    screenShake();
                } else {
                    addLog(`Took ${result.damage} damage!`, 'enemy');
                    AudioSystem.playSound('hit');
                }
                
                if (move.effect && move.effectChance && Math.random() * 100 < move.effectChance) {
                    applyStatus('player', move.effect);
                }
                
                const playerSpriteBack = document.getElementById('player-sprite-back');
                playerSpriteBack.classList.add('damaged');
                setTimeout(() => playerSpriteBack.classList.remove('damaged'), 400);
                
                updateHPBars();
                
                if (gameState.playerHP <= 0) {
                    endBattle(false);
                } else {
                    endEnemyTurn();
                }
            }, 300);
        }
        
        function endEnemyTurn() {
            if (gameState.playerStatus === 'brn' || gameState.playerStatus === 'psn') {
                const statusDamage = Math.floor(gameState.playerMaxHP / 16);
                gameState.playerHP = Math.max(0, gameState.playerHP - statusDamage);
                const statusName = gameState.playerStatus === 'brn' ? 'burn' : 'poison';
                addLog(`${CHARACTERS[gameState.playerKey].name} was hurt by ${statusName}!`, 'info');
                updateHPBars();
                
                if (gameState.playerHP <= 0) {
                    endBattle(false);
                    return;
                }
            }
            
            gameState.isPlayerTurn = true;
            updateTurnIndicator();
            renderMoves();
        }
        
        function getTypeEffectiveness(moveType, defenderType) {
            if (TYPE_CHART[moveType] && TYPE_CHART[moveType][defenderType] !== undefined) {
                return TYPE_CHART[moveType][defenderType];
            }
            return 1;
        }
        
        function applyStatus(target, status) {
            if (status === 'paralyze') status = 'par';
            
            if (target === 'player' && !gameState.playerStatus) {
                gameState.playerStatus = status;
                const statusNames = { par: 'paralyzed', brn: 'burned', psn: 'poisoned', slp: 'fell asleep' };
                addLog(`${CHARACTERS[gameState.playerKey].name} was ${statusNames[status]}!`, 'info');
                AudioSystem.playSound('select');
            } else if (target === 'enemy' && !gameState.enemyStatus) {
                gameState.enemyStatus = status;
                const statusNames = { par: 'paralyzed', brn: 'burned', psn: 'poisoned', slp: 'fell asleep' };
                addLog(`${CHARACTERS[gameState.enemyKey].name} was ${statusNames[status]}!`, 'info');
                AudioSystem.playSound('select');
            }
            updateStatusDisplay();
        }

        function calculateDamage(move, attacker, defender, isPlayer) {
            const level = isPlayer ? gameState.playerLevel : gameState.enemyLevel;
            const attackBoost = isPlayer ? gameState.playerBoosts.attack : gameState.enemyBoosts.attack;
            const defenseBoost = isPlayer ? gameState.enemyBoosts.defense : gameState.playerBoosts.defense;
            
            const atkMultiplier = [0.25, 0.28, 0.33, 0.4, 0.5, 0.67, 1, 1.5, 2, 2.5, 3, 3.5, 4][attackBoost + 6];
            const defMultiplier = [0.25, 0.28, 0.33, 0.4, 0.5, 0.67, 1, 1.5, 2, 2.5, 3, 3.5, 4][defenseBoost + 6];
            
            const attack = attacker.attack * atkMultiplier;
            const defense = defender.defense * defMultiplier;
            
            let damage = Math.floor(((2 * level / 5 + 2) * move.power * attack / defense) / 50 + 2);
            
            if (move.type === attacker.type) {
                damage = Math.floor(damage * 1.5);
            }
            
            const effectiveness = getTypeEffectiveness(move.type, defender.type);
            damage = Math.floor(damage * effectiveness);
            
            const critChance = move.highCrit ? 0.25 : 0.0625;
            const isCritical = Math.random() < critChance;
            if (isCritical) {
                damage = Math.floor(damage * 1.5);
            }
            
            damage = Math.floor(damage * (0.85 + Math.random() * 0.15));
            
            const attackerStatus = isPlayer ? gameState.playerStatus : gameState.enemyStatus;
            if (attackerStatus === 'brn') {
                damage = Math.floor(damage * 0.5);
            }
            
            return { damage: Math.max(1, damage), isCritical, effectiveness };
        }
        
        function showDamageNumber(value, target, isCritical = false, isHeal = false) {
            const arena = document.getElementById('battle-arena');
            const num = document.createElement('div');
            num.className = 'damage-number' + (isCritical ? ' critical' : '') + (isHeal ? ' heal' : '') + (value === 'MISS' ? ' miss' : '');
            num.textContent = isHeal ? value : (value === 'MISS' ? 'MISS' : '-' + value);
            
            if (target === 'enemy') {
                num.style.right = '15%';
                num.style.top = '180px';
            } else {
                num.style.left = '15%';
                num.style.bottom = '200px';
            }
            
            arena.appendChild(num);
            setTimeout(() => num.remove(), 1200);
        }
        
        function showEffectivenessPopup(type) {
            const arena = document.getElementById('battle-arena');
            const popup = document.createElement('div');
            popup.className = 'effectiveness-popup ' + type;
            popup.textContent = type === 'super' ? "It's super effective!" : type === 'not-very' ? "Not very effective..." : "No effect!";
            arena.appendChild(popup);
            setTimeout(() => popup.remove(), 1500);
        }

        function updateHPBars() {
            const playerPercent = (gameState.playerHP / gameState.playerMaxHP) * 100;
            const enemyPercent = (gameState.enemyHP / gameState.enemyMaxHP) * 100;
            
            const playerBar = document.getElementById('player-hp-bar');
            const enemyBar = document.getElementById('enemy-hp-bar');
            
            playerBar.style.width = Math.max(0, playerPercent) + '%';
            enemyBar.style.width = Math.max(0, enemyPercent) + '%';
            
            playerBar.className = 'hp-bar-inner' + (playerPercent <= 20 ? ' low' : playerPercent <= 50 ? ' medium' : '');
            enemyBar.className = 'hp-bar-inner' + (enemyPercent <= 20 ? ' low' : enemyPercent <= 50 ? ' medium' : '');
            
            document.getElementById('player-hp').textContent = Math.max(0, gameState.playerHP);
        }

        function endBattle(won) {
            const result = document.getElementById('battle-result');
            const player = CHARACTERS[gameState.playerKey];
            const enemy = CHARACTERS[gameState.enemyKey];
            
            if (won) {
                const baseExp = Math.floor(enemy.hp * gameState.enemyLevel / 7);
                const expGain = Math.floor(baseExp * (gameState.enemyShiny ? 1.5 : 1));
                const pumpGain = Math.floor((200 + Math.random() * 300) * (gameState.enemyShiny ? 2 : 1));
                
                document.getElementById('result-title').textContent = 'VICTORY!';
                document.getElementById('result-subtitle').innerHTML = `
                    ${player.name} gained ${expGain} EXP!<br>
                    <span style="color: var(--primary)">+${pumpGain} $PUMP</span>
                    ${gameState.enemyShiny ? '<br><span style="color: #ec4899"> Shiny bonus!</span>' : ''}
                `;
                
                const enemySprite = document.getElementById('enemy-sprite');
                enemySprite.style.transition = 'all 0.5s';
                enemySprite.style.opacity = '0';
                enemySprite.style.transform = 'translateY(30px)';
                
                AudioSystem.playSound('victory');
            } else {
                document.getElementById('result-title').textContent = 'DEFEATED';
                document.getElementById('result-subtitle').textContent = 'Try again!';
                
                const playerSpriteBack = document.getElementById('player-sprite-back');
                playerSpriteBack.style.transition = 'all 0.5s';
                playerSpriteBack.style.opacity = '0';
                playerSpriteBack.style.transform = 'translateY(30px) rotate(10deg)';
                
                AudioSystem.playSound('defeat');
            }
            
            setTimeout(() => {
                result.style.display = 'block';
                result.classList.add('show');
            }, 600);
        }

        function resetBattle() {
            const result = document.getElementById('battle-result');
            result.style.display = 'none';
            result.classList.remove('show');
            initBattle();
        }

        function addLog(text, type = '') {
            const log = document.getElementById('battle-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + type;
            entry.textContent = '> ' + text;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function clearLog() {
            document.getElementById('battle-log').innerHTML = '';
        }

        function screenShake() {
            const arena = document.getElementById('battle-arena');
            arena.classList.add('shake');
            setTimeout(() => arena.classList.remove('shake'), 300);
        }

        function openModal() {
            renderCharacterGrid();
            const modal = document.getElementById('modal');
            modal.style.display = 'flex';
            modal.style.visibility = 'visible';
            modal.classList.add('show');
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            modal.style.display = 'none';
            modal.style.visibility = 'hidden';
            modal.classList.remove('show');
        }

        function confirmSelection() {
            gameState.playerKey = gameState.selectedChar;
            closeModal();
            initBattle();
            scrollToGame();
        }

        function scrollToGame() {
            document.getElementById('game').scrollIntoView({ behavior: 'smooth' });
        }

        /* ================================
           INITIALIZATION
           ================================ */
        document.addEventListener('DOMContentLoaded', () => {
            WalletSystem.init();
            AudioSystem.init();
            init();
            
            // Switch music on scroll
            let lastSection = 'main';
            window.addEventListener('scroll', () => {
                const gameSection = document.getElementById('game');
                const rect = gameSection.getBoundingClientRect();
                const inGame = rect.top < window.innerHeight * 0.5 && rect.bottom > window.innerHeight * 0.5;
                
                if (inGame && lastSection !== 'battle') {
                    lastSection = 'battle';
                    AudioSystem.switchTrack('battle');
                } else if (!inGame && lastSection !== 'main') {
                    lastSection = 'main';
                    AudioSystem.switchTrack('main');
                }
            });
        });
    </script>
</body>
</html>