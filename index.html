<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PumpFighters - Memecoin Battle Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #ffd93d;
            --bg: #0a0a0f;
            --bg-card: #12121a;
            --text: #ffffff;
            --text-muted: #888;
            --border: #2a2a3a;
            --green: #22c55e;
            --red: #ef4444;
            --blue: #3b82f6;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.5;
            animation: orbFloat 20s ease-in-out infinite;
        }

        .orb-1 {
            width: 400px;
            height: 400px;
            background: linear-gradient(135deg, #6c5ce7 0%, #a855f7 100%);
            top: -100px;
            left: -100px;
            animation-delay: 0s;
        }

        .orb-2 {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, #ffd93d 0%, #ff9500 100%);
            top: 50%;
            right: -50px;
            animation-delay: -5s;
        }

        .orb-3 {
            width: 350px;
            height: 350px;
            background: linear-gradient(135deg, #00d4aa 0%, #00a8cc 100%);
            bottom: -100px;
            left: 30%;
            animation-delay: -10s;
        }

        .orb-4 {
            width: 250px;
            height: 250px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%);
            top: 30%;
            left: 50%;
            animation-delay: -15s;
        }

        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(50px, -50px) scale(1.1); }
            50% { transform: translate(-30px, 30px) scale(0.9); }
            75% { transform: translate(40px, 20px) scale(1.05); }
        }

        .grid-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 60px 60px;
        }

        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            opacity: 0.6;
            animation: particleFloat 15s linear infinite;
        }

        .particle:nth-child(1) { left: 10%; top: 20%; animation-delay: 0s; }
        .particle:nth-child(2) { left: 20%; top: 80%; animation-delay: -2s; }
        .particle:nth-child(3) { left: 30%; top: 40%; animation-delay: -4s; }
        .particle:nth-child(4) { left: 50%; top: 60%; animation-delay: -6s; }
        .particle:nth-child(5) { left: 70%; top: 30%; animation-delay: -8s; }
        .particle:nth-child(6) { left: 80%; top: 70%; animation-delay: -10s; }
        .particle:nth-child(7) { left: 90%; top: 50%; animation-delay: -12s; }
        .particle:nth-child(8) { left: 40%; top: 90%; animation-delay: -14s; }

        @keyframes particleFloat {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        /* Floating Pills */
        .floating-pills {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 0;
        }

        .floating-pill {
            position: absolute;
            width: 40px;
            height: 40px;
            opacity: 0.15;
            animation: floatPillUp 18s linear infinite;
        }

        .floating-pill img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .floating-pill:nth-child(1) { left: 5%; bottom: -60px; animation-delay: 0s; animation-duration: 20s; }
        .floating-pill:nth-child(2) { left: 15%; bottom: -60px; animation-delay: 3s; animation-duration: 18s; width: 30px; height: 30px; }
        .floating-pill:nth-child(3) { left: 25%; bottom: -60px; animation-delay: 6s; animation-duration: 22s; width: 50px; height: 50px; }
        .floating-pill:nth-child(4) { left: 35%; bottom: -60px; animation-delay: 2s; animation-duration: 19s; }
        .floating-pill:nth-child(5) { left: 45%; bottom: -60px; animation-delay: 8s; animation-duration: 21s; width: 35px; height: 35px; }
        .floating-pill:nth-child(6) { left: 55%; bottom: -60px; animation-delay: 4s; animation-duration: 17s; width: 45px; height: 45px; }
        .floating-pill:nth-child(7) { left: 65%; bottom: -60px; animation-delay: 10s; animation-duration: 23s; }
        .floating-pill:nth-child(8) { left: 75%; bottom: -60px; animation-delay: 1s; animation-duration: 16s; width: 30px; height: 30px; }
        .floating-pill:nth-child(9) { left: 85%; bottom: -60px; animation-delay: 7s; animation-duration: 20s; width: 50px; height: 50px; }
        .floating-pill:nth-child(10) { left: 95%; bottom: -60px; animation-delay: 5s; animation-duration: 18s; }

        @keyframes floatPillUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            5% { opacity: 0.15; }
            95% { opacity: 0.15; }
            100% { transform: translateY(-110vh) rotate(360deg); opacity: 0; }
        }

        /* Simple Nav */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 16px 24px;
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: contain;
            background: var(--bg-card);
            border: 1px solid var(--border);
        }

        .logo-text {
            font-family: 'Press Start 2P', cursive;
            font-size: 1rem;
            color: var(--primary);
        }

        .nav-links {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .nav-links a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .nav-links a:hover { color: var(--text); }

        .music-btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .music-btn:hover {
            border-color: var(--primary);
            transform: scale(1.1);
        }

        .music-btn.playing {
            background: var(--primary);
            color: #000;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 217, 61, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(255, 217, 61, 0); }
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--primary);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255, 217, 61, 0.3);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
        }

        /* Hero Section */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 100px 24px 60px;
            position: relative;
            z-index: 10;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 50px;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 24px;
        }

        .hero-badge .live { color: var(--green); }

        .hero-title {
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(1.8rem, 5vw, 3rem);
            margin-bottom: 16px;
            line-height: 1.3;
        }

        .hero-title .highlight { color: var(--primary); }

        .hero-subtitle {
            font-size: 1.1rem;
            color: var(--text-muted);
            max-width: 500px;
            margin-bottom: 40px;
        }

        /* Character Preview */
        .character-preview {
            display: flex;
            gap: 16px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .char-avatar {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
        }

        .char-avatar:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .char-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cta-buttons {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Game Section */
        .game-wrapper {
            background: #0a0a0f;
            position: relative;
            z-index: 50;
        }

        .game-section {
            padding: 60px 24px;
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
        }

        .section-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 40px;
        }

        .section-title .highlight { color: var(--primary); }

        /* Battle Arena */
        .battle-arena {
            background: linear-gradient(180deg, #87CEEB 0%, #87CEEB 40%, #90EE90 60%, #228B22 100%);
            border-radius: 16px;
            height: 450px;
            position: relative;
            overflow: hidden;
            margin-bottom: 16px;
            border: 3px solid #1a1a2e;
            perspective: 800px;
        }

        /* Battle field floor with perspective */
        .battle-field {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 55%;
            background: linear-gradient(180deg, #90EE90 0%, #228B22 50%, #1a5c1a 100%);
            transform: rotateX(45deg);
            transform-origin: bottom center;
        }

        /* Sun */
        .sun {
            position: absolute;
            top: 20px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            z-index: 2;
        }

        /* Ground Platforms with 3D perspective */
        .ground-player {
            position: absolute;
            left: 5%;
            bottom: 80px;
            width: 220px;
            height: 25px;
            background: linear-gradient(90deg, #1a5c1a 0%, #228B22 30%, #32CD32 50%, #228B22 70%, #1a5c1a 100%);
            border-radius: 50%;
            box-shadow: 
                0 8px 0 #0d3d0d,
                0 12px 20px rgba(0,0,0,0.3);
            transform: perspective(200px) rotateX(20deg);
            z-index: 8;
        }

        .ground-enemy {
            position: absolute;
            right: 10%;
            top: 175px;
            width: 130px;
            height: 18px;
            background: linear-gradient(90deg, #1a5c1a 0%, #228B22 30%, #32CD32 50%, #228B22 70%, #1a5c1a 100%);
            border-radius: 50%;
            box-shadow: 
                0 5px 0 #0d3d0d,
                0 8px 15px rgba(0,0,0,0.25);
            transform: perspective(200px) rotateX(20deg);
            z-index: 3;
        }

        /* Character Sprites - Front view (hidden, using back instead) */
        .sprite-player {
            display: none;
        }

        .sprite-player img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Back POV sprite - Pokemon style (large, bottom left) */
        .sprite-player-back {
            position: absolute;
            left: 2%;
            bottom: 85px;
            width: 200px;
            height: 200px;
            animation: bounceBack 2.5s ease-in-out infinite;
            z-index: 10;
        }

        .sprite-player-back img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(4px 8px 12px rgba(0,0,0,0.5));
        }

        @keyframes bounceBack {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        /* Attack animation for back sprite */
        .sprite-player-back.attacking {
            animation: attackBack 0.4s ease-out forwards;
        }

        @keyframes attackBack {
            0% { transform: translateX(0) translateY(0); }
            50% { transform: translateX(50px) translateY(-15px) scale(1.08); }
            100% { transform: translateX(0) translateY(0); }
        }

        /* Damage animation for back sprite */
        .sprite-player-back.damaged {
            animation: damagedBack 0.5s ease-out;
        }

        @keyframes damagedBack {
            0%, 100% { transform: translateX(0); opacity: 1; }
            20% { transform: translateX(-10px); opacity: 0.4; filter: brightness(2); }
            40% { transform: translateX(10px); opacity: 0.6; }
            60% { transform: translateX(-5px); opacity: 0.8; }
            80% { transform: translateX(5px); opacity: 0.9; }
        }

        /* Enemy sprite - smaller, top right (far away for depth) */
        .sprite-enemy {
            position: absolute;
            right: 10%;
            top: 60px;
            width: 115px;
            height: 115px;
            animation: bounce 2.5s ease-in-out infinite;
            animation-delay: 0.5s;
            z-index: 5;
        }

        .sprite-enemy img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(3px 6px 10px rgba(0,0,0,0.4));
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        /* Attack animation for enemy */
        .sprite-enemy.attacking {
            animation: attackEnemy 0.4s ease-out forwards;
        }

        @keyframes attackEnemy {
            0% { transform: translateX(0) translateY(0); }
            50% { transform: translateX(-50px) translateY(15px) scale(1.15); }
            100% { transform: translateX(0) translateY(0); }
        }

        /* Damage animation for enemy */
        .sprite-enemy.damaged {
            animation: damagedEnemy 0.5s ease-out;
        }

        @keyframes damagedEnemy {
            0%, 100% { transform: translateX(0); opacity: 1; }
            20% { transform: translateX(8px); opacity: 0.4; filter: brightness(2); }
            40% { transform: translateX(-8px); opacity: 0.6; }
            60% { transform: translateX(4px); opacity: 0.8; }
            80% { transform: translateX(-4px); opacity: 0.9; }
        }

        /* HP Boxes */
        .hp-box {
            position: absolute;
            background: #fff;
            border-radius: 10px;
            padding: 12px 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            min-width: 200px;
        }

        .hp-box.enemy {
            top: 20px;
            left: 20px;
        }

        .hp-box.player {
            bottom: 20px;
            right: 20px;
        }

        .hp-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .pokemon-name {
            font-weight: 700;
            color: #333;
            font-size: 0.9rem;
        }

        .level {
            background: #333;
            color: #fff;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
        }

        .hp-bar-outer {
            height: 8px;
            background: #e5e5e5;
            border-radius: 4px;
            overflow: hidden;
        }

        .hp-bar-inner {
            height: 100%;
            background: var(--green);
            border-radius: 4px;
            transition: width 0.5s;
        }

        .hp-bar-inner.medium { background: #eab308; }
        .hp-bar-inner.low { background: var(--red); animation: hpPulse 0.5s infinite; }

        @keyframes hpPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Status Badges */
        .status-container {
            display: flex;
            gap: 4px;
            margin-top: 4px;
        }

        .status-badge {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.4rem;
            padding: 2px 4px;
            border-radius: 3px;
            color: #fff;
        }

        .status-par { background: #eab308; }
        .status-brn { background: #f97316; }
        .status-psn { background: #a855f7; }
        .status-slp { background: #6b7280; }
        .status-frz { background: #06b6d4; }

        /* Floating Damage Numbers */
        .damage-number {
            position: absolute;
            font-family: 'Press Start 2P', cursive;
            font-size: 1.5rem;
            color: #fff;
            text-shadow: 3px 3px 0 #000, -3px -3px 0 #000, 3px -3px 0 #000, -3px 3px 0 #000;
            animation: damageFloat 1.2s ease-out forwards;
            pointer-events: none;
            z-index: 100;
        }

        .damage-number.critical {
            font-size: 2rem;
            color: #fbbf24;
        }

        .damage-number.heal {
            color: #22c55e;
        }

        .damage-number.miss {
            font-size: 1rem;
            color: #888;
        }

        @keyframes damageFloat {
            0% { transform: translateY(0) scale(0.5); opacity: 1; }
            30% { transform: translateY(-30px) scale(1.3); opacity: 1; }
            100% { transform: translateY(-80px) scale(1); opacity: 0; }
        }

        /* Type Effectiveness Popup */
        .effectiveness-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Press Start 2P', cursive;
            font-size: 0.75rem;
            padding: 10px 20px;
            border-radius: 8px;
            animation: popupShow 1.5s ease-out forwards;
            z-index: 100;
            white-space: nowrap;
        }

        .effectiveness-popup.super { background: var(--green); color: #fff; }
        .effectiveness-popup.not-very { background: #6b7280; color: #fff; }
        .effectiveness-popup.immune { background: #1f2937; color: #fff; }

        @keyframes popupShow {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }

        /* Turn Indicator */
        .turn-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -120px);
            font-family: 'Press Start 2P', cursive;
            font-size: 0.6rem;
            background: rgba(0,0,0,0.85);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid var(--primary);
            z-index: 50;
        }

        .turn-indicator.enemy { color: var(--red); border-color: var(--red); }

        /* Shiny Effect */
        .sprite-player.shiny img,
        .sprite-player-back.shiny img,
        .sprite-enemy.shiny img {
            filter: drop-shadow(0 0 15px #ec4899) drop-shadow(0 8px 16px rgba(0,0,0,0.3)) hue-rotate(30deg);
        }

        .shiny-sparkle {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #fff 0%, transparent 70%);
            border-radius: 50%;
            animation: sparkle 1s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1); }
        }

        /* Battle Intro */
        .battle-intro {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            animation: introFade 2.5s ease-out forwards;
        }

        .battle-intro.hide { display: none; }

        .intro-text {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.9rem;
            color: #fff;
            text-align: center;
        }

        .intro-text .shiny-name { color: #ec4899; }

        @keyframes introFade {
            0%, 60% { opacity: 1; }
            100% { opacity: 0; pointer-events: none; }

        .hp-text {
            text-align: right;
            font-size: 0.7rem;
            color: #666;
            margin-top: 4px;
        }

        /* Battle Menu */
        .battle-menu {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }

        .battle-log {
            padding: 16px;
            border-right: 1px solid var(--border);
            background: #000;
            min-height: 120px;
            max-height: 150px;
            overflow-y: auto;
        }

        .battle-log::-webkit-scrollbar {
            width: 4px;
        }

        .battle-log::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }

        .log-entry {
            font-size: 0.75rem;
            color: var(--green);
            padding: 3px 0;
            font-family: 'Press Start 2P', monospace;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .log-entry.system { color: var(--primary); }
        .log-entry.enemy { color: var(--red); }
        .log-entry.info { color: var(--blue); }

        .move-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            padding: 12px;
            background: var(--bg-card);
        }

        .move-btn {
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .move-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background: rgba(255, 217, 61, 0.1);
        }

        .move-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .move-name {
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 4px;
            color: var(--text);
        }

        .move-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .move-type {
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .type-water { background: #3b82f6; color: #fff; }
        .type-electric { background: #fbbf24; color: #000; }
        .type-fire { background: #ef4444; color: #fff; }
        .type-normal { background: #a3a3a3; color: #fff; }
        .type-dark { background: #374151; color: #fff; }
        .type-psychic { background: #ec4899; color: #fff; }

        .move-pp {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* How It Works */
        .how-it-works {
            padding: 100px 24px;
            background: #0a0a0f;
            position: relative;
            z-index: 200;
        }

        .how-container {
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .how-it-works .section-title {
            text-align: center;
            margin-bottom: 60px;
        }

        .steps {
            display: grid !important;
            grid-template-columns: repeat(3, 1fr) !important;
            gap: 30px !important;
        }

        .step {
            text-align: center;
            padding: 40px 28px;
            background: #1a1a2e !important;
            border-radius: 20px;
            border: 1px solid #2a2a3e !important;
            transition: transform 0.3s, border-color 0.3s;
            display: block !important;
        }

        .step:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .step-icon {
            font-size: 3.5rem;
            margin-bottom: 24px;
            display: block !important;
            line-height: 1;
        }

        .step-title {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            margin: 0 0 16px 0;
            color: #fff;
        }

        .step-desc {
            color: var(--text-muted);
            font-size: 0.95rem;
            line-height: 1.7;
            margin: 0;
        }

        /* Footer */
        footer {
            padding: 50px 24px;
            text-align: center;
            border-top: 1px solid var(--border);
            background: #0a0a0f;
            position: relative;
            z-index: 200;
        }

        .footer-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .social-links {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .social-links a {
            color: var(--text-muted);
            text-decoration: none;
            padding: 12px 24px;
            border: 1px solid var(--border);
            border-radius: 10px;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .social-links a:hover {
            color: var(--primary);
            border-color: var(--primary);
            background: rgba(255, 217, 61, 0.05);
        }

        .copyright {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        /* Selection Modal */
        .modal {
            display: none !important;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            visibility: hidden;
        }

        .modal.show { 
            display: flex !important; 
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 32px;
            max-width: 600px;
            width: 90%;
        }

        .modal-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 1rem;
            text-align: center;
            margin-bottom: 24px;
            color: var(--primary);
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .char-card {
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .char-card:hover {
            border-color: var(--primary);
        }

        .char-card.selected {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(255, 217, 61, 0.3);
        }

        .char-card img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .char-card .name {
            font-weight: 600;
            font-size: 0.85rem;
        }

        .modal-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
        }

        /* Battle Result */
        .battle-result {
            display: none !important;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-card);
            border: 3px solid var(--primary);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            z-index: 500;
        }

        .battle-result.show { display: block !important; }

        .battle-arena.shake {
            animation: screenShake 0.3s ease-out;
        }

        @keyframes screenShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-3px); }
        }

        .result-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 16px;
        }

        .result-subtitle {
            color: var(--text-muted);
            margin-bottom: 24px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links a:not(.btn) { display: none; }

            .logo-img {
                width: 32px;
                height: 32px;
            }

            .logo-text {
                font-size: 0.75rem;
            }
            
            .steps {
                grid-template-columns: 1fr;
                gap: 20px;
                max-width: 400px;
                margin: 0 auto;
            }

            .step {
                padding: 30px 24px;
            }

            .step-icon {
                font-size: 2.5rem;
                margin-bottom: 16px;
            }

            .how-it-works {
                padding: 60px 20px;
            }

            .how-it-works .section-title {
                margin-bottom: 40px;
            }

            .battle-arena {
                height: 400px;
            }

            .battle-menu {
                grid-template-columns: 1fr;
            }

            .battle-log {
                border-right: none;
                border-bottom: 1px solid var(--border);
                max-height: 80px;
            }

            .character-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .sprite-player-back {
                width: 150px;
                height: 150px;
                left: 1%;
                bottom: 70px;
            }

            .sprite-enemy {
                width: 85px;
                height: 85px;
                right: 8%;
                top: 55px;
            }

            .ground-player {
                width: 170px;
                left: 1%;
                bottom: 55px;
                height: 18px;
            }

            .ground-enemy {
                width: 95px;
                right: 8%;
                top: 135px;
                height: 14px;
            }

            .hp-box {
                min-width: 130px;
                padding: 8px 10px;
            }

            .hp-box.player {
                bottom: 8px;
                right: 8px;
            }

            .hp-box.enemy {
                top: 10px;
                left: 10px;
            }

            .turn-indicator {
                font-size: 0.5rem;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="orb orb-4"></div>
        <div class="grid-pattern"></div>
        <div class="particles">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
        </div>
    </div>

    <!-- Floating Pills -->
    <div class="floating-pills">
        <div class="floating-pill"><img src="assets/images/pumpfun-logo.png" alt=""></div>
        <div class="floating-pill"><img src="assets/images/pumpfun-logo.png" alt=""></div>
        <div class="floating-pill"><img src="assets/images/pumpfun-logo.png" alt=""></div>
        <div class="floating-pill"><img src="assets/images/pumpfun-logo.png" alt=""></div>
        <div class="floating-pill"><img src="assets/images/pumpfun-logo.png" alt=""></div>
        <div class="floating-pill"><img src="assets/images/pumpfun-logo.png" alt=""></div>
        <div class="floating-pill"><img src="assets/images/pumpfun-logo.png" alt=""></div>
        <div class="floating-pill"><img src="assets/images/pumpfun-logo.png" alt=""></div>
        <div class="floating-pill"><img src="assets/images/pumpfun-logo.png" alt=""></div>
        <div class="floating-pill"><img src="assets/images/pumpfun-logo.png" alt=""></div>
    </div>

    <!-- Navigation -->
    <nav>
        <div class="logo">
            <img src="assets/images/logo.png" alt="PumpFighters Logo" class="logo-img" onerror="this.style.display='none'">
            <span class="logo-text">PUMPFIGHTERS</span>
        </div>
        <div class="nav-links">
            <a href="#game">Play</a>
            <a href="#how">How It Works</a>
            <button class="music-btn" id="music-btn" onclick="toggleMusic()">üéµ</button>
            <a href="#" class="btn btn-primary">Buy $PUMP</a>
        </div>
    </nav>

    <!-- Hero -->
    <section class="hero">
        <div class="hero-badge">
            üéÆ <span class="live">Live on Solana</span>
        </div>
        
        <h1 class="hero-title">
            Battle Memecoins.<br>
            <span class="highlight">Win $PUMP.</span>
        </h1>
        
        <p class="hero-subtitle">
            Choose your favorite memecoin character and battle in Pokemon-style combat. 
            Every victory earns you $PUMP tokens.
        </p>

        <div class="character-preview">
            <div class="char-avatar" onclick="selectAndPlay('pepe')">
                <img src="assets/images/characters/pepe.png" alt="PEPE">
            </div>
            <div class="char-avatar" onclick="selectAndPlay('whale')">
                <img src="assets/images/characters/whale.png" alt="WHALE">
            </div>
            <div class="char-avatar" onclick="selectAndPlay('cow')">
                <img src="assets/images/characters/cow.png" alt="COW">
            </div>
            <div class="char-avatar" onclick="selectAndPlay('moodeng')">
                <img src="assets/images/characters/moodeng.png" alt="MOODENG">
            </div>
            <div class="char-avatar" onclick="selectAndPlay('alon')">
                <img src="assets/images/characters/alon.png" alt="ALON">
            </div>
            <div class="char-avatar" onclick="selectAndPlay('catana')">
                <img src="assets/images/characters/catana.png" alt="CATANA">
            </div>
        </div>

        <div class="cta-buttons">
            <button class="btn btn-primary" onclick="openModal()">üéÆ Choose Fighter</button>
            <button class="btn btn-secondary" onclick="scrollToGame()">‚öîÔ∏è Quick Battle</button>
        </div>
    </section>

    <!-- Game Section -->
    <div class="game-wrapper">
        <section class="game-section" id="game">
            <h2 class="section-title">‚öîÔ∏è Battle <span class="highlight">Arena</span></h2>
            
            <div class="battle-arena" id="battle-arena">
            <div class="sun"></div>
            
            <div class="ground-player"></div>
            <div class="ground-enemy"></div>

            <!-- Turn Indicator -->
            <div class="turn-indicator" id="turn-indicator">YOUR TURN</div>

            <div class="hp-box enemy">
                <div class="hp-header">
                    <span class="pokemon-name" id="enemy-name">WHALE</span>
                    <span class="level">Lv<span id="enemy-level">48</span></span>
                </div>
                <div class="hp-bar-outer">
                    <div class="hp-bar-inner" id="enemy-hp-bar" style="width: 100%"></div>
                </div>
                <div class="status-container" id="enemy-status"></div>
            </div>

            <div class="hp-box player">
                <div class="hp-header">
                    <span class="pokemon-name" id="player-name">PEPE</span>
                    <span class="level">Lv<span id="player-level">50</span></span>
                </div>
                <div class="hp-bar-outer">
                    <div class="hp-bar-inner" id="player-hp-bar" style="width: 100%"></div>
                </div>
                <div class="hp-text"><span id="player-hp">100</span>/<span id="player-max-hp">100</span></div>
                <div class="status-container" id="player-status"></div>
            </div>

            <div class="sprite-player" id="player-sprite">
                <img id="player-img" src="assets/images/characters/pepe.png" alt="Player">
            </div>

            <!-- Back POV Sprite (Pokemon style) -->
            <div class="sprite-player-back" id="player-sprite-back">
                <img id="player-img-back" src="assets/images/characters/pepe-back.png" alt="Player Back">
            </div>

            <div class="sprite-enemy" id="enemy-sprite">
                <img id="enemy-img" src="assets/images/characters/whale.png" alt="Enemy">
            </div>

            <!-- Battle Intro -->
            <div class="battle-intro" id="battle-intro">
                <div class="intro-text" id="intro-text">A wild WHALE appeared!</div>
            </div>

            <div class="battle-result" id="battle-result" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #12121a; border: 3px solid #ffd93d; border-radius: 20px; padding: 40px; text-align: center; z-index: 500;">
                <div class="result-title" id="result-title" style="font-family: 'Press Start 2P', cursive; font-size: 1.5rem; color: #ffd93d; margin-bottom: 16px;">VICTORY!</div>
                <div class="result-subtitle" id="result-subtitle" style="color: #888; margin-bottom: 24px;">You earned 500 $PUMP!</div>
                <button class="btn btn-primary" onclick="resetBattle()" style="background: #ffd93d; color: #000; padding: 12px 24px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600;">Battle Again</button>
            </div>
        </div>

        <div class="battle-menu" style="display: grid; grid-template-columns: 1fr 1.5fr; background: #12121a; border-radius: 16px; border: 1px solid #2a2a3a; overflow: hidden;">
            <div class="battle-log" id="battle-log" style="padding: 16px; border-right: 1px solid #2a2a3a; background: #000; min-height: 120px; max-height: 150px; overflow-y: auto;">
                <div class="log-entry system">Choose a move to attack!</div>
            </div>
            <div class="move-grid" id="move-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 12px; background: #12121a;">
                <!-- Moves will be inserted here -->
            </div>
        </div>
    </section>
    </div>

    <!-- How It Works -->
    <section class="how-it-works" id="how" style="background: #0a0a0f; position: relative; z-index: 200;">
        <div class="how-container" style="max-width: 1000px; margin: 0 auto;">
            <h2 class="section-title">How It <span class="highlight">Works</span></h2>
            
            <div class="steps" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px;">
                <div class="step" style="background: #1a1a2e; padding: 40px 28px; border-radius: 20px; border: 1px solid #2a2a3e; text-align: center;">
                    <span class="step-icon" style="font-size: 3.5rem; display: block; margin-bottom: 24px;">üéÆ</span>
                    <h3 class="step-title" style="color: #fff; font-size: 1.1rem; margin-bottom: 16px;">1. Choose Your Fighter</h3>
                    <p class="step-desc" style="color: #a0a0a0; font-size: 0.95rem; line-height: 1.7;">Pick from 6 iconic memecoin characters, each with unique stats and moves.</p>
                </div>
                <div class="step" style="background: #1a1a2e; padding: 40px 28px; border-radius: 20px; border: 1px solid #2a2a3e; text-align: center;">
                    <span class="step-icon" style="font-size: 3.5rem; display: block; margin-bottom: 24px;">‚öîÔ∏è</span>
                    <h3 class="step-title" style="color: #fff; font-size: 1.1rem; margin-bottom: 16px;">2. Battle Opponents</h3>
                    <p class="step-desc" style="color: #a0a0a0; font-size: 0.95rem; line-height: 1.7;">Fight in turn-based Pokemon-style combat. Use strategy to defeat enemies.</p>
                </div>
                <div class="step" style="background: #1a1a2e; padding: 40px 28px; border-radius: 20px; border: 1px solid #2a2a3e; text-align: center;">
                    <span class="step-icon" style="font-size: 3.5rem; display: block; margin-bottom: 24px;">üí∞</span>
                    <h3 class="step-title" style="color: #fff; font-size: 1.1rem; margin-bottom: 16px;">3. Earn $PUMP</h3>
                    <p class="step-desc" style="color: #a0a0a0; font-size: 0.95rem; line-height: 1.7;">Win battles to earn $PUMP tokens. The more you win, the more you earn.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer style="background: #0a0a0f; position: relative; z-index: 200;">
        <div class="footer-content" style="max-width: 600px; margin: 0 auto;">
            <div class="social-links" style="display: flex; gap: 16px; justify-content: center; margin-bottom: 24px;">
                <a href="#" style="color: #a0a0a0; text-decoration: none; padding: 12px 24px; border: 1px solid #2a2a3e; border-radius: 10px;">ùïè Twitter</a>
                <a href="#" style="color: #a0a0a0; text-decoration: none; padding: 12px 24px; border: 1px solid #2a2a3e; border-radius: 10px;">üìÑ Docs</a>
                <a href="#" style="color: #a0a0a0; text-decoration: none; padding: 12px 24px; border: 1px solid #2a2a3e; border-radius: 10px;">üí¨ Telegram</a>
            </div>
            <p class="copyright" style="color: #666;">¬© 2025 PumpFighters. Built on Solana.</p>
        </div>
    </footer>

    <!-- Character Selection Modal -->
    <div class="modal" id="modal" style="display: none !important; visibility: hidden;">
        <div class="modal-content">
            <h3 class="modal-title">Choose Your Fighter</h3>
            <div class="character-grid" id="char-grid">
                <!-- Characters will be inserted here -->
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmSelection()">‚öîÔ∏è Fight!</button>
            </div>
        </div>
    </div>

    <script>
        // Audio System
        const AudioSystem = {
            music: null,
            battleMusic: null,
            isMusicPlaying: false,
            currentTrack: 'main',
            
            init() {
                this.music = new Audio('assets/audio/main-theme.mp3');
                this.battleMusic = new Audio('assets/audio/battle-theme.mp3');
                this.music.loop = true;
                this.battleMusic.loop = true;
                this.music.volume = 0.4;
                this.battleMusic.volume = 0.5;
            },
            
            toggleMusic() {
                if (this.isMusicPlaying) {
                    this.stopMusic();
                } else {
                    this.playMusic();
                }
            },
            
            playMusic() {
                const track = this.currentTrack === 'battle' ? this.battleMusic : this.music;
                track.play().then(() => {
                    this.isMusicPlaying = true;
                    document.getElementById('music-btn').classList.add('playing');
                    document.getElementById('music-btn').textContent = 'üîä';
                }).catch(e => console.log('Audio play failed:', e));
            },
            
            stopMusic() {
                this.music.pause();
                this.battleMusic.pause();
                this.isMusicPlaying = false;
                document.getElementById('music-btn').classList.remove('playing');
                document.getElementById('music-btn').textContent = 'üéµ';
            },
            
            switchTrack(track) {
                if (this.currentTrack === track) return;
                
                const wasPlaying = this.isMusicPlaying;
                this.music.pause();
                this.battleMusic.pause();
                this.music.currentTime = 0;
                this.battleMusic.currentTime = 0;
                this.currentTrack = track;
                
                if (wasPlaying) {
                    this.playMusic();
                }
            },
            
            // Sound Effects using Web Audio API
            playSound(type) {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                switch(type) {
                    case 'hit':
                        oscillator.frequency.setValueAtTime(200, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.1);
                        gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.1);
                        break;
                        
                    case 'critical':
                        oscillator.frequency.setValueAtTime(400, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.1);
                        oscillator.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.2);
                        gainNode.gain.setValueAtTime(0.4, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.2);
                        break;
                        
                    case 'victory':
                        const notes = [523, 659, 784, 1047];
                        notes.forEach((freq, i) => {
                            const osc = ctx.createOscillator();
                            const gain = ctx.createGain();
                            osc.connect(gain);
                            gain.connect(ctx.destination);
                            osc.frequency.value = freq;
                            gain.gain.setValueAtTime(0.2, ctx.currentTime + i * 0.15);
                            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.15 + 0.3);
                            osc.start(ctx.currentTime + i * 0.15);
                            osc.stop(ctx.currentTime + i * 0.15 + 0.3);
                        });
                        break;
                        
                    case 'defeat':
                        oscillator.frequency.setValueAtTime(300, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.5);
                        gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.5);
                        break;
                        
                    case 'select':
                        oscillator.frequency.setValueAtTime(600, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.05);
                        gainNode.gain.setValueAtTime(0.15, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.05);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.05);
                        break;
                        
                    case 'heal':
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(400, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.2);
                        gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.3);
                        break;
                }
            }
        };

        function toggleMusic() {
            AudioSystem.toggleMusic();
        }

        // Character Data
        // Type Effectiveness Chart (like Pokemon)
        const TYPE_CHART = {
            water: { fire: 2, water: 0.5, grass: 0.5, electric: 1, normal: 1, psychic: 1, dark: 1 },
            fire: { water: 0.5, fire: 0.5, grass: 2, electric: 1, normal: 1, psychic: 1, dark: 1 },
            grass: { water: 2, fire: 0.5, grass: 0.5, electric: 1, normal: 1, psychic: 1, dark: 1 },
            electric: { water: 2, fire: 1, grass: 0.5, electric: 0.5, normal: 1, psychic: 1, dark: 1 },
            normal: { water: 1, fire: 1, grass: 1, electric: 1, normal: 1, psychic: 1, dark: 1 },
            psychic: { water: 1, fire: 1, grass: 1, electric: 1, normal: 1, psychic: 0.5, dark: 0 },
            dark: { water: 1, fire: 1, grass: 1, electric: 1, normal: 1, psychic: 2, dark: 0.5 }
        };

        const CHARACTERS = {
            pepe: { name: 'PEPE', image: 'pepe.png', hp: 100, attack: 35, defense: 30, speed: 40, type: 'water' },
            whale: { name: 'WHALE', image: 'whale.png', hp: 130, attack: 28, defense: 50, speed: 20, type: 'water' },
            cow: { name: 'COW', image: 'cow.png', hp: 115, attack: 32, defense: 40, speed: 30, type: 'normal' },
            moodeng: { name: 'MOODENG', image: 'moodeng.png', hp: 95, attack: 42, defense: 28, speed: 45, type: 'psychic' },
            alon: { name: 'ALON', image: 'alon.png', hp: 88, attack: 40, defense: 25, speed: 52, type: 'electric' },
            catana: { name: 'CATANA', image: 'catana.png', hp: 82, attack: 48, defense: 22, speed: 58, type: 'dark' }
        };

        const MOVES = {
            pepe: [
                { name: 'WATER GUN', type: 'water', power: 40, accuracy: 100, pp: 25 },
                { name: 'BUBBLE BEAM', type: 'water', power: 65, accuracy: 100, pp: 15, effect: 'speed-down', effectChance: 10 },
                { name: 'MEME MAGIC', type: 'psychic', power: 50, accuracy: 100, pp: 15, effect: 'confuse', effectChance: 10 },
                { name: 'RECOVER', type: 'normal', power: 0, accuracy: 100, pp: 10, heal: 50 }
            ],
            whale: [
                { name: 'SURF', type: 'water', power: 90, accuracy: 100, pp: 15 },
                { name: 'BODY SLAM', type: 'normal', power: 85, accuracy: 100, pp: 15, effect: 'paralyze', effectChance: 30 },
                { name: 'MARKET CRASH', type: 'dark', power: 120, accuracy: 85, pp: 5 },
                { name: 'REST', type: 'normal', power: 0, accuracy: 100, pp: 10, heal: 100, selfSleep: true }
            ],
            cow: [
                { name: 'STOMP', type: 'normal', power: 65, accuracy: 100, pp: 20, effect: 'flinch', effectChance: 30 },
                { name: 'EARTHQUAKE', type: 'normal', power: 100, accuracy: 100, pp: 10 },
                { name: 'MILK DRINK', type: 'normal', power: 0, accuracy: 100, pp: 10, heal: 50 },
                { name: 'ZEN HEADBUTT', type: 'psychic', power: 80, accuracy: 90, pp: 15, effect: 'flinch', effectChance: 20 }
            ],
            moodeng: [
                { name: 'PSYCHIC', type: 'psychic', power: 90, accuracy: 100, pp: 10, effect: 'spdef-down', effectChance: 10 },
                { name: 'CRUNCH', type: 'dark', power: 80, accuracy: 100, pp: 15, effect: 'def-down', effectChance: 20 },
                { name: 'HIPPO CHOMP', type: 'dark', power: 60, accuracy: 100, pp: 25 },
                { name: 'CALM MIND', type: 'psychic', power: 0, accuracy: 100, pp: 20, boost: { attack: 1 } }
            ],
            alon: [
                { name: 'THUNDERBOLT', type: 'electric', power: 90, accuracy: 100, pp: 15, effect: 'paralyze', effectChance: 10 },
                { name: 'THUNDER', type: 'electric', power: 110, accuracy: 70, pp: 10, effect: 'paralyze', effectChance: 30 },
                { name: 'MOON BEAM', type: 'psychic', power: 75, accuracy: 100, pp: 15 },
                { name: 'AGILITY', type: 'normal', power: 0, accuracy: 100, pp: 30, boost: { speed: 2 } }
            ],
            catana: [
                { name: 'NIGHT SLASH', type: 'dark', power: 70, accuracy: 100, pp: 15, highCrit: true },
                { name: 'SUCKER PUNCH', type: 'dark', power: 70, accuracy: 100, pp: 5, priority: true },
                { name: 'SLASH', type: 'normal', power: 70, accuracy: 100, pp: 20, highCrit: true },
                { name: 'SWORDS DANCE', type: 'normal', power: 0, accuracy: 100, pp: 20, boost: { attack: 2 } }
            ]
        };

        // Game State
        let gameState = {
            playerKey: 'pepe',
            enemyKey: 'whale',
            playerHP: 100,
            playerMaxHP: 100,
            enemyHP: 130,
            enemyMaxHP: 130,
            playerLevel: 50,
            enemyLevel: 48,
            isPlayerTurn: true,
            selectedChar: 'pepe',
            moves: [],
            playerStatus: null,
            enemyStatus: null,
            playerShiny: false,
            enemyShiny: false,
            playerBoosts: { attack: 0, defense: 0, speed: 0 },
            enemyBoosts: { attack: 0, defense: 0, speed: 0 },
            turnCount: 0
        };

        // Initialize
        function init() {
            renderCharacterGrid();
            initBattle();
        }

        function renderCharacterGrid() {
            const grid = document.getElementById('char-grid');
            grid.innerHTML = '';
            
            Object.entries(CHARACTERS).forEach(([key, char]) => {
                const card = document.createElement('div');
                card.className = `char-card ${key === gameState.selectedChar ? 'selected' : ''}`;
                card.onclick = () => selectChar(key);
                card.innerHTML = `
                    <img src="assets/images/characters/${char.image}" alt="${char.name}">
                    <div class="name">${char.name}</div>
                `;
                grid.appendChild(card);
            });
        }

        function selectChar(key) {
            gameState.selectedChar = key;
            AudioSystem.playSound('select');
            document.querySelectorAll('.char-card').forEach(c => c.classList.remove('selected'));
            document.querySelector(`.char-card:nth-child(${Object.keys(CHARACTERS).indexOf(key) + 1})`).classList.add('selected');
        }

        function selectAndPlay(key) {
            gameState.selectedChar = key;
            gameState.playerKey = key;
            AudioSystem.playSound('select');
            initBattle();
            scrollToGame();
        }

        function initBattle() {
            const playerKey = gameState.playerKey;
            const player = CHARACTERS[playerKey];
            
            // Pick random enemy
            const enemyKeys = Object.keys(CHARACTERS).filter(k => k !== playerKey);
            const enemyKey = enemyKeys[Math.floor(Math.random() * enemyKeys.length)];
            const enemy = CHARACTERS[enemyKey];
            
            // Set game state
            gameState.enemyKey = enemyKey;
            gameState.playerHP = player.hp;
            gameState.playerMaxHP = player.hp;
            gameState.enemyHP = enemy.hp;
            gameState.enemyMaxHP = enemy.hp;
            gameState.playerLevel = 50;
            gameState.enemyLevel = 45 + Math.floor(Math.random() * 10);
            gameState.moves = MOVES[playerKey].map(m => ({...m, currentPP: m.pp}));
            
            // Reset status and boosts
            gameState.playerStatus = null;
            gameState.enemyStatus = null;
            gameState.playerBoosts = { attack: 0, defense: 0, speed: 0 };
            gameState.enemyBoosts = { attack: 0, defense: 0, speed: 0 };
            gameState.turnCount = 0;
            
            // Shiny check (5% chance)
            gameState.playerShiny = Math.random() < 0.05;
            gameState.enemyShiny = Math.random() < 0.05;
            
            // Speed determines who goes first
            gameState.isPlayerTurn = player.speed >= enemy.speed;
            
            // Update UI
            document.getElementById('player-name').textContent = player.name + (gameState.playerShiny ? ' ‚ú®' : '');
            document.getElementById('enemy-name').textContent = enemy.name + (gameState.enemyShiny ? ' ‚ú®' : '');
            document.getElementById('player-hp').textContent = player.hp;
            document.getElementById('player-max-hp').textContent = player.hp;
            document.getElementById('player-level').textContent = gameState.playerLevel;
            document.getElementById('enemy-level').textContent = gameState.enemyLevel;
            
            document.getElementById('player-img').src = `assets/images/characters/${player.image}`;
            document.getElementById('enemy-img').src = `assets/images/characters/${enemy.image}`;
            
            // Set back sprite image (uses same image with -back suffix, or falls back to regular)
            const backImageName = player.image.replace('.png', '-back.png');
            document.getElementById('player-img-back').src = `assets/images/characters/${backImageName}`;
            // Fallback to regular image if back doesn't exist
            document.getElementById('player-img-back').onerror = function() {
                this.src = `assets/images/characters/${player.image}`;
            };
            
            // Shiny styling
            const playerSprite = document.getElementById('player-sprite');
            const playerSpriteBack = document.getElementById('player-sprite-back');
            const enemySprite = document.getElementById('enemy-sprite');
            playerSprite.classList.toggle('shiny', gameState.playerShiny);
            playerSpriteBack.classList.toggle('shiny', gameState.playerShiny);
            enemySprite.classList.toggle('shiny', gameState.enemyShiny);
            
            // Reset faint animations
            playerSprite.style.opacity = '1';
            playerSprite.style.transform = '';
            playerSpriteBack.style.opacity = '1';
            playerSpriteBack.style.transform = '';
            enemySprite.style.opacity = '1';
            enemySprite.style.transform = '';
            
            updateHPBars();
            updateStatusDisplay();
            updateTurnIndicator();
            renderMoves();
            clearLog();
            
            // Show battle intro
            showBattleIntro(enemy);
            
            const battleResult = document.getElementById('battle-result');
            battleResult.style.display = 'none';
            battleResult.classList.remove('show');
        }
        
        function showBattleIntro(enemy) {
            const intro = document.getElementById('battle-intro');
            const text = document.getElementById('intro-text');
            
            intro.classList.remove('hide');
            intro.style.animation = 'none';
            intro.offsetHeight;
            intro.style.animation = 'introFade 2.5s ease-out forwards';
            
            const shinyText = gameState.enemyShiny ? '<span class="shiny-name">‚ú® SHINY ' + enemy.name + ' ‚ú®</span>' : enemy.name;
            text.innerHTML = `A wild ${shinyText} appeared!`;
            
            setTimeout(() => {
                intro.classList.add('hide');
                addLog(`A wild ${enemy.name} appeared!`, 'system');
                if (gameState.enemyShiny) addLog(`It's shiny! ‚ú®`, 'info');
                addLog(`Go! ${CHARACTERS[gameState.playerKey].name}!`, 'system');
                if (gameState.playerShiny) addLog(`Your ${CHARACTERS[gameState.playerKey].name} is shiny! ‚ú®`, 'info');
                
                if (!gameState.isPlayerTurn) {
                    addLog(`${enemy.name} is faster!`, 'enemy');
                    setTimeout(() => enemyTurn(), 1000);
                }
            }, 2500);
        }
        
        function updateTurnIndicator() {
            const indicator = document.getElementById('turn-indicator');
            indicator.textContent = gameState.isPlayerTurn ? 'YOUR TURN' : 'ENEMY TURN';
            indicator.className = 'turn-indicator' + (gameState.isPlayerTurn ? '' : ' enemy');
        }
        
        function updateStatusDisplay() {
            const playerStatus = document.getElementById('player-status');
            const enemyStatus = document.getElementById('enemy-status');
            
            const statusNames = { par: 'PAR', brn: 'BRN', psn: 'PSN', slp: 'SLP', frz: 'FRZ' };
            
            playerStatus.innerHTML = gameState.playerStatus 
                ? `<span class="status-badge status-${gameState.playerStatus}">${statusNames[gameState.playerStatus]}</span>` 
                : '';
            enemyStatus.innerHTML = gameState.enemyStatus 
                ? `<span class="status-badge status-${gameState.enemyStatus}">${statusNames[gameState.enemyStatus]}</span>` 
                : '';
        }

        function renderMoves() {
            const grid = document.getElementById('move-grid');
            grid.innerHTML = '';
            
            const typeColors = {
                water: '#3b82f6',
                electric: '#fbbf24',
                fire: '#ef4444',
                normal: '#a3a3a3',
                dark: '#374151',
                psychic: '#ec4899',
                grass: '#22c55e'
            };
            
            gameState.moves.forEach((move, i) => {
                const btn = document.createElement('button');
                btn.className = 'move-btn';
                btn.disabled = !gameState.isPlayerTurn || move.currentPP <= 0;
                btn.onclick = () => useMove(i);
                btn.style.cssText = `
                    background: #0a0a0f;
                    border: 2px solid #2a2a3a;
                    border-radius: 10px;
                    padding: 12px;
                    cursor: ${btn.disabled ? 'not-allowed' : 'pointer'};
                    text-align: left;
                    opacity: ${btn.disabled ? '0.5' : '1'};
                `;
                
                const typeColor = typeColors[move.type] || '#a3a3a3';
                const textColor = move.type === 'electric' ? '#000' : '#fff';
                
                btn.innerHTML = `
                    <div style="font-weight: 600; font-size: 0.8rem; margin-bottom: 6px; color: #fff;">${move.name}</div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.6rem; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; font-weight: 600; background: ${typeColor}; color: ${textColor};">${move.type.toUpperCase()}</span>
                        <span style="font-size: 0.7rem; color: #888;">PP ${move.currentPP}/${move.pp}</span>
                    </div>
                `;
                grid.appendChild(btn);
            });
        }

        function useMove(index) {
            if (!gameState.isPlayerTurn) return;
            
            const move = gameState.moves[index];
            if (move.currentPP <= 0) return;
            
            move.currentPP--;
            gameState.isPlayerTurn = false;
            updateTurnIndicator();
            AudioSystem.playSound('select');
            
            const player = CHARACTERS[gameState.playerKey];
            const enemy = CHARACTERS[gameState.enemyKey];
            
            // Check paralysis
            if (gameState.playerStatus === 'par' && Math.random() < 0.25) {
                addLog(`${player.name} is paralyzed! It can't move!`, 'info');
                setTimeout(() => enemyTurn(), 1000);
                return;
            }
            
            // Check sleep
            if (gameState.playerStatus === 'slp') {
                if (Math.random() < 0.33) {
                    gameState.playerStatus = null;
                    updateStatusDisplay();
                    addLog(`${player.name} woke up!`, 'info');
                } else {
                    addLog(`${player.name} is fast asleep!`, 'info');
                    setTimeout(() => enemyTurn(), 1000);
                    return;
                }
            }
            
            addLog(`${player.name} used ${move.name}!`);
            
            // Attack animation on back sprite
            const playerSpriteBack = document.getElementById('player-sprite-back');
            playerSpriteBack.classList.add('attacking');
            setTimeout(() => playerSpriteBack.classList.remove('attacking'), 400);
            
            setTimeout(() => {
                // Accuracy check
                if (move.accuracy && Math.random() * 100 > move.accuracy) {
                    addLog(`${player.name}'s attack missed!`, 'info');
                    AudioSystem.playSound('select');
                    showDamageNumber('MISS', 'enemy', true);
                    setTimeout(() => enemyTurn(), 1000);
                    return;
                }
                
                // Heal move
                if (move.heal) {
                    const healAmount = Math.floor(gameState.playerMaxHP * (move.heal / 100));
                    gameState.playerHP = Math.min(gameState.playerMaxHP, gameState.playerHP + healAmount);
                    addLog(`${player.name} recovered ${healAmount} HP!`, 'info');
                    AudioSystem.playSound('heal');
                    showDamageNumber(`+${healAmount}`, 'player', false, true);
                    
                    if (move.selfSleep) {
                        gameState.playerStatus = 'slp';
                        updateStatusDisplay();
                        addLog(`${player.name} fell asleep!`, 'info');
                    }
                    
                    updateHPBars();
                    setTimeout(() => enemyTurn(), 1000);
                    return;
                }
                
                // Stat boost move
                if (move.boost) {
                    Object.entries(move.boost).forEach(([stat, amount]) => {
                        gameState.playerBoosts[stat] = Math.min(6, gameState.playerBoosts[stat] + amount);
                        const sharpText = amount >= 2 ? ' sharply' : '';
                        addLog(`${player.name}'s ${stat} rose${sharpText}!`, 'info');
                    });
                    AudioSystem.playSound('heal');
                    setTimeout(() => enemyTurn(), 1000);
                    return;
                }
                
                // Damage calculation with type effectiveness
                const result = calculateDamage(move, player, enemy, true);
                gameState.enemyHP = Math.max(0, gameState.enemyHP - result.damage);
                
                // Show floating damage
                showDamageNumber(result.damage, 'enemy', result.isCritical);
                
                // Type effectiveness messages
                if (result.effectiveness > 1) {
                    addLog("It's super effective!", 'info');
                    showEffectivenessPopup('super');
                    AudioSystem.playSound('critical');
                } else if (result.effectiveness < 1 && result.effectiveness > 0) {
                    addLog("It's not very effective...", 'info');
                    showEffectivenessPopup('not-very');
                } else if (result.effectiveness === 0) {
                    addLog(`It doesn't affect ${enemy.name}...`, 'info');
                    showEffectivenessPopup('immune');
                }
                
                if (result.isCritical) {
                    addLog(`Critical hit! Dealt ${result.damage} damage!`);
                    AudioSystem.playSound('critical');
                    screenShake();
                } else {
                    addLog(`Dealt ${result.damage} damage!`);
                    AudioSystem.playSound('hit');
                }
                
                // Status effect chance
                if (move.effect && move.effectChance && Math.random() * 100 < move.effectChance) {
                    applyStatus('enemy', move.effect);
                }
                
                // Damage animation on enemy
                const enemySprite = document.getElementById('enemy-sprite');
                enemySprite.classList.add('damaged');
                setTimeout(() => enemySprite.classList.remove('damaged'), 400);
                
                updateHPBars();
                renderMoves();
                
                if (gameState.enemyHP <= 0) {
                    endBattle(true);
                } else {
                    setTimeout(enemyTurn, 1000);
                }
            }, 300);
        }

        function enemyTurn() {
            const enemy = CHARACTERS[gameState.enemyKey];
            const player = CHARACTERS[gameState.playerKey];
            const enemyMoves = MOVES[gameState.enemyKey];
            
            gameState.turnCount++;
            
            // Status damage at start of turn
            if (gameState.enemyStatus === 'brn' || gameState.enemyStatus === 'psn') {
                const statusDamage = Math.floor(gameState.enemyMaxHP / 16);
                gameState.enemyHP = Math.max(0, gameState.enemyHP - statusDamage);
                const statusName = gameState.enemyStatus === 'brn' ? 'burn' : 'poison';
                addLog(`${enemy.name} was hurt by ${statusName}!`, 'info');
                updateHPBars();
                
                if (gameState.enemyHP <= 0) {
                    endBattle(true);
                    return;
                }
            }
            
            // Check paralysis
            if (gameState.enemyStatus === 'par' && Math.random() < 0.25) {
                addLog(`${enemy.name} is paralyzed! It can't move!`, 'enemy');
                endEnemyTurn();
                return;
            }
            
            // Check sleep
            if (gameState.enemyStatus === 'slp') {
                if (Math.random() < 0.33) {
                    gameState.enemyStatus = null;
                    updateStatusDisplay();
                    addLog(`${enemy.name} woke up!`, 'enemy');
                } else {
                    addLog(`${enemy.name} is fast asleep!`, 'enemy');
                    endEnemyTurn();
                    return;
                }
            }
            
            // AI: Pick best move
            let move;
            if (gameState.playerHP < gameState.playerMaxHP * 0.3) {
                // Finish off low HP player - use strongest move
                move = enemyMoves.reduce((best, m) => (m.power || 0) > (best.power || 0) ? m : best);
            } else {
                // Prefer super effective moves
                const superMoves = enemyMoves.filter(m => m.power && getTypeEffectiveness(m.type, player.type) > 1);
                if (superMoves.length > 0 && Math.random() < 0.7) {
                    move = superMoves[Math.floor(Math.random() * superMoves.length)];
                } else {
                    move = enemyMoves[Math.floor(Math.random() * enemyMoves.length)];
                }
            }
            
            addLog(`${enemy.name} used ${move.name}!`, 'enemy');
            
            // Attack animation on enemy sprite
            const enemySprite = document.getElementById('enemy-sprite');
            enemySprite.classList.add('attacking');
            setTimeout(() => enemySprite.classList.remove('attacking'), 400);
            
            setTimeout(() => {
                // Accuracy check
                if (move.accuracy && Math.random() * 100 > move.accuracy) {
                    addLog(`${enemy.name}'s attack missed!`, 'enemy');
                    showDamageNumber('MISS', 'player', true);
                    endEnemyTurn();
                    return;
                }
                
                // Heal move
                if (move.heal) {
                    const healAmount = Math.floor(gameState.enemyMaxHP * (move.heal / 100));
                    gameState.enemyHP = Math.min(gameState.enemyMaxHP, gameState.enemyHP + healAmount);
                    addLog(`${enemy.name} recovered health!`, 'enemy');
                    AudioSystem.playSound('heal');
                    updateHPBars();
                    endEnemyTurn();
                    return;
                }
                
                // Stat boost
                if (move.boost) {
                    Object.entries(move.boost).forEach(([stat, amount]) => {
                        gameState.enemyBoosts[stat] = Math.min(6, gameState.enemyBoosts[stat] + amount);
                    });
                    addLog(`${enemy.name}'s stats rose!`, 'enemy');
                    endEnemyTurn();
                    return;
                }
                
                const result = calculateDamage(move, enemy, player, false);
                gameState.playerHP = Math.max(0, gameState.playerHP - result.damage);
                
                showDamageNumber(result.damage, 'player', result.isCritical);
                
                if (result.effectiveness > 1) {
                    addLog("It's super effective!", 'enemy');
                } else if (result.effectiveness < 1 && result.effectiveness > 0) {
                    addLog("It's not very effective...", 'enemy');
                }
                
                if (result.isCritical) {
                    addLog(`Critical hit! Took ${result.damage} damage!`, 'enemy');
                    AudioSystem.playSound('critical');
                    screenShake();
                } else {
                    addLog(`Took ${result.damage} damage!`, 'enemy');
                    AudioSystem.playSound('hit');
                }
                
                // Status effect
                if (move.effect && move.effectChance && Math.random() * 100 < move.effectChance) {
                    applyStatus('player', move.effect);
                }
                
                // Damage animation on back sprite
                const playerSpriteBack = document.getElementById('player-sprite-back');
                playerSpriteBack.classList.add('damaged');
                setTimeout(() => playerSpriteBack.classList.remove('damaged'), 400);
                
                updateHPBars();
                
                if (gameState.playerHP <= 0) {
                    endBattle(false);
                } else {
                    endEnemyTurn();
                }
            }, 300);
        }
        
        function endEnemyTurn() {
            // Player status damage
            if (gameState.playerStatus === 'brn' || gameState.playerStatus === 'psn') {
                const statusDamage = Math.floor(gameState.playerMaxHP / 16);
                gameState.playerHP = Math.max(0, gameState.playerHP - statusDamage);
                const statusName = gameState.playerStatus === 'brn' ? 'burn' : 'poison';
                addLog(`${CHARACTERS[gameState.playerKey].name} was hurt by ${statusName}!`, 'info');
                updateHPBars();
                
                if (gameState.playerHP <= 0) {
                    endBattle(false);
                    return;
                }
            }
            
            gameState.isPlayerTurn = true;
            updateTurnIndicator();
            renderMoves();
        }
        
        function getTypeEffectiveness(moveType, defenderType) {
            if (TYPE_CHART[moveType] && TYPE_CHART[moveType][defenderType] !== undefined) {
                return TYPE_CHART[moveType][defenderType];
            }
            return 1;
        }
        
        function applyStatus(target, status) {
            if (status === 'paralyze') status = 'par';
            
            if (target === 'player' && !gameState.playerStatus) {
                gameState.playerStatus = status;
                const statusNames = { par: 'paralyzed', brn: 'burned', psn: 'poisoned', slp: 'fell asleep' };
                addLog(`${CHARACTERS[gameState.playerKey].name} was ${statusNames[status]}!`, 'info');
                AudioSystem.playSound('select');
            } else if (target === 'enemy' && !gameState.enemyStatus) {
                gameState.enemyStatus = status;
                const statusNames = { par: 'paralyzed', brn: 'burned', psn: 'poisoned', slp: 'fell asleep' };
                addLog(`${CHARACTERS[gameState.enemyKey].name} was ${statusNames[status]}!`, 'info');
                AudioSystem.playSound('select');
            }
            updateStatusDisplay();
        }

        function calculateDamage(move, attacker, defender, isPlayer) {
            const level = isPlayer ? gameState.playerLevel : gameState.enemyLevel;
            const attackBoost = isPlayer ? gameState.playerBoosts.attack : gameState.enemyBoosts.attack;
            const defenseBoost = isPlayer ? gameState.enemyBoosts.defense : gameState.playerBoosts.defense;
            
            // Stat stage multipliers
            const atkMultiplier = [0.25, 0.28, 0.33, 0.4, 0.5, 0.67, 1, 1.5, 2, 2.5, 3, 3.5, 4][attackBoost + 6];
            const defMultiplier = [0.25, 0.28, 0.33, 0.4, 0.5, 0.67, 1, 1.5, 2, 2.5, 3, 3.5, 4][defenseBoost + 6];
            
            const attack = attacker.attack * atkMultiplier;
            const defense = defender.defense * defMultiplier;
            
            // Base damage formula (simplified Pokemon formula)
            let damage = Math.floor(((2 * level / 5 + 2) * move.power * attack / defense) / 50 + 2);
            
            // STAB (Same Type Attack Bonus)
            if (move.type === attacker.type) {
                damage = Math.floor(damage * 1.5);
            }
            
            // Type effectiveness
            const effectiveness = getTypeEffectiveness(move.type, defender.type);
            damage = Math.floor(damage * effectiveness);
            
            // Critical hit (6.25% base, 25% for high crit moves)
            const critChance = move.highCrit ? 0.25 : 0.0625;
            const isCritical = Math.random() < critChance;
            if (isCritical) {
                damage = Math.floor(damage * 1.5);
            }
            
            // Random variance (85-100%)
            damage = Math.floor(damage * (0.85 + Math.random() * 0.15));
            
            // Burn halves physical damage (simplified: all damage)
            const attackerStatus = isPlayer ? gameState.playerStatus : gameState.enemyStatus;
            if (attackerStatus === 'brn') {
                damage = Math.floor(damage * 0.5);
            }
            
            return { damage: Math.max(1, damage), isCritical, effectiveness };
        }
        
        function showDamageNumber(value, target, isCritical = false, isHeal = false) {
            const arena = document.getElementById('battle-arena');
            const num = document.createElement('div');
            num.className = 'damage-number' + (isCritical ? ' critical' : '') + (isHeal ? ' heal' : '') + (value === 'MISS' ? ' miss' : '');
            num.textContent = isHeal ? value : (value === 'MISS' ? 'MISS' : '-' + value);
            
            if (target === 'enemy') {
                num.style.right = '15%';
                num.style.top = '180px';
            } else {
                num.style.left = '15%';
                num.style.bottom = '200px';
            }
            
            arena.appendChild(num);
            setTimeout(() => num.remove(), 1200);
        }
        
        function showEffectivenessPopup(type) {
            const arena = document.getElementById('battle-arena');
            const popup = document.createElement('div');
            popup.className = 'effectiveness-popup ' + type;
            popup.textContent = type === 'super' ? "It's super effective!" : type === 'not-very' ? "Not very effective..." : "No effect!";
            arena.appendChild(popup);
            setTimeout(() => popup.remove(), 1500);
        }

        function updateHPBars() {
            const playerPercent = (gameState.playerHP / gameState.playerMaxHP) * 100;
            const enemyPercent = (gameState.enemyHP / gameState.enemyMaxHP) * 100;
            
            const playerBar = document.getElementById('player-hp-bar');
            const enemyBar = document.getElementById('enemy-hp-bar');
            
            playerBar.style.width = Math.max(0, playerPercent) + '%';
            enemyBar.style.width = Math.max(0, enemyPercent) + '%';
            
            playerBar.className = 'hp-bar-inner' + (playerPercent <= 20 ? ' low' : playerPercent <= 50 ? ' medium' : '');
            enemyBar.className = 'hp-bar-inner' + (enemyPercent <= 20 ? ' low' : enemyPercent <= 50 ? ' medium' : '');
            
            document.getElementById('player-hp').textContent = Math.max(0, gameState.playerHP);
        }

        function endBattle(won) {
            const result = document.getElementById('battle-result');
            const player = CHARACTERS[gameState.playerKey];
            const enemy = CHARACTERS[gameState.enemyKey];
            
            if (won) {
                // Calculate EXP and rewards
                const baseExp = Math.floor(enemy.hp * gameState.enemyLevel / 7);
                const expGain = Math.floor(baseExp * (gameState.enemyShiny ? 1.5 : 1));
                const pumpGain = Math.floor((200 + Math.random() * 300) * (gameState.enemyShiny ? 2 : 1));
                
                document.getElementById('result-title').textContent = 'VICTORY!';
                document.getElementById('result-subtitle').innerHTML = `
                    ${player.name} gained ${expGain} EXP!<br>
                    <span style="color: var(--primary)">+${pumpGain} $PUMP</span>
                    ${gameState.enemyShiny ? '<br><span style="color: #ec4899">‚ú® Shiny bonus!</span>' : ''}
                `;
                
                // Faint animation for enemy
                const enemySprite = document.getElementById('enemy-sprite');
                enemySprite.style.transition = 'all 0.5s';
                enemySprite.style.opacity = '0';
                enemySprite.style.transform = 'translateY(30px)';
                
                AudioSystem.playSound('victory');
            } else {
                document.getElementById('result-title').textContent = 'DEFEATED';
                document.getElementById('result-subtitle').textContent = 'Try again!';
                
                // Faint animation for player back sprite
                const playerSpriteBack = document.getElementById('player-sprite-back');
                playerSpriteBack.style.transition = 'all 0.5s';
                playerSpriteBack.style.opacity = '0';
                playerSpriteBack.style.transform = 'translateY(30px) rotate(10deg)';
                
                AudioSystem.playSound('defeat');
            }
            
            setTimeout(() => {
                result.style.display = 'block';
                result.classList.add('show');
            }, 600);
        }

        function resetBattle() {
            const result = document.getElementById('battle-result');
            result.style.display = 'none';
            result.classList.remove('show');
            initBattle();
        }

        function addLog(text, type = '') {
            const log = document.getElementById('battle-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + type;
            entry.textContent = '> ' + text;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function clearLog() {
            document.getElementById('battle-log').innerHTML = '';
        }

        function screenShake() {
            const arena = document.getElementById('battle-arena');
            arena.classList.add('shake');
            setTimeout(() => arena.classList.remove('shake'), 300);
        }

        // Modal
        function openModal() {
            renderCharacterGrid();
            const modal = document.getElementById('modal');
            modal.style.display = 'flex';
            modal.style.visibility = 'visible';
            modal.classList.add('show');
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            modal.style.display = 'none';
            modal.style.visibility = 'hidden';
            modal.classList.remove('show');
        }

        function confirmSelection() {
            gameState.playerKey = gameState.selectedChar;
            closeModal();
            initBattle();
            scrollToGame();
        }

        function scrollToGame() {
            document.getElementById('game').scrollIntoView({ behavior: 'smooth' });
        }

        // Add attack animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes attack {
                0%, 100% { transform: translateX(0) scaleX(-1); }
                50% { transform: translateX(30px) scaleX(-1); }
            }
            @keyframes attackEnemy {
                0%, 100% { transform: translateX(0); }
                50% { transform: translateX(-30px); }
            }
        `;
        document.head.appendChild(style);

        // Start
        AudioSystem.init();
        init();

        // Switch music on scroll
        let lastSection = 'main';
        window.addEventListener('scroll', () => {
            const gameSection = document.getElementById('game');
            const rect = gameSection.getBoundingClientRect();
            const inGame = rect.top < window.innerHeight * 0.5 && rect.bottom > window.innerHeight * 0.5;
            
            if (inGame && lastSection !== 'battle') {
                lastSection = 'battle';
                AudioSystem.switchTrack('battle');
            } else if (!inGame && lastSection !== 'main') {
                lastSection = 'main';
                AudioSystem.switchTrack('main');
            }
        });
    </script>
</body>
</html>