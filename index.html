<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PumpMon</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Add these CDN scripts to your HTML head -->
<script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
<script src="https://unpkg.com/@solana/spl-token@0.3.8/lib/index.iife.min.js"></script>
    <style>
       /* ================================
   CSS VARIABLES & RESET
   ================================ */
* { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
}

:root {
    --primary: #ffd93d;
    --bg: #0a0a0f;
    --bg-card: #12121a;
    --text: #ffffff;
    --text-muted: #888;
    --border: #2a2a3a;
    --green: #22c55e;
    --red: #ef4444;
    --blue: #3b82f6;
}

body {
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    overflow-x: hidden;
}

/* ================================
   ANIMATED BACKGROUND
   ================================ */
.bg-animation {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    overflow: hidden;
    background: 
        radial-gradient(ellipse at 20% 20%, rgba(255, 95, 95, 0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 30%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 80%, rgba(255, 217, 61, 0.12) 0%, transparent 50%),
        linear-gradient(180deg, 
            #0a0a1a 0%,
            #1a1a3a 25%,
            #0d1f3c 50%,
            #1a0a2e 75%,
            #0a0a1a 100%
        );
}

/* Retro Scanlines */
.scanlines {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.15) 0px,
        rgba(0, 0, 0, 0.15) 1px,
        transparent 1px,
        transparent 2px
    );
    pointer-events: none;
    z-index: 100;
    opacity: 0.5;
}

/* CRT Glow Effect */
.crt-glow {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    box-shadow: inset 0 0 150px rgba(255, 217, 61, 0.03);
    pointer-events: none;
}

/* Pixel Stars */
.pixel-stars {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.star {
    position: absolute;
    background: #fff;
    animation: twinkle 2s ease-in-out infinite;
    image-rendering: pixelated;
}

.star.small { width: 2px; height: 2px; }
.star.medium { width: 3px; height: 3px; box-shadow: 0 0 8px #fff, 0 0 12px rgba(255,255,255,0.5); }
.star.large { width: 4px; height: 4px; box-shadow: 0 0 12px #ffd93d, 0 0 24px #ffd93d, 0 0 36px rgba(255,217,61,0.3); }

.star:nth-child(1) { left: 5%; top: 10%; animation-delay: 0s; }
.star:nth-child(2) { left: 15%; top: 25%; animation-delay: 0.3s; }
.star:nth-child(3) { left: 25%; top: 8%; animation-delay: 0.6s; }
.star:nth-child(4) { left: 35%; top: 30%; animation-delay: 0.9s; }
.star:nth-child(5) { left: 45%; top: 15%; animation-delay: 1.2s; }
.star:nth-child(6) { left: 55%; top: 5%; animation-delay: 0.2s; }
.star:nth-child(7) { left: 65%; top: 20%; animation-delay: 0.5s; }
.star:nth-child(8) { left: 75%; top: 12%; animation-delay: 0.8s; }
.star:nth-child(9) { left: 85%; top: 28%; animation-delay: 1.1s; }
.star:nth-child(10) { left: 95%; top: 8%; animation-delay: 1.4s; }
.star:nth-child(11) { left: 10%; top: 45%; animation-delay: 0.4s; }
.star:nth-child(12) { left: 30%; top: 55%; animation-delay: 0.7s; }
.star:nth-child(13) { left: 50%; top: 40%; animation-delay: 1s; }
.star:nth-child(14) { left: 70%; top: 50%; animation-delay: 1.3s; }
.star:nth-child(15) { left: 90%; top: 45%; animation-delay: 0.1s; }
.star:nth-child(16) { left: 20%; top: 70%; animation-delay: 0.6s; }
.star:nth-child(17) { left: 40%; top: 75%; animation-delay: 0.9s; }
.star:nth-child(18) { left: 60%; top: 65%; animation-delay: 1.2s; }
.star:nth-child(19) { left: 80%; top: 72%; animation-delay: 0.3s; }
.star:nth-child(20) { left: 8%; top: 85%; animation-delay: 0.8s; }

@keyframes twinkle {
    0%, 100% { opacity: 0.2; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.8); }
}

/* Pokemon Type Energy Orbs */
.orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.5;
    animation: orbFloat 20s ease-in-out infinite;
}

.orb-1 {
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, 
        rgba(255, 95, 95, 0.8) 0%, 
        rgba(255, 60, 0, 0.5) 30%,
        rgba(255, 165, 0, 0.3) 50%,
        transparent 70%
    );
    top: -200px;
    left: -200px;
    animation-delay: 0s;
}

.orb-2 {
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, 
        rgba(59, 130, 246, 0.8) 0%, 
        rgba(37, 99, 235, 0.5) 30%,
        rgba(96, 165, 250, 0.3) 50%,
        transparent 70%
    );
    top: 35%;
    right: -150px;
    animation-delay: -5s;
}

.orb-3 {
    width: 550px;
    height: 550px;
    background: radial-gradient(circle, 
        rgba(255, 217, 61, 0.9) 0%, 
        rgba(250, 204, 21, 0.5) 30%,
        rgba(253, 224, 71, 0.3) 50%,
        transparent 70%
    );
    bottom: -200px;
    left: 15%;
    animation-delay: -10s;
}

.orb-4 {
    width: 450px;
    height: 450px;
    background: radial-gradient(circle, 
        rgba(168, 85, 247, 0.8) 0%, 
        rgba(139, 92, 246, 0.5) 30%,
        rgba(192, 132, 252, 0.3) 50%,
        transparent 70%
    );
    top: 55%;
    left: 55%;
    animation-delay: -15s;
}

.orb-5 {
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, 
        rgba(34, 197, 94, 0.7) 0%, 
        rgba(22, 163, 74, 0.4) 30%,
        rgba(74, 222, 128, 0.2) 50%,
        transparent 70%
    );
    top: 20%;
    left: 40%;
    animation-delay: -8s;
    animation-duration: 25s;
}

@keyframes orbFloat {
    0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.4; }
    25% { transform: translate(40px, -50px) scale(1.15); opacity: 0.6; }
    50% { transform: translate(-30px, 30px) scale(0.9); opacity: 0.35; }
    75% { transform: translate(35px, 25px) scale(1.1); opacity: 0.55; }
}

/* Pixel Grid Pattern */
.grid-pattern {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        linear-gradient(rgba(255,217,61,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,217,61,0.03) 1px, transparent 1px);
    background-size: 32px 32px;
    opacity: 0.6;
}

/* Floating Pokeballs */
.pokeball-particles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.pokeball {
    position: absolute;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: linear-gradient(180deg, 
        #ff5f5f 0%, #ff5f5f 45%, 
        #2a2a3e 45%, #2a2a3e 55%, 
        #fff 55%, #fff 100%
    );
    opacity: 0.12;
    animation: floatPokeball 25s linear infinite;
    box-shadow: 0 0 10px rgba(255, 95, 95, 0.3);
}

.pokeball::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    background: #fff;
    border-radius: 50%;
    border: 2px solid #2a2a3e;
    box-shadow: 0 0 4px rgba(255,255,255,0.5);
}

.pokeball:nth-child(1) { left: 5%; animation-delay: 0s; animation-duration: 28s; }
.pokeball:nth-child(2) { left: 15%; animation-delay: -4s; animation-duration: 24s; width: 18px; height: 18px; }
.pokeball:nth-child(3) { left: 25%; animation-delay: -8s; animation-duration: 30s; width: 28px; height: 28px; }
.pokeball:nth-child(4) { left: 35%; animation-delay: -2s; animation-duration: 22s; }
.pokeball:nth-child(5) { left: 45%; animation-delay: -12s; animation-duration: 26s; width: 20px; height: 20px; }
.pokeball:nth-child(6) { left: 55%; animation-delay: -6s; animation-duration: 28s; width: 26px; height: 26px; }
.pokeball:nth-child(7) { left: 65%; animation-delay: -14s; animation-duration: 25s; }
.pokeball:nth-child(8) { left: 75%; animation-delay: -1s; animation-duration: 30s; width: 18px; height: 18px; }
.pokeball:nth-child(9) { left: 85%; animation-delay: -10s; animation-duration: 23s; width: 28px; height: 28px; }
.pokeball:nth-child(10) { left: 92%; animation-delay: -7s; animation-duration: 27s; }

@keyframes floatPokeball {
    0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
    3% { opacity: 0.12; }
    97% { opacity: 0.12; }
    100% { transform: translateY(-10vh) rotate(1080deg); opacity: 0; }
}

/* Battle Energy Sparkles */
.sparkles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.sparkle {
    position: absolute;
    width: 12px;
    height: 12px;
    background: transparent;
    animation: sparkleAnim 2.5s ease-in-out infinite;
}

.sparkle::before,
.sparkle::after {
    content: '';
    position: absolute;
    background: linear-gradient(90deg, transparent, #ffd93d, transparent);
    border-radius: 2px;
}

.sparkle::before {
    width: 100%;
    height: 3px;
    top: 50%;
    left: 0;
    transform: translateY(-50%);
}

.sparkle::after {
    width: 3px;
    height: 100%;
    left: 50%;
    top: 0;
    transform: translateX(-50%);
    background: linear-gradient(180deg, transparent, #ffd93d, transparent);
}

.sparkle:nth-child(1) { left: 8%; top: 15%; animation-delay: 0s; }
.sparkle:nth-child(2) { left: 22%; top: 35%; animation-delay: 0.4s; }
.sparkle:nth-child(3) { left: 38%; top: 18%; animation-delay: 0.8s; }
.sparkle:nth-child(4) { left: 52%; top: 42%; animation-delay: 1.2s; }
.sparkle:nth-child(5) { left: 68%; top: 22%; animation-delay: 1.6s; }
.sparkle:nth-child(6) { left: 82%; top: 38%; animation-delay: 2s; }
.sparkle:nth-child(7) { left: 12%; top: 58%; animation-delay: 0.2s; }
.sparkle:nth-child(8) { left: 42%; top: 68%; animation-delay: 0.6s; }
.sparkle:nth-child(9) { left: 72%; top: 62%; animation-delay: 1s; }
.sparkle:nth-child(10) { left: 88%; top: 52%; animation-delay: 1.4s; }
.sparkle:nth-child(11) { left: 18%; top: 82%; animation-delay: 1.8s; }
.sparkle:nth-child(12) { left: 58%; top: 78%; animation-delay: 0.3s; }

@keyframes sparkleAnim {
    0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
    50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
}

/* Type Symbols */
.type-symbols {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.type-symbol {
    position: absolute;
    font-size: 20px;
    opacity: 0.08;
    animation: floatSymbol 30s linear infinite;
    filter: blur(1px);
}

.type-symbol:nth-child(1) { left: 8%; animation-delay: 0s; }
.type-symbol:nth-child(2) { left: 18%; animation-delay: -5s; }
.type-symbol:nth-child(3) { left: 28%; animation-delay: -10s; }
.type-symbol:nth-child(4) { left: 38%; animation-delay: -15s; }
.type-symbol:nth-child(5) { left: 48%; animation-delay: -20s; }
.type-symbol:nth-child(6) { left: 58%; animation-delay: -3s; }
.type-symbol:nth-child(7) { left: 68%; animation-delay: -8s; }
.type-symbol:nth-child(8) { left: 78%; animation-delay: -13s; }
.type-symbol:nth-child(9) { left: 88%; animation-delay: -18s; }
.type-symbol:nth-child(10) { left: 95%; animation-delay: -23s; }

@keyframes floatSymbol {
    0% { transform: translateY(110vh) rotate(0deg) scale(1); opacity: 0; }
    5% { opacity: 0.08; }
    50% { transform: translateY(50vh) rotate(180deg) scale(1.2); }
    95% { opacity: 0.08; }
    100% { transform: translateY(-10vh) rotate(360deg) scale(1); opacity: 0; }
}

/* Energy Wave */
.energy-wave {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 200%;
    height: 200px;
    background: linear-gradient(180deg, 
        transparent 0%,
        rgba(153, 69, 255, 0.08) 30%,
        rgba(20, 241, 149, 0.1) 60%,
        rgba(255, 217, 61, 0.08) 100%
    );
    animation: waveMove 12s linear infinite;
}

@keyframes waveMove {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
}

/* Battle Border */
.battle-border {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    box-shadow: 
        inset 0 0 100px rgba(255, 217, 61, 0.03),
        inset 0 0 200px rgba(139, 92, 246, 0.02);
    animation: borderPulse 4s ease-in-out infinite;
}

@keyframes borderPulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

/* Floating Character Pills */
.floating-pills {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    pointer-events: none;
    z-index: 2;
}

.floating-pill {
    position: absolute;
    width: 55px;
    height: 55px;
    opacity: 0.2;
    animation: floatPillUp 20s linear infinite;
    filter: drop-shadow(0 0 15px rgba(255, 217, 61, 0.6)) drop-shadow(0 0 30px rgba(139, 92, 246, 0.3));
}

.floating-pill img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 50%;
}

.floating-pill:nth-child(1) { left: 5%; bottom: -60px; animation-delay: 0s; animation-duration: 25s; }
.floating-pill:nth-child(2) { left: 15%; bottom: -60px; animation-delay: 3s; animation-duration: 22s; width: 35px; height: 35px; }
.floating-pill:nth-child(3) { left: 25%; bottom: -60px; animation-delay: 6s; animation-duration: 28s; width: 55px; height: 55px; }
.floating-pill:nth-child(4) { left: 35%; bottom: -60px; animation-delay: 2s; animation-duration: 24s; }
.floating-pill:nth-child(5) { left: 45%; bottom: -60px; animation-delay: 8s; animation-duration: 26s; width: 40px; height: 40px; }
.floating-pill:nth-child(6) { left: 55%; bottom: -60px; animation-delay: 4s; animation-duration: 21s; width: 50px; height: 50px; }
.floating-pill:nth-child(7) { left: 65%; bottom: -60px; animation-delay: 10s; animation-duration: 27s; }
.floating-pill:nth-child(8) { left: 75%; bottom: -60px; animation-delay: 1s; animation-duration: 20s; width: 35px; height: 35px; }
.floating-pill:nth-child(9) { left: 85%; bottom: -60px; animation-delay: 7s; animation-duration: 24s; width: 55px; height: 55px; }

@keyframes floatPillUp {
    0% { transform: translateY(0) rotate(0deg) scale(0.8); opacity: 0; }
    5% { opacity: 0.25; }
    50% { transform: translateY(-55vh) rotate(180deg) scale(1); }
    95% { opacity: 0.25; }
    100% { transform: translateY(-110vh) rotate(360deg) scale(0.8); opacity: 0; }
}

/* ================================
   NAVIGATION
   ================================ */
nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    padding: 16px 24px;
    background: rgba(10, 10, 15, 0.8);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 1000;
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 1001;
}

.logo-img {
    width: 60px;
    height: 60px;
    object-fit: contain;
}

.logo-text {
    font-family: 'Press Start 2P', cursive;
    font-size: 1rem;
    color: var(--primary);
}

/* Hamburger Menu */
.hamburger {
    display: none;
    flex-direction: column;
    justify-content: center;
    gap: 5px;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 10px;
    z-index: 1001;
}

.hamburger-line {
    width: 28px;
    height: 3px;
    background: var(--text);
    border-radius: 3px;
    transition: all 0.3s ease;
}

.hamburger.active .hamburger-line:nth-child(1) {
    transform: rotate(45deg) translate(6px, 6px);
}

.hamburger.active .hamburger-line:nth-child(2) {
    opacity: 0;
}

.hamburger.active .hamburger-line:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
}

.nav-links {
    display: flex;
    gap: 24px;
    align-items: center;
}

.nav-links a {
    color: var(--text-muted);
    text-decoration: none;
    font-size: 0.9rem;
    transition: color 0.2s;
}

.nav-links a:hover { 
    color: var(--text); 
}

.music-btn {
    background: var(--bg-card);
    border: 1px solid var(--border);
    color: var(--text);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.1rem;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.music-btn:hover {
    border-color: var(--primary);
    transform: scale(1.1);
}

.music-btn.playing {
    background: var(--primary);
    color: #000;
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(255, 217, 61, 0.4); }
    50% { box-shadow: 0 0 0 10px rgba(255, 217, 61, 0); }
}

/* ================================
   BUTTONS
   ================================ */
.btn {
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
    font-size: 0.9rem;
}

.btn-primary {
    background: var(--primary);
    color: #000;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(255, 217, 61, 0.3);
}

.btn-secondary {
    background: var(--bg-card);
    color: var(--text);
    border: 1px solid var(--border);
}

.btn-secondary:hover {
    border-color: var(--primary);
}

.btn-wallet {
    background: linear-gradient(135deg, #9945FF 0%, #14F195 100%);
    color: #fff;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    padding: 10px 16px;
}

.btn-wallet .solana-logo {
    flex-shrink: 0;
}

.btn-wallet:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(153, 69, 255, 0.4);
}

.btn-wallet.connected {
    background: linear-gradient(135deg, #14F195 0%, #9945FF 100%);
}

/* ================================
   HERO SECTION
   ================================ */
.hero {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 100px 24px 60px;
    position: relative;
    z-index: 1;
    overflow: hidden;
}

.hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url('assets/images/hero-bg.png');
    background-size: cover;
    background-position: center 70%;
    background-repeat: no-repeat;
    opacity: 0.60;
    z-index: -2;
}

.hero::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
        180deg,
        rgba(10, 10, 26, 0.85) 0%,
        rgba(10, 10, 26, 0.6) 50%,
        rgba(10, 10, 26, 0.9) 100%
    );
    z-index: -1;
}

.hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(18, 18, 30, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border);
    border-radius: 50px;
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-bottom: 24px;
}

.hero-badge .solana-logo-small {
    flex-shrink: 0;
}

.hero-badge .live { 
    color: var(--green); 
}

.hero-title {
    font-family: 'Press Start 2P', cursive;
    font-size: clamp(1.8rem, 5vw, 3rem);
    margin-bottom: 16px;
    line-height: 1.3;
    text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

.hero-title .highlight { 
    color: var(--primary); 
    text-shadow: 0 0 30px rgba(255, 217, 61, 0.5); 
}

.hero-subtitle {
    font-size: 1.1rem;
    color: var(--text-muted);
    max-width: 500px;
    margin-bottom: 40px;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
}

/* Character Preview */
.character-preview {
    display: flex;
    gap: 20px;
    margin-bottom: 40px;
    flex-wrap: wrap;
    justify-content: center;
}

.char-avatar {
    width: 150px;
    border-radius: 0px;
    background: transparent;
    border: none;
    overflow: visible;
    transition: all 0.3s;
    cursor: pointer;
    text-align: center;
    padding: 0;
}

.char-avatar .char-name {
    display: none;
    font-family: 'Press Start 2P', cursive;
    font-size: 0.55rem;
    color: var(--primary);
    margin: 8px 0 4px;
    text-shadow: 0 0 10px rgba(255, 217, 61, 0.3);
}

.char-avatar:hover {
    transform: scale(1.1) translateY(-10px);
    filter: drop-shadow(0 10px 30px rgba(255, 217, 61, 0.5));
}

.char-avatar img {
    width: 100%;
    height: 200px;
    object-fit: contain;
    padding: 0;
    border-radius: 8px;
    transition: all 0.3s;
}

.char-avatar .char-type {
    display: none;
    font-size: 0.6rem;
    color: var(--text-muted);
    text-transform: uppercase;
}

.char-avatar .char-type.water { color: #3b82f6; }
.char-avatar .char-type.electric { color: #fbbf24; }
.char-avatar .char-type.normal { color: #a3a3a3; }
.char-avatar .char-type.dark { color: #8b5cf6; }
.char-avatar .char-type.psychic { color: #ec4899; }

.cta-buttons {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    justify-content: center;
}

/* Contract Address */
.ca-container {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 24px;
    padding: 12px 20px;
    background: rgba(18, 18, 30, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border);
    border-radius: 50px;
    font-family: monospace;
    font-size: 0.8rem;
}

.ca-label {
    color: var(--primary);
    font-weight: 700;
}

.ca-address {
    color: var(--text-muted);
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.ca-copy {
    background: transparent;
    border: none;
    cursor: pointer;
    font-size: 1rem;
    transition: transform 0.2s;
}

.ca-copy:hover {
    transform: scale(1.2);
}

/* ================================
   GAME SECTION
   ================================ */
.game-wrapper {
    background: transparent;
    position: relative;
    z-index: 50;
}

.game-section {
    padding: 60px 24px;
    max-width: 1000px;
    margin: 0 auto;
    position: relative;
}

.section-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.2rem;
    text-align: center;
    margin-bottom: 40px;
}

.section-title .highlight { 
    color: var(--primary); 
}

/* Battle Arena */
.battle-arena {
    background-color: #228B22;
    background-image: url('assets/images/battle-bg.png');
    background-size: cover;
    background-position: center bottom;
    background-repeat: no-repeat;
    border-radius: 16px;
    height: 480px;
    position: relative;
    overflow: hidden;
    margin-bottom: 16px;
    border: 3px solid #1a1a2e;
    image-rendering: pixelated;
}

.battle-arena::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(180deg, #87CEEB 0%, #87CEEB 45%, #90EE90 65%, #228B22 100%);
    z-index: 0;
    opacity: 0;
    transition: opacity 0.3s;
}

.battle-arena.no-bg::before {
    opacity: 1;
}

.btn-shuffle {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text-muted);
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 0.8rem;
    margin-bottom: 20px;
    transition: all 0.3s;
}

.btn-shuffle:hover {
    border-color: var(--primary);
    color: var(--primary);
}

.sun {
    position: absolute;
    top: 20px;
    right: 30px;
    width: 50px;
    height: 50px;
    background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
    border-radius: 50%;
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
    z-index: 2;
    display: none;
}

.battle-arena.no-bg .sun {
    display: block;
}

/* HP Boxes */
.hp-box {
    position: absolute;
    background: #fff;
    border-radius: 10px;
    padding: 12px 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    min-width: 200px;
    z-index: 20;
}

.hp-box.enemy {
    top: 20px;
    left: 20px;
}

.hp-box.player {
    bottom: 20px;
    right: 20px;
}

.hp-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.pokemon-name {
    font-weight: 700;
    color: #333;
    font-size: 0.9rem;
}

.level {
    background: #333;
    color: #fff;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.7rem;
}

.hp-bar-outer {
    height: 8px;
    background: #e5e5e5;
    border-radius: 4px;
    overflow: hidden;
}

.hp-bar-inner {
    height: 100%;
    background: var(--green);
    border-radius: 4px;
    transition: width 0.5s;
}

.hp-bar-inner.medium { background: #eab308; }
.hp-bar-inner.low { background: var(--red); animation: hpPulse 0.5s infinite; }

@keyframes hpPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}

.hp-text {
    text-align: right;
    font-size: 0.7rem;
    color: #666;
    margin-top: 4px;
}

/* Status Badges */
.status-container {
    display: flex;
    gap: 4px;
    margin-top: 4px;
}

.status-badge {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.4rem;
    padding: 2px 4px;
    border-radius: 3px;
    color: #fff;
}

.status-par { background: #eab308; }
.status-brn { background: #f97316; }
.status-psn { background: #a855f7; }
.status-slp { background: #6b7280; }
.status-frz { background: #06b6d4; }

/* Sprites */
.sprite-player {
    display: none;
}

.sprite-player-back {
    position: absolute;
    left: -20px;
    bottom: -40px;
    width: 400px;
    height: 400px;
    animation: bounceBack 2.5s ease-in-out infinite;
    z-index: 10;
}

.sprite-player-back img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center bottom;
    filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.4));
}

@keyframes bounceBack {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}

.sprite-player-back.attacking {
    animation: attackBack 0.4s ease-out forwards;
}

@keyframes attackBack {
    0% { transform: translateX(0) translateY(0); }
    50% { transform: translateX(80px) translateY(-20px) scale(1.1); }
    100% { transform: translateX(0) translateY(0); }
}

.sprite-player-back.damaged {
    animation: damagedBack 0.5s ease-out;
}

@keyframes damagedBack {
    0%, 100% { transform: translateX(0); opacity: 1; }
    20% { transform: translateX(-15px); opacity: 0.4; filter: brightness(2); }
    40% { transform: translateX(15px); opacity: 0.6; }
    60% { transform: translateX(-8px); opacity: 0.8; }
    80% { transform: translateX(8px); opacity: 0.9; }
}

.sprite-enemy {
    position: absolute;
    right: 5%;
    bottom: 80px;
    width: 400px;
    height: 400px;
    animation: bounce 2.5s ease-in-out infinite;
    animation-delay: 0.5s;
    z-index: 5;
}

.sprite-enemy img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.35));
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}

.sprite-enemy.attacking {
    animation: attackEnemy 0.4s ease-out forwards;
}

@keyframes attackEnemy {
    0% { transform: translateX(0) translateY(0); }
    50% { transform: translateX(-80px) translateY(10px) scale(1.15); }
    100% { transform: translateX(0) translateY(0); }
}

.sprite-enemy.damaged {
    animation: damagedEnemy 0.5s ease-out;
}

@keyframes damagedEnemy {
    0%, 100% { transform: translateX(0); opacity: 1; }
    20% { transform: translateX(10px); opacity: 0.4; filter: brightness(2); }
    40% { transform: translateX(-10px); opacity: 0.6; }
    60% { transform: translateX(5px); opacity: 0.8; }
    80% { transform: translateX(-5px); opacity: 0.9; }
}

/* Shuffle Animation */
.character-preview.shuffling .char-avatar {
    animation: shuffleCard 0.6s ease-in-out;
}

.character-preview.shuffling .char-avatar:nth-child(1) { animation-delay: 0s; }
.character-preview.shuffling .char-avatar:nth-child(2) { animation-delay: 0.1s; }
.character-preview.shuffling .char-avatar:nth-child(3) { animation-delay: 0.2s; }
.character-preview.shuffling .char-avatar:nth-child(4) { animation-delay: 0.3s; }
.character-preview.shuffling .char-avatar:nth-child(5) { animation-delay: 0.4s; }
.character-preview.shuffling .char-avatar:nth-child(6) { animation-delay: 0.5s; }

@keyframes shuffleCard {
    0% { transform: translateY(0) rotateY(0); opacity: 1; }
    25% { transform: translateY(-30px) rotateY(90deg); opacity: 0.5; }
    50% { transform: translateY(0) rotateY(180deg); opacity: 0.3; }
    75% { transform: translateY(-15px) rotateY(270deg); opacity: 0.5; }
    100% { transform: translateY(0) rotateY(360deg); opacity: 1; }
}

/* Shiny Effect */
.sprite-player.shiny img,
.sprite-player-back.shiny img,
.sprite-enemy.shiny img {
    filter: drop-shadow(0 0 15px #ec4899) drop-shadow(0 8px 16px rgba(0,0,0,0.3)) hue-rotate(30deg);
}

/* Turn Indicator */
.turn-indicator {
    position: absolute;
    bottom: 1%;
    left: 50%;
    transform: translate(-50%);
    font-family: 'Press Start 2P', cursive;
    font-size: 0.65rem;
    background: rgba(0,0,0,0.9);
    color: var(--primary);
    padding: 10px 20px;
    border-radius: 25px;
    border: 2px solid var(--primary);
    z-index: 50;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.turn-indicator.enemy { 
    color: var(--red); 
    border-color: var(--red); 
}

/* Damage Numbers */
.damage-number {
    position: absolute;
    font-family: 'Press Start 2P', cursive;
    font-size: 1.5rem;
    color: #fff;
    text-shadow: 3px 3px 0 #000, -3px -3px 0 #000, 3px -3px 0 #000, -3px 3px 0 #000;
    animation: damageFloat 1.2s ease-out forwards;
    pointer-events: none;
    z-index: 100;
}

.damage-number.critical {
    font-size: 2rem;
    color: #fbbf24;
}

.damage-number.heal {
    color: #22c55e;
}

.damage-number.miss {
    font-size: 1rem;
    color: #888;
}

@keyframes damageFloat {
    0% { transform: translateY(0) scale(0.5); opacity: 1; }
    30% { transform: translateY(-30px) scale(1.3); opacity: 1; }
    100% { transform: translateY(-80px) scale(1); opacity: 0; }
}

/* Effectiveness Popup */
.effectiveness-popup {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'Press Start 2P', cursive;
    font-size: 0.75rem;
    padding: 10px 20px;
    border-radius: 8px;
    animation: popupShow 1.5s ease-out forwards;
    z-index: 100;
    white-space: nowrap;
}

.effectiveness-popup.super { background: var(--green); color: #fff; }
.effectiveness-popup.not-very { background: #6b7280; color: #fff; }
.effectiveness-popup.immune { background: #1f2937; color: #fff; }

@keyframes popupShow {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
    20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
    80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
}

/* Battle Intro */
.battle-intro {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 200;
    animation: introFade 2.5s ease-out forwards;
}

.battle-intro.hide { display: none; }

.intro-text {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.9rem;
    color: #fff;
    text-align: center;
}

.intro-text .shiny-name { color: #ec4899; }

@keyframes introFade {
    0%, 60% { opacity: 1; }
    100% { opacity: 0; pointer-events: none; }
}

/* Battle Menu */
.battle-menu {
    background: rgba(18, 18, 26, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    border: 1px solid rgba(42, 42, 58, 0.8);
    display: grid;
    grid-template-columns: 1fr 1.5fr;
    overflow: hidden;
    position: relative;
    z-index: 10;
}

.battle-log {
    padding: 16px;
    border-right: 1px solid rgba(42, 42, 58, 0.8);
    background: rgba(0, 0, 0, 0.8);
    min-height: 120px;
    max-height: 150px;
    overflow-y: auto;
}

.battle-log::-webkit-scrollbar {
    width: 4px;
}

.battle-log::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 2px;
}

.log-entry {
    font-size: 0.75rem;
    color: var(--green);
    padding: 3px 0;
    font-family: 'Press Start 2P', monospace;
    line-height: 1.5;
    word-wrap: break-word;
}

.log-entry.system { color: var(--primary); }
.log-entry.enemy { color: var(--red); }
.log-entry.info { color: var(--blue); }

.move-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    padding: 12px;
    background: rgba(18, 18, 26, 0.8);
}

.move-btn {
    background: rgba(10, 10, 15, 0.8);
    border: 2px solid rgba(42, 42, 58, 0.8);
    border-radius: 10px;
    padding: 12px;
    cursor: pointer;
    text-align: left;
    backdrop-filter: blur(5px);
    transition: all 0.2s;
}

.move-btn:hover:not(:disabled) {
    border-color: var(--primary);
    background: rgba(255, 217, 61, 0.1);
}

.move-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Battle Result */
.battle-result {
    display: none !important;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--bg-card);
    border: 3px solid var(--primary);
    border-radius: 20px;
    padding: 40px;
    text-align: center;
    z-index: 500;
}

.battle-result.show { display: block !important; }

.result-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.5rem;
    color: var(--primary);
    margin-bottom: 16px;
}

.result-subtitle {
    color: var(--text-muted);
    margin-bottom: 24px;
}

.battle-arena.shake {
    animation: screenShake 0.3s ease-out;
}

@keyframes screenShake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    75% { transform: translateX(-3px); }
}

/* ================================
   SAFARI ZONE GAME - FULLSCREEN
   ================================ */

/* Safari Zone Entry Section */
.safari-zone {
    padding: 80px 24px;
    background: transparent;
    position: relative;
    z-index: 10;
}

.safari-container {
    max-width: 600px;
    margin: 0 auto;
    text-align: center;
}

.safari-card {
    background: rgba(26, 26, 46, 0.9);
    backdrop-filter: blur(10px);
    border: 2px solid var(--primary);
    border-radius: 24px;
    padding: 40px 32px;
    margin-top: 32px;
    box-shadow: 0 0 40px rgba(255, 217, 61, 0.15);
}

.safari-icon {
    font-size: 4rem;
    margin-bottom: 20px;
}

.safari-info {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    flex-wrap: wrap;
    margin-bottom: 20px;
}

.safari-tokens {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.2rem;
    color: #fff;
}

.safari-equals {
    font-size: 1.5rem;
    color: var(--primary);
}

.safari-reward {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.9rem;
    color: var(--primary);
    background: rgba(255, 217, 61, 0.1);
    padding: 12px 20px;
    border-radius: 12px;
    border: 1px solid var(--primary);
}

.safari-desc {
    color: var(--text-muted);
    font-size: 0.95rem;
    margin-bottom: 24px;
}

.ticket-display {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-bottom: 20px;
    font-family: 'Press Start 2P', cursive;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.ticket-display .count {
    color: var(--primary);
    font-size: 1rem;
}

/* Safari Modal - FULLSCREEN */
.safari-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 3000;
}

.safari-modal.show {
    display: flex;
}

/* Background Image Layer */
.safari-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
}

.safari-bg-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.4;
}

/* Fallback gradient if no image */
.safari-bg-fallback {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(ellipse at 30% 20%, rgba(34, 197, 94, 0.3) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 60%, rgba(251, 191, 36, 0.2) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 90%, rgba(59, 130, 246, 0.2) 0%, transparent 50%),
        linear-gradient(180deg, #0a1a0a 0%, #1a2a1a 30%, #0d2a1a 60%, #0a1a0a 100%);
}

/* Animated particles overlay */
.safari-bg-particles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: hidden;
}

.safari-particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    animation: floatParticle 15s linear infinite;
}

.safari-particle:nth-child(1) { left: 10%; animation-delay: 0s; }
.safari-particle:nth-child(2) { left: 20%; animation-delay: 2s; }
.safari-particle:nth-child(3) { left: 30%; animation-delay: 4s; }
.safari-particle:nth-child(4) { left: 40%; animation-delay: 1s; }
.safari-particle:nth-child(5) { left: 50%; animation-delay: 3s; }
.safari-particle:nth-child(6) { left: 60%; animation-delay: 5s; }
.safari-particle:nth-child(7) { left: 70%; animation-delay: 2.5s; }
.safari-particle:nth-child(8) { left: 80%; animation-delay: 4.5s; }
.safari-particle:nth-child(9) { left: 90%; animation-delay: 1.5s; }
.safari-particle:nth-child(10) { left: 95%; animation-delay: 3.5s; }

@keyframes floatParticle {
    0% { transform: translateY(100vh) scale(0); opacity: 0; }
    10% { opacity: 0.6; }
    90% { opacity: 0.6; }
    100% { transform: translateY(-10vh) scale(1); opacity: 0; }
}

/* Vignette overlay */
.safari-vignette {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    box-shadow: inset 0 0 200px rgba(0, 0, 0, 0.8);
    pointer-events: none;
}

/* Main Game Container - Centered */
.safari-game-container {
    position: relative;
    z-index: 10;
    background: rgba(10, 20, 10, 0.85);
    backdrop-filter: blur(20px);
    border: 3px solid #2d5a2d;
    border-radius: 24px;
    width: 95%;
    max-width: 900px;
    height: 90vh;
    max-height: 800px;
    margin: auto;
    display: flex;
    flex-direction: column;
    box-shadow: 
        0 0 80px rgba(34, 197, 94, 0.3),
        0 0 150px rgba(34, 197, 94, 0.1),
        inset 0 0 100px rgba(0, 0, 0, 0.3);
    overflow: hidden;
}

/* Safari Header */
.safari-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 28px;
    background: rgba(0, 0, 0, 0.6);
    border-bottom: 2px solid #2d5a2d;
}

.safari-biome-name {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.85rem;
    color: var(--green);
    text-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
}

.safari-header-right {
    display: flex;
    align-items: center;
    gap: 20px;
}

.safari-actions-left {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.75rem;
    color: var(--primary);
    text-shadow: 0 0 10px rgba(255, 217, 61, 0.5);
}

.safari-exit-btn {
    background: rgba(239, 68, 68, 0.2);
    border: 2px solid var(--red);
    color: var(--red);
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.2s;
}

.safari-exit-btn:hover {
    background: var(--red);
    color: #fff;
    transform: scale(1.05);
}

/* Safari Game Area */
.safari-game-area {
    flex: 1;
    padding: 30px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.safari-screen {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    max-width: 700px;
    min-height: 450px;
}

.safari-screen.hidden {
    display: none;
}

.safari-screen-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.1rem;
    color: var(--primary);
    margin-bottom: 32px;
    text-align: center;
    text-shadow: 0 0 20px rgba(255, 217, 61, 0.4);
}

/* Biome Selection */
.biome-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    width: 100%;
    max-width: 600px;
}

.biome-card {
    background: rgba(0, 0, 0, 0.5);
    border: 3px solid #2d5a2d;
    border-radius: 16px;
    padding: 30px 24px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
}

.biome-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.3s;
}

.biome-card:hover {
    border-color: var(--green);
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 15px 40px rgba(34, 197, 94, 0.3);
}

.biome-card:hover::before {
    opacity: 1;
}

.biome-card.locked {
    opacity: 0.5;
    cursor: not-allowed;
}

.biome-card.locked:hover {
    transform: none;
    border-color: #2d5a2d;
    box-shadow: none;
}

.biome-emoji {
    font-size: 4rem;
    margin-bottom: 16px;
    display: block;
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
}

.biome-name {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.8rem;
    color: #fff;
    margin-bottom: 8px;
}

.biome-difficulty {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-transform: uppercase;
    font-weight: 600;
}

.biome-difficulty.easy { color: var(--green); }
.biome-difficulty.medium { color: var(--primary); }
.biome-difficulty.hard { color: #f97316; }
.biome-difficulty.extreme { color: var(--red); }

/* Exploration Screen */
.safari-environment {
    width: 100%;
    height: 150px;
    background-image: url('assets/images/battle-arena.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: 12px;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    gap: 30px;
    padding-bottom: 20px;
}

.safari-grass {
    width: 50px;
    height: 70px;
    background: linear-gradient(180deg, #32CD32 0%, #228B22 100%);
    border-radius: 50% 50% 0 0;
    position: relative;
    animation: grassSway 2s ease-in-out infinite;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.safari-grass:nth-child(2) {
    animation-delay: 0.3s;
    height: 85px;
}

.safari-grass:nth-child(3) {
    animation-delay: 0.6s;
}

@keyframes grassSway {
    0%, 100% { transform: rotate(-5deg); }
    50% { transform: rotate(5deg); }
}

.safari-message {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.85rem;
    color: #fff;
    text-align: center;
    padding: 24px 32px;
    background: rgba(0, 0, 0, 0.7);
    border: 2px solid #3d5a3d;
    border-radius: 16px;
    margin-bottom: 28px;
    line-height: 1.8;
    min-height: 80px;
    max-width: 500px;
}

.safari-explore-btn {
    padding: 20px 60px;
    font-size: 1.1rem;
    font-family: 'Press Start 2P', cursive;
    background: linear-gradient(135deg, var(--green) 0%, #16a34a 100%);
    border: none;
    color: #fff;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
}

.safari-explore-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 10px 30px rgba(34, 197, 94, 0.5);
}

/* ================================
   ENCOUNTER SCREEN - IMMERSIVE
   ================================ */

#encounter-screen {
    display: flex;
    flex-direction: column;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    padding: 0 !important;
    margin: 0 !important;
    max-width: none !important;
    min-height: auto !important;
    overflow: hidden;
}

#encounter-screen.hidden {
    display: none !important;
}

/* Game Scene - Full Background */
.encounter-scene {
    flex: 1;
    width: 100%;
    background: url('assets/images/battle-arena.jpg') center center / cover no-repeat;
    position: relative;
    overflow: hidden;
}

/* Creature - Anchored to Ground */
.encounter-creature {
    position: absolute;
    bottom: 80px;
    right: 50%;
    left: 50%;
    top: 10%;
    transform: translateX(-50%);
}

.encounter-creature img {
    width: 140px;
    height: 140px;
    object-fit: contain;
    animation: creatureBounce 1.5s ease-in-out infinite;
    filter: drop-shadow(0 8px 16px rgba(0,0,0,0.5));
}

@keyframes creatureBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.encounter-creature img.shake {
    animation: creatureShake 0.5s ease-out;
}

@keyframes creatureShake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-12px) rotate(-5deg); }
    40% { transform: translateX(12px) rotate(5deg); }
    60% { transform: translateX(-8px); }
    80% { transform: translateX(8px); }
}

.encounter-creature img.caught {
    animation: creatureCaught 0.8s ease-out forwards;
}

@keyframes creatureCaught {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.3); filter: brightness(2); }
    100% { transform: scale(0); opacity: 0; }
}

@keyframes creatureFled {
    0% { transform: translateX(0); opacity: 1; }
    100% { transform: translateX(300px); opacity: 0; }
}

@keyframes creatureFled {
    0% { transform: translateX(0); opacity: 1; }
    100% { transform: translateX(300px); opacity: 0; }
}

/* Creature Info - Top Overlay */
.creature-info-overlay {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.85);
    padding: 12px 24px;
    border-radius: 12px;
    text-align: center;
    border: 2px solid rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    z-index: 10;
}

.creature-info-overlay .creature-name {
    font-family: 'Press Start 2P', cursive;
    font-size: 1rem;
    color: #fff;
    display: block;
    margin-bottom: 8px;
    text-shadow: 0 2px 8px rgba(0,0,0,0.5);
}

.creature-info-overlay .creature-rarity {
    font-size: 0.7rem;
    padding: 4px 14px;
    border-radius: 20px;
    text-transform: uppercase;
    font-weight: 700;
    display: inline-block;
}

.creature-rarity.common { background: #6b7280; color: #fff; }
.creature-rarity.uncommon { background: #22c55e; color: #fff; }
.creature-rarity.rare { background: #3b82f6; color: #fff; }
.creature-rarity.epic { background: #a855f7; color: #fff; }
.creature-rarity.legendary { background: linear-gradient(90deg, #fbbf24, #f97316); color: #000; }

.creature-status {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin-top: 10px;
}

.status-effect {
    font-size: 0.55rem;
    padding: 4px 10px;
    border-radius: 6px;
    background: rgba(0,0,0,0.6);
    font-weight: 600;
}

.status-effect.eating { color: #fbbf24; border: 1px solid #fbbf24; }
.status-effect.angry { color: #ef4444; border: 1px solid #ef4444; }

/* Creature - Grounded on Grass */
.encounter-creature {
    position: absolute;
    bottom: 15%;
    left: 50%;
    transform: translateX(-50%);
    z-index: 5;
}

/* UI Panel - Below Scene (Separated) */
.encounter-ui-panel {
    background: rgba(10, 20, 10, 0.98);
    border-top: 3px solid #2d5a2d;
    padding: 16px 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    flex-shrink: 0;
}

/* Encounter Log */
.encounter-log {
    background: rgba(0, 0, 0, 0.6);
    border: 2px solid #3d5a3d;
    border-radius: 10px;
    padding: 12px 16px;
    min-height: 45px;
    max-height: 60px;
    overflow-y: auto;
}

.encounter-log-entry {
    font-size: 0.65rem;
    color: #22c55e;
    padding: 2px 0;
    font-family: 'Press Start 2P', cursive;
    line-height: 1.4;
}   

.encounter-log-entry.warning { color: #ffd93d; }
.encounter-log-entry.danger { color: #ef4444; }
.encounter-log-entry.success { color: #22c55e; }

/* Action Buttons - Clean Grid */
.encounter-actions {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
}


.encounter-btn {
    background: rgba(0, 0, 0, 0.7);
    border: 2px solid #3d5a3d;
    border-radius: 10px;
    padding: 12px 8px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.encounter-btn:hover:not(:disabled) {
    transform: translateY(-2px);
}

.encounter-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.encounter-btn-icon {
    font-size: 1.6rem;
}

.encounter-btn-label {
    font-size: 0.6rem;
    color: #888;
    font-weight: 600;
}

.encounter-btn-count {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.55rem;
    color: #ffd93d;
}

.creature-info-overlay {
    animation: popupFade 3s ease-out forwards;
}

@keyframes popupFade {
    0% { opacity: 0; transform: translateX(-50%) scale(0.8); }
    10% { opacity: 1; transform: translateX(-50%) scale(1); }
    80% { opacity: 1; transform: translateX(-50%) scale(1); }
    100% { opacity: 0; transform: translateX(-50%) scale(0.9); visibility: hidden; }
}

.encounter-btn.capsule:hover:not(:disabled) { 
    border-color: #ef4444; 
    background: rgba(239, 68, 68, 0.15);
}

.encounter-btn.bait:hover:not(:disabled) { 
    border-color: #fbbf24; 
    background: rgba(251, 191, 36, 0.15);
}

.encounter-btn.rock:hover:not(:disabled) { 
    border-color: #9ca3af; 
    background: rgba(156, 163, 175, 0.15);
}

.encounter-btn.run:hover:not(:disabled) { 
    border-color: #3b82f6; 
    background: rgba(59, 130, 246, 0.15);
}

/* Results Screen */
.results-stats {
    display: flex;
    gap: 24px;
    margin-bottom: 32px;
    flex-wrap: wrap;
    justify-content: center;
}

.result-stat {
    background: rgba(0, 0, 0, 0.5);
    border: 2px solid #3d5a3d;
    border-radius: 16px;
    padding: 24px 36px;
    text-align: center;
    min-width: 140px;
}

.result-label {
    font-size: 0.7rem;
    color: var(--text-muted);
    display: block;
    margin-bottom: 12px;
    text-transform: uppercase;
}

.result-value {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.8rem;
    color: var(--green);
    text-shadow: 0 0 15px rgba(34, 197, 94, 0.5);
}

.result-value.fled { color: var(--red); text-shadow: 0 0 15px rgba(239, 68, 68, 0.5); }
.result-value.rare { color: var(--primary); text-shadow: 0 0 15px rgba(255, 217, 61, 0.5); }

.results-creatures {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
    margin-bottom: 32px;
    max-height: 200px;
    overflow-y: auto;
    width: 100%;
    padding: 10px;
}

.result-creature {
    background: rgba(0, 0, 0, 0.5);
    border: 3px solid #3d5a3d;
    border-radius: 12px;
    padding: 16px;
    text-align: center;
    width: 100px;
    transition: transform 0.2s;
}

.result-creature:hover {
    transform: scale(1.05);
}

.result-creature img {
    width: 60px;
    height: 60px;
    object-fit: contain;
}

.result-creature .name {
    font-size: 0.55rem;
    color: #fff;
    margin-top: 8px;
    font-family: 'Press Start 2P', cursive;
}

.result-creature.rare { border-color: #3b82f6; box-shadow: 0 0 15px rgba(59, 130, 246, 0.3); }
.result-creature.epic { border-color: #a855f7; box-shadow: 0 0 15px rgba(168, 85, 247, 0.3); }
.result-creature.legendary { 
    border-color: #fbbf24; 
    box-shadow: 0 0 25px rgba(251, 191, 36, 0.4);
    animation: legendaryCreature 2s ease-in-out infinite;
}

@keyframes legendaryCreature {
    0%, 100% { box-shadow: 0 0 25px rgba(251, 191, 36, 0.4); }
    50% { box-shadow: 0 0 40px rgba(251, 191, 36, 0.7); }
}

.results-actions {
    display: flex;
    gap: 20px;
    justify-content: center;
}

.results-actions .btn {
    padding: 16px 32px;
    font-size: 0.9rem;
}

/* Safari Inventory Bar */
.safari-inventory {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 28px;
    padding: 18px 28px;
    background: rgba(0, 0, 0, 0.7);
    border-top: 2px solid #2d5a2d;
}

.inventory-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 10px;
}

.inv-icon {
    font-size: 1.5rem;
}

.inv-count {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.85rem;
    color: #fff;
}

.inventory-item.caught {
    border: 2px solid var(--green);
}

.inventory-item.caught .inv-count {
    color: var(--green);
}

.inventory-divider {
    width: 2px;
    height: 32px;
    background: #3d5a3d;
}

/* ================================
   HOW IT WORKS SECTION
   ================================ */
.how-it-works {
    padding: 100px 24px;
    background: transparent;
    position: relative;
    z-index: 10;
}

.how-container {
    max-width: 1000px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
}

.steps {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 30px;
}

.step {
    text-align: center;
    padding: 40px 28px;
    background: rgba(26, 26, 46, 0.85);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    border: 1px solid rgba(42, 42, 62, 0.8);
    transition: transform 0.3s, border-color 0.3s;
}

.step:hover {
    transform: translateY(-5px);
    border-color: var(--primary);
}

.step-icon {
    font-size: 3.5rem;
    margin-bottom: 24px;
    display: block;
    line-height: 1;
}

.step-title {
    font-family: 'Inter', sans-serif;
    font-weight: 700;
    font-size: 1.1rem;
    margin: 0 0 16px 0;
    color: #fff;
}

.step-desc {
    color: var(--text-muted);
    font-size: 0.95rem;
    line-height: 1.7;
    margin: 0;
}

/* ================================
   FOOTER
   ================================ */
footer {
    padding: 32px 24px 24px;
    text-align: center;
    border-top: 1px solid rgba(42, 42, 58, 0.5);
    background: transparent;
    position: relative;
    z-index: 10;
}

.footer-content {
    max-width: 700px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
}

.social-links {
    display: flex;
    gap: 16px;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
}

.social-links a {
    color: #a0a0a0;
    text-decoration: none;
    padding: 12px 24px;
    border: 1px solid rgba(42, 42, 62, 0.8);
    border-radius: 10px;
    background: rgba(26, 26, 46, 0.6);
    backdrop-filter: blur(5px);
    transition: all 0.3s;
    font-size: 0.9rem;
}

.social-links a:hover {
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-3px);
}

/* ================================
   MODALS
   ================================ */
.modal {
    display: none !important;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    visibility: hidden;
}

.modal.show { 
    display: flex !important; 
    visibility: visible;
}

.modal-content {
    background: var(--bg-card);
    border-radius: 20px;
    padding: 32px;
    max-width: 900px;
    width: 95%;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.1rem;
    text-align: center;
    margin-bottom: 28px;
    color: var(--primary);
    text-shadow: 0 0 20px rgba(255, 217, 61, 0.3);
}

/* Character Grid */
.character-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 24px;
}

.char-card {
    background: linear-gradient(145deg, rgba(26, 26, 46, 0.9) 0%, rgba(18, 18, 30, 0.95) 100%);
    border: 2px solid var(--border);
    border-radius: 16px;
    padding: 20px 16px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.char-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), transparent);
    opacity: 0;
    transition: opacity 0.3s;
}

.char-card:hover {
    border-color: var(--primary);
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(255, 217, 61, 0.15);
}

.char-card:hover::before {
    opacity: 1;
}

.char-card.selected {
    border-color: var(--primary);
    box-shadow: 0 0 30px rgba(255, 217, 61, 0.3), inset 0 0 20px rgba(255, 217, 61, 0.05);
}

.char-card.selected::before {
    opacity: 1;
}

.char-card img {
    width: 100px;
    height: 100px;
    object-fit: contain;
    border-radius: 12px;
    margin-bottom: 12px;
    background: rgba(0, 0, 0, 0.3);
    padding: 8px;
    transition: transform 0.3s;
}

.char-card:hover img {
    transform: scale(1.1);
}

.char-card .name {
    font-family: 'Press Start 2P', cursive;
    font-weight: 600;
    font-size: 0.75rem;
    color: var(--primary);
    margin-bottom: 6px;
}

.char-card .type-badge {
    display: inline-block;
    font-size: 0.65rem;
    padding: 3px 10px;
    border-radius: 20px;
    text-transform: uppercase;
    font-weight: 600;
    margin-bottom: 10px;
}

.char-card .role {
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-bottom: 8px;
    font-weight: 500;
}

.char-card .description {
    font-size: 0.7rem;
    color: var(--text-muted);
    line-height: 1.4;
    margin-bottom: 12px;
    min-height: 36px;
}

.char-card .stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 6px;
    font-size: 0.6rem;
}

.char-card .stat {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 4px 8px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 6px;
}

.char-card .stat-label {
    color: var(--text-muted);
    text-transform: uppercase;
}

.char-card .stat-value {
    color: var(--text);
    font-weight: 600;
}

.char-card .stat-value.high { color: #22c55e; }
.char-card .stat-value.medium { color: #fbbf24; }
.char-card .stat-value.low { color: #ef4444; }

.modal-actions {
    display: flex;
    gap: 16px;
    justify-content: center;
}

/* Wallet Modal */
.wallet-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 3000;
    align-items: center;
    justify-content: center;
}

.wallet-modal.show {
    display: flex;
}

.wallet-modal-content {
    background: var(--bg-card);
    border-radius: 20px;
    padding: 32px;
    max-width: 400px;
    width: 90%;
    border: 1px solid var(--border);
}

.wallet-modal-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.9rem;
    text-align: center;
    margin-bottom: 24px;
    color: var(--primary);
}

.wallet-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.wallet-option {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.wallet-option:hover {
    border-color: var(--primary);
    background: rgba(255, 217, 61, 0.05);
}

.wallet-option img {
    width: 40px;
    height: 40px;
    border-radius: 8px;
}

.wallet-option-info {
    flex: 1;
}

.wallet-option-name {
    font-weight: 600;
    font-size: 1rem;
    color: var(--text);
}

.wallet-option-desc {
    font-size: 0.8rem;
    color: var(--text-muted);
}

.wallet-option-status {
    font-size: 0.7rem;
    padding: 4px 8px;
    border-radius: 4px;
    background: var(--green);
    color: #000;
}

.wallet-option-status.not-installed {
    background: var(--border);
    color: var(--text-muted);
}

.wallet-modal-close {
    margin-top: 20px;
    width: 100%;
    padding: 12px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.2s;
}

.wallet-modal-close:hover {
    border-color: var(--red);
    color: var(--red);
}

.wallet-address {
    font-family: monospace;
    font-size: 0.8rem;
}

.wallet-balance {
    font-size: 0.7rem;
    color: var(--green);
    margin-left: 4px;
}

/* ================================
   RESPONSIVE STYLES
   ================================ */

/* Tablet */
@media (max-width: 900px) {
    .steps {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .character-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* Mobile */
@media (max-width: 768px) {
    .encounter-creature img {
        width: 110px;
        height: 110px;
    }

    /* Mobile nav overlay */
    .nav-links {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(10, 10, 15, 0.98);
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 28px;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        padding: 2rem;
        z-index: 1000;
    }

    .nav-links.active {
        opacity: 1;
        visibility: visible;
    }

    .nav-links a {
        display: block;
        font-size: 1.3rem;
        padding: 10px 20px;
        color: var(--text);
    }

    .nav-links .btn-wallet {
        width: 100%;
        max-width: 240px;
        justify-content: center;
        padding: 14px 24px;
        font-size: 0.9rem;
    }

    .nav-links .btn-primary {
        width: 100%;
        max-width: 240px;
        text-align: center;
        padding: 14px 24px;
        display: block;
    }

    .nav-links .music-btn {
        width: 55px;
        height: 55px;
        font-size: 1.4rem;
    }

    nav {
        padding: 12px 16px;
    }

    .logo-img {
        width: 45px;
        height: 45px;
    }

    .logo-text {
        font-size: 0.75rem;
    }

    /* Hero */
    .hero {
        padding: 90px 20px 50px;
    }

    .hero-title {
        font-size: clamp(1.2rem, 5vw, 1.8rem);
    }

    .hero-subtitle {
        font-size: 0.95rem;
        padding: 0 10px;
    }

    .char-avatar {
        width: 60px;
        height: 60px;
    }

    .ca-container {
        padding: 10px 14px;
        font-size: 0.7rem;
    }

    .ca-address {
        max-width: 120px;
    }

    .cta-buttons {
        flex-direction: column;
        width: 100%;
        max-width: 280px;
    }

    .cta-buttons .btn {
        width: 100%;
    }

    /* Game Section */
    .game-section {
        padding: 40px 16px;
    }

    .section-title {
        font-size: 1rem;
        margin-bottom: 24px;
    }

    .battle-arena {
        height: 360px;
    }

    .sprite-player-back {
        width: 200px;
        height: 200px;
        left: -15px;
        bottom: -25px;
    }

    .sprite-enemy {
        width: 130px;
        height: 130px;
        right: 5%;
        bottom: 70px;
    }

    .hp-box {
        min-width: 120px;
        padding: 8px 10px;
    }

    .hp-box .pokemon-name {
        font-size: 0.7rem;
    }

    .hp-box .level {
        font-size: 0.55rem;
        padding: 2px 5px;
    }

    .hp-box.player {
        bottom: 10px;
        right: 10px;
    }

    .hp-box.enemy {
        top: 10px;
        left: 10px;
    }

    .hp-text {
        font-size: 0.6rem;
    }

    .turn-indicator {
        font-size: 0.5rem;
        padding: 6px 14px;
    }

    .battle-menu {
        grid-template-columns: 1fr;
    }

    .battle-log {
        border-right: none;
        border-bottom: 1px solid rgba(42, 42, 58, 0.8);
        max-height: 80px;
        min-height: 80px;
    }

    .log-entry {
        font-size: 0.6rem;
    }

    .move-grid {
        gap: 6px;
        padding: 10px;
    }

    .move-btn {
        padding: 10px;
    }

    /* Safari Zone Mobile */
    .safari-zone {
        padding: 60px 20px;
    }
    
    .safari-card {
        padding: 30px 20px;
    }
    
    .safari-tokens {
        font-size: 0.9rem;
    }
    
    .safari-reward {
        font-size: 0.7rem;
        padding: 10px 14px;
    }
    
    .safari-game-container {
        width: 100%;
        height: 100vh;
        max-height: none;
        border-radius: 0;
        border: none;
    }
    
    .safari-header {
        padding: 14px 18px;
    }
    
    .safari-biome-name {
        font-size: 0.6rem;
    }
    
    .safari-actions-left {
        font-size: 0.6rem;
    }
    
    .safari-exit-btn {
        padding: 8px 14px;
        font-size: 0.75rem;
    }
    
    .safari-game-area {
        padding: 20px 16px;
    }
    
    .safari-screen-title {
        font-size: 0.9rem;
        margin-bottom: 24px;
    }
    
    .biome-grid {
        gap: 12px;
    }
    
    .biome-card {
        padding: 20px 16px;
    }
    
    .biome-emoji {
        font-size: 2.5rem;
    }
    
    .biome-name {
        font-size: 0.6rem;
    }
    
    .safari-environment {
        height: 160px;
    }
    
    .safari-message {
        font-size: 0.7rem;
        padding: 18px 20px;
    }
    
    .safari-explore-btn {
        padding: 16px 40px;
        font-size: 0.9rem;
    }
    
    /* Encounter Screen Mobile */
    .encounter-scene {
        min-height: 240px;
    }
    
    .encounter-creature {
        bottom: 60px;
    }
    
    .encounter-creature img {
        width: 120px;
        height: 120px;
    }
    
    .creature-info-overlay {
        padding: 10px 18px;
    }
    
    .creature-info-overlay .creature-name {
        font-size: 0.8rem;
    }
    
    .encounter-ui-panel {
        padding: 12px 16px;
    }
    
    .encounter-btn {
        padding: 10px 6px;
    }
    
    .encounter-btn-icon {
        font-size: 1.3rem;
    }
    
    .encounter-btn-label {
        font-size: 0.55rem;
    }
    
    .results-stats {
        gap: 12px;
    }
    
    .result-stat {
        padding: 18px 24px;
        min-width: 110px;
    }
    
    .result-value {
        font-size: 1.4rem;
    }
    
    .result-creature {
        width: 80px;
        padding: 12px;
    }
    
    .result-creature img {
        width: 50px;
        height: 50px;
    }
    
    .safari-inventory {
        gap: 16px;
        padding: 14px 20px;
    }
    
    .inventory-item {
        padding: 6px 12px;
    }
    
    .inv-icon {
        font-size: 1.2rem;
    }
    
    .inv-count {
        font-size: 0.7rem;
    }

    /* How It Works */
    .how-it-works {
        padding: 60px 20px;
    }

    .steps {
        grid-template-columns: 1fr;
        gap: 20px;
        max-width: 400px;
        margin: 0 auto;
    }

    .step {
        padding: 30px 24px;
    }

    .step-icon {
        font-size: 2.5rem;
        margin-bottom: 16px;
    }

    .step-title {
        font-size: 1rem;
    }

    .step-desc {
        font-size: 0.9rem;
    }

    /* Footer */
    footer {
        padding: 24px 16px;
    }

    .social-links {
        flex-direction: column;
        gap: 12px;
        width: 100%;
        max-width: 280px;
    }

    .social-links a {
        width: 100%;
        text-align: center;
        padding: 14px 20px;
    }

    /* Modals */
    .modal-content {
        padding: 20px 16px;
        max-height: 85vh;
        margin: 10px;
    }

    .modal-title {
        font-size: 0.85rem;
        margin-bottom: 20px;
    }

    .character-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }

    .char-card {
        padding: 14px 10px;
    }

    .char-card img {
        width: 70px;
        height: 70px;
    }

    .char-card .name {
        font-size: 0.55rem;
    }

    .char-card .type-badge {
        font-size: 0.5rem;
        padding: 2px 8px;
    }

    .char-card .role {
        font-size: 0.55rem;
    }

    .char-card .description {
        font-size: 0.55rem;
        min-height: 28px;
        margin-bottom: 8px;
    }

    .char-card .stats {
        gap: 4px;
    }

    .char-card .stat {
        padding: 3px 5px;
        font-size: 0.5rem;
    }

    .modal-actions {
        flex-direction: column;
        gap: 10px;
    }

    .modal-actions .btn {
        width: 100%;
    }

    /* Wallet Modal */
    .wallet-modal-content {
        padding: 24px 20px;
        margin: 16px;
    }

    .wallet-modal-title {
        font-size: 0.75rem;
    }

    .wallet-option {
        padding: 12px;
    }

    .wallet-option img {
        width: 32px;
        height: 32px;
    }

    .wallet-option-name {
        font-size: 0.9rem;
    }

    .wallet-option-desc {
        font-size: 0.7rem;
    }

    /* Battle result */
    .battle-result {
        padding: 24px 20px;
        width: 90%;
    }

    .result-title {
        font-size: 1.1rem;
    }

    .result-subtitle {
        font-size: 0.85rem;
    }

    /* Floating elements - reduce on mobile */
    .floating-pill {
        width: 35px;
        height: 35px;
    }

    .orb {
        filter: blur(60px);
        opacity: 0.3;
    }
}

/* Extra small phones */
@media (max-width: 480px) {
    .biome-grid {
        grid-template-columns: 1fr;
        max-width: 280px;
    }
    
    .results-actions {
        flex-direction: column;
        width: 100%;
        max-width: 250px;
    }
    
    .results-actions .btn {
        width: 100%;
    }
}

@media (max-width: 380px) {
    nav {
        padding: 10px 12px;
    }

    .logo-text {
        font-size: 0.6rem;
    }

    .logo-img {
        width: 38px;
        height: 38px;
    }

    .nav-links a {
        font-size: 1.1rem;
    }

    .hero-title {
        font-size: 1rem;
    }

    .hero-subtitle {
        font-size: 0.85rem;
    }

    .char-avatar {
        width: 50px;
        height: 50px;
    }

    .battle-arena {
        height: 320px;
    }

    .sprite-player-back {
        width: 160px;
        height: 160px;
        left: -10px;
        bottom: -20px;
    }

    .sprite-enemy {
        width: 100px;
        height: 100px;
        bottom: 60px;
    }

    .hp-box {
        min-width: 100px;
        padding: 6px 8px;
    }

    .hp-box .pokemon-name {
        font-size: 0.6rem;
    }

    .character-grid {
        grid-template-columns: 1fr;
        max-width: 200px;
        margin: 0 auto 20px;
    }

    .char-card img {
        width: 80px;
        height: 80px;
    }
    .token-balance-display {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: rgba(255, 217, 61, 0.1);
    border: 1px solid var(--primary);
    border-radius: 12px;
    font-family: 'Press Start 2P', cursive;
    font-size: 0.7rem;
    color: var(--primary);
}
.demo-badge {
    position: absolute;
    top: -12px;
    right: -12px;
    background: linear-gradient(135deg, var(--green), #16a34a);
    color: #000;
    font-family: 'Press Start 2P', cursive;
    font-size: 0.55rem;
    padding: 6px 12px;
    border-radius: 20px;
    font-weight: 700;
    box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
    animation: demoPulse 2s ease-in-out infinite;
}

@keyframes demoPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

#pumpmon-balance {
    color: #fff;
    font-weight: bold;
}
}

/* Rewards Panel */
.rewards-panel {
    background: rgba(26, 26, 46, 0.95);
    border: 2px solid var(--primary);
    border-radius: 16px;
    padding: 20px;
    max-width: 300px;
    margin: 20px auto;
    text-align: center;
}

.rewards-header {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.8rem;
    color: var(--primary);
    margin-bottom: 16px;
}

.rewards-stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 16px;
}

.reward-stat {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.reward-label {
    font-size: 0.7rem;
    color: var(--text-muted);
    text-transform: uppercase;
}

.reward-value {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.2rem;
    color: #fff;
}

.reward-value.highlight {
    color: var(--primary);
    text-shadow: 0 0 10px rgba(255, 217, 61, 0.5);
}

.reward-currency {
    font-size: 0.7rem;
    color: var(--primary);
}

.claim-btn {
    width: 100%;
    padding: 12px;
    font-size: 0.9rem;
}

/* Token Earned Popup */
.token-earned-popup {
    position: fixed;
    top: 20%;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, var(--primary) 0%, #f97316 100%);
    color: #000;
    padding: 20px 40px;
    border-radius: 16px;
    font-family: 'Press Start 2P', cursive;
    font-size: 1.2rem;
    z-index: 9999;
    animation: popupAnim 3s ease-out forwards;
    box-shadow: 0 0 30px rgba(255, 217, 61, 0.5);
}

@keyframes popupAnim {
    0% { opacity: 0; transform: translateX(-50%) translateY(20px) scale(0.8); }
    15% { opacity: 1; transform: translateX(-50%) translateY(0) scale(1.1); }
    30% { transform: translateX(-50%) translateY(0) scale(1); }
    80% { opacity: 1; }
    100% { opacity: 0; transform: translateX(-50%) translateY(-30px); }
}
    </style>
</head>
<body>
    <!-- Pokemon Style Animated Background -->
    <div class="bg-animation">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="orb orb-4"></div>
        <div class="orb orb-5"></div>
        
        <div class="grid-pattern"></div>
        
        <div class="pixel-stars">
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star large"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star large"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star large"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
        </div>
        
        <div class="pokeball-particles">
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
        </div>
        
        <div class="sparkles">
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
        </div>
        
        <div class="type-symbols">
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
            <div class="type-symbol"></div>
        </div>
        
        <div class="energy-wave"></div>
        <div class="crt-glow"></div>
        <div class="battle-border"></div>
    </div>
    
    <div class="scanlines"></div>

    <!-- Floating Character Pills -->
    <div class="floating-pills">
        <div class="floating-pill"><img src="assets/images/characters/pepe.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/whale.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/cow.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/moodeng.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/catana.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/pepe.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/whale.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/cow.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/moodeng.png" alt="" onerror="this.parentElement.style.display='none'"></div>
    </div>

    <!-- Navigation -->
    <nav>
        <div class="logo">
            <img src="assets/images/logo.png" alt="PumpFighters Logo" class="logo-img" onerror="this.style.display='none'">
            <span class="logo-text">PUMPMON</span>
        </div>
        
        <!-- Hamburger Menu Button -->
        <button class="hamburger" id="hamburger" onclick="toggleMobileMenu()" aria-label="Menu">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
        
        <div class="nav-links" id="nav-links">
            <!-- Add this where you want to show the token balance -->

            <a href="#game">Play</a>
            <a href="#how">How It Works</a>
            <button class="music-btn" id="music-btn" onclick="toggleMusic()"></button>
            <button class="btn btn-wallet" id="wallet-btn" onclick="connectWallet()">
                <svg class="solana-logo" width="18" height="18" viewBox="0 0 397.7 311.7" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M64.6 237.9c2.4-2.4 5.7-3.8 9.2-3.8h317.4c5.8 0 8.7 7 4.6 11.1l-62.7 62.7c-2.4 2.4-5.7 3.8-9.2 3.8H6.5c-5.8 0-8.7-7-4.6-11.1l62.7-62.7z" fill="#00FFA3"/>
                    <path d="M64.6 3.8C67.1 1.4 70.4 0 73.8 0h317.4c5.8 0 8.7 7 4.6 11.1l-62.7 62.7c-2.4 2.4-5.7 3.8-9.2 3.8H6.5c-5.8 0-8.7-7-4.6-11.1L64.6 3.8z" fill="#00FFA3"/>
                    <path d="M333.1 120.1c-2.4-2.4-5.7-3.8-9.2-3.8H6.5c-5.8 0-8.7 7-4.6 11.1l62.7 62.7c2.4 2.4 5.7 3.8 9.2 3.8h317.4c5.8 0 8.7-7 4.6-11.1l-62.7-62.7z" fill="#00FFA3"/>
                </svg>
                <span id="wallet-text">Connect Wallet</span>
            </button>
            <a href="#" class="btn btn-primary">Buy $PUMP</a>
            <div id="token-balance-display" class="token-balance-display" style="display: none;">
     $PUMPMON: <span id="pumpmon-balance">0</span>
</div>
        </div>
    </nav>

    <!-- Hero -->
    <section class="hero">
        <h1 class="hero-title">
            Battle Memecoins.<br>
            <span class="highlight">Win $PUMP.</span>
        </h1>
        
        <p class="hero-subtitle">
            Choose your favorite memecoin character and battle in Pokemon-style combat. 
            Every victory earns you $PUMP tokens.
        </p>

  <div class="character-preview">
    <div class="char-avatar" onclick="selectAndPlay('pepe')">
        <img src="assets/images/characters/pepecard.png" alt="PEPE">
    </div>
        <div class="char-avatar" onclick="selectAndPlay('dicklet')">
        <img src="assets/images/characters/dickletcard.png" alt="DICKLET">
    </div>
    <div class="char-avatar" onclick="selectAndPlay('whale')">
        <img src="assets/images/characters/whalecard.png" alt="WHALE">
    </div>
    <div class="char-avatar" onclick="selectAndPlay('cow')">
        <img src="assets/images/characters/cowcard.png" alt="COW">
    </div>
    <div class="char-avatar" onclick="selectAndPlay('moodeng')">
        <img src="assets/images/characters/moodengcard.png" alt="MOODENG">
    </div>
    <div class="char-avatar" onclick="selectAndPlay('penguin')">
        <img src="assets/images/characters/panguincard.png" alt="PENG">
    </div>
    <div class="char-avatar" onclick="selectAndPlay('catana')">
        <img src="assets/images/characters/catanacard.png" alt="CATANA">
    </div>
</div>

        <div class="cta-buttons">
            <button class="btn btn-secondary" onclick="scrollToGame()"> Quick Battle</button>
        </div>
        
        <div class="ca-container">
            <span class="ca-label">CA:</span>
            <span class="ca-address" id="ca-address">BZz5TeFBaQ4uv5iXFf4S7mX7qzvyFLSbDpjeyzwRpump</span>
            <button class="ca-copy" onclick="copyCA()"></button>
        </div>
    </section>

    <!-- Game Section -->
    <div class="game-wrapper">
        <section class="game-section" id="game">
            <h2 class="section-title"> Battle <span class="highlight">Arena</span></h2>
            
            <div class="battle-arena" id="battle-arena">
                <div class="sun"></div>
                
                <div class="turn-indicator" id="turn-indicator">YOUR TURN</div>

                <div class="hp-box enemy">
                    <div class="hp-header">
                        <span class="pokemon-name" id="enemy-name">WHALE</span>
                        <span class="level">Lv<span id="enemy-level">48</span></span>
                    </div>
                    <div class="hp-bar-outer">
                        <div class="hp-bar-inner" id="enemy-hp-bar" style="width: 100%"></div>
                    </div>
                    <div class="status-container" id="enemy-status"></div>
                </div>

                <div class="hp-box player">
                    <div class="hp-header">
                        <span class="pokemon-name" id="player-name">PEPE</span>
                        <span class="level">Lv<span id="player-level">50</span></span>
                    </div>
                    <div class="hp-bar-outer">
                        <div class="hp-bar-inner" id="player-hp-bar" style="width: 100%"></div>
                    </div>
                    <div class="hp-text"><span id="player-hp">100</span>/<span id="player-max-hp">100</span></div>
                    <div class="status-container" id="player-status"></div>
                </div>

                <div class="sprite-player" id="player-sprite">
                    <img id="player-img" src="assets/images/characters/pepe.png" alt="Player">
                </div>

                <div class="sprite-player-back" id="player-sprite-back">
                    <img id="player-img-back" src="assets/images/characters/peng-back.png" alt="Player Back">
                </div>

                <div class="sprite-enemy" id="enemy-sprite">
                    <img id="enemy-img" src="assets/images/characters/whale.png" alt="Enemy">
                </div>

                <div class="battle-intro" id="battle-intro">
                    <div class="intro-text" id="intro-text">A wild WHALE appeared!</div>
                </div>

                <div class="battle-result" id="battle-result">
                    <div class="result-title" id="result-title">VICTORY!</div>
                    <div class="result-subtitle" id="result-subtitle">You earned 500 $PUMP!</div>
                    <button class="btn btn-primary" onclick="resetBattle()">Battle Again</button>
                </div>
            </div>

            <div class="battle-menu">
                <div class="battle-log" id="battle-log">
                    <div class="log-entry system">Choose a move to attack!</div>
                </div>
                <div class="move-grid" id="move-grid">
                    <!-- Moves will be inserted here -->
                </div>
            </div>
            <!-- Rewards Panel - Add after battle arena or in navbar -->
<div class="rewards-panel" id="rewards-panel">
    <div class="rewards-header">
        <span> Your Rewards</span>
    </div>
    <div class="rewards-stats">
        <div class="reward-stat">
            <span class="reward-label">Total Wins</span>
            <span class="reward-value" id="total-wins">0</span>
        </div>
        <div class="reward-stat">
            <span class="reward-label">Claimable</span>
            <span class="reward-value highlight" id="claimable-tokens">0</span>
            <span class="reward-currency">$PUMPMON</span>
        </div>
    </div>
    <button class="btn btn-primary claim-btn" id="claim-btn" onclick="RewardSystem.claimTokens()">
         Claim $PUMPMON
    </button>
</div>
        </section>
    </div>

    <!-- How It Works -->
    <section class="how-it-works" id="how">
        <div class="how-container">
            <h2 class="section-title">How It <span class="highlight">Works</span></h2>
            
            <div class="steps">
                <div class="step">
                    <span class="step-icon"></span>
                    <h3 class="step-title">1. Choose Your Fighter</h3>
                    <p class="step-desc">Pick from 6 iconic memecoin characters, each with unique stats and moves.</p>
                </div>
                <div class="step">
                    <span class="step-icon"></span>
                    <h3 class="step-title">2. Battle Opponents</h3>
                    <p class="step-desc">Fight in turn-based Pokemon-style combat. Use strategy to defeat enemies.</p>
                </div>
                <div class="step">
                    <span class="step-icon"></span>
                    <h3 class="step-title">3. Earn $PUMP</h3>
                    <p class="step-desc">Win battles to earn $PUMP tokens. The more you win, the more you earn.</p>
                </div>
            </div>
        </div>
    </section>


        <!-- Safari Zone Section -->
<!-- Safari Zone Section -->
<section class="safari-zone" id="safari">
    <div class="safari-container">
        <h2 class="section-title"> Enter the <span class="highlight">Safari Zone</span></h2>
        <div class="safari-card">
            <span class="demo-badge"> DEMO</span>
            <div class="safari-icon"></div>
            <div class="safari-info">
                <div class="safari-tokens">1000 <span class="highlight">$P</span></div>
                <div class="safari-equals">=</div>
                <div class="safari-reward">1 Entry Ticket</div>
            </div>
            <p class="safari-desc">Explore biomes, encounter rare creatures, and catch them Safari-style!</p>
            <div class="ticket-display">
                 Your Tickets: <span class="count" id="ticket-count">1</span>
            </div>
            <button class="btn btn-primary" onclick="openSafari()"> Enter Safari Zone</button>
        </div>
    </div>
</section>

<!-- Safari Zone Game Modal -->
<div class="safari-modal" id="safari-modal">
    <div class="safari-game-container">
        <!-- Header -->
        <div class="safari-header">
            <div class="safari-header-left">
                <span class="safari-biome-name" id="safari-biome-name"> Jungle Zone</span>
            </div>
            <div class="safari-header-right">
                <span class="safari-actions-left"> <span id="actions-left">10</span> Actions</span>
                <button class="safari-exit-btn" onclick="exitSafari()"> Exit</button>
            </div>
        </div>

        <!-- Main Game Area -->
        <div class="safari-game-area" id="safari-game-area">
            <!-- Biome Selection Screen -->
            <div class="safari-screen" id="biome-select-screen">
                <h3 class="safari-screen-title">Choose Your Biome</h3>
                <div class="biome-grid" id="biome-grid">
                    <!-- Biomes inserted via JS -->
                </div>
            </div>

            <!-- Exploration Screen -->
            <div class="safari-screen hidden" id="explore-screen">
                <div class="safari-environment" id="safari-environment">
                    <div class="safari-grass"></div>
                    <div class="safari-grass"></div>
                    <div class="safari-grass"></div>
                </div>
                <div class="safari-message" id="safari-message">You entered the Safari Zone!</div>
                <button class="btn btn-primary safari-explore-btn" id="explore-btn" onclick="SafariGame.explore()">
                     Explore
                </button>
            </div>


<!-- Encounter Screen -->
<div class="safari-screen hidden" id="encounter-screen">
    <div class="encounter-scene">
        <div class="creature-info-overlay">
            <span class="creature-name" id="encounter-creature-name">???</span>
            <span class="creature-rarity" id="encounter-creature-rarity">Common</span>
            <div class="creature-status" id="creature-status"></div>
        </div>
        <div class="encounter-creature" id="encounter-creature">
            <img id="encounter-creature-img" src="" alt="Wild Creature">
        </div>
    </div>
    
    <div class="encounter-ui-panel">
        <div class="encounter-log" id="encounter-log"></div>
        <div class="encounter-actions">
            <button class="encounter-btn capsule" onclick="SafariGame.throwCapsule()">
                <span class="encounter-btn-icon"></span>
                <span class="encounter-btn-label">Capsule</span>
                <span class="encounter-btn-count" id="capsule-count">5</span>
            </button>
            <button class="encounter-btn bait" onclick="SafariGame.throwBait()">
                <span class="encounter-btn-icon"></span>
                <span class="encounter-btn-label">Bait</span>
                <span class="encounter-btn-count" id="bait-count">3</span>
            </button>
            <button class="encounter-btn rock" onclick="SafariGame.throwRock()">
                <span class="encounter-btn-icon"></span>
                <span class="encounter-btn-label">Rock</span>
                <span class="encounter-btn-count" id="rock-count">3</span>
            </button>
            <button class="encounter-btn run" onclick="SafariGame.runAway()">
                <span class="encounter-btn-icon"></span>
                <span class="encounter-btn-label">Run</span>
            </button>
        </div>
    </div>
    
</div>

            <!-- Results Screen -->
            <div class="safari-screen hidden" id="results-screen">
                <h3 class="safari-screen-title">Safari Run Complete!</h3>
                <div class="results-stats">
                    <div class="result-stat">
                        <span class="result-label">Creatures Caught</span>
                        <span class="result-value" id="result-caught">0</span>
                    </div>
                    <div class="result-stat">
                        <span class="result-label">Creatures Fled</span>
                        <span class="result-value fled" id="result-fled">0</span>
                    </div>
                    <div class="result-stat">
                        <span class="result-label">Rares Found</span>
                        <span class="result-value rare" id="result-rares">0</span>
                    </div>
                </div>
                <div class="results-creatures" id="results-creatures">
                    <!-- Caught creatures shown here -->
                </div>
                <div class="results-actions">
                    <button class="btn btn-secondary" onclick="closeSafari()">Exit</button>
                    <button class="btn btn-primary" onclick="SafariGame.playAgain()"> Play Again</button>
                </div>
            </div>
        </div>

        <!-- Inventory Bar -->
        <div class="safari-inventory" id="safari-inventory">
            <div class="inventory-item">
                <span class="inv-icon"></span>
                <span class="inv-count" id="inv-capsules">5</span>
            </div>
            <div class="inventory-item">
                <span class="inv-icon"></span>
                <span class="inv-count" id="inv-bait">3</span>
            </div>
            <div class="inventory-item">
                <span class="inv-icon"></span>
                <span class="inv-count" id="inv-rocks">3</span>
            </div>
            <div class="inventory-divider"></div>
            <div class="inventory-item caught">
                <span class="inv-icon"></span>
                <span class="inv-count" id="inv-caught">0</span>
            </div>
        </div>
    </div>
</div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="social-links">
                <a href="https://x.com/i/communities/2015567621471789205?fbclid=IwY2xjawPk2j1leHRuA2FlbQIxMABicmlkETFLSmJqV0VzZ0s4QW1FckFpc3J0YwZhcHBfaWQQMjIyMDM5MTc4ODIwMDg5MgABHv4_il_u1SWaUtfb4bJItvSwfJJPtLlckLbSAqst1EgrZEuAkFOCfnvDv33v_aem_YJiGXBPW-19VESya08dFyg" target="_blank"> Twitter</a>

            </div>
        </div>
    </footer>

    <!-- Character Selection Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 class="modal-title">Choose Your Fighter</h3>
            <div class="character-grid" id="char-grid">
                <!-- Characters will be inserted here -->
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmSelection()"> Fight!</button>
            </div>
        </div>
    </div>

    <!-- Wallet Connection Modal -->
    <div class="wallet-modal" id="wallet-modal">
        <div class="wallet-modal-content">
            <h3 class="wallet-modal-title">Connect Wallet</h3>
            <div class="wallet-list" id="wallet-list">
                <!-- Wallet options will be inserted here -->
            </div>
            <button class="wallet-modal-close" onclick="closeWalletModal()">Cancel</button>
        </div>
    </div>

    <script>
        /* ================================
           MOBILE MENU
           ================================ */
        function toggleMobileMenu() {
            const hamburger = document.getElementById('hamburger');
            const navLinks = document.getElementById('nav-links');
            
            hamburger.classList.toggle('active');
            navLinks.classList.toggle('active');
            document.body.style.overflow = navLinks.classList.contains('active') ? 'hidden' : '';
        }

        // Close menu when clicking links
        document.querySelectorAll('.nav-links a, .nav-links .btn').forEach(el => {
            el.addEventListener('click', () => {
                document.getElementById('hamburger').classList.remove('active');
                document.getElementById('nav-links').classList.remove('active');
                document.body.style.overflow = '';
            });
        });

        // Auto-close on resize to desktop
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                document.getElementById('hamburger').classList.remove('active');
                document.getElementById('nav-links').classList.remove('active');
                document.body.style.overflow = '';
            }
        });


            /* ================================
   SAFARI ZONE GAME SYSTEM
   ================================ */
const SafariGame = {
    // Game State
    state: {
        tickets: 1, // Demo: start with 1 ticket
        pumpmonBalance: 5000,
        currentBiome: null,
        actionsLeft: 0,
        maxActions: 10,
        inventory: {
            capsules: 5,
            bait: 3,
            rocks: 3
        },
        currentCreature: null,
        creatureModifiers: {
            baitActive: false,
            baitTurns: 0,
            angryActive: false,
            angryTurns: 0
        },
        caughtCreatures: [],
        fledCreatures: 0,
        raresFound: 0,
        isEncounterActive: false
    },

    // Biome Definitions
    biomes: {
        jungle: {
            id: 'jungle',
            name: 'Jungle',
            emoji: '',
            difficulty: 'easy',
            fleeRateModifier: 1.0,
            rareSpawnChance: 0.15,
            maxActions: 10,
            encounterTable: [
                { id: 'pepe', weight: 30, rarity: 'common' },
                { id: 'froggie', weight: 25, rarity: 'common' },
                { id: 'monke', weight: 20, rarity: 'uncommon' },
                { id: 'snek', weight: 15, rarity: 'uncommon' },
                { id: 'jungleking', weight: 8, rarity: 'rare' },
                { id: 'goldenfrog', weight: 2, rarity: 'epic' }
            ]
        },
        swamp: {
            id: 'swamp',
            name: 'Swamp',
            emoji: '',
            difficulty: 'medium',
            fleeRateModifier: 0.9,
            rareSpawnChance: 0.2,
            maxActions: 10,
            encounterTable: [
                { id: 'whale', weight: 25, rarity: 'common' },
                { id: 'mudfish', weight: 25, rarity: 'common' },
                { id: 'gator', weight: 20, rarity: 'uncommon' },
                { id: 'swampthing', weight: 15, rarity: 'uncommon' },
                { id: 'hydra', weight: 10, rarity: 'rare' },
                { id: 'swampgod', weight: 5, rarity: 'epic' }
            ]
        },
        volcanic: {
            id: 'volcanic',
            name: 'Volcanic',
            emoji: '',
            difficulty: 'hard',
            fleeRateModifier: 1.2,
            rareSpawnChance: 0.25,
            maxActions: 8,
            encounterTable: [
                { id: 'flameling', weight: 30, rarity: 'common' },
                { id: 'magmite', weight: 25, rarity: 'uncommon' },
                { id: 'lavabeast', weight: 20, rarity: 'uncommon' },
                { id: 'phoenix', weight: 15, rarity: 'rare' },
                { id: 'dragonlord', weight: 8, rarity: 'epic' },
                { id: 'inferno', weight: 2, rarity: 'legendary' }
            ],
            locked: false
        },
        cosmic: {
            id: 'cosmic',
            name: 'Cosmic',
            emoji: '',
            difficulty: 'extreme',
            fleeRateModifier: 1.5,
            rareSpawnChance: 0.35,
            maxActions: 6,
            encounterTable: [
                { id: 'stardust', weight: 25, rarity: 'uncommon' },
                { id: 'nebula', weight: 25, rarity: 'uncommon' },
                { id: 'voidwalker', weight: 20, rarity: 'rare' },
                { id: 'cosmicwhale', weight: 15, rarity: 'rare' },
                { id: 'galaxian', weight: 10, rarity: 'epic' },
                { id: 'celestial', weight: 5, rarity: 'legendary' }
            ],
            locked: true
        }
    },

    // Creature Definitions
    creatures: {
        // Jungle
        pepe: { name: 'PEPE', image: 'pepe.png', baseCatchRate: 0.4, baseFleeRate: 0.2 },
        froggie: { name: 'FROGGIE', image: 'pepe.png', baseCatchRate: 0.45, baseFleeRate: 0.15 },
        monke: { name: 'MONKE', image: 'moodeng.png', baseCatchRate: 0.3, baseFleeRate: 0.25 },
        snek: { name: 'SNEK', image: 'catana.png', baseCatchRate: 0.35, baseFleeRate: 0.3 },
        jungleking: { name: 'JUNGLE KING', image: 'cow.png', baseCatchRate: 0.2, baseFleeRate: 0.35 },
        goldenfrog: { name: 'GOLDEN FROG', image: 'pepe.png', baseCatchRate: 0.1, baseFleeRate: 0.45 },
        // Swamp
        whale: { name: 'WHALE', image: 'whale.png', baseCatchRate: 0.35, baseFleeRate: 0.2 },
        mudfish: { name: 'MUDFISH', image: 'whale.png', baseCatchRate: 0.45, baseFleeRate: 0.15 },
        gator: { name: 'GATOR', image: 'catana.png', baseCatchRate: 0.3, baseFleeRate: 0.3 },
        swampthing: { name: 'SWAMP THING', image: 'moodeng.png', baseCatchRate: 0.25, baseFleeRate: 0.35 },
        hydra: { name: 'HYDRA', image: 'whale.png', baseCatchRate: 0.15, baseFleeRate: 0.4 },
        swampgod: { name: 'SWAMP GOD', image: 'whale.png', baseCatchRate: 0.08, baseFleeRate: 0.5 },
        // Volcanic
        flameling: { name: 'FLAMELING', image: 'pepe.png', baseCatchRate: 0.35, baseFleeRate: 0.25 },
        magmite: { name: 'MAGMITE', image: 'moodeng.png', baseCatchRate: 0.3, baseFleeRate: 0.3 },
        lavabeast: { name: 'LAVA BEAST', image: 'cow.png', baseCatchRate: 0.25, baseFleeRate: 0.35 },
        phoenix: { name: 'PHOENIX', image: 'pepe.png', baseCatchRate: 0.15, baseFleeRate: 0.45 },
        dragonlord: { name: 'DRAGON LORD', image: 'catana.png', baseCatchRate: 0.08, baseFleeRate: 0.5 },
        inferno: { name: 'INFERNO', image: 'pepe.png', baseCatchRate: 0.05, baseFleeRate: 0.6 },
        // Cosmic
        stardust: { name: 'STARDUST', image: 'whale.png', baseCatchRate: 0.3, baseFleeRate: 0.3 },
        nebula: { name: 'NEBULA', image: 'moodeng.png', baseCatchRate: 0.25, baseFleeRate: 0.35 },
        voidwalker: { name: 'VOIDWALKER', image: 'catana.png', baseCatchRate: 0.2, baseFleeRate: 0.4 },
        cosmicwhale: { name: 'COSMIC WHALE', image: 'whale.png', baseCatchRate: 0.15, baseFleeRate: 0.45 },
        galaxian: { name: 'GALAXIAN', image: 'pepe.png', baseCatchRate: 0.08, baseFleeRate: 0.55 },
        celestial: { name: 'CELESTIAL', image: 'cow.png', baseCatchRate: 0.03, baseFleeRate: 0.65 }
    },

    // Initialize
    init() {
        this.updateTicketDisplay();
    },

    // Open Safari Modal
    open() {
        if (this.state.tickets <= 0) {
            alert('You need a Safari Ticket! Get 1000 $PUMPMON to enter.');
            return;
        }

        const modal = document.getElementById('safari-modal');
        modal.classList.add('show');
        this.showScreen('biome-select-screen');
        this.renderBiomeSelection();
        AudioSystem.playSound('select');
    },

    // Close Safari Modal
    close() {
        document.getElementById('safari-modal').classList.remove('show');
        this.resetState();
    },

    // Show specific screen
    showScreen(screenId) {
        document.querySelectorAll('.safari-screen').forEach(s => s.classList.add('hidden'));
        document.getElementById(screenId).classList.remove('hidden');
    },

    // Render Biome Selection
    renderBiomeSelection() {
        const grid = document.getElementById('biome-grid');
        grid.innerHTML = Object.values(this.biomes).map(biome => `
            <div class="biome-card ${biome.locked ? 'locked' : ''}" onclick="SafariGame.selectBiome('${biome.id}')">
                <span class="biome-emoji">${biome.emoji}</span>
                <div class="biome-name">${biome.name}</div>
                <div class="biome-difficulty ${biome.difficulty}">${biome.locked ? ' Locked' : biome.difficulty.toUpperCase()}</div>
            </div>
        `).join('');
    },

    // Select Biome and Start Run
    selectBiome(biomeId) {
        const biome = this.biomes[biomeId];
        if (biome.locked) {
            alert('This biome is locked! Complete more runs to unlock.');
            return;
        }

        // Consume ticket
        this.state.tickets--;
        this.updateTicketDisplay();

        // Setup run
        this.state.currentBiome = biome;
        this.state.actionsLeft = biome.maxActions;
        this.state.maxActions = biome.maxActions;
        this.state.inventory = { capsules: 5, bait: 3, rocks: 3 };
        this.state.caughtCreatures = [];
        this.state.fledCreatures = 0;
        this.state.raresFound = 0;

        // Update UI
        document.getElementById('safari-biome-name').textContent = `${biome.emoji} ${biome.name} Zone`;
        this.updateActionsDisplay();
        this.updateInventoryDisplay();

        // Show exploration screen
        this.showScreen('explore-screen');
        this.setMessage(`You entered the ${biome.name}! Look for creatures in the tall grass.`);

        AudioSystem.playSound('select');
    },

    // Explore action
    explore() {
        if (this.state.actionsLeft <= 0) {
            this.endRun();
            return;
        }

        this.state.actionsLeft--;
        this.updateActionsDisplay();

        // Random encounter chance (70%)
        if (Math.random() < 0.7) {
            this.triggerEncounter();
        } else {
            const messages = [
                'The grass rustles... but nothing appears.',
                'You hear something in the distance...',
                'A shadow moves, but disappears.',
                'The area seems quiet...'
            ];
            this.setMessage(messages[Math.floor(Math.random() * messages.length)]);
            AudioSystem.playSound('select');

            if (this.state.actionsLeft <= 0) {
                setTimeout(() => this.endRun(), 1500);
            }
        }
    },

    // Trigger an encounter
    triggerEncounter() {
        const biome = this.state.currentBiome;
        
        // Weighted random selection
        const totalWeight = biome.encounterTable.reduce((sum, c) => sum + c.weight, 0);
        let roll = Math.random() * totalWeight;
        let selectedEntry = biome.encounterTable[0];

        for (const entry of biome.encounterTable) {
            roll -= entry.weight;
            if (roll <= 0) {
                selectedEntry = entry;
                break;
            }
        }

        const creature = this.creatures[selectedEntry.id];
        this.state.currentCreature = {
            ...creature,
            id: selectedEntry.id,
            rarity: selectedEntry.rarity,
            catchRate: creature.baseCatchRate,
            fleeRate: creature.baseFleeRate * biome.fleeRateModifier
        };

        this.state.creatureModifiers = {
            baitActive: false,
            baitTurns: 0,
            angryActive: false,
            angryTurns: 0
        };
        this.state.isEncounterActive = true;

        if (['rare', 'epic', 'legendary'].includes(selectedEntry.rarity)) {
            this.state.raresFound++;
        }

        // Update encounter UI
        document.getElementById('encounter-creature-img').src = `assets/images/characters/${creature.image}`;
        document.getElementById('encounter-creature-name').textContent = creature.name;
        
        const rarityEl = document.getElementById('encounter-creature-rarity');
        rarityEl.textContent = selectedEntry.rarity.toUpperCase();
        rarityEl.className = 'creature-rarity ' + selectedEntry.rarity;

        this.updateEncounterButtons();
        this.clearEncounterLog();
        this.addEncounterLog(`A wild ${creature.name} appeared!`, 'success');

        this.showScreen('encounter-screen');
        AudioSystem.playSound('select');
    },

    // Throw Capsule
    throwCapsule() {
        if (!this.state.isEncounterActive || this.state.inventory.capsules <= 0) return;

        this.state.inventory.capsules--;
        this.state.actionsLeft--;
        this.updateActionsDisplay();
        this.updateInventoryDisplay();
        this.updateEncounterButtons();

        const creature = this.state.currentCreature;
        let catchRate = creature.catchRate;

        // Apply modifiers
        if (this.state.creatureModifiers.baitActive) {
            catchRate *= 0.7; // Bait decreases catch rate
        }
        if (this.state.creatureModifiers.angryActive) {
            catchRate *= 1.5; // Angry increases catch rate
        }

        this.addEncounterLog('You threw a Capture Capsule!');
        
        const creatureImg = document.getElementById('encounter-creature-img');
        creatureImg.classList.add('shake');

        setTimeout(() => {
            creatureImg.classList.remove('shake');

            if (Math.random() < catchRate) {
                // Caught!
                this.catchCreature();
            } else {
                this.addEncounterLog('Oh no! It broke free!', 'warning');
                AudioSystem.playSound('hit');
                this.checkFlee();
            }
        }, 800);
    },

    // Throw Bait
    throwBait() {
        if (!this.state.isEncounterActive || this.state.inventory.bait <= 0) return;

        this.state.inventory.bait--;
        this.state.actionsLeft--;
        this.updateActionsDisplay();
        this.updateInventoryDisplay();
        this.updateEncounterButtons();

        this.state.creatureModifiers.baitActive = true;
        this.state.creatureModifiers.baitTurns = 3;
        this.state.creatureModifiers.angryActive = false;
        this.state.creatureModifiers.angryTurns = 0;

        this.addEncounterLog('You threw some bait!');
        this.addEncounterLog(`${this.state.currentCreature.name} is eating...`, 'success');
        this.updateCreatureStatus();

        AudioSystem.playSound('select');
        this.decrementModifiers();
    },

    // Throw Rock
    throwRock() {
        if (!this.state.isEncounterActive || this.state.inventory.rocks <= 0) return;

        this.state.inventory.rocks--;
        this.state.actionsLeft--;
        this.updateActionsDisplay();
        this.updateInventoryDisplay();
        this.updateEncounterButtons();

        this.state.creatureModifiers.angryActive = true;
        this.state.creatureModifiers.angryTurns = 3;
        this.state.creatureModifiers.baitActive = false;
        this.state.creatureModifiers.baitTurns = 0;

        this.addEncounterLog('You threw a rock!');
        this.addEncounterLog(`${this.state.currentCreature.name} is angry!`, 'danger');
        this.updateCreatureStatus();

        const creatureImg = document.getElementById('encounter-creature-img');
        creatureImg.classList.add('shake');
        setTimeout(() => creatureImg.classList.remove('shake'), 500);

        AudioSystem.playSound('hit');
        this.checkFlee(true); // Higher flee chance when angry
    },

    // Run Away
    runAway() {
        if (!this.state.isEncounterActive) return;

        this.addEncounterLog('Got away safely!');
        this.state.isEncounterActive = false;

        setTimeout(() => {
            if (this.state.actionsLeft <= 0 || this.state.inventory.capsules <= 0) {
                this.endRun();
            } else {
                this.showScreen('explore-screen');
                this.setMessage('You ran away. Keep exploring!');
            }
        }, 800);
    },

    // Catch creature
    catchCreature() {
        const creature = this.state.currentCreature;
        this.state.caughtCreatures.push({
            id: creature.id,
            name: creature.name,
            image: creature.image,
            rarity: creature.rarity
        });

        this.addEncounterLog(`Gotcha! ${creature.name} was caught!`, 'success');
        AudioSystem.playSound('victory');

        const creatureImg = document.getElementById('encounter-creature-img');
        creatureImg.classList.add('caught');

        this.state.isEncounterActive = false;
        this.updateInventoryDisplay();

        setTimeout(() => {
            creatureImg.classList.remove('caught');
            if (this.state.actionsLeft <= 0 || this.state.inventory.capsules <= 0) {
                this.endRun();
            } else {
                this.showScreen('explore-screen');
                this.setMessage(`${creature.name} was caught! Keep exploring!`);
            }
        }, 1200);
    },

    // Check if creature flees
    checkFlee(angry = false) {
        const creature = this.state.currentCreature;
        let fleeRate = creature.fleeRate;

        if (this.state.creatureModifiers.baitActive) {
            fleeRate *= 0.5; // Bait decreases flee rate
        }
        if (angry || this.state.creatureModifiers.angryActive) {
            fleeRate *= 1.5; // Angry increases flee rate
        }

        if (Math.random() < fleeRate) {
            this.creatureFled();
        } else {
            this.decrementModifiers();
        }
    },

    // Creature fled
    creatureFled() {
        const creature = this.state.currentCreature;
        this.state.fledCreatures++;
        this.state.isEncounterActive = false;

        this.addEncounterLog(`${creature.name} fled!`, 'danger');
        AudioSystem.playSound('defeat');

        const creatureImg = document.getElementById('encounter-creature-img');
        creatureImg.classList.add('fled');

        setTimeout(() => {
            creatureImg.classList.remove('fled');
            if (this.state.actionsLeft <= 0 || this.state.inventory.capsules <= 0) {
                this.endRun();
            } else {
                this.showScreen('explore-screen');
                this.setMessage(`${creature.name} ran away... Keep looking!`);
            }
        }, 800);
    },

    // Decrement modifier turns
    decrementModifiers() {
        if (this.state.creatureModifiers.baitTurns > 0) {
            this.state.creatureModifiers.baitTurns--;
            if (this.state.creatureModifiers.baitTurns <= 0) {
                this.state.creatureModifiers.baitActive = false;
            }
        }
        if (this.state.creatureModifiers.angryTurns > 0) {
            this.state.creatureModifiers.angryTurns--;
            if (this.state.creatureModifiers.angryTurns <= 0) {
                this.state.creatureModifiers.angryActive = false;
            }
        }
        this.updateCreatureStatus();
    },

    // End the run
    endRun() {
        this.showScreen('results-screen');

        document.getElementById('result-caught').textContent = this.state.caughtCreatures.length;
        document.getElementById('result-fled').textContent = this.state.fledCreatures;
        document.getElementById('result-rares').textContent = this.state.raresFound;

        const creaturesContainer = document.getElementById('results-creatures');
        if (this.state.caughtCreatures.length > 0) {
            creaturesContainer.innerHTML = this.state.caughtCreatures.map(c => `
                <div class="result-creature ${c.rarity}">
                    <img src="assets/images/characters/${c.image}" alt="${c.name}">
                    <div class="name">${c.name}</div>
                </div>
            `).join('');
        } else {
            creaturesContainer.innerHTML = '<p style="color: var(--text-muted); font-size: 0.8rem;">No creatures caught this run.</p>';
        }

        if (this.state.caughtCreatures.length > 0) {
            AudioSystem.playSound('victory');
        } else {
            AudioSystem.playSound('defeat');
        }
    },

    // Play Again
    playAgain() {
        if (this.state.tickets <= 0) {
            alert('You need more tickets! Get 1000 $PUMPMON for each ticket.');
            return;
        }
        this.showScreen('biome-select-screen');
        this.renderBiomeSelection();
    },

    // Reset state
    resetState() {
        this.state.currentBiome = null;
        this.state.currentCreature = null;
        this.state.isEncounterActive = false;
        this.state.caughtCreatures = [];
        this.state.fledCreatures = 0;
        this.state.raresFound = 0;
    },

    // UI Updates
    setMessage(msg) {
        document.getElementById('safari-message').textContent = msg;
    },

    updateActionsDisplay() {
        document.getElementById('actions-left').textContent = this.state.actionsLeft;
    },

    updateInventoryDisplay() {
        document.getElementById('inv-capsules').textContent = this.state.inventory.capsules;
        document.getElementById('inv-bait').textContent = this.state.inventory.bait;
        document.getElementById('inv-rocks').textContent = this.state.inventory.rocks;
        document.getElementById('inv-caught').textContent = this.state.caughtCreatures.length;

        document.getElementById('capsule-count').textContent = this.state.inventory.capsules;
        document.getElementById('bait-count').textContent = this.state.inventory.bait;
        document.getElementById('rock-count').textContent = this.state.inventory.rocks;
    },

    updateEncounterButtons() {
        document.querySelector('.encounter-btn.capsule').disabled = this.state.inventory.capsules <= 0;
        document.querySelector('.encounter-btn.bait').disabled = this.state.inventory.bait <= 0;
        document.querySelector('.encounter-btn.rock').disabled = this.state.inventory.rocks <= 0;
    },

    updateCreatureStatus() {
        const statusEl = document.getElementById('creature-status');
        let html = '';
        if (this.state.creatureModifiers.baitActive) {
            html += '<span class="status-effect bait"> Eating</span>';
        }
        if (this.state.creatureModifiers.angryActive) {
            html += '<span class="status-effect angry"> Angry</span>';
        }
        statusEl.innerHTML = html;
    },

    updateTicketDisplay() {
        const ticketEl = document.getElementById('ticket-count');
        if (ticketEl) ticketEl.textContent = this.state.tickets;
    },

    addEncounterLog(msg, type = '') {
        const log = document.getElementById('encounter-log');
        const entry = document.createElement('div');
        entry.className = 'encounter-log-entry ' + type;
        entry.textContent = '> ' + msg;
        log.appendChild(entry);
        log.scrollTop = log.scrollHeight;
    },

    clearEncounterLog() {
        document.getElementById('encounter-log').innerHTML = '';
    }
};

// Global functions
function openSafari() {
    SafariGame.open();
}

function closeSafari() {
    SafariGame.close();
}

function exitSafari() {
    if (SafariGame.state.isEncounterActive || SafariGame.state.actionsLeft > 0) {
        if (confirm('Are you sure? Your progress will be lost!')) {
            SafariGame.endRun();
        }
    } else {
        closeSafari();
    }
}

// Initialize on load
document.addEventListener('DOMContentLoaded', () => {
    SafariGame.init();
});



        /* ================================
           WALLET SYSTEM
           ================================ */
        const WalletSystem = {
    connected: false,
    address: null,
    balance: 0,
    tokenBalance: 0,
    provider: null,
    
    // Replace with your actual $PUMPMON token mint address
    tokenMint: '8Jx8AAHj86wbQgUTjGuj6GTTL5Ps3cqxKRTvpaJApump',
    
    wallets: [
        {
            name: 'Phantom',
            icon: 'assets/images/phantom-logo.png',
            getProvider: () => {
                if ('phantom' in window) {
                    const provider = window.phantom?.solana;
                    if (provider?.isPhantom) {
                        return provider;
                    }
                }
                return null;
            },
            downloadUrl: 'https://phantom.app/'
        },
    ],
    
    init() {
        const savedAddress = localStorage.getItem('walletAddress');
        if (savedAddress) {
            setTimeout(() => this.checkExistingConnection(), 500);
        }
    },
    
    async checkExistingConnection() {
        try {
            const provider = this.wallets[0].getProvider();
            if (provider) {
                const resp = await provider.connect({ onlyIfTrusted: true });
                if (resp.publicKey) {
                    this.handleConnection(resp.publicKey.toString(), provider, 'Phantom');
                }
            }
        } catch (err) {
            console.log('Auto-reconnect failed:', err.message);
            localStorage.removeItem('walletAddress');
            localStorage.removeItem('walletName');
        }
    },
    
    openModal() {
        const modal = document.getElementById('wallet-modal');
        const list = document.getElementById('wallet-list');
        
        list.innerHTML = this.wallets.map(wallet => {
            const provider = wallet.getProvider();
            const isInstalled = !!provider;
            
            return `
                <div class="wallet-option" onclick="WalletSystem.connectTo('${wallet.name}')">
                    <img src="${wallet.icon}" alt="${wallet.name}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22><rect fill=%22%23AB9FF2%22 width=%2240%22 height=%2240%22 rx=%228%22/><text x=%2250%%22 y=%2255%%22 text-anchor=%22middle%22 fill=%22white%22 font-size=%2218%22></text></svg>'">
                    <div class="wallet-option-info">
                        <div class="wallet-option-name">${wallet.name}</div>
                        <div class="wallet-option-desc">${isInstalled ? 'Click to connect' : 'Click to install'}</div>
                    </div>
                    <span class="wallet-option-status ${isInstalled ? '' : 'not-installed'}">
                        ${isInstalled ? 'Detected' : 'Install'}
                    </span>
                </div>
            `;
        }).join('');
        
        modal.classList.add('show');
    },
    
    closeModal() {
        document.getElementById('wallet-modal').classList.remove('show');
    },
    
    async connectTo(walletName) {
        const wallet = this.wallets.find(w => w.name === walletName);
        if (!wallet) return;
        
        const provider = wallet.getProvider();
        
        if (!provider) {
            window.open(wallet.downloadUrl, '_blank');
            return;
        }
        
        try {
            const resp = await provider.connect();
            
            if (resp.publicKey) {
                this.handleConnection(resp.publicKey.toString(), provider, walletName);
                this.closeModal();
            }
        } catch (err) {
            console.error('Connection error:', err);
            
            if (err.code === 4001) {
                alert('Connection cancelled. Please approve the connection request in Phantom.');
            } else if (err.code === -32603) {
                alert('Connection error. Please make sure Phantom is unlocked.');
            } else {
                alert('Failed to connect: ' + (err.message || 'Unknown error'));
            }
        }
    },
    
    handleConnection(address, provider, walletName) {
        this.connected = true;
        this.address = address;
        this.provider = provider;
        
        localStorage.setItem('walletAddress', address);
        localStorage.setItem('walletName', walletName);
        
        console.log(' Wallet connected:', address);
        
        this.updateUI();
        this.getBalance();
        this.getTokenBalance();
        
        provider.on('disconnect', () => {
            console.log('Wallet disconnected event');
            this.handleDisconnect();
        });
        
        provider.on('accountChanged', (publicKey) => {
            if (publicKey) {
                console.log('Account changed to:', publicKey.toString());
                this.address = publicKey.toString();
                localStorage.setItem('walletAddress', this.address);
                this.updateUI();
                this.getBalance();
                this.getTokenBalance();
            } else {
                this.handleDisconnect();
            }
        });
    },
    
    async getBalance() {
        if (!this.address) return;
        
     const endpoints = [
    'https://rpc.ankr.com/solana',
    'https://solana-mainnet.g.alchemy.com/v2/demo'
];
        
        for (const endpoint of endpoints) {
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'getBalance',
                        params: [this.address]
                    })
                });
                
                const data = await response.json();
                
                if (data.result?.value !== undefined) {
                    this.balance = (data.result.value / 1e9).toFixed(4);
                    this.updateUI();
                    console.log(' SOL Balance:', this.balance, 'SOL');
                    return;
                }
            } catch (e) {
                console.log('RPC failed:', endpoint, e.message);
                continue;
            }
        }
        
        console.log('Could not fetch SOL balance from any endpoint');
    },
    
    async getTokenBalance() {
        if (!this.address || !this.tokenMint) return;
        
const endpoints = [
    'https://rpc.ankr.com/solana',
    'https://solana-mainnet.g.alchemy.com/v2/demo'
];
        
        for (const endpoint of endpoints) {
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'getTokenAccountsByOwner',
                        params: [
                            this.address,
                            { mint: this.tokenMint },
                            { encoding: 'jsonParsed' }
                        ]
                    })
                });
                
                const data = await response.json();
                
                if (data.result?.value?.length > 0) {
                    this.tokenBalance = data.result.value[0].account.data.parsed.info.tokenAmount.uiAmount || 0;
                } else {
                    this.tokenBalance = 0;
                }
                
                console.log(' $PUMPMON Balance:', this.tokenBalance);
                this.updateUI();
                
                // Update Safari Zone tickets (1000 tokens = 1 ticket)
                if (typeof SafariGame !== 'undefined') {
                    SafariGame.state.tickets = Math.floor(this.tokenBalance / 1000);
                    SafariGame.state.pumpmonBalance = this.tokenBalance;
                    SafariGame.updateTicketDisplay();
                }
                
                return this.tokenBalance;
            } catch (e) {
                console.log('Token RPC failed:', endpoint, e.message);
                continue;
            }
        }
        
        console.log('Could not fetch token balance from any endpoint');
        return 0;
    },
    
    // Fetch balance for any SPL token by mint address
    async getAnyTokenBalance(mintAddress) {
        if (!this.address || !mintAddress) return 0;
        
        try {
            const response = await fetch('https://api.mainnet-beta.solana.com', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    jsonrpc: '2.0',
                    id: 1,
                    method: 'getTokenAccountsByOwner',
                    params: [
                        this.address,
                        { mint: mintAddress },
                        { encoding: 'jsonParsed' }
                    ]
                })
            });
            
            const data = await response.json();
            
            if (data.result?.value?.length > 0) {
                return data.result.value[0].account.data.parsed.info.tokenAmount.uiAmount || 0;
            }
            return 0;
        } catch (error) {
            console.error('Error fetching token balance:', error);
            return 0;
        }
    },
    
    // Fetch all SPL tokens owned by the wallet
    async getAllTokenBalances() {
        if (!this.address) return [];
        
        try {
            const response = await fetch('https://api.mainnet-beta.solana.com', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    jsonrpc: '2.0',
                    id: 1,
                    method: 'getTokenAccountsByOwner',
                    params: [
                        this.address,
                        { programId: 'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA' },
                        { encoding: 'jsonParsed' }
                    ]
                })
            });
            
            const data = await response.json();
            
            if (data.result?.value?.length > 0) {
                return data.result.value.map(account => ({
                    mint: account.account.data.parsed.info.mint,
                    balance: account.account.data.parsed.info.tokenAmount.uiAmount || 0,
                    decimals: account.account.data.parsed.info.tokenAmount.decimals,
                    raw: account.account.data.parsed.info.tokenAmount.amount
                })).filter(token => token.balance > 0);
            }
            return [];
        } catch (error) {
            console.error('Error fetching all tokens:', error);
            return [];
        }
    },
    
    updateUI() {
        const btn = document.getElementById('wallet-btn');
        const text = document.getElementById('wallet-text');
        
        if (this.connected && this.address) {
            const shortAddress = this.address.slice(0, 4) + '...' + this.address.slice(-4);
            text.innerHTML = `
                <span class="wallet-address">${shortAddress}</span>
                ${this.balance ? `<span class="wallet-balance">${this.balance} SOL</span>` : ''}
            `;
            btn.classList.add('connected');
            
            // Update token balance display elements if they exist
            const tokenBalanceEl = document.getElementById('pumpmon-balance');
            if (tokenBalanceEl) {
                tokenBalanceEl.textContent = this.tokenBalance.toLocaleString();
            }
            
            const tokenDisplayEl = document.getElementById('token-balance-display');
            if (tokenDisplayEl) {
                tokenDisplayEl.style.display = 'block';
            }
        } else {
            text.textContent = 'Connect Wallet';
            btn.classList.remove('connected');
            
            const tokenDisplayEl = document.getElementById('token-balance-display');
            if (tokenDisplayEl) {
                tokenDisplayEl.style.display = 'none';
            }
        }
    },
    
    async showDisconnectOption() {
        if (confirm('Disconnect wallet?')) {
            await this.disconnect();
        }
    },
    
    handleDisconnect() {
        this.connected = false;
        this.address = null;
        this.balance = 0;
        this.tokenBalance = 0;
        this.provider = null;
        
        localStorage.removeItem('walletAddress');
        localStorage.removeItem('walletName');
        
        this.updateUI();
        console.log('Wallet disconnected');
    },
    
    async disconnect() {
        try {
            if (this.provider?.disconnect) {
                await this.provider.disconnect();
            }
        } catch (e) {
            console.log('Disconnect error:', e);
        }
        
        this.handleDisconnect();
    },
    
    // Refresh all balances
    async refreshBalances() {
        if (!this.connected) return;
        await this.getBalance();
        await this.getTokenBalance();
    }
};

// Global helper functions
function connectWallet() {
    if (WalletSystem.connected) {
        WalletSystem.showDisconnectOption();
    } else {
        WalletSystem.openModal();
    }
}

function copyCA() {
    const ca = document.getElementById('ca-address').textContent;
    navigator.clipboard.writeText(ca);
    
    const btn = document.querySelector('.ca-copy');
    btn.textContent = '';
    setTimeout(() => btn.textContent = '', 1500);
}

function closeWalletModal() {
    WalletSystem.closeModal();
}

// Auto-refresh balances every 30 seconds when connected
setInterval(() => {
    if (WalletSystem.connected) {
        WalletSystem.refreshBalances();
    }
}, 30000);

        /* ================================
           AUDIO SYSTEM
           ================================ */
        const AudioSystem = {
    music: null,
    battleMusic: null,
    isMusicPlaying: false,
    currentTrack: 'main',
    
    init() {
        this.music = new Audio('assets/audio/main-theme.mp3');
        this.battleMusic = new Audio('assets/audio/battle-theme.mp3');
        this.music.loop = true;
        this.battleMusic.loop = true;
        this.music.volume = 0.4;
        this.battleMusic.volume = 0.5;
        
        // Try autoplay
        this.tryAutoplay();
    },
    
    tryAutoplay() {
        const playAttempt = this.music.play();
        
        if (playAttempt !== undefined) {
            playAttempt.then(() => {
                // Autoplay worked
                this.isMusicPlaying = true;
                this.updateButton(true);
                console.log('Music autoplay started');
            }).catch(() => {
                // Autoplay blocked - play on first interaction
                console.log('Autoplay blocked, waiting for interaction');
                
                const startMusic = () => {
                    this.playMusic();
                    document.removeEventListener('click', startMusic);
                    document.removeEventListener('scroll', startMusic);
                };
                
                document.addEventListener('click', startMusic, { once: true });
                document.addEventListener('scroll', startMusic, { once: true });
            });
        }
    },
    
    updateButton(isPlaying) {
        const btn = document.getElementById('music-btn');
        if (btn) {
            if (isPlaying) {
                btn.classList.add('playing');
                btn.textContent = '';
            } else {
                btn.classList.remove('playing');
                btn.textContent = '';
            }
        }
    },
    
    toggleMusic() {
        if (this.isMusicPlaying) {
            this.stopMusic();
        } else {
            this.playMusic();
        }
    },
    
    playMusic() {
        const track = this.currentTrack === 'battle' ? this.battleMusic : this.music;
        track.play().then(() => {
            this.isMusicPlaying = true;
            this.updateButton(true);
        }).catch(e => console.log('Audio play failed:', e));
    },
    
    stopMusic() {
        this.music.pause();
        this.battleMusic.pause();
        this.isMusicPlaying = false;
        this.updateButton(false);
    },
    
    switchTrack(track) {
        if (this.currentTrack === track) return;
        
        const wasPlaying = this.isMusicPlaying;
        this.music.pause();
        this.battleMusic.pause();
        this.music.currentTime = 0;
        this.battleMusic.currentTime = 0;
        this.currentTrack = track;
        
        if (wasPlaying) {
            this.playMusic();
        }
    },
    
    playSound(type) {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = ctx.createOscillator();
        const gainNode = ctx.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(ctx.destination);
        
        switch(type) {
            case 'hit':
                oscillator.frequency.setValueAtTime(200, ctx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.1);
                break;
                
            case 'critical':
                oscillator.frequency.setValueAtTime(400, ctx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.1);
                oscillator.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.4, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.2);
                break;
                
            case 'victory':
                const notes = [523, 659, 784, 1047];
                notes.forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0.2, ctx.currentTime + i * 0.15);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.15 + 0.3);
                    osc.start(ctx.currentTime + i * 0.15);
                    osc.stop(ctx.currentTime + i * 0.15 + 0.3);
                });
                break;
                
            case 'defeat':
                oscillator.frequency.setValueAtTime(300, ctx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.5);
                gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.5);
                break;
                
            case 'select':
                oscillator.frequency.setValueAtTime(600, ctx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.05);
                gainNode.gain.setValueAtTime(0.15, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.05);
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.05);
                break;
                
            case 'heal':
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(400, ctx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.3);
                break;
        }
    }
};

function toggleMusic() {
    AudioSystem.toggleMusic();
}

        /* ================================
           GAME DATA
           ================================ */
const TYPE_CHART = {
    water: { fire: 2, water: 0.5, grass: 0.5, electric: 1, normal: 1, psychic: 1, dark: 1, ice: 1, rock: 2 },
    fire: { water: 0.5, fire: 0.5, grass: 2, electric: 1, normal: 1, psychic: 1, dark: 1, ice: 2, rock: 0.5 },
    grass: { water: 2, fire: 0.5, grass: 0.5, electric: 1, normal: 1, psychic: 1, dark: 1, ice: 0.5, rock: 2 },
    electric: { water: 2, fire: 1, grass: 0.5, electric: 0.5, normal: 1, psychic: 1, dark: 1, ice: 1, rock: 1 },
    normal: { water: 1, fire: 1, grass: 1, electric: 1, normal: 1, psychic: 1, dark: 1, ice: 1, rock: 0.5 },
    psychic: { water: 1, fire: 1, grass: 1, electric: 1, normal: 1, psychic: 0.5, dark: 0, ice: 1, rock: 1 },
    dark: { water: 1, fire: 1, grass: 1, electric: 1, normal: 1, psychic: 2, dark: 0.5, ice: 1, rock: 1 },
    ice: { water: 0.5, fire: 0.5, grass: 2, electric: 1, normal: 1, psychic: 1, dark: 1, ice: 0.5, rock: 1 },
    rock: { water: 0.5, fire: 2, grass: 0.5, electric: 1, normal: 1, psychic: 1, dark: 1, ice: 2, rock: 1 }
};

       const CHARACTERS = {
    pepe: { 
        name: 'PEPE', 
        image: 'pepe.png', 
        hp: 100, 
        attack: 35, 
        defense: 30, 
        speed: 40, 
        type: 'water',
        description: 'The OG memecoin legend. Balanced stats with healing powers.',
        role: 'Balanced'
    },
    whale: { 
        name: 'WHALE', 
        image: 'whale.png', 
        hp: 130, 
        attack: 28, 
        defense: 50, 
        speed: 20, 
        type: 'water',
        description: 'Massive HP pool and crushing defense. Slow but unstoppable.',
        role: 'Tank'
    },
    cow: { 
        name: 'COW', 
        image: 'cow.png', 
        hp: 115, 
        attack: 32, 
        defense: 40, 
        speed: 30, 
        type: 'normal',
        description: 'Sacred bovine with earthquake powers. Well-rounded bruiser.',
        role: 'Bruiser'
    },
    moodeng: { 
        name: 'MOODENG', 
        image: 'moodeng.png', 
        hp: 95, 
        attack: 42, 
        defense: 28, 
        speed: 45, 
        type: 'psychic',
        description: 'Viral hippo with psychic chomps. High attack potential.',
        role: 'Attacker'
    },
    catana: { 
        name: 'CATANA', 
        image: 'catana.png', 
        hp: 82, 
        attack: 48, 
        defense: 22, 
        speed: 58, 
        type: 'dark',
        description: 'Ninja cat assassin. Glass cannon with critical hits.',
        role: 'Assassin'
    },
dicklet: { 
    name: 'DICKLET', 
    image: 'dicklet.png', 
    hp: 120, 
    attack: 38, 
    defense: 55, 
    speed: 15, 
    type: 'rock',
    description: 'Ancient rock warrior. Extremely tanky with devastating quakes.',
    role: 'Tank'
},

// PENGUIN - change to ice type
penguin: { 
    name: 'PENGUIN', 
    image: 'penguin.png', 
    hp: 88, 
    attack: 45, 
    defense: 32, 
    speed: 50, 
    type: 'ice',
    description: 'Icy evolved form of PEPE. Fast attacker with freezing powers.',
    role: 'Speedster'
}
};

       const MOVES = {
    pepe: [
        { name: 'WATER GUN', type: 'water', power: 40, accuracy: 100, pp: 25 },
        { name: 'BUBBLE BEAM', type: 'water', power: 65, accuracy: 100, pp: 15, effect: 'speed-down', effectChance: 10 },
        { name: 'MEME MAGIC', type: 'psychic', power: 50, accuracy: 100, pp: 15, effect: 'confuse', effectChance: 10 },
        { name: 'RECOVER', type: 'normal', power: 0, accuracy: 100, pp: 10, heal: 50 }
    ],
    whale: [
        { name: 'SURF', type: 'water', power: 90, accuracy: 100, pp: 15 },
        { name: 'BODY SLAM', type: 'normal', power: 85, accuracy: 100, pp: 15, effect: 'paralyze', effectChance: 30 },
        { name: 'MARKET CRASH', type: 'dark', power: 120, accuracy: 85, pp: 5 },
        { name: 'REST', type: 'normal', power: 0, accuracy: 100, pp: 10, heal: 100, selfSleep: true }
    ],
    cow: [
        { name: 'STOMP', type: 'normal', power: 65, accuracy: 100, pp: 20, effect: 'flinch', effectChance: 30 },
        { name: 'EARTHQUAKE', type: 'normal', power: 100, accuracy: 100, pp: 10 },
        { name: 'MILK DRINK', type: 'normal', power: 0, accuracy: 100, pp: 10, heal: 50 },
        { name: 'ZEN HEADBUTT', type: 'psychic', power: 80, accuracy: 90, pp: 15, effect: 'flinch', effectChance: 20 }
    ],
    moodeng: [
        { name: 'PSYCHIC', type: 'psychic', power: 90, accuracy: 100, pp: 10, effect: 'spdef-down', effectChance: 10 },
        { name: 'CRUNCH', type: 'dark', power: 80, accuracy: 100, pp: 15, effect: 'def-down', effectChance: 20 },
        { name: 'HIPPO CHOMP', type: 'dark', power: 60, accuracy: 100, pp: 25 },
        { name: 'CALM MIND', type: 'psychic', power: 0, accuracy: 100, pp: 20, boost: { attack: 1 } }
    ],
    catana: [
        { name: 'NIGHT SLASH', type: 'dark', power: 70, accuracy: 100, pp: 15, highCrit: true },
        { name: 'SUCKER PUNCH', type: 'dark', power: 70, accuracy: 100, pp: 5, priority: true },
        { name: 'SLASH', type: 'normal', power: 70, accuracy: 100, pp: 20, highCrit: true },
        { name: 'SWORDS DANCE', type: 'normal', power: 0, accuracy: 100, pp: 20, boost: { attack: 2 } }
    ],
// Updated moves with proper types
dicklet: [
    { name: 'ROCK THROW', type: 'rock', power: 50, accuracy: 90, pp: 25 },
    { name: 'EARTHQUAKE', type: 'rock', power: 100, accuracy: 100, pp: 10 },
    { name: 'STONE EDGE', type: 'rock', power: 100, accuracy: 80, pp: 5, highCrit: true },
    { name: 'HARDEN', type: 'rock', power: 0, accuracy: 100, pp: 30, boost: { defense: 1 } }
],
penguin: [
    { name: 'ICE BEAM', type: 'ice', power: 90, accuracy: 100, pp: 10, effect: 'freeze', effectChance: 10 },
    { name: 'SURF', type: 'water', power: 90, accuracy: 100, pp: 15 },
    { name: 'BLIZZARD', type: 'ice', power: 110, accuracy: 70, pp: 5, effect: 'freeze', effectChance: 10 },
    { name: 'AQUA RING', type: 'water', power: 0, accuracy: 100, pp: 20, heal: 25 }
]
};

        /* ================================
           GAME STATE
           ================================ */
        let gameState = {
            playerKey: 'pepe',
            enemyKey: 'whale',
            playerHP: 100,
            playerMaxHP: 100,
            enemyHP: 130,
            enemyMaxHP: 130,
            playerLevel: 50,
            enemyLevel: 48,
            isPlayerTurn: true,
            selectedChar: 'pepe',
            moves: [],
            playerStatus: null,
            enemyStatus: null,
            playerShiny: false,
            enemyShiny: false,
            playerBoosts: { attack: 0, defense: 0, speed: 0 },
            enemyBoosts: { attack: 0, defense: 0, speed: 0 },
            turnCount: 0
        };

        /* ================================
           GAME FUNCTIONS
           ================================ */
        function checkBattleBackground() {
            const arena = document.getElementById('battle-arena');
            const bgImage = new Image();
            bgImage.src = 'assets/images/battle-bg.png';
            
            bgImage.onload = () => arena.classList.remove('no-bg');
            bgImage.onerror = () => arena.classList.add('no-bg');
            
            setTimeout(() => {
                if (!bgImage.complete || bgImage.naturalWidth === 0) {
                    arena.classList.add('no-bg');
                }
            }, 1000);
        }

        function init() {
            checkBattleBackground();
            renderCharacterGrid();
            initBattle();
        }

        function renderCharacterGrid() {
            const grid = document.getElementById('char-grid');
            grid.innerHTML = '';
            
            Object.entries(CHARACTERS).forEach(([key, char]) => {
                const card = document.createElement('div');
                card.className = `char-card ${key === gameState.selectedChar ? 'selected' : ''}`;
                card.onclick = () => selectChar(key);
                
                const getStatClass = (value, stat) => {
                    if (stat === 'hp') return value >= 110 ? 'high' : value >= 95 ? 'medium' : 'low';
                    if (stat === 'attack') return value >= 42 ? 'high' : value >= 32 ? 'medium' : 'low';
                    if (stat === 'defense') return value >= 40 ? 'high' : value >= 28 ? 'medium' : 'low';
                    if (stat === 'speed') return value >= 45 ? 'high' : value >= 30 ? 'medium' : 'low';
                    return '';
                };
                
                card.innerHTML = `
                    <img src="assets/images/characters/${char.image}" alt="${char.name}">
                    <div class="name">${char.name}</div>
                    <span class="type-badge ${char.type}">${char.type}</span>
                    <div class="role"> ${char.role}</div>
                    <div class="description">${char.description}</div>
                    <div class="stats">
                        <div class="stat">
                            <span class="stat-label">HP</span>
                            <span class="stat-value ${getStatClass(char.hp, 'hp')}">${char.hp}</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">ATK</span>
                            <span class="stat-value ${getStatClass(char.attack, 'attack')}">${char.attack}</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">DEF</span>
                            <span class="stat-value ${getStatClass(char.defense, 'defense')}">${char.defense}</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">SPD</span>
                            <span class="stat-value ${getStatClass(char.speed, 'speed')}">${char.speed}</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function selectChar(key) {
            gameState.selectedChar = key;
            AudioSystem.playSound('select');
            document.querySelectorAll('.char-card').forEach(c => c.classList.remove('selected'));
            document.querySelector(`.char-card:nth-child(${Object.keys(CHARACTERS).indexOf(key) + 1})`).classList.add('selected');
        }

        function selectAndPlay(key) {
            gameState.selectedChar = key;
            gameState.playerKey = key;
            AudioSystem.playSound('select');
            initBattle();
            scrollToGame();
        }

        function initBattle() {
            const playerKey = gameState.playerKey;
            const player = CHARACTERS[playerKey];
            
            const enemyKeys = Object.keys(CHARACTERS).filter(k => k !== playerKey);
            const enemyKey = enemyKeys[Math.floor(Math.random() * enemyKeys.length)];
            const enemy = CHARACTERS[enemyKey];
            
            gameState.enemyKey = enemyKey;
            gameState.playerHP = player.hp;
            gameState.playerMaxHP = player.hp;
            gameState.enemyHP = enemy.hp;
            gameState.enemyMaxHP = enemy.hp;
            gameState.playerLevel = 50;
            gameState.enemyLevel = 45 + Math.floor(Math.random() * 10);
            gameState.moves = MOVES[playerKey].map(m => ({...m, currentPP: m.pp}));
            
            gameState.playerStatus = null;
            gameState.enemyStatus = null;
            gameState.playerBoosts = { attack: 0, defense: 0, speed: 0 };
            gameState.enemyBoosts = { attack: 0, defense: 0, speed: 0 };
            gameState.turnCount = 0;
            
            gameState.playerShiny = Math.random() < 0.05;
            gameState.enemyShiny = Math.random() < 0.05;
            
            gameState.isPlayerTurn = player.speed >= enemy.speed;
            
            document.getElementById('player-name').textContent = player.name + (gameState.playerShiny ? ' ' : '');
            document.getElementById('enemy-name').textContent = enemy.name + (gameState.enemyShiny ? ' ' : '');
            document.getElementById('player-hp').textContent = player.hp;
            document.getElementById('player-max-hp').textContent = player.hp;
            document.getElementById('player-level').textContent = gameState.playerLevel;
            document.getElementById('enemy-level').textContent = gameState.enemyLevel;
            
            document.getElementById('player-img').src = `assets/images/characters/${player.image}`;
            document.getElementById('enemy-img').src = `assets/images/characters/${enemy.image}`;
            
            const backImageName = player.image.replace('.png', '-back.png');
            document.getElementById('player-img-back').src = `assets/images/characters/${backImageName}`;
            document.getElementById('player-img-back').onerror = function() {
                this.src = `assets/images/characters/${player.image}`;
            };
            
            const playerSprite = document.getElementById('player-sprite');
            const playerSpriteBack = document.getElementById('player-sprite-back');
            const enemySprite = document.getElementById('enemy-sprite');
            playerSprite.classList.toggle('shiny', gameState.playerShiny);
            playerSpriteBack.classList.toggle('shiny', gameState.playerShiny);
            enemySprite.classList.toggle('shiny', gameState.enemyShiny);
            
            playerSprite.style.opacity = '1';
            playerSprite.style.transform = '';
            playerSpriteBack.style.opacity = '1';
            playerSpriteBack.style.transform = '';
            enemySprite.style.opacity = '1';
            enemySprite.style.transform = '';
            
            updateHPBars();
            updateStatusDisplay();
            updateTurnIndicator();
            renderMoves();
            clearLog();
            
            showBattleIntro(enemy);
            
            const battleResult = document.getElementById('battle-result');
            battleResult.style.display = 'none';
            battleResult.classList.remove('show');
        }
        
        function showBattleIntro(enemy) {
            const intro = document.getElementById('battle-intro');
            const text = document.getElementById('intro-text');
            
            intro.classList.remove('hide');
            intro.style.animation = 'none';
            intro.offsetHeight;
            intro.style.animation = 'introFade 2.5s ease-out forwards';
            
            const shinyText = gameState.enemyShiny ? '<span class="shiny-name"> SHINY ' + enemy.name + ' </span>' : enemy.name;
            text.innerHTML = `A wild ${shinyText} appeared!`;
            
            setTimeout(() => {
                intro.classList.add('hide');
                addLog(`A wild ${enemy.name} appeared!`, 'system');
                if (gameState.enemyShiny) addLog(`It's shiny! `, 'info');
                addLog(`Go! ${CHARACTERS[gameState.playerKey].name}!`, 'system');
                if (gameState.playerShiny) addLog(`Your ${CHARACTERS[gameState.playerKey].name} is shiny! `, 'info');
                
                if (!gameState.isPlayerTurn) {
                    addLog(`${enemy.name} is faster!`, 'enemy');
                    setTimeout(() => enemyTurn(), 1000);
                }
            }, 2500);
        }
        
        function updateTurnIndicator() {
            const indicator = document.getElementById('turn-indicator');
            indicator.textContent = gameState.isPlayerTurn ? 'YOUR TURN' : 'ENEMY TURN';
            indicator.className = 'turn-indicator' + (gameState.isPlayerTurn ? '' : ' enemy');
        }
        
        function updateStatusDisplay() {
            const playerStatus = document.getElementById('player-status');
            const enemyStatus = document.getElementById('enemy-status');
            
            const statusNames = { par: 'PAR', brn: 'BRN', psn: 'PSN', slp: 'SLP', frz: 'FRZ' };
            
            playerStatus.innerHTML = gameState.playerStatus 
                ? `<span class="status-badge status-${gameState.playerStatus}">${statusNames[gameState.playerStatus]}</span>` 
                : '';
            enemyStatus.innerHTML = gameState.enemyStatus 
                ? `<span class="status-badge status-${gameState.enemyStatus}">${statusNames[gameState.enemyStatus]}</span>` 
                : '';
        }

        function renderMoves() {
            const grid = document.getElementById('move-grid');
            grid.innerHTML = '';
            
            const typeColors = {
                water: '#3b82f6',
                electric: '#fbbf24',
                fire: '#ef4444',
                normal: '#a3a3a3',
                dark: '#374151',
                psychic: '#ec4899',
                grass: '#22c55e'
            };
            
            gameState.moves.forEach((move, i) => {
                const btn = document.createElement('button');
                btn.className = 'move-btn';
                btn.disabled = !gameState.isPlayerTurn || move.currentPP <= 0;
                btn.onclick = () => useMove(i);
                
                const typeColor = typeColors[move.type] || '#a3a3a3';
                const textColor = move.type === 'electric' ? '#000' : '#fff';
                
                btn.innerHTML = `
                    <div style="font-weight: 600; font-size: 0.8rem; margin-bottom: 6px; color: #fff;">${move.name}</div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.6rem; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; font-weight: 600; background: ${typeColor}; color: ${textColor};">${move.type.toUpperCase()}</span>
                        <span style="font-size: 0.7rem; color: #888;">PP ${move.currentPP}/${move.pp}</span>
                    </div>
                `;
                grid.appendChild(btn);
            });
        }

        function useMove(index) {
            if (!gameState.isPlayerTurn) return;
            
            const move = gameState.moves[index];
            if (move.currentPP <= 0) return;
            
            move.currentPP--;
            gameState.isPlayerTurn = false;
            updateTurnIndicator();
            AudioSystem.playSound('select');
            
            const player = CHARACTERS[gameState.playerKey];
            const enemy = CHARACTERS[gameState.enemyKey];
            
            if (gameState.playerStatus === 'par' && Math.random() < 0.25) {
                addLog(`${player.name} is paralyzed! It can't move!`, 'info');
                setTimeout(() => enemyTurn(), 1000);
                return;
            }
            
            if (gameState.playerStatus === 'slp') {
                if (Math.random() < 0.33) {
                    gameState.playerStatus = null;
                    updateStatusDisplay();
                    addLog(`${player.name} woke up!`, 'info');
                } else {
                    addLog(`${player.name} is fast asleep!`, 'info');
                    setTimeout(() => enemyTurn(), 1000);
                    return;
                }
            }
            
            addLog(`${player.name} used ${move.name}!`);
            
            const playerSpriteBack = document.getElementById('player-sprite-back');
            playerSpriteBack.classList.add('attacking');
            setTimeout(() => playerSpriteBack.classList.remove('attacking'), 400);
            
            setTimeout(() => {
                if (move.accuracy && Math.random() * 100 > move.accuracy) {
                    addLog(`${player.name}'s attack missed!`, 'info');
                    AudioSystem.playSound('select');
                    showDamageNumber('MISS', 'enemy', true);
                    setTimeout(() => enemyTurn(), 1000);
                    return;
                }
                
                if (move.heal) {
                    const healAmount = Math.floor(gameState.playerMaxHP * (move.heal / 100));
                    gameState.playerHP = Math.min(gameState.playerMaxHP, gameState.playerHP + healAmount);
                    addLog(`${player.name} recovered ${healAmount} HP!`, 'info');
                    AudioSystem.playSound('heal');
                    showDamageNumber(`+${healAmount}`, 'player', false, true);
                    
                    if (move.selfSleep) {
                        gameState.playerStatus = 'slp';
                        updateStatusDisplay();
                        addLog(`${player.name} fell asleep!`, 'info');
                    }
                    
                    updateHPBars();
                    setTimeout(() => enemyTurn(), 1000);
                    return;
                }
                
                if (move.boost) {
                    Object.entries(move.boost).forEach(([stat, amount]) => {
                        gameState.playerBoosts[stat] = Math.min(6, gameState.playerBoosts[stat] + amount);
                        const sharpText = amount >= 2 ? ' sharply' : '';
                        addLog(`${player.name}'s ${stat} rose${sharpText}!`, 'info');
                    });
                    AudioSystem.playSound('heal');
                    setTimeout(() => enemyTurn(), 1000);
                    return;
                }
                
                const result = calculateDamage(move, player, enemy, true);
                gameState.enemyHP = Math.max(0, gameState.enemyHP - result.damage);
                
                showDamageNumber(result.damage, 'enemy', result.isCritical);
                
                if (result.effectiveness > 1) {
                    addLog("It's super effective!", 'info');
                    showEffectivenessPopup('super');
                    AudioSystem.playSound('critical');
                } else if (result.effectiveness < 1 && result.effectiveness > 0) {
                    addLog("It's not very effective...", 'info');
                    showEffectivenessPopup('not-very');
                } else if (result.effectiveness === 0) {
                    addLog(`It doesn't affect ${enemy.name}...`, 'info');
                    showEffectivenessPopup('immune');
                }
                
                if (result.isCritical) {
                    addLog(`Critical hit! Dealt ${result.damage} damage!`);
                    AudioSystem.playSound('critical');
                    screenShake();
                } else {
                    addLog(`Dealt ${result.damage} damage!`);
                    AudioSystem.playSound('hit');
                }
                
                if (move.effect && move.effectChance && Math.random() * 100 < move.effectChance) {
                    applyStatus('enemy', move.effect);
                }
                
                const enemySprite = document.getElementById('enemy-sprite');
                enemySprite.classList.add('damaged');
                setTimeout(() => enemySprite.classList.remove('damaged'), 400);
                
                updateHPBars();
                renderMoves();
                
                if (gameState.enemyHP <= 0) {
                    endBattle(true);
                } else {
                    setTimeout(enemyTurn, 1000);
                }
            }, 300);
        }

        function enemyTurn() {
            const enemy = CHARACTERS[gameState.enemyKey];
            const player = CHARACTERS[gameState.playerKey];
            const enemyMoves = MOVES[gameState.enemyKey];
            
            gameState.turnCount++;
            
            if (gameState.enemyStatus === 'brn' || gameState.enemyStatus === 'psn') {
                const statusDamage = Math.floor(gameState.enemyMaxHP / 16);
                gameState.enemyHP = Math.max(0, gameState.enemyHP - statusDamage);
                const statusName = gameState.enemyStatus === 'brn' ? 'burn' : 'poison';
                addLog(`${enemy.name} was hurt by ${statusName}!`, 'info');
                updateHPBars();
                
                if (gameState.enemyHP <= 0) {
                    endBattle(true);
                    return;
                }
            }
            
            if (gameState.enemyStatus === 'par' && Math.random() < 0.25) {
                addLog(`${enemy.name} is paralyzed! It can't move!`, 'enemy');
                endEnemyTurn();
                return;
            }
            
            if (gameState.enemyStatus === 'slp') {
                if (Math.random() < 0.33) {
                    gameState.enemyStatus = null;
                    updateStatusDisplay();
                    addLog(`${enemy.name} woke up!`, 'enemy');
                } else {
                    addLog(`${enemy.name} is fast asleep!`, 'enemy');
                    endEnemyTurn();
                    return;
                }
            }
            
            let move;
            if (gameState.playerHP < gameState.playerMaxHP * 0.3) {
                move = enemyMoves.reduce((best, m) => (m.power || 0) > (best.power || 0) ? m : best);
            } else {
                const superMoves = enemyMoves.filter(m => m.power && getTypeEffectiveness(m.type, player.type) > 1);
                if (superMoves.length > 0 && Math.random() < 0.7) {
                    move = superMoves[Math.floor(Math.random() * superMoves.length)];
                } else {
                    move = enemyMoves[Math.floor(Math.random() * enemyMoves.length)];
                }
            }
            
            addLog(`${enemy.name} used ${move.name}!`, 'enemy');
            
            const enemySprite = document.getElementById('enemy-sprite');
            enemySprite.classList.add('attacking');
            setTimeout(() => enemySprite.classList.remove('attacking'), 400);
            
            setTimeout(() => {
                if (move.accuracy && Math.random() * 100 > move.accuracy) {
                    addLog(`${enemy.name}'s attack missed!`, 'enemy');
                    showDamageNumber('MISS', 'player', true);
                    endEnemyTurn();
                    return;
                }
                
                if (move.heal) {
                    const healAmount = Math.floor(gameState.enemyMaxHP * (move.heal / 100));
                    gameState.enemyHP = Math.min(gameState.enemyMaxHP, gameState.enemyHP + healAmount);
                    addLog(`${enemy.name} recovered health!`, 'enemy');
                    AudioSystem.playSound('heal');
                    updateHPBars();
                    endEnemyTurn();
                    return;
                }
                
                if (move.boost) {
                    Object.entries(move.boost).forEach(([stat, amount]) => {
                        gameState.enemyBoosts[stat] = Math.min(6, gameState.enemyBoosts[stat] + amount);
                    });
                    addLog(`${enemy.name}'s stats rose!`, 'enemy');
                    endEnemyTurn();
                    return;
                }
                
                const result = calculateDamage(move, enemy, player, false);
                gameState.playerHP = Math.max(0, gameState.playerHP - result.damage);
                
                showDamageNumber(result.damage, 'player', result.isCritical);
                
                if (result.effectiveness > 1) {
                    addLog("It's super effective!", 'enemy');
                } else if (result.effectiveness < 1 && result.effectiveness > 0) {
                    addLog("It's not very effective...", 'enemy');
                }
                
                if (result.isCritical) {
                    addLog(`Critical hit! Took ${result.damage} damage!`, 'enemy');
                    AudioSystem.playSound('critical');
                    screenShake();
                } else {
                    addLog(`Took ${result.damage} damage!`, 'enemy');
                    AudioSystem.playSound('hit');
                }
                
                if (move.effect && move.effectChance && Math.random() * 100 < move.effectChance) {
                    applyStatus('player', move.effect);
                }
                
                const playerSpriteBack = document.getElementById('player-sprite-back');
                playerSpriteBack.classList.add('damaged');
                setTimeout(() => playerSpriteBack.classList.remove('damaged'), 400);
                
                updateHPBars();
                
                if (gameState.playerHP <= 0) {
                    endBattle(false);
                } else {
                    endEnemyTurn();
                }
            }, 300);
        }
        
        function endEnemyTurn() {
            if (gameState.playerStatus === 'brn' || gameState.playerStatus === 'psn') {
                const statusDamage = Math.floor(gameState.playerMaxHP / 16);
                gameState.playerHP = Math.max(0, gameState.playerHP - statusDamage);
                const statusName = gameState.playerStatus === 'brn' ? 'burn' : 'poison';
                addLog(`${CHARACTERS[gameState.playerKey].name} was hurt by ${statusName}!`, 'info');
                updateHPBars();
                
                if (gameState.playerHP <= 0) {
                    endBattle(false);
                    return;
                }
            }
            
            gameState.isPlayerTurn = true;
            updateTurnIndicator();
            renderMoves();
        }
        
        function getTypeEffectiveness(moveType, defenderType) {
            if (TYPE_CHART[moveType] && TYPE_CHART[moveType][defenderType] !== undefined) {
                return TYPE_CHART[moveType][defenderType];
            }
            return 1;
        }
        
        function applyStatus(target, status) {
            if (status === 'paralyze') status = 'par';
            
            if (target === 'player' && !gameState.playerStatus) {
                gameState.playerStatus = status;
                const statusNames = { par: 'paralyzed', brn: 'burned', psn: 'poisoned', slp: 'fell asleep' };
                addLog(`${CHARACTERS[gameState.playerKey].name} was ${statusNames[status]}!`, 'info');
                AudioSystem.playSound('select');
            } else if (target === 'enemy' && !gameState.enemyStatus) {
                gameState.enemyStatus = status;
                const statusNames = { par: 'paralyzed', brn: 'burned', psn: 'poisoned', slp: 'fell asleep' };
                addLog(`${CHARACTERS[gameState.enemyKey].name} was ${statusNames[status]}!`, 'info');
                AudioSystem.playSound('select');
            }
            updateStatusDisplay();
        }

        function calculateDamage(move, attacker, defender, isPlayer) {
            const level = isPlayer ? gameState.playerLevel : gameState.enemyLevel;
            const attackBoost = isPlayer ? gameState.playerBoosts.attack : gameState.enemyBoosts.attack;
            const defenseBoost = isPlayer ? gameState.enemyBoosts.defense : gameState.playerBoosts.defense;
            
            const atkMultiplier = [0.25, 0.28, 0.33, 0.4, 0.5, 0.67, 1, 1.5, 2, 2.5, 3, 3.5, 4][attackBoost + 6];
            const defMultiplier = [0.25, 0.28, 0.33, 0.4, 0.5, 0.67, 1, 1.5, 2, 2.5, 3, 3.5, 4][defenseBoost + 6];
            
            const attack = attacker.attack * atkMultiplier;
            const defense = defender.defense * defMultiplier;
            
            let damage = Math.floor(((2 * level / 5 + 2) * move.power * attack / defense) / 50 + 2);
            
            if (move.type === attacker.type) {
                damage = Math.floor(damage * 1.5);
            }
            
            const effectiveness = getTypeEffectiveness(move.type, defender.type);
            damage = Math.floor(damage * effectiveness);
            
            const critChance = move.highCrit ? 0.25 : 0.0625;
            const isCritical = Math.random() < critChance;
            if (isCritical) {
                damage = Math.floor(damage * 1.5);
            }
            
            damage = Math.floor(damage * (0.85 + Math.random() * 0.15));
            
            const attackerStatus = isPlayer ? gameState.playerStatus : gameState.enemyStatus;
            if (attackerStatus === 'brn') {
                damage = Math.floor(damage * 0.5);
            }
            
            return { damage: Math.max(1, damage), isCritical, effectiveness };
        }
        
        function showDamageNumber(value, target, isCritical = false, isHeal = false) {
            const arena = document.getElementById('battle-arena');
            const num = document.createElement('div');
            num.className = 'damage-number' + (isCritical ? ' critical' : '') + (isHeal ? ' heal' : '') + (value === 'MISS' ? ' miss' : '');
            num.textContent = isHeal ? value : (value === 'MISS' ? 'MISS' : '-' + value);
            
            if (target === 'enemy') {
                num.style.right = '15%';
                num.style.top = '180px';
            } else {
                num.style.left = '15%';
                num.style.bottom = '200px';
            }
            
            arena.appendChild(num);
            setTimeout(() => num.remove(), 1200);
        }
        
        function showEffectivenessPopup(type) {
            const arena = document.getElementById('battle-arena');
            const popup = document.createElement('div');
            popup.className = 'effectiveness-popup ' + type;
            popup.textContent = type === 'super' ? "It's super effective!" : type === 'not-very' ? "Not very effective..." : "No effect!";
            arena.appendChild(popup);
            setTimeout(() => popup.remove(), 1500);
        }

        function updateHPBars() {
            const playerPercent = (gameState.playerHP / gameState.playerMaxHP) * 100;
            const enemyPercent = (gameState.enemyHP / gameState.enemyMaxHP) * 100;
            
            const playerBar = document.getElementById('player-hp-bar');
            const enemyBar = document.getElementById('enemy-hp-bar');
            
            playerBar.style.width = Math.max(0, playerPercent) + '%';
            enemyBar.style.width = Math.max(0, enemyPercent) + '%';
            
            playerBar.className = 'hp-bar-inner' + (playerPercent <= 20 ? ' low' : playerPercent <= 50 ? ' medium' : '');
            enemyBar.className = 'hp-bar-inner' + (enemyPercent <= 20 ? ' low' : enemyPercent <= 50 ? ' medium' : '');
            
            document.getElementById('player-hp').textContent = Math.max(0, gameState.playerHP);
        }

        function endBattle(won) {
            const result = document.getElementById('battle-result');
            const player = CHARACTERS[gameState.playerKey];
            const enemy = CHARACTERS[gameState.enemyKey];
            
            if (won) {
                const baseExp = Math.floor(enemy.hp * gameState.enemyLevel / 7);
                const expGain = Math.floor(baseExp * (gameState.enemyShiny ? 1.5 : 1));
                const pumpGain = Math.floor((200 + Math.random() * 300) * (gameState.enemyShiny ? 2 : 1));
                
                document.getElementById('result-title').textContent = 'VICTORY!';
                document.getElementById('result-subtitle').innerHTML = `
                    ${player.name} gained ${expGain} EXP!<br>
                    <span style="color: var(--primary)">+${pumpGain} $PUMP</span>
                    ${gameState.enemyShiny ? '<br><span style="color: #ec4899"> Shiny bonus!</span>' : ''}
                `;
                
                const enemySprite = document.getElementById('enemy-sprite');
                enemySprite.style.transition = 'all 0.5s';
                enemySprite.style.opacity = '0';
                enemySprite.style.transform = 'translateY(30px)';
                
                AudioSystem.playSound('victory');
            } else {
                document.getElementById('result-title').textContent = 'DEFEATED';
                document.getElementById('result-subtitle').textContent = 'Try again!';
                
                const playerSpriteBack = document.getElementById('player-sprite-back');
                playerSpriteBack.style.transition = 'all 0.5s';
                playerSpriteBack.style.opacity = '0';
                playerSpriteBack.style.transform = 'translateY(30px) rotate(10deg)';
                
                AudioSystem.playSound('defeat');
            }
            
            setTimeout(() => {
                result.style.display = 'block';
                result.classList.add('show');
            }, 600);
        }

        function resetBattle() {
            const result = document.getElementById('battle-result');
            result.style.display = 'none';
            result.classList.remove('show');
            initBattle();
        }

        function addLog(text, type = '') {
            const log = document.getElementById('battle-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + type;
            entry.textContent = '> ' + text;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function clearLog() {
            document.getElementById('battle-log').innerHTML = '';
        }

        function screenShake() {
            const arena = document.getElementById('battle-arena');
            arena.classList.add('shake');
            setTimeout(() => arena.classList.remove('shake'), 300);
        }

        function openModal() {
            renderCharacterGrid();
            const modal = document.getElementById('modal');
            modal.style.display = 'flex';
            modal.style.visibility = 'visible';
            modal.classList.add('show');
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            modal.style.display = 'none';
            modal.style.visibility = 'hidden';
            modal.classList.remove('show');
        }

        function confirmSelection() {
            gameState.playerKey = gameState.selectedChar;
            closeModal();
            initBattle();
            scrollToGame();
        }

        function scrollToGame() {
            document.getElementById('game').scrollIntoView({ behavior: 'smooth' });
        }


        // Shuffle character cards
function shuffleCards() {
    const preview = document.querySelector('.character-preview');
    const cards = Array.from(preview.children);
    
    // Add shuffling animation
    preview.classList.add('shuffling');
    
    // After animation, actually shuffle the cards
    setTimeout(() => {
        // Fisher-Yates shuffle
        for (let i = cards.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            preview.appendChild(cards[j]);
            [cards[i], cards[j]] = [cards[j], cards[i]];
        }
        
        preview.classList.remove('shuffling');
    }, 800);
}

// Auto shuffle every 5 seconds
setInterval(shuffleCards, 5000);

// Initial shuffle on page load
setTimeout(shuffleCards, 1500);

        /* ================================
           INITIALIZATION
           ================================ */
document.addEventListener('DOMContentLoaded', () => {
    WalletSystem.init();
    AudioSystem.init();
    init();
    
    // Try autoplay music
    const tryAutoplay = () => {
        if (AudioSystem.tracks && AudioSystem.tracks.main) {
            AudioSystem.tracks.main.volume = 0.3;
            const playAttempt = AudioSystem.tracks.main.play();
            
            if (playAttempt !== undefined) {
                playAttempt.then(() => {
                    // Autoplay worked
                    AudioSystem.isPlaying = true;
                    const musicBtn = document.querySelector('.music-btn');
                    if (musicBtn) {
                        musicBtn.classList.add('playing');
                        musicBtn.textContent = '';
                    }
                    console.log('Music autoplay started');
                }).catch(() => {
                    // Autoplay blocked - play on first interaction
                    console.log('Autoplay blocked, waiting for interaction');
                    
                    const startMusic = () => {
                        AudioSystem.tracks.main.play();
                        AudioSystem.isPlaying = true;
                        const musicBtn = document.querySelector('.music-btn');
                        if (musicBtn) {
                            musicBtn.classList.add('playing');
                            musicBtn.textContent = '';
                        }
                        document.removeEventListener('click', startMusic);
                        document.removeEventListener('scroll', startMusic);
                    };
                    
                    document.addEventListener('click', startMusic, { once: true });
                    document.addEventListener('scroll', startMusic, { once: true });
                });
            }
        }
    };
    
    tryAutoplay();
    
    // Switch music on scroll
    let lastSection = 'main';
    window.addEventListener('scroll', () => {
        const gameSection = document.getElementById('game');
        const rect = gameSection.getBoundingClientRect();
        const inGame = rect.top < window.innerHeight * 0.5 && rect.bottom > window.innerHeight * 0.5;
        
        if (inGame && lastSection !== 'battle') {
            lastSection = 'battle';
            AudioSystem.switchTrack('battle');
        } else if (!inGame && lastSection !== 'main') {
            lastSection = 'main';
            AudioSystem.switchTrack('main');
        }
    });
});

const RewardSystem = {
    // Reward rate: 1 win = 100 $PENG
    tokensPerWin: 100,
    
    // Track earnings
    state: {
        totalWins: 0,
        totalPointsEarned: 0,
        claimableTokens: 0,
        claimedTokens: 0
    },
    
    init() {
        // Load saved progress from localStorage
        const saved = localStorage.getItem('peng_rewards');
        if (saved) {
            this.state = JSON.parse(saved);
        }
        this.updateUI();
    },
    
    // Call this when player wins a battle
    onBattleWin(basePoints = 100) {
        if (!WalletSystem.connected) {
            console.log('Connect wallet to earn $PENG!');
            return;
        }
        
        this.state.totalWins++;
        this.state.totalPointsEarned += basePoints;
        this.state.claimableTokens += this.tokensPerWin;
        
        this.save();
        this.updateUI();
        this.showEarnedPopup(this.tokensPerWin);
        
        console.log(` Battle won! Earned ${this.tokensPerWin} $PENG`);
    },
    
    // Save to localStorage
    save() {
        localStorage.setItem('peng_rewards', JSON.stringify(this.state));
        localStorage.setItem('peng_wallet', WalletSystem.address);
    },
    
    // Update UI elements
    updateUI() {
        const claimableEl = document.getElementById('claimable-tokens');
        const totalWinsEl = document.getElementById('total-wins');
        const totalEarnedEl = document.getElementById('total-earned');
        
        if (claimableEl) claimableEl.textContent = this.state.claimableTokens.toLocaleString();
        if (totalWinsEl) totalWinsEl.textContent = this.state.totalWins;
        if (totalEarnedEl) totalEarnedEl.textContent = this.state.totalPointsEarned.toLocaleString();
    },
    
    // Show popup when tokens earned
    showEarnedPopup(amount) {
        const popup = document.createElement('div');
        popup.className = 'token-earned-popup';
        popup.innerHTML = `+${amount} $PENG! `;
        document.body.appendChild(popup);
        
        setTimeout(() => popup.remove(), 3000);
    },
    
    // Claim tokens (connects to backend)
    async claimTokens() {
        if (!WalletSystem.connected) {
            alert('Please connect your wallet first!');
            return;
        }
        
        if (this.state.claimableTokens <= 0) {
            alert('No tokens to claim!');
            return;
        }
        
        const amount = this.state.claimableTokens;
        const wallet = WalletSystem.address;
        
        // Show loading
        const claimBtn = document.getElementById('claim-btn');
        if (claimBtn) {
            claimBtn.disabled = true;
            claimBtn.textContent = 'Claiming...';
        }
        
        try {
            // TODO: Replace with your backend API
            const response = await fetch('https://your-backend.com/api/claim', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    wallet: wallet,
                    amount: amount,
                    wins: this.state.totalWins
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                this.state.claimedTokens += amount;
                this.state.claimableTokens = 0;
                this.save();
                this.updateUI();
                alert(`Successfully claimed ${amount} $PENG! `);
            } else {
                alert('Claim failed: ' + result.error);
            }
        } catch (error) {
            // For now, simulate success (remove this in production)
            console.log('Backend not connected. Simulating claim...');
            alert(`Demo mode: ${amount} $PENG would be sent to your wallet!`);
            
            // Uncomment below for demo/testing
            // this.state.claimedTokens += amount;
            // this.state.claimableTokens = 0;
            // this.save();
            // this.updateUI();
        }
        
        if (claimBtn) {
            claimBtn.disabled = false;
            claimBtn.textContent = 'Claim $PENG';
        }
    },
    
    // Reset (for testing)
    reset() {
        this.state = {
            totalWins: 0,
            totalPointsEarned: 0,
            claimableTokens: 0,
            claimedTokens: 0
        };
        this.save();
        this.updateUI();
    }
};

    </script>
</body>
</html>