<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$PALS</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Add these CDN scripts to your HTML head -->
     <link rel="stylesheet" href="pay-modal.css"> 
<script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
<script src="https://unpkg.com/@solana/spl-token@0.3.8/lib/index.iife.min.js"></script>
<!-- Solana Web3 -->
<script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>

<!-- SPL Token - Use this CDN -->
<script src="https://unpkg.com/@solana/spl-token@0.3.7/lib/index.iife.js"></script>

<!-- Solana Pay -->
<script src="https://unpkg.com/@solana/pay@latest/dist/index.iife.js"></script>
<script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
<!-- BigNumber (required for Solana Pay) -->
<script src="https://unpkg.com/bignumber.js@latest/bignumber.min.js"></script>
<script src="https://unpkg.com/@solana/spl-token@0.3.8/lib/index.iife.min.js"></script>
<style>
/* ================================
   CSS VARIABLES & RESET
   ================================ */
* { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
}

:root {
    --primary: #ffd93d;
    --bg: #0a0a0f;
    --bg-card: #12121a;
    --text: #ffffff;
    --text-muted: #888;
    --border: #2a2a3a;
    --green: #22c55e;
    --red: #ef4444;
    --blue: #3b82f6;
}

body {
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    overflow-x: hidden;
}

/* ================================
   ANIMATED BACKGROUND
   ================================ */
.bg-animation {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    overflow: hidden;
    
    /* YOUR BACKGROUND IMAGE - Replace path with your image */
    background-image: 
        linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
        url('assets/images/site-bg.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
}

/* Retro Scanlines */
.scanlines {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.15) 0px,
        rgba(0, 0, 0, 0.15) 1px,
        transparent 1px,
        transparent 2px
    );
    pointer-events: none;
    z-index: 100;
    opacity: 0.5;
}

/* CRT Glow Effect */
.crt-glow {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    box-shadow: inset 0 0 150px rgba(255, 217, 61, 0.03);
    pointer-events: none;
}

/* Pixel Stars */
.pixel-stars {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.star {
    position: absolute;
    background: #fff;
    animation: twinkle 2s ease-in-out infinite;
    image-rendering: pixelated;
}

.star.small { width: 2px; height: 2px; }
.star.medium { width: 3px; height: 3px; box-shadow: 0 0 8px #fff, 0 0 12px rgba(255,255,255,0.5); }
.star.large { width: 4px; height: 4px; box-shadow: 0 0 12px #ffd93d, 0 0 24px #ffd93d, 0 0 36px rgba(255,217,61,0.3); }

.star:nth-child(1) { left: 5%; top: 10%; animation-delay: 0s; }
.star:nth-child(2) { left: 15%; top: 25%; animation-delay: 0.3s; }
.star:nth-child(3) { left: 25%; top: 8%; animation-delay: 0.6s; }
.star:nth-child(4) { left: 35%; top: 30%; animation-delay: 0.9s; }
.star:nth-child(5) { left: 45%; top: 15%; animation-delay: 1.2s; }
.star:nth-child(6) { left: 55%; top: 5%; animation-delay: 0.2s; }
.star:nth-child(7) { left: 65%; top: 20%; animation-delay: 0.5s; }
.star:nth-child(8) { left: 75%; top: 12%; animation-delay: 0.8s; }
.star:nth-child(9) { left: 85%; top: 28%; animation-delay: 1.1s; }
.star:nth-child(10) { left: 95%; top: 8%; animation-delay: 1.4s; }
.star:nth-child(11) { left: 10%; top: 45%; animation-delay: 0.4s; }
.star:nth-child(12) { left: 30%; top: 55%; animation-delay: 0.7s; }
.star:nth-child(13) { left: 50%; top: 40%; animation-delay: 1s; }
.star:nth-child(14) { left: 70%; top: 50%; animation-delay: 1.3s; }
.star:nth-child(15) { left: 90%; top: 45%; animation-delay: 0.1s; }
.star:nth-child(16) { left: 20%; top: 70%; animation-delay: 0.6s; }
.star:nth-child(17) { left: 40%; top: 75%; animation-delay: 0.9s; }
.star:nth-child(18) { left: 60%; top: 65%; animation-delay: 1.2s; }
.star:nth-child(19) { left: 80%; top: 72%; animation-delay: 0.3s; }
.star:nth-child(20) { left: 8%; top: 85%; animation-delay: 0.8s; }

@keyframes twinkle {
    0%, 100% { opacity: 0.2; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.8); }
}

/* Pokemon Type Energy Orbs */
.orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.5;
    animation: orbFloat 20s ease-in-out infinite;
}

.orb-1 {
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, 
        rgba(255, 95, 95, 0.8) 0%, 
        rgba(255, 60, 0, 0.5) 30%,
        rgba(255, 165, 0, 0.3) 50%,
        transparent 70%
    );
    top: -200px;
    left: -200px;
    animation-delay: 0s;
}

.orb-2 {
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, 
        rgba(59, 130, 246, 0.8) 0%, 
        rgba(37, 99, 235, 0.5) 30%,
        rgba(96, 165, 250, 0.3) 50%,
        transparent 70%
    );
    top: 35%;
    right: -150px;
    animation-delay: -5s;
}

.orb-3 {
    width: 550px;
    height: 550px;
    background: radial-gradient(circle, 
        rgba(255, 217, 61, 0.9) 0%, 
        rgba(250, 204, 21, 0.5) 30%,
        rgba(253, 224, 71, 0.3) 50%,
        transparent 70%
    );
    bottom: -200px;
    left: 15%;
    animation-delay: -10s;
}

.orb-4 {
    width: 450px;
    height: 450px;
    background: radial-gradient(circle, 
        rgba(168, 85, 247, 0.8) 0%, 
        rgba(139, 92, 246, 0.5) 30%,
        rgba(192, 132, 252, 0.3) 50%,
        transparent 70%
    );
    top: 55%;
    left: 55%;
    animation-delay: -15s;
}

.orb-5 {
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, 
        rgba(34, 197, 94, 0.7) 0%, 
        rgba(22, 163, 74, 0.4) 30%,
        rgba(74, 222, 128, 0.2) 50%,
        transparent 70%
    );
    top: 20%;
    left: 40%;
    animation-delay: -8s;
    animation-duration: 25s;
}

@keyframes orbFloat {
    0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.4; }
    25% { transform: translate(40px, -50px) scale(1.15); opacity: 0.6; }
    50% { transform: translate(-30px, 30px) scale(0.9); opacity: 0.35; }
    75% { transform: translate(35px, 25px) scale(1.1); opacity: 0.55; }
}

/* Pixel Grid Pattern */
.grid-pattern {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        linear-gradient(rgba(255,217,61,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,217,61,0.03) 1px, transparent 1px);
    background-size: 32px 32px;
    opacity: 0.6;
}

/* Floating Pokeballs */
.pokeball-particles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.pokeball {
    position: absolute;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: linear-gradient(180deg, 
        #ff5f5f 0%, #ff5f5f 45%, 
        #2a2a3e 45%, #2a2a3e 55%, 
        #fff 55%, #fff 100%
    );
    opacity: 0.12;
    animation: floatPokeball 25s linear infinite;
    box-shadow: 0 0 10px rgba(255, 95, 95, 0.3);
}

.pokeball::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    background: #fff;
    border-radius: 50%;
    border: 2px solid #2a2a3e;
    box-shadow: 0 0 4px rgba(255,255,255,0.5);
}

.pokeball:nth-child(1) { left: 5%; animation-delay: 0s; animation-duration: 28s; }
.pokeball:nth-child(2) { left: 15%; animation-delay: -4s; animation-duration: 24s; width: 18px; height: 18px; }
.pokeball:nth-child(3) { left: 25%; animation-delay: -8s; animation-duration: 30s; width: 28px; height: 28px; }
.pokeball:nth-child(4) { left: 35%; animation-delay: -2s; animation-duration: 22s; }
.pokeball:nth-child(5) { left: 45%; animation-delay: -12s; animation-duration: 26s; width: 20px; height: 20px; }
.pokeball:nth-child(6) { left: 55%; animation-delay: -6s; animation-duration: 28s; width: 26px; height: 26px; }
.pokeball:nth-child(7) { left: 65%; animation-delay: -14s; animation-duration: 25s; }
.pokeball:nth-child(8) { left: 75%; animation-delay: -1s; animation-duration: 30s; width: 18px; height: 18px; }
.pokeball:nth-child(9) { left: 85%; animation-delay: -10s; animation-duration: 23s; width: 28px; height: 28px; }
.pokeball:nth-child(10) { left: 92%; animation-delay: -7s; animation-duration: 27s; }

@keyframes floatPokeball {
    0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
    3% { opacity: 0.12; }
    97% { opacity: 0.12; }
    100% { transform: translateY(-10vh) rotate(1080deg); opacity: 0; }
}

/* Battle Energy Sparkles */
.sparkles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.sparkle {
    position: absolute;
    width: 12px;
    height: 12px;
    background: transparent;
    animation: sparkleAnim 2.5s ease-in-out infinite;
}

.sparkle::before,
.sparkle::after {
    content: '';
    position: absolute;
    background: linear-gradient(90deg, transparent, #ffd93d, transparent);
    border-radius: 2px;
}

.sparkle::before {
    width: 100%;
    height: 3px;
    top: 50%;
    left: 0;
    transform: translateY(-50%);
}

.sparkle::after {
    width: 3px;
    height: 100%;
    left: 50%;
    top: 0;
    transform: translateX(-50%);
    background: linear-gradient(180deg, transparent, #ffd93d, transparent);
}

.sparkle:nth-child(1) { left: 8%; top: 15%; animation-delay: 0s; }
.sparkle:nth-child(2) { left: 22%; top: 35%; animation-delay: 0.4s; }
.sparkle:nth-child(3) { left: 38%; top: 18%; animation-delay: 0.8s; }
.sparkle:nth-child(4) { left: 52%; top: 42%; animation-delay: 1.2s; }
.sparkle:nth-child(5) { left: 68%; top: 22%; animation-delay: 1.6s; }
.sparkle:nth-child(6) { left: 82%; top: 38%; animation-delay: 2s; }
.sparkle:nth-child(7) { left: 12%; top: 58%; animation-delay: 0.2s; }
.sparkle:nth-child(8) { left: 42%; top: 68%; animation-delay: 0.6s; }
.sparkle:nth-child(9) { left: 72%; top: 62%; animation-delay: 1s; }
.sparkle:nth-child(10) { left: 88%; top: 52%; animation-delay: 1.4s; }
.sparkle:nth-child(11) { left: 18%; top: 82%; animation-delay: 1.8s; }
.sparkle:nth-child(12) { left: 58%; top: 78%; animation-delay: 0.3s; }

@keyframes sparkleAnim {
    0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
    50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
}

/* Type Symbols */
.type-symbols {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.type-symbol {
    position: absolute;
    font-size: 20px;
    opacity: 0.08;
    animation: floatSymbol 30s linear infinite;
    filter: blur(1px);
}

.type-symbol:nth-child(1) { left: 8%; animation-delay: 0s; }
.type-symbol:nth-child(2) { left: 18%; animation-delay: -5s; }
.type-symbol:nth-child(3) { left: 28%; animation-delay: -10s; }
.type-symbol:nth-child(4) { left: 38%; animation-delay: -15s; }
.type-symbol:nth-child(5) { left: 48%; animation-delay: -20s; }
.type-symbol:nth-child(6) { left: 58%; animation-delay: -3s; }
.type-symbol:nth-child(7) { left: 68%; animation-delay: -8s; }
.type-symbol:nth-child(8) { left: 78%; animation-delay: -13s; }
.type-symbol:nth-child(9) { left: 88%; animation-delay: -18s; }
.type-symbol:nth-child(10) { left: 95%; animation-delay: -23s; }

@keyframes floatSymbol {
    0% { transform: translateY(110vh) rotate(0deg) scale(1); opacity: 0; }
    5% { opacity: 0.08; }
    50% { transform: translateY(50vh) rotate(180deg) scale(1.2); }
    95% { opacity: 0.08; }
    100% { transform: translateY(-10vh) rotate(360deg) scale(1); opacity: 0; }
}

/* Energy Wave */
.energy-wave {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 200%;
    height: 200px;
    background: linear-gradient(180deg, 
        transparent 0%,
        rgba(153, 69, 255, 0.08) 30%,
        rgba(20, 241, 149, 0.1) 60%,
        rgba(255, 217, 61, 0.08) 100%
    );
    animation: waveMove 12s linear infinite;
}

@keyframes waveMove {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
}

/* Battle Border */
.battle-border {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    box-shadow: 
        inset 0 0 100px rgba(255, 217, 61, 0.03),
        inset 0 0 200px rgba(139, 92, 246, 0.02);
    animation: borderPulse 4s ease-in-out infinite;
}

@keyframes borderPulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

/* Floating Character Pills */
.floating-pills {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    pointer-events: none;
    z-index: 2;
}

.floating-pill {
    position: absolute;
    width: 55px;
    height: 55px;
    opacity: 0.2;
    animation: floatPillUp 20s linear infinite;
    filter: drop-shadow(0 0 15px rgba(255, 217, 61, 0.6)) drop-shadow(0 0 30px rgba(139, 92, 246, 0.3));
}

.floating-pill img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 50%;
}

.floating-pill:nth-child(1) { left: 5%; bottom: -60px; animation-delay: 0s; animation-duration: 25s; }
.floating-pill:nth-child(2) { left: 15%; bottom: -60px; animation-delay: 3s; animation-duration: 22s; width: 35px; height: 35px; }
.floating-pill:nth-child(3) { left: 25%; bottom: -60px; animation-delay: 6s; animation-duration: 28s; width: 55px; height: 55px; }
.floating-pill:nth-child(4) { left: 35%; bottom: -60px; animation-delay: 2s; animation-duration: 24s; }
.floating-pill:nth-child(5) { left: 45%; bottom: -60px; animation-delay: 8s; animation-duration: 26s; width: 40px; height: 40px; }
.floating-pill:nth-child(6) { left: 55%; bottom: -60px; animation-delay: 4s; animation-duration: 21s; width: 50px; height: 50px; }
.floating-pill:nth-child(7) { left: 65%; bottom: -60px; animation-delay: 10s; animation-duration: 27s; }
.floating-pill:nth-child(8) { left: 75%; bottom: -60px; animation-delay: 1s; animation-duration: 20s; width: 35px; height: 35px; }
.floating-pill:nth-child(9) { left: 85%; bottom: -60px; animation-delay: 7s; animation-duration: 24s; width: 55px; height: 55px; }

@keyframes floatPillUp {
    0% { transform: translateY(0) rotate(0deg) scale(0.8); opacity: 0; }
    5% { opacity: 0.25; }
    50% { transform: translateY(-55vh) rotate(180deg) scale(1); }
    95% { opacity: 0.25; }
    100% { transform: translateY(-110vh) rotate(360deg) scale(0.8); opacity: 0; }
}

/* ================================
   NAVIGATION
   ================================ */
nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    padding: 16px 24px;
    background: rgba(10, 10, 15, 0.8);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 1000;
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 1001;
}

.logo-img {
    width: 60px;
    height: 60px;
    object-fit: contain;
}

.logo-text {
    font-family: 'Press Start 2P', cursive;
    font-size: 1rem;
    color: var(--primary);
}

/* Hamburger Menu */
.hamburger {
    display: none;
    flex-direction: column;
    justify-content: center;
    gap: 5px;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 10px;
    z-index: 1001;
}

.hamburger-line {
    width: 28px;
    height: 3px;
    background: var(--text);
    border-radius: 3px;
    transition: all 0.3s ease;
}

.hamburger.active .hamburger-line:nth-child(1) {
    transform: rotate(45deg) translate(6px, 6px);
}

.hamburger.active .hamburger-line:nth-child(2) {
    opacity: 0;
}

.hamburger.active .hamburger-line:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
}

.nav-links {
    display: flex;
    gap: 24px;
    align-items: center;
}

.nav-links a {
    color: var(--text-muted);
    text-decoration: none;
    font-size: 0.9rem;
    transition: color 0.2s;
}

.nav-links a:hover { 
    color: var(--text); 
}

.music-btn {
    background: var(--bg-card);
    border: 1px solid var(--border);
    color: var(--text);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.1rem;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.music-btn:hover {
    border-color: var(--primary);
    transform: scale(1.1);
}

.music-btn.playing {
    background: var(--primary);
    color: #000;
    animation: musicPulse 2s ease-in-out infinite;
}

@keyframes musicPulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(255, 217, 61, 0.4); }
    50% { box-shadow: 0 0 0 10px rgba(255, 217, 61, 0); }
}

/* ================================
   BUTTONS
   ================================ */
.btn {
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
    font-size: 0.9rem;
}

.btn-primary {
    background: var(--primary);
    color: #000;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(255, 217, 61, 0.3);
}

.btn-secondary {
    background: var(--bg-card);
    color: var(--text);
    border: 1px solid var(--border);
}

.btn-secondary:hover {
    border-color: var(--primary);
}

.btn-wallet {
    background: linear-gradient(135deg, #9945FF 0%, #14F195 100%);
    color: #fff;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    padding: 10px 16px;
}

.btn-wallet .solana-logo {
    flex-shrink: 0;
}

.btn-wallet:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(153, 69, 255, 0.4);
}

.btn-wallet.connected {
    background: linear-gradient(135deg, #14F195 0%, #9945FF 100%);
}

.btn-large {
    padding: 18px 48px;
    font-size: 1rem;
}

/* ================================
   HERO SECTION
   ================================ */
.hero {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 100px 24px 30px;
    position: relative;
    z-index: 1;
    overflow: hidden;
}

.hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url('assets/images/hero-bg.png');
    background-size: cover;
    background-position: center 70%;
    background-repeat: no-repeat;
    opacity: 0.60;
    z-index: -2;
}

.hero::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
        180deg,
        rgba(10, 10, 26, 0.85) 0%,
        rgba(10, 10, 26, 0.6) 50%,
        rgba(10, 10, 26, 0.9) 100%
    );
    z-index: -1;
}

.hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(18, 18, 30, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border);
    border-radius: 50px;
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-bottom: 24px;
}

.hero-badge .solana-logo-small {
    flex-shrink: 0;
}

.hero-badge .live { 
    color: var(--green); 
}

.hero-title {
    font-family: 'Press Start 2P', cursive;
    font-size: clamp(1.8rem, 5vw, 3rem);
    margin-bottom: 16px;
    line-height: 1.3;
    text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

.hero-title .highlight { 
    color: var(--primary); 
    text-shadow: 0 0 30px rgba(255, 217, 61, 0.5); 
}

.hero-subtitle {
    font-size: 1.1rem;
    color: var(--text-muted);
    max-width: 500px;
    margin-bottom: 40px;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
}

/* Character Preview - Old Style (kept for compatibility) */
.character-preview {
    display: flex;
    gap: 20px;
    margin-bottom: 40px;
    flex-wrap: wrap;
    justify-content: center;
}

.character-preview .char-avatar {
    width: 130px;
    border-radius: 0px;
    background: transparent;
    border: none;
    overflow: visible;
    transition: all 0.3s;
    cursor: pointer;
    text-align: center;
    padding: 0;
}

.character-preview .char-avatar .char-name {
    display: none;
    font-family: 'Press Start 2P', cursive;
    font-size: 0.55rem;
    color: var(--primary);
    margin: 8px 0 4px;
    text-shadow: 0 0 10px rgba(255, 217, 61, 0.3);
}

.character-preview .char-avatar:hover {
    transform: scale(1.1) translateY(-10px);
    filter: drop-shadow(0 10px 30px rgba(255, 217, 61, 0.5));
}

.character-preview .char-avatar img {
    width: 100%;
    height: 200px;
    object-fit: contain;
    padding: 0;
    border-radius: 8px;
    transition: all 0.3s;
}

.char-avatar .char-type {
    display: none;
    font-size: 0.6rem;
    color: var(--text-muted);
    text-transform: uppercase;
}

.char-avatar .char-type.water { color: #3b82f6; }
.char-avatar .char-type.electric { color: #fbbf24; }
.char-avatar .char-type.normal { color: #a3a3a3; }
.char-avatar .char-type.dark { color: #8b5cf6; }
.char-avatar .char-type.psychic { color: #ec4899; }

.cta-buttons {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    justify-content: center;
}

/* Contract Address */
.ca-container {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 24px;
    padding: 12px 20px;
    background: rgba(18, 18, 30, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border);
    border-radius: 50px;
    font-family: monospace;
    font-size: 0.8rem;
}

.ca-label {
    color: var(--primary);
    font-weight: 700;
}

.ca-address {
    color: var(--text-muted);
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.ca-copy {
    background: transparent;
    border: none;
    cursor: pointer;
    font-size: 1rem;
    transition: transform 0.2s;
}

.ca-copy:hover {
    transform: scale(1.2);
}

/* ================================
   CHARACTER SELECT SECTION
   ================================ */
.character-select-section {
    display: none;
    flex-direction: column;
    align-items: center;
    padding: 40px 20px;
    background: rgba(18, 18, 30, 0.95);
    border: 2px solid var(--primary);
    border-radius: 20px;
    margin-bottom: 24px;
    box-shadow: 0 0 40px rgba(255, 217, 61, 0.2);
}

.character-select-section.show {
    display: flex;
}

.select-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.2rem;
    color: var(--primary);
    margin-bottom: 8px;
    text-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
}

.select-subtitle {
    color: var(--text-muted);
    font-size: 0.9rem;
    margin-bottom: 30px;
}

/* Card Fan for Selection */
.select-card-fan {
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    height: 280px;
    width: 100%;
    max-width: 900px;
    margin-bottom: 30px;
}

.select-card {
    position: absolute;
    width: 120px;
    height: 170px;
    cursor: pointer;
    transition: all 0.4s ease;
    transform-origin: bottom center;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
    border: 3px solid transparent;
}

.select-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 10px;
    pointer-events: none;
}

.select-card .card-name {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.9);
    color: #fff;
    font-family: 'Press Start 2P', cursive;
    font-size: 0.45rem;
    padding: 6px 4px;
    text-align: center;
    opacity: 0;
    transition: opacity 0.3s;
}

/* Fan Positions - 9 cards */
.select-card:nth-child(1) { transform: rotate(-24deg) translateX(-200px); z-index: 1; }
.select-card:nth-child(2) { transform: rotate(-18deg) translateX(-150px); z-index: 2; }
.select-card:nth-child(3) { transform: rotate(-12deg) translateX(-100px); z-index: 3; }
.select-card:nth-child(4) { transform: rotate(-6deg) translateX(-50px); z-index: 4; }
.select-card:nth-child(5) { transform: rotate(0deg) translateX(0px); z-index: 5; }
.select-card:nth-child(6) { transform: rotate(6deg) translateX(50px); z-index: 6; }
.select-card:nth-child(7) { transform: rotate(12deg) translateX(100px); z-index: 7; }
.select-card:nth-child(8) { transform: rotate(18deg) translateX(150px); z-index: 8; }
.select-card:nth-child(9) { transform: rotate(24deg) translateX(200px); z-index: 9; }

/* Hover - lift card */
.select-card:hover {
    transform: translateY(-40px) scale(1.15) rotate(0deg) !important;
    z-index: 100 !important;
    box-shadow: 0 20px 50px rgba(255, 217, 61, 0.4);
    border-color: var(--primary);
}

.select-card:hover .card-name {
    opacity: 1;
}

/* Selected Card */
.select-card.selected {
    transform: translateY(-50px) scale(1.2) rotate(0deg) !important;
    z-index: 200 !important;
    border-color: var(--primary) !important;
    box-shadow: 0 25px 60px rgba(255, 217, 61, 0.6) !important;
}

.select-card.selected::after {
    content: 'âœ“';
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--primary);
    color: #000;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 0.8rem;
}

.select-card.selected .card-name {
    opacity: 1;
    background: var(--primary);
    color: #000;
}

/* Confirm Button */
.btn-confirm-select {
    padding: 16px 40px;
    font-size: 0.9rem;
    font-family: 'Press Start 2P', cursive;
}

.btn-confirm-select:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* ================================
   RESPONSIVE - Character Select
   ================================ */
@media (max-width: 768px) {
    .select-card-fan {
        height: 200px;
    }
    
    .select-card {
        width: 80px;
        height: 115px;
    }
    
    .select-card:nth-child(1) { transform: rotate(-20deg) translateX(-130px); }
    .select-card:nth-child(2) { transform: rotate(-15deg) translateX(-97px); }
    .select-card:nth-child(3) { transform: rotate(-10deg) translateX(-65px); }
    .select-card:nth-child(4) { transform: rotate(-5deg) translateX(-32px); }
    .select-card:nth-child(5) { transform: rotate(0deg) translateX(0px); }
    .select-card:nth-child(6) { transform: rotate(5deg) translateX(32px); }
    .select-card:nth-child(7) { transform: rotate(10deg) translateX(65px); }
    .select-card:nth-child(8) { transform: rotate(15deg) translateX(97px); }
    .select-card:nth-child(9) { transform: rotate(20deg) translateX(130px); }
    
    .select-card .card-name {
        font-size: 0.35rem;
        padding: 4px 2px;
    }
    
    .select-title {
        font-size: 0.9rem;
    }
}

@media (max-width: 480px) {
    .select-card-fan {
        height: 160px;
    }
    
    .select-card {
        width: 60px;
        height: 85px;
    }
    
    .select-card:nth-child(1) { transform: rotate(-20deg) translateX(-95px); }
    .select-card:nth-child(2) { transform: rotate(-15deg) translateX(-72px); }
    .select-card:nth-child(3) { transform: rotate(-10deg) translateX(-48px); }
    .select-card:nth-child(4) { transform: rotate(-5deg) translateX(-24px); }
    .select-card:nth-child(5) { transform: rotate(0deg) translateX(0px); }
    .select-card:nth-child(6) { transform: rotate(5deg) translateX(24px); }
    .select-card:nth-child(7) { transform: rotate(10deg) translateX(48px); }
    .select-card:nth-child(8) { transform: rotate(15deg) translateX(72px); }
    .select-card:nth-child(9) { transform: rotate(20deg) translateX(95px); }
    
    .select-title {
        font-size: 0.75rem;
    }
    
    .select-subtitle {
        font-size: 0.75rem;
    }
    
    .btn-confirm-select {
        padding: 12px 24px;
        font-size: 0.7rem;
    }
}
/* ================================
   FANNED CARD LAYOUT
   ================================ */
.card-fan {
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    height: 320px;
    margin: -60px auto 60px;
    perspective: 1000px;
    z-index: 10;
}

.card-fan .char-avatar {
    position: absolute;
    width: 140px;
    height: 200px;
    transition: all 0.4s ease;
    cursor: pointer;
    transform-origin: bottom center;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    background: transparent;
    border: none;
    padding: 0;
    pointer-events: auto;
}

.card-fan .char-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 12px;
    pointer-events: none;
}

/* Fanned positions - stacked by default */
.card-fan .char-avatar:nth-child(1) { transform: rotate(-24deg) translateX(-220px); z-index: 1; }
.card-fan .char-avatar:nth-child(2) { transform: rotate(-18deg) translateX(-165px); z-index: 2; }
.card-fan .char-avatar:nth-child(3) { transform: rotate(-12deg) translateX(-110px); z-index: 3; }
.card-fan .char-avatar:nth-child(4) { transform: rotate(-6deg) translateX(-55px); z-index: 4; }
.card-fan .char-avatar:nth-child(5) { transform: rotate(0deg) translateX(0px); z-index: 5; }
.card-fan .char-avatar:nth-child(6) { transform: rotate(6deg) translateX(55px); z-index: 6; }
.card-fan .char-avatar:nth-child(7) { transform: rotate(12deg) translateX(110px); z-index: 7; }
.card-fan .char-avatar:nth-child(8) { transform: rotate(18deg) translateX(165px); z-index: 8; }
.card-fan .char-avatar:nth-child(9) { transform: rotate(24deg) translateX(220px); z-index: 9; }

/* Hover on container - spread cards */
.card-fan:hover .char-avatar:nth-child(1) { transform: rotate(-28deg) translateX(-280px) translateY(-10px); }
.card-fan:hover .char-avatar:nth-child(2) { transform: rotate(-21deg) translateX(-210px) translateY(-10px); }
.card-fan:hover .char-avatar:nth-child(3) { transform: rotate(-14deg) translateX(-140px) translateY(-10px); }
.card-fan:hover .char-avatar:nth-child(4) { transform: rotate(-7deg) translateX(-70px) translateY(-10px); }
.card-fan:hover .char-avatar:nth-child(5) { transform: rotate(0deg) translateX(0px) translateY(-10px); }
.card-fan:hover .char-avatar:nth-child(6) { transform: rotate(7deg) translateX(70px) translateY(-10px); }
.card-fan:hover .char-avatar:nth-child(7) { transform: rotate(14deg) translateX(140px) translateY(-10px); }
.card-fan:hover .char-avatar:nth-child(8) { transform: rotate(21deg) translateX(210px) translateY(-10px); }
.card-fan:hover .char-avatar:nth-child(9) { transform: rotate(28deg) translateX(280px) translateY(-10px); }

/* Individual card hover - lift up */
.card-fan .char-avatar:hover {
    transform: translateY(-50px) scale(1.2) rotate(0deg) !important;
    z-index: 100 !important;
    box-shadow: 0 25px 60px rgba(255, 217, 61, 0.5);
}

/* Visual feedback on click */
.card-fan .char-avatar:active {
    transform: translateY(-30px) scale(1.1) rotate(0deg) !important;
    box-shadow: 0 30px 70px rgba(255, 217, 61, 0.7) !important;
}

/* Card name tooltip */
.card-fan .char-avatar::after {
    content: attr(data-name);
    position: absolute;
    bottom: -35px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.95);
    color: var(--primary);
    padding: 8px 14px;
    border-radius: 8px;
    font-family: 'Press Start 2P', cursive;
    font-size: 0.55rem;
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
    border: 1px solid var(--primary);
}

.card-fan .char-avatar:hover::after {
    opacity: 1;
}

/* Glow border on hover */
.card-fan .char-avatar::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 12px;
    border: 3px solid transparent;
    transition: all 0.3s;
    pointer-events: none;
    z-index: 10;
}

.card-fan .char-avatar:hover::before {
    border-color: var(--primary);
    box-shadow: 0 0 25px rgba(255, 217, 61, 0.6);
}

/* Selected card highlight */
.card-fan .char-avatar.selected {
    transform: translateY(-60px) scale(1.25) rotate(0deg) !important;
    z-index: 200 !important;
    box-shadow: 0 30px 80px rgba(255, 217, 61, 0.8) !important;
}

.card-fan .char-avatar.selected::before {
    border-color: var(--primary) !important;
    box-shadow: 0 0 40px rgba(255, 217, 61, 0.8) !important;
}

/* ================================
   AUTO SHUFFLE ANIMATION
   ================================ */
.card-fan .char-avatar {
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Wave shuffle effect */
@keyframes cardWaveShuffle {
    0% { transform: var(--original-transform); }
    20% { transform: translateY(-100px) translateX(0) rotate(0deg) scale(0.8); }
    40% { transform: translateY(-50px) translateX(20px) rotate(180deg) scale(0.9); }
    60% { transform: translateY(-80px) translateX(-20px) rotate(270deg) scale(0.85); }
    80% { transform: translateY(-30px) translateX(0) rotate(350deg) scale(0.95); }
    100% { transform: var(--original-transform); }
}

.card-fan.wave-shuffle .char-avatar {
    animation: cardWaveShuffle 1.5s ease-in-out forwards;
}

.card-fan.wave-shuffle .char-avatar:nth-child(1) { animation-delay: 0s; }
.card-fan.wave-shuffle .char-avatar:nth-child(2) { animation-delay: 0.1s; }
.card-fan.wave-shuffle .char-avatar:nth-child(3) { animation-delay: 0.2s; }
.card-fan.wave-shuffle .char-avatar:nth-child(4) { animation-delay: 0.3s; }
.card-fan.wave-shuffle .char-avatar:nth-child(5) { animation-delay: 0.4s; }
.card-fan.wave-shuffle .char-avatar:nth-child(6) { animation-delay: 0.5s; }
.card-fan.wave-shuffle .char-avatar:nth-child(7) { animation-delay: 0.6s; }
.card-fan.wave-shuffle .char-avatar:nth-child(8) { animation-delay: 0.7s; }
.card-fan.wave-shuffle .char-avatar:nth-child(9) { animation-delay: 0.8s; }

/* Flip shuffle effect */
@keyframes cardFlipShuffle {
    0% { transform: var(--original-transform) rotateY(0deg); }
    50% { transform: translateY(-60px) rotateY(180deg) scale(0.9); }
    100% { transform: var(--original-transform) rotateY(360deg); }
}

.card-fan.flip-shuffle .char-avatar {
    animation: cardFlipShuffle 1s ease-in-out forwards;
}

.card-fan.flip-shuffle .char-avatar:nth-child(1) { animation-delay: 0.4s; }
.card-fan.flip-shuffle .char-avatar:nth-child(2) { animation-delay: 0.35s; }
.card-fan.flip-shuffle .char-avatar:nth-child(3) { animation-delay: 0.3s; }
.card-fan.flip-shuffle .char-avatar:nth-child(4) { animation-delay: 0.25s; }
.card-fan.flip-shuffle .char-avatar:nth-child(5) { animation-delay: 0.2s; }
.card-fan.flip-shuffle .char-avatar:nth-child(6) { animation-delay: 0.25s; }
.card-fan.flip-shuffle .char-avatar:nth-child(7) { animation-delay: 0.3s; }
.card-fan.flip-shuffle .char-avatar:nth-child(8) { animation-delay: 0.35s; }
.card-fan.flip-shuffle .char-avatar:nth-child(9) { animation-delay: 0.4s; }

/* Scatter shuffle effect */
@keyframes cardScatterShuffle {
    0% { transform: var(--original-transform); opacity: 1; }
    30% { transform: translate(var(--scatter-x), var(--scatter-y)) rotate(var(--scatter-rot)) scale(0.7); opacity: 0.6; }
    60% { transform: translateY(-50px) rotate(180deg) scale(0.8); opacity: 0.8; }
    100% { transform: var(--original-transform); opacity: 1; }
}

.card-fan.scatter-shuffle .char-avatar {
    animation: cardScatterShuffle 1.3s ease-in-out forwards;
}

.card-fan.scatter-shuffle .char-avatar:nth-child(1) { --scatter-x: -150px; --scatter-y: -80px; --scatter-rot: -45deg; animation-delay: 0s; }
.card-fan.scatter-shuffle .char-avatar:nth-child(2) { --scatter-x: -100px; --scatter-y: -120px; --scatter-rot: 30deg; animation-delay: 0.05s; }
.card-fan.scatter-shuffle .char-avatar:nth-child(3) { --scatter-x: -50px; --scatter-y: -100px; --scatter-rot: -60deg; animation-delay: 0.1s; }
.card-fan.scatter-shuffle .char-avatar:nth-child(4) { --scatter-x: 20px; --scatter-y: -130px; --scatter-rot: 45deg; animation-delay: 0.15s; }
.card-fan.scatter-shuffle .char-avatar:nth-child(5) { --scatter-x: 0px; --scatter-y: -150px; --scatter-rot: 0deg; animation-delay: 0.2s; }
.card-fan.scatter-shuffle .char-avatar:nth-child(6) { --scatter-x: -20px; --scatter-y: -130px; --scatter-rot: -45deg; animation-delay: 0.15s; }
.card-fan.scatter-shuffle .char-avatar:nth-child(7) { --scatter-x: 50px; --scatter-y: -100px; --scatter-rot: 60deg; animation-delay: 0.1s; }
.card-fan.scatter-shuffle .char-avatar:nth-child(8) { --scatter-x: 100px; --scatter-y: -120px; --scatter-rot: -30deg; animation-delay: 0.05s; }
.card-fan.scatter-shuffle .char-avatar:nth-child(9) { --scatter-x: 150px; --scatter-y: -80px; --scatter-rot: 45deg; animation-delay: 0s; }

/* ================================
   GAME SECTION
   ================================ */
.game-wrapper {
    background: transparent;
    position: relative;
    z-index: 50;
}

.game-section {
    padding: 60px 24px;
    max-width: 1400px;
    margin: 0 auto;
    position: relative;
}

.section-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.2rem;
    text-align: center;
    margin-bottom: 40px;
}

.section-title .highlight { 
    color: var(--primary); 
}

/* ================================
   BATTLE LAYOUT - Side by Side
   ================================ */
.battle-layout {
    display: flex;
    flex-direction: row;
    gap: 24px;
    max-width: 1300px;
    margin: 0 auto;
    align-items: flex-start;
}

.battle-main {
    flex: 1;
    min-width: 0;
    max-width: 900px;
}

.battle-sidebar {
    width: 300px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    gap: 16px;
    position: sticky;
    top: 100px;
}

/* ================================
   ACTIVITY FEED
   ================================ */
.activity-feed {
    background: rgba(26, 26, 46, 0.95);
    border: 2px solid var(--border);
    border-radius: 16px;
    padding: 16px;
    backdrop-filter: blur(10px);
}

.feed-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border);
}

.feed-header span:first-child {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.65rem;
    color: var(--primary);
}

.live-badge {
    font-size: 0.6rem;
    color: #22c55e;
    animation: livePulse 2s infinite;
}

@keyframes livePulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
}

.feed-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-height: 250px;
    overflow-y: auto;
}

.feed-list::-webkit-scrollbar {
    width: 4px;
}

.feed-list::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
}

.feed-list::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 4px;
}

.feed-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    font-size: 0.65rem;
    border-left: 3px solid transparent;
    animation: feedSlideIn 0.3s ease-out;
}

.feed-item.new {
    animation: feedHighlight 0.5s ease-out;
}

@keyframes feedSlideIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes feedHighlight {
    0% { background: rgba(255, 217, 61, 0.3); }
    100% { background: rgba(0, 0, 0, 0.3); }
}

.feed-item.win { border-left-color: #22c55e; }
.feed-item.loss { border-left-color: #ef4444; }
.feed-item.claim { border-left-color: var(--primary); }
.feed-item.shiny { border-left-color: #ec4899; background: rgba(236, 72, 153, 0.1); }
.feed-item.streak { border-left-color: #f97316; }

.feed-icon {
    font-size: 1rem;
    min-width: 20px;
    text-align: center;
}

.feed-text {
    flex: 1;
    color: var(--text);
    line-height: 1.3;
}

.feed-text .wallet {
    color: var(--primary);
    font-family: monospace;
    font-weight: 600;
}

.feed-text .amount-win {
    color: #22c55e;
    font-weight: bold;
}

.feed-text .amount-loss {
    color: #ef4444;
    font-weight: bold;
}

.feed-time {
    font-size: 0.5rem;
    color: var(--text-muted);
    white-space: nowrap;
}

/* ================================
   REWARDS PANEL
   ================================ */
.rewards-panel {
    background: rgba(26, 26, 46, 0.95);
    border: 2px solid var(--primary);
    border-radius: 16px;
    padding: 16px;
    backdrop-filter: blur(10px);
}

.battle-sidebar .rewards-panel {
    max-width: none;
    margin: 0;
}

.rewards-header {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.65rem;
    color: var(--primary);
    margin-bottom: 14px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
}

.rewards-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-bottom: 14px;
}

.reward-stat {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    padding: 10px;
    text-align: center;
}

.reward-label {
    display: block;
    font-size: 0.55rem;
    color: var(--text-muted);
    text-transform: uppercase;
    margin-bottom: 4px;
}

.reward-value {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.8rem;
    color: #fff;
}

.reward-value.highlight {
    color: var(--primary);
    text-shadow: 0 0 10px rgba(255, 217, 61, 0.5);
}

.reward-currency {
    font-size: 0.6rem;
    color: var(--primary);
}

.claimable-box {
    background: linear-gradient(135deg, rgba(255, 217, 61, 0.15) 0%, rgba(249, 115, 22, 0.15) 100%);
    border: 2px solid var(--primary);
    border-radius: 10px;
    padding: 14px;
    text-align: center;
    margin-bottom: 12px;
}

.claimable-label {
    display: block;
    font-size: 0.55rem;
    color: var(--primary);
    text-transform: uppercase;
    margin-bottom: 6px;
}

.claimable-amount {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.3rem;
    color: var(--primary);
    text-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
}

.claimable-currency {
    display: block;
    font-size: 0.6rem;
    color: var(--primary);
    opacity: 0.8;
    margin-top: 4px;
}

.claim-btn {
    width: 100%;
    padding: 12px;
    font-size: 0.65rem;
    font-family: 'Press Start 2P', cursive;
}

.claim-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.total-earned {
    text-align: center;
    font-size: 0.6rem;
    color: var(--text-muted);
    margin-top: 10px;
}

.total-earned span {
    color: var(--primary);
    font-weight: 600;
}

/* ================================
   BATTLE ARENA
   ================================ */
.battle-arena {
    background-color: #228B22;
    background-image: url('assets/images/battle-bg.png');
    background-size: cover;
    background-position: center bottom;
    background-repeat: no-repeat;
    border-radius: 16px;
    height: 480px;
    position: relative;
    overflow: hidden;
    margin-bottom: 16px;
    border: 3px solid #1a1a2e;
    image-rendering: pixelated;
}

.battle-arena::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(180deg, #87CEEB 0%, #87CEEB 45%, #90EE90 65%, #228B22 100%);
    z-index: 0;
    opacity: 0;
    transition: opacity 0.3s;
}

.battle-arena.no-bg::before {
    opacity: 1;
}

.btn-shuffle {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text-muted);
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 0.8rem;
    margin-bottom: 20px;
    transition: all 0.3s;
}

.btn-shuffle:hover {
    border-color: var(--primary);
    color: var(--primary);
}

.sun {
    position: absolute;
    top: 20px;
    right: 30px;
    width: 50px;
    height: 50px;
    background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
    border-radius: 50%;
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
    z-index: 2;
    display: none;
}

.battle-arena.no-bg .sun {
    display: block;
}

/* HP Boxes */
.hp-box {
    position: absolute;
    background: #fff;
    border-radius: 10px;
    padding: 12px 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    min-width: 200px;
    z-index: 20;
}

.hp-box.enemy {
    top: 20px;
    left: 20px;
}

.hp-box.player {
    bottom: 20px;
    right: 20px;
}

.hp-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.pokemon-name {
    font-weight: 700;
    color: #333;
    font-size: 0.9rem;
}

.level {
    background: #333;
    color: #fff;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.7rem;
}

.hp-bar-outer {
    height: 8px;
    background: #e5e5e5;
    border-radius: 4px;
    overflow: hidden;
}

.hp-bar-inner {
    height: 100%;
    background: var(--green);
    border-radius: 4px;
    transition: width 0.5s;
}

.hp-bar-inner.medium { background: #eab308; }
.hp-bar-inner.low { background: var(--red); animation: hpPulse 0.5s infinite; }

@keyframes hpPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}

.hp-text {
    text-align: right;
    font-size: 0.7rem;
    color: #666;
    margin-top: 4px;
}

/* Status Badges */
.status-container {
    display: flex;
    gap: 4px;
    margin-top: 4px;
}

.status-badge {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.4rem;
    padding: 2px 4px;
    border-radius: 3px;
    color: #fff;
}

.status-par { background: #eab308; }
.status-brn { background: #f97316; }
.status-psn { background: #a855f7; }
.status-slp { background: #6b7280; }
.status-frz { background: #06b6d4; }

/* Sprites */
.sprite-player {
    display: none;
}

.sprite-player-back {
    position: absolute;
    left: -20px;
    bottom: -40px;
    width: 400px;
    height: 400px;
    animation: bounceBack 2.5s ease-in-out infinite;
    z-index: 10;
}

.sprite-player-back img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center bottom;
    filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.4));
}

@keyframes bounceBack {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}

.sprite-player-back.attacking {
    animation: attackBack 0.4s ease-out forwards;
}

@keyframes attackBack {
    0% { transform: translateX(0) translateY(0); }
    50% { transform: translateX(80px) translateY(-20px) scale(1.1); }
    100% { transform: translateX(0) translateY(0); }
}

.sprite-player-back.damaged {
    animation: damagedBack 0.5s ease-out;
}

@keyframes damagedBack {
    0%, 100% { transform: translateX(0); opacity: 1; }
    20% { transform: translateX(-15px); opacity: 0.4; filter: brightness(2); }
    40% { transform: translateX(15px); opacity: 0.6; }
    60% { transform: translateX(-8px); opacity: 0.8; }
    80% { transform: translateX(8px); opacity: 0.9; }
}

.sprite-enemy {
    position: absolute;
    right: 5%;
    bottom: 80px;
    width: 400px;
    height: 400px;
    animation: bounce 2.5s ease-in-out infinite;
    animation-delay: 0.5s;
    z-index: 5;
}

.sprite-enemy img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.35));
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}

.sprite-enemy.attacking {
    animation: attackEnemy 0.4s ease-out forwards;
}

@keyframes attackEnemy {
    0% { transform: translateX(0) translateY(0); }
    50% { transform: translateX(-80px) translateY(10px) scale(1.15); }
    100% { transform: translateX(0) translateY(0); }
}

.sprite-enemy.damaged {
    animation: damagedEnemy 0.5s ease-out;
}

@keyframes damagedEnemy {
    0%, 100% { transform: translateX(0); opacity: 1; }
    20% { transform: translateX(10px); opacity: 0.4; filter: brightness(2); }
    40% { transform: translateX(-10px); opacity: 0.6; }
    60% { transform: translateX(5px); opacity: 0.8; }
    80% { transform: translateX(-5px); opacity: 0.9; }
}

/* Shuffle Animation */
.character-preview.shuffling .char-avatar {
    animation: shuffleCard 0.6s ease-in-out;
}

.character-preview.shuffling .char-avatar:nth-child(1) { animation-delay: 0s; }
.character-preview.shuffling .char-avatar:nth-child(2) { animation-delay: 0.1s; }
.character-preview.shuffling .char-avatar:nth-child(3) { animation-delay: 0.2s; }
.character-preview.shuffling .char-avatar:nth-child(4) { animation-delay: 0.3s; }
.character-preview.shuffling .char-avatar:nth-child(5) { animation-delay: 0.4s; }
.character-preview.shuffling .char-avatar:nth-child(6) { animation-delay: 0.5s; }

@keyframes shuffleCard {
    0% { transform: translateY(0) rotateY(0); opacity: 1; }
    25% { transform: translateY(-30px) rotateY(90deg); opacity: 0.5; }
    50% { transform: translateY(0) rotateY(180deg); opacity: 0.3; }
    75% { transform: translateY(-15px) rotateY(270deg); opacity: 0.5; }
    100% { transform: translateY(0) rotateY(360deg); opacity: 1; }
}

/* Shiny Effect */
.sprite-player.shiny img,
.sprite-player-back.shiny img,
.sprite-enemy.shiny img {
    filter: drop-shadow(0 0 15px #ec4899) drop-shadow(0 8px 16px rgba(0,0,0,0.3)) hue-rotate(30deg);
}

/* Turn Indicator */
.turn-indicator {
    position: absolute;
    bottom: 1%;
    left: 50%;
    transform: translate(-50%);
    font-family: 'Press Start 2P', cursive;
    font-size: 0.65rem;
    background: rgba(0,0,0,0.9);
    color: var(--primary);
    padding: 10px 20px;
    border-radius: 25px;
    border: 2px solid var(--primary);
    z-index: 50;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.turn-indicator.enemy { 
    color: var(--red); 
    border-color: var(--red); 
}

/* Damage Numbers */
.damage-number {
    position: absolute;
    font-family: 'Press Start 2P', cursive;
    font-size: 1.5rem;
    color: #fff;
    text-shadow: 3px 3px 0 #000, -3px -3px 0 #000, 3px -3px 0 #000, -3px 3px 0 #000;
    animation: damageFloat 1.2s ease-out forwards;
    pointer-events: none;
    z-index: 100;
}

.damage-number.critical {
    font-size: 2rem;
    color: #fbbf24;
}

.damage-number.heal {
    color: #22c55e;
}

.damage-number.miss {
    font-size: 1rem;
    color: #888;
}

@keyframes damageFloat {
    0% { transform: translateY(0) scale(0.5); opacity: 1; }
    30% { transform: translateY(-30px) scale(1.3); opacity: 1; }
    100% { transform: translateY(-80px) scale(1); opacity: 0; }
}

/* Effectiveness Popup */
.effectiveness-popup {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'Press Start 2P', cursive;
    font-size: 0.75rem;
    padding: 10px 20px;
    border-radius: 8px;
    animation: popupShow 1.5s ease-out forwards;
    z-index: 100;
    white-space: nowrap;
}

.effectiveness-popup.super { background: var(--green); color: #fff; }
.effectiveness-popup.not-very { background: #6b7280; color: #fff; }
.effectiveness-popup.immune { background: #1f2937; color: #fff; }

@keyframes popupShow {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
    20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
    80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
}

/* Battle Intro */
.battle-intro {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 200;
    animation: introFade 2.5s ease-out forwards;
}

.battle-intro.hide { display: none; }

.intro-text {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.9rem;
    color: #fff;
    text-align: center;
}

.intro-text .shiny-name { color: #ec4899; }

@keyframes introFade {
    0%, 60% { opacity: 1; }
    100% { opacity: 0; pointer-events: none; }
}

/* Battle Menu */
.battle-menu {
    background: rgba(18, 18, 26, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    border: 1px solid rgba(42, 42, 58, 0.8);
    display: grid;
    grid-template-columns: 1fr 1.5fr;
    overflow: hidden;
    position: relative;
    z-index: 10;
}

.battle-log {
    padding: 16px;
    border-right: 1px solid rgba(42, 42, 58, 0.8);
    background: rgba(0, 0, 0, 0.8);
    min-height: 120px;
    max-height: 150px;
    overflow-y: auto;
}

.battle-log::-webkit-scrollbar {
    width: 4px;
}

.battle-log::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 2px;
}

.log-entry {
    font-size: 0.75rem;
    color: var(--green);
    padding: 3px 0;
    font-family: 'Press Start 2P', monospace;
    line-height: 1.5;
    word-wrap: break-word;
}

.log-entry.system { color: var(--primary); }
.log-entry.enemy { color: var(--red); }
.log-entry.info { color: var(--blue); }

.move-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    padding: 12px;
    background: rgba(18, 18, 26, 0.8);
}

.move-btn {
    background: rgba(10, 10, 15, 0.8);
    border: 2px solid rgba(42, 42, 58, 0.8);
    border-radius: 10px;
    padding: 12px;
    cursor: pointer;
    text-align: left;
    backdrop-filter: blur(5px);
    transition: all 0.2s;
}

.move-btn:hover:not(:disabled) {
    border-color: var(--primary);
    background: rgba(255, 217, 61, 0.1);
}

.move-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Battle Result */
.battle-result {
    display: none !important;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--bg-card);
    border: 3px solid var(--primary);
    border-radius: 20px;
    padding: 40px;
    text-align: center;
    z-index: 500;
}

.battle-result.show { display: block !important; }

.result-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.5rem;
    color: var(--primary);
    margin-bottom: 16px;
}

.result-subtitle {
    color: var(--text-muted);
    margin-bottom: 24px;
}

.battle-arena.shake {
    animation: screenShake 0.3s ease-out;
}

@keyframes screenShake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    75% { transform: translateX(-3px); }
}

/* Token Earned Popup */
.token-earned-popup,
.reward-popup {
    position: fixed;
    top: 20%;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, var(--primary) 0%, #f97316 100%);
    color: #000;
    padding: 20px 40px;
    border-radius: 16px;
    font-family: 'Press Start 2P', cursive;
    font-size: 1.2rem;
    z-index: 9999;
    animation: rewardPopupAnim 3s ease-out forwards;
    box-shadow: 0 0 30px rgba(255, 217, 61, 0.5);
    text-align: center;
}

.reward-popup.danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: #fff;
}

@keyframes rewardPopupAnim {
    0% { opacity: 0; transform: translateX(-50%) translateY(20px) scale(0.8); }
    15% { opacity: 1; transform: translateX(-50%) translateY(0) scale(1.1); }
    30% { transform: translateX(-50%) translateY(0) scale(1); }
    80% { opacity: 1; }
    100% { opacity: 0; transform: translateX(-50%) translateY(-30px); }
}

/* Token Balance Display */
.token-balance-display {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: rgba(255, 217, 61, 0.1);
    border: 1px solid var(--primary);
    border-radius: 12px;
    font-family: 'Press Start 2P', cursive;
    font-size: 0.7rem;
    color: var(--primary);
}

#pumpmon-balance {
    color: #fff;
    font-weight: bold;
}

.demo-badge {
    position: absolute;
    top: -12px;
    right: -12px;
    background: linear-gradient(135deg, var(--green), #16a34a);
    color: #000;
    font-family: 'Press Start 2P', cursive;
    font-size: 0.55rem;
    padding: 6px 12px;
    border-radius: 20px;
    font-weight: 700;
    box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
    animation: demoPulse 2s ease-in-out infinite;
}

@keyframes demoPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

/* ================================
   SAFARI ZONE GAME - FULLSCREEN
   ================================ */

/* Safari Zone Entry Section */
.safari-zone {
    padding: 80px 24px;
    background: transparent;
    position: relative;
    z-index: 10;
}

.safari-container {
    max-width: 600px;
    margin: 0 auto;
    text-align: center;
}

.safari-card {
    background: rgba(26, 26, 46, 0.9);
    backdrop-filter: blur(10px);
    border: 2px solid var(--primary);
    border-radius: 24px;
    padding: 40px 32px;
    margin-top: 32px;
    box-shadow: 0 0 40px rgba(255, 217, 61, 0.15);
}

.safari-icon {
    font-size: 4rem;
    margin-bottom: 20px;
}

.safari-info {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    flex-wrap: wrap;
    margin-bottom: 20px;
}

.safari-tokens {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.2rem;
    color: #fff;
}

.safari-equals {
    font-size: 1.5rem;
    color: var(--primary);
}

.safari-reward {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.9rem;
    color: var(--primary);
    background: rgba(255, 217, 61, 0.1);
    padding: 12px 20px;
    border-radius: 12px;
    border: 1px solid var(--primary);
}

.safari-desc {
    color: var(--text-muted);
    font-size: 0.95rem;
    margin-bottom: 24px;
}

.ticket-display {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-bottom: 20px;
    font-family: 'Press Start 2P', cursive;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.ticket-display .count {
    color: var(--primary);
    font-size: 1rem;
}

/* Safari Modal - FULLSCREEN */
.safari-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 3000;
}

.safari-modal.show {
    display: flex;
}

/* Background Image Layer */
.safari-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
}

.safari-bg-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.4;
}

/* Fallback gradient if no image */
.safari-bg-fallback {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(ellipse at 30% 20%, rgba(34, 197, 94, 0.3) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 60%, rgba(251, 191, 36, 0.2) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 90%, rgba(59, 130, 246, 0.2) 0%, transparent 50%),
        linear-gradient(180deg, #0a1a0a 0%, #1a2a1a 30%, #0d2a1a 60%, #0a1a0a 100%);
}

/* Animated particles overlay */
.safari-bg-particles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: hidden;
}

.safari-particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    animation: floatParticle 15s linear infinite;
}

.safari-particle:nth-child(1) { left: 10%; animation-delay: 0s; }
.safari-particle:nth-child(2) { left: 20%; animation-delay: 2s; }
.safari-particle:nth-child(3) { left: 30%; animation-delay: 4s; }
.safari-particle:nth-child(4) { left: 40%; animation-delay: 1s; }
.safari-particle:nth-child(5) { left: 50%; animation-delay: 3s; }
.safari-particle:nth-child(6) { left: 60%; animation-delay: 5s; }
.safari-particle:nth-child(7) { left: 70%; animation-delay: 2.5s; }
.safari-particle:nth-child(8) { left: 80%; animation-delay: 4.5s; }
.safari-particle:nth-child(9) { left: 90%; animation-delay: 1.5s; }
.safari-particle:nth-child(10) { left: 95%; animation-delay: 3.5s; }

@keyframes floatParticle {
    0% { transform: translateY(100vh) scale(0); opacity: 0; }
    10% { opacity: 0.6; }
    90% { opacity: 0.6; }
    100% { transform: translateY(-10vh) scale(1); opacity: 0; }
}

/* Vignette overlay */
.safari-vignette {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    box-shadow: inset 0 0 200px rgba(0, 0, 0, 0.8);
    pointer-events: none;
}

/* Main Game Container - Centered */
.safari-game-container {
    position: relative;
    z-index: 10;
    background: rgba(10, 20, 10, 0.85);
    backdrop-filter: blur(20px);
    border: 3px solid #2d5a2d;
    border-radius: 24px;
    width: 95%;
    max-width: 900px;
    height: 90vh;
    max-height: 800px;
    margin: auto;
    display: flex;
    flex-direction: column;
    box-shadow: 
        0 0 80px rgba(34, 197, 94, 0.3),
        0 0 150px rgba(34, 197, 94, 0.1),
        inset 0 0 100px rgba(0, 0, 0, 0.3);
    overflow: hidden;
}

/* Safari Header */
.safari-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 28px;
    background: rgba(0, 0, 0, 0.6);
    border-bottom: 2px solid #2d5a2d;
}

.safari-biome-name {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.85rem;
    color: var(--green);
    text-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
}

.safari-header-right {
    display: flex;
    align-items: center;
    gap: 20px;
}

.safari-actions-left {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.75rem;
    color: var(--primary);
    text-shadow: 0 0 10px rgba(255, 217, 61, 0.5);
}

.safari-exit-btn {
    background: rgba(239, 68, 68, 0.2);
    border: 2px solid var(--red);
    color: var(--red);
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.2s;
}

.safari-exit-btn:hover {
    background: var(--red);
    color: #fff;
    transform: scale(1.05);
}

/* Safari Game Area */
.safari-game-area {
    flex: 1;
    padding: 30px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.safari-screen {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    max-width: 700px;
    min-height: 450px;
}

.safari-screen.hidden {
    display: none;
}

.safari-screen-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.1rem;
    color: var(--primary);
    margin-bottom: 32px;
    text-align: center;
    text-shadow: 0 0 20px rgba(255, 217, 61, 0.4);
}

/* Biome Selection */
.biome-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    width: 100%;
    max-width: 600px;
}

.biome-card {
    background: rgba(0, 0, 0, 0.5);
    border: 3px solid #2d5a2d;
    border-radius: 16px;
    padding: 30px 24px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
}

.biome-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.3s;
}

.biome-card:hover {
    border-color: var(--green);
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 15px 40px rgba(34, 197, 94, 0.3);
}

.biome-card:hover::before {
    opacity: 1;
}

.biome-card.locked {
    opacity: 0.5;
    cursor: not-allowed;
}

.biome-card.locked:hover {
    transform: none;
    border-color: #2d5a2d;
    box-shadow: none;
}

.biome-emoji {
    font-size: 4rem;
    margin-bottom: 16px;
    display: block;
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
}

.biome-name {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.8rem;
    color: #fff;
    margin-bottom: 8px;
}

.biome-difficulty {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-transform: uppercase;
    font-weight: 600;
}

.biome-difficulty.easy { color: var(--green); }
.biome-difficulty.medium { color: var(--primary); }
.biome-difficulty.hard { color: #f97316; }
.biome-difficulty.extreme { color: var(--red); }

/* Exploration Screen */
.safari-environment {
    width: 100%;
    height: 150px;
    background-image: url('assets/images/battle-arena.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: 12px;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    gap: 30px;
    padding-bottom: 20px;
}

.safari-grass {
    width: 50px;
    height: 70px;
    background: linear-gradient(180deg, #32CD32 0%, #228B22 100%);
    border-radius: 50% 50% 0 0;
    position: relative;
    animation: grassSway 2s ease-in-out infinite;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.safari-grass:nth-child(2) {
    animation-delay: 0.3s;
    height: 85px;
}

.safari-grass:nth-child(3) {
    animation-delay: 0.6s;
}

@keyframes grassSway {
    0%, 100% { transform: rotate(-5deg); }
    50% { transform: rotate(5deg); }
}

.safari-message {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.85rem;
    color: #fff;
    text-align: center;
    padding: 24px 32px;
    background: rgba(0, 0, 0, 0.7);
    border: 2px solid #3d5a3d;
    border-radius: 16px;
    margin-bottom: 28px;
    line-height: 1.8;
    min-height: 80px;
    max-width: 500px;
}

.safari-explore-btn {
    padding: 20px 60px;
    font-size: 1.1rem;
    font-family: 'Press Start 2P', cursive;
    background: linear-gradient(135deg, var(--green) 0%, #16a34a 100%);
    border: none;
    color: #fff;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
}

.safari-explore-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 10px 30px rgba(34, 197, 94, 0.5);
}

/* ================================
   ENCOUNTER SCREEN - IMMERSIVE
   ================================ */

#encounter-screen {
    display: flex;
    flex-direction: column;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    padding: 0 !important;
    margin: 0 !important;
    max-width: none !important;
    min-height: auto !important;
    overflow: hidden;
}

#encounter-screen.hidden {
    display: none !important;
}

/* Game Scene - Full Background */
.encounter-scene {
    flex: 1;
    width: 100%;
    background: url('assets/images/battle-arena.jpg') center center / cover no-repeat;
    position: relative;
    overflow: hidden;
}

/* Creature - Anchored to Ground */
.encounter-creature {
    position: absolute;
    bottom: 15%;
    left: 50%;
    transform: translateX(-50%);
    z-index: 5;
}

.encounter-creature img {
    width: 140px;
    height: 140px;
    object-fit: contain;
    animation: creatureBounce 1.5s ease-in-out infinite;
    filter: drop-shadow(0 8px 16px rgba(0,0,0,0.5));
}

@keyframes creatureBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.encounter-creature img.shake {
    animation: creatureShake 0.5s ease-out;
}

@keyframes creatureShake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-12px) rotate(-5deg); }
    40% { transform: translateX(12px) rotate(5deg); }
    60% { transform: translateX(-8px); }
    80% { transform: translateX(8px); }
}

.encounter-creature img.caught {
    animation: creatureCaught 0.8s ease-out forwards;
}

@keyframes creatureCaught {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.3); filter: brightness(2); }
    100% { transform: scale(0); opacity: 0; }
}

@keyframes creatureFled {
    0% { transform: translateX(0); opacity: 1; }
    100% { transform: translateX(300px); opacity: 0; }
}

/* Creature Info - Top Overlay */
.creature-info-overlay {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.85);
    padding: 12px 24px;
    border-radius: 12px;
    text-align: center;
    border: 2px solid rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    z-index: 10;
    animation: popupFade 3s ease-out forwards;
}

@keyframes popupFade {
    0% { opacity: 0; transform: translateX(-50%) scale(0.8); }
    10% { opacity: 1; transform: translateX(-50%) scale(1); }
    80% { opacity: 1; transform: translateX(-50%) scale(1); }
    100% { opacity: 0; transform: translateX(-50%) scale(0.9); visibility: hidden; }
}

.creature-info-overlay .creature-name {
    font-family: 'Press Start 2P', cursive;
    font-size: 1rem;
    color: #fff;
    display: block;
    margin-bottom: 8px;
    text-shadow: 0 2px 8px rgba(0,0,0,0.5);
}

.creature-info-overlay .creature-rarity {
    font-size: 0.7rem;
    padding: 4px 14px;
    border-radius: 20px;
    text-transform: uppercase;
    font-weight: 700;
    display: inline-block;
}

.creature-rarity.common { background: #6b7280; color: #fff; }
.creature-rarity.uncommon { background: #22c55e; color: #fff; }
.creature-rarity.rare { background: #3b82f6; color: #fff; }
.creature-rarity.epic { background: #a855f7; color: #fff; }
.creature-rarity.legendary { background: linear-gradient(90deg, #fbbf24, #f97316); color: #000; }

.creature-status {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin-top: 10px;
}

.status-effect {
    font-size: 0.55rem;
    padding: 4px 10px;
    border-radius: 6px;
    background: rgba(0,0,0,0.6);
    font-weight: 600;
}

.status-effect.eating { color: #fbbf24; border: 1px solid #fbbf24; }
.status-effect.angry { color: #ef4444; border: 1px solid #ef4444; }

/* UI Panel - Below Scene (Separated) */
.encounter-ui-panel {
    background: rgba(10, 20, 10, 0.98);
    border-top: 3px solid #2d5a2d;
    padding: 16px 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    flex-shrink: 0;
}

/* Encounter Log */
.encounter-log {
    background: rgba(0, 0, 0, 0.6);
    border: 2px solid #3d5a3d;
    border-radius: 10px;
    padding: 12px 16px;
    min-height: 45px;
    max-height: 60px;
    overflow-y: auto;
}

.encounter-log-entry {
    font-size: 0.65rem;
    color: #22c55e;
    padding: 2px 0;
    font-family: 'Press Start 2P', cursive;
    line-height: 1.4;
}   

.encounter-log-entry.warning { color: #ffd93d; }
.encounter-log-entry.danger { color: #ef4444; }
.encounter-log-entry.success { color: #22c55e; }

/* Action Buttons - Clean Grid */
.encounter-actions {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
}

.encounter-btn {
    background: rgba(0, 0, 0, 0.7);
    border: 2px solid #3d5a3d;
    border-radius: 10px;
    padding: 12px 8px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.encounter-btn:hover:not(:disabled) {
    transform: translateY(-2px);
}

.encounter-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.encounter-btn-icon {
    font-size: 1.6rem;
}

.encounter-btn-label {
    font-size: 0.6rem;
    color: #888;
    font-weight: 600;
}

.encounter-btn-count {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.55rem;
    color: #ffd93d;
}

.encounter-btn.capsule:hover:not(:disabled) { 
    border-color: #ef4444; 
    background: rgba(239, 68, 68, 0.15);
}

.encounter-btn.bait:hover:not(:disabled) { 
    border-color: #fbbf24; 
    background: rgba(251, 191, 36, 0.15);
}

.encounter-btn.rock:hover:not(:disabled) { 
    border-color: #9ca3af; 
    background: rgba(156, 163, 175, 0.15);
}

.encounter-btn.run:hover:not(:disabled) { 
    border-color: #3b82f6; 
    background: rgba(59, 130, 246, 0.15);
}

/* Results Screen */
.results-stats {
    display: flex;
    gap: 24px;
    margin-bottom: 32px;
    flex-wrap: wrap;
    justify-content: center;
}

.result-stat {
    background: rgba(0, 0, 0, 0.5);
    border: 2px solid #3d5a3d;
    border-radius: 16px;
    padding: 24px 36px;
    text-align: center;
    min-width: 140px;
}

.result-label {
    font-size: 0.7rem;
    color: var(--text-muted);
    display: block;
    margin-bottom: 12px;
    text-transform: uppercase;
}

.result-value {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.8rem;
    color: var(--green);
    text-shadow: 0 0 15px rgba(34, 197, 94, 0.5);
}

.result-value.fled { color: var(--red); text-shadow: 0 0 15px rgba(239, 68, 68, 0.5); }
.result-value.rare { color: var(--primary); text-shadow: 0 0 15px rgba(255, 217, 61, 0.5); }

.results-creatures {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
    margin-bottom: 32px;
    max-height: 200px;
    overflow-y: auto;
    width: 100%;
    padding: 10px;
}

.result-creature {
    background: rgba(0, 0, 0, 0.5);
    border: 3px solid #3d5a3d;
    border-radius: 12px;
    padding: 16px;
    text-align: center;
    width: 100px;
    transition: transform 0.2s;
}

.result-creature:hover {
    transform: scale(1.05);
}

.result-creature img {
    width: 60px;
    height: 60px;
    object-fit: contain;
}

.result-creature .name {
    font-size: 0.55rem;
    color: #fff;
    margin-top: 8px;
    font-family: 'Press Start 2P', cursive;
}

.result-creature.rare { border-color: #3b82f6; box-shadow: 0 0 15px rgba(59, 130, 246, 0.3); }
.result-creature.epic { border-color: #a855f7; box-shadow: 0 0 15px rgba(168, 85, 247, 0.3); }
.result-creature.legendary { 
    border-color: #fbbf24; 
    box-shadow: 0 0 25px rgba(251, 191, 36, 0.4);
    animation: legendaryCreature 2s ease-in-out infinite;
}

@keyframes legendaryCreature {
    0%, 100% { box-shadow: 0 0 25px rgba(251, 191, 36, 0.4); }
    50% { box-shadow: 0 0 40px rgba(251, 191, 36, 0.7); }
}

.results-actions {
    display: flex;
    gap: 20px;
    justify-content: center;
}

.results-actions .btn {
    padding: 16px 32px;
    font-size: 0.9rem;
}

/* Safari Inventory Bar */
.safari-inventory {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 28px;
    padding: 18px 28px;
    background: rgba(0, 0, 0, 0.7);
    border-top: 2px solid #2d5a2d;
}

.inventory-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 10px;
}

.inv-icon {
    font-size: 1.5rem;
}

.inv-count {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.85rem;
    color: #fff;
}

.inventory-item.caught {
    border: 2px solid var(--green);
}

.inventory-item.caught .inv-count {
    color: var(--green);
}

.inventory-divider {
    width: 2px;
    height: 32px;
    background: #3d5a3d;
}

/* ================================
   GAME MECHANICS SECTION
   ================================ */
.mechanics-section {
    padding: 80px 24px;
    background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(26,26,46,0.9) 100%);
}

.mechanics-container {
    max-width: 1100px;
    margin: 0 auto;
}

.mechanics-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 24px;
    margin-top: 40px;
}

.mechanic-card {
    background: rgba(26, 26, 46, 0.95);
    border: 2px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    transition: all 0.3s;
}

.mechanic-card:hover {
    border-color: var(--primary);
    transform: translateY(-4px);
    box-shadow: 0 10px 40px rgba(255, 217, 61, 0.1);
}

.mechanic-card.warning {
    border-color: #ef4444;
    background: rgba(239, 68, 68, 0.1);
}

.mechanic-card.warning:hover {
    border-color: #ef4444;
    box-shadow: 0 10px 40px rgba(239, 68, 68, 0.2);
}

.mechanic-icon {
    font-size: 2.5rem;
    margin-bottom: 12px;
}

.mechanic-card h3 {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.9rem;
    color: var(--primary);
    margin-bottom: 16px;
}

.mechanic-card ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.mechanic-card li {
    padding: 8px 0;
    padding-left: 20px;
    position: relative;
    font-size: 0.85rem;
    color: var(--text-muted);
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.mechanic-card li:last-child {
    border-bottom: none;
}

.mechanic-card li::before {
    content: 'â–¸';
    position: absolute;
    left: 0;
    color: var(--primary);
}

.mechanic-card .highlight {
    color: var(--primary);
    font-weight: 600;
}

.mechanic-card .danger {
    color: #ef4444;
    font-weight: 600;
}

/* Type Chart Mini */
.type-chart-mini {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.type-row {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.75rem;
    color: var(--text-muted);
    flex-wrap: wrap;
}

.type-badge {
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.6rem;
    font-weight: 600;
    text-transform: uppercase;
}

.type-badge.water { background: #3b82f6; color: #fff; }
.type-badge.fire { background: #ef4444; color: #fff; }
.type-badge.grass { background: #22c55e; color: #fff; }
.type-badge.electric { background: #fbbf24; color: #000; }
.type-badge.ice { background: #67e8f9; color: #000; }
.type-badge.psychic { background: #ec4899; color: #fff; }
.type-badge.dark { background: #374151; color: #fff; }
.type-badge.rock { background: #a8a29e; color: #000; }
.type-badge.normal { background: #a3a3a3; color: #000; }
.type-badge.steel { background: #9ca3af; color: #000; }

/* Tips Box */
.tips-box {
    background: rgba(255, 217, 61, 0.1);
    border: 2px solid var(--primary);
    border-radius: 16px;
    padding: 24px;
    margin-top: 32px;
}

.tips-box h4 {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.85rem;
    color: var(--primary);
    margin-bottom: 16px;
    text-align: center;
}

.tips-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.tip {
    background: rgba(0, 0, 0, 0.3);
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 0.8rem;
    color: var(--text);
}

/* Start Battle CTA */
.start-battle-cta {
    text-align: center;
    margin-top: 40px;
}

.start-battle-cta p {
    font-size: 1rem;
    color: var(--text-muted);
    margin-bottom: 16px;
}

/* ================================
   HOW IT WORKS SECTION
   ================================ */
.how-it-works {
    padding: 100px 24px;
    background: transparent;
    position: relative;
    z-index: 10;
}

.how-container {
    max-width: 1000px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
}

.steps {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 30px;
}

.step {
    text-align: center;
    padding: 40px 28px;
    background: rgba(26, 26, 46, 0.85);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    border: 1px solid rgba(42, 42, 62, 0.8);
    transition: transform 0.3s, border-color 0.3s;
}

.step:hover {
    transform: translateY(-5px);
    border-color: var(--primary);
}

.step-icon {
    font-size: 3.5rem;
    margin-bottom: 24px;
    display: block;
    line-height: 1;
}

.step-title {
    font-family: 'Inter', sans-serif;
    font-weight: 700;
    font-size: 1.1rem;
    margin: 0 0 16px 0;
    color: #fff;
}

.step-desc {
    color: var(--text-muted);
    font-size: 0.95rem;
    line-height: 1.7;
    margin: 0;
}

/* ================================
   FOOTER
   ================================ */
footer {
    padding: 32px 24px 24px;
    text-align: center;
    border-top: 1px solid rgba(42, 42, 58, 0.5);
    background: transparent;
    position: relative;
    z-index: 10;
}

.footer-content {
    max-width: 700px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
}

.social-links {
    display: flex;
    gap: 16px;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
}

.social-links a {
    color: #a0a0a0;
    text-decoration: none;
    padding: 12px 24px;
    border: 1px solid rgba(42, 42, 62, 0.8);
    border-radius: 10px;
    background: rgba(26, 26, 46, 0.6);
    backdrop-filter: blur(5px);
    transition: all 0.3s;
    font-size: 0.9rem;
}

.social-links a:hover {
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-3px);
}

/* ================================
   MODALS
   ================================ */
.modal {
    display: none !important;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    visibility: hidden;
}

.modal.show { 
    display: flex !important; 
    visibility: visible;
}

.modal-content {
    background: var(--bg-card);
    border-radius: 20px;
    padding: 32px;
    max-width: 900px;
    width: 95%;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.1rem;
    text-align: center;
    margin-bottom: 28px;
    color: var(--primary);
    text-shadow: 0 0 20px rgba(255, 217, 61, 0.3);
}

/* Character Grid */
.character-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 24px;
}

.char-card {
    background: linear-gradient(145deg, rgba(26, 26, 46, 0.9) 0%, rgba(18, 18, 30, 0.95) 100%);
    border: 2px solid var(--border);
    border-radius: 16px;
    padding: 20px 16px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.char-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), transparent);
    opacity: 0;
    transition: opacity 0.3s;
}

.char-card:hover {
    border-color: var(--primary);
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(255, 217, 61, 0.15);
}

.char-card:hover::before {
    opacity: 1;
}

.char-card.selected {
    border-color: var(--primary);
    box-shadow: 0 0 30px rgba(255, 217, 61, 0.3), inset 0 0 20px rgba(255, 217, 61, 0.05);
}

.char-card.selected::before {
    opacity: 1;
}

.char-card img {
    width: 100px;
    height: 100px;
    object-fit: contain;
    border-radius: 12px;
    margin-bottom: 12px;
    background: rgba(0, 0, 0, 0.3);
    padding: 8px;
    transition: transform 0.3s;
}

.char-card:hover img {
    transform: scale(1.1);
}

.char-card .name {
    font-family: 'Press Start 2P', cursive;
    font-weight: 600;
    font-size: 0.75rem;
    color: var(--primary);
    margin-bottom: 6px;
}

.char-card .type-badge {
    display: inline-block;
    font-size: 0.65rem;
    padding: 3px 10px;
    border-radius: 20px;
    text-transform: uppercase;
    font-weight: 600;
    margin-bottom: 10px;
}

.char-card .role {
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-bottom: 8px;
    font-weight: 500;
}

.char-card .description {
    font-size: 0.7rem;
    color: var(--text-muted);
    line-height: 1.4;
    margin-bottom: 12px;
    min-height: 36px;
}

.char-card .stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 6px;
    font-size: 0.6rem;
}

.char-card .stat {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 4px 8px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 6px;
}

.char-card .stat-label {
    color: var(--text-muted);
    text-transform: uppercase;
}

.char-card .stat-value {
    color: var(--text);
    font-weight: 600;
}

.char-card .stat-value.high { color: #22c55e; }
.char-card .stat-value.medium { color: #fbbf24; }
.char-card .stat-value.low { color: #ef4444; }

.modal-actions {
    display: flex;
    gap: 16px;
    justify-content: center;
}

/* Wallet Modal */
.wallet-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 3000;
    align-items: center;
    justify-content: center;
}

.wallet-modal.show {
    display: flex;
}

.wallet-modal-content {
    background: var(--bg-card);
    border-radius: 20px;
    padding: 32px;
    max-width: 400px;
    width: 90%;
    border: 1px solid var(--border);
}

.wallet-modal-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.9rem;
    text-align: center;
    margin-bottom: 24px;
    color: var(--primary);
}

.wallet-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.wallet-option {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.wallet-option:hover {
    border-color: var(--primary);
    background: rgba(255, 217, 61, 0.05);
}

.wallet-option img {
    width: 40px;
    height: 40px;
    border-radius: 8px;
}

.wallet-option-info {
    flex: 1;
}

.wallet-option-name {
    font-weight: 600;
    font-size: 1rem;
    color: var(--text);
}

.wallet-option-desc {
    font-size: 0.8rem;
    color: var(--text-muted);
}

.wallet-option-status {
    font-size: 0.7rem;
    padding: 4px 8px;
    border-radius: 4px;
    background: var(--green);
    color: #000;
}

.wallet-option-status.not-installed {
    background: var(--border);
    color: var(--text-muted);
}

.wallet-modal-close {
    margin-top: 20px;
    width: 100%;
    padding: 12px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.2s;
}

.wallet-modal-close:hover {
    border-color: var(--red);
    color: var(--red);
}

.wallet-address {
    font-family: monospace;
    font-size: 0.8rem;
}

.wallet-balance {
    font-size: 0.7rem;
    color: var(--green);
    margin-left: 4px;
}

/* ================================
   PAY TO PLAY OVERLAY
   ================================ */
.battle-layout {
    position: relative;
}

.pay-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 16px;
}

.pay-overlay.hidden {
    display: none !important;
}

.pay-overlay-content {
    text-align: center;
    padding: 40px;
    max-width: 400px;
}

.pay-overlay-icon {
    font-size: 4rem;
    display: block;
    margin-bottom: 16px;
    animation: iconPulse 2s ease-in-out infinite;
}

@keyframes iconPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.pay-overlay-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.2rem;
    color: #ffd93d;
    margin: 0 0 24px 0;
    text-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
}

.pay-overlay-fee {
    display: inline-flex;
    align-items: baseline;
    gap: 8px;
    background: rgba(255, 217, 61, 0.1);
    border: 2px solid #ffd93d;
    border-radius: 16px;
    padding: 20px 40px;
    margin-bottom: 24px;
}

.pay-fee-value {
    font-family: 'Press Start 2P', cursive;
    font-size: 2rem;
    color: #ffd93d;
    text-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
}

.pay-fee-currency {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.9rem;
    color: #ffd93d;
    opacity: 0.8;
}

.pay-overlay-rewards {
    display: flex;
    justify-content: center;
    gap: 16px;
    flex-wrap: wrap;
    margin-bottom: 28px;
    font-size: 0.85rem;
    color: #ccc;
}

.pay-overlay-rewards span {
    background: rgba(255, 255, 255, 0.05);
    padding: 8px 14px;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.pay-overlay-btn {
    padding: 18px 48px;
    font-size: 1rem;
    font-family: 'Press Start 2P', cursive;
    background: linear-gradient(135deg, #9945FF 0%, #14F195 100%);
    border: none;
    border-radius: 12px;
    color: #fff;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
}

.pay-overlay-btn:hover {
    transform: translateY(-3px);
    box-shadow: 
        0 10px 40px rgba(153, 69, 255, 0.5),
        0 0 20px rgba(20, 241, 149, 0.4);
}

.pay-overlay-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.pay-overlay-btn .pay-btn-text {
    display: block;
}

.pay-overlay-btn .pay-btn-loading {
    display: none;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.pay-overlay-btn.loading .pay-btn-text {
    display: none;
}

.pay-overlay-btn.loading .pay-btn-loading {
    display: flex;
}

.pay-overlay-note {
    margin-top: 20px;
    font-size: 0.75rem;
    color: #888;
}

#wallet-status {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

#wallet-status.connected {
    color: #14F195;
    border-color: rgba(20, 241, 149, 0.3);
    background: rgba(20, 241, 149, 0.1);
}

/* Spinner */
.spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top-color: #fff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Mobile */
@media (max-width: 768px) {
    .pay-overlay-content {
        padding: 24px;
    }
    
    .pay-overlay-icon {
        font-size: 3rem;
    }
    
    .pay-overlay-title {
        font-size: 0.9rem;
    }
    
    .pay-fee-value {
        font-size: 1.5rem;
    }
    
    .pay-overlay-rewards {
        gap: 8px;
        font-size: 0.75rem;
    }
    
    .pay-overlay-btn {
        padding: 14px 32px;
        font-size: 0.8rem;
    }
}

/* ================================
   PAY TO PLAY MODAL - HORIZONTAL
   ================================ */
#pay-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 9999;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 20px;
}

#pay-modal.show {
    display: flex !important;
}

.pay-modal-content.horizontal {
    background: linear-gradient(145deg, #1a1a2e 0%, #0a0a0f 100%);
    border: 2px solid #ffd93d;
    border-radius: 24px;
    padding: 32px 40px;
    max-width: 750px;
    width: 95%;
    display: flex;
    gap: 40px;
    align-items: center;
    box-shadow: 
        0 0 60px rgba(255, 217, 61, 0.3),
        0 0 120px rgba(255, 217, 61, 0.1);
    animation: modalPop 0.3s ease-out;
}

@keyframes modalPop {
    0% { transform: scale(0.8); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}

/* Left Side */
.pay-left {
    flex: 0 0 200px;
    text-align: center;
}

.pay-icon {
    font-size: 3rem;
    margin-bottom: 12px;
    display: block;
    animation: iconBounce 2s ease-in-out infinite;
}

@keyframes iconBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}

.pay-title {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.9rem;
    color: #ffd93d;
    margin: 0 0 16px 0;
    text-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
}

.fee-display {
    background: rgba(255, 217, 61, 0.1);
    border: 2px solid #ffd93d;
    border-radius: 12px;
    padding: 16px;
}

.fee-amount {
    display: flex;
    align-items: baseline;
    justify-content: center;
    gap: 6px;
}

.fee-value {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.8rem;
    color: #ffd93d;
    text-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
}

.fee-currency {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.8rem;
    color: #ffd93d;
    opacity: 0.8;
}

.fee-label {
    font-size: 0.7rem;
    color: #888;
    text-transform: uppercase;
    margin-top: 6px;
    letter-spacing: 1px;
}

/* Right Side */
.pay-right {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.pay-rewards {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.pay-reward-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.8rem;
    color: #fff;
    padding: 10px 14px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.pay-reward-item:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 217, 61, 0.3);
    transform: translateX(5px);
}

.reward-icon {
    font-size: 1.1rem;
    flex-shrink: 0;
}

#pay-btn {
    width: 100%;
    padding: 14px 24px;
    font-size: 0.85rem;
    font-family: 'Press Start 2P', cursive;
    background: linear-gradient(135deg, #9945FF 0%, #14F195 100%);
    border: none;
    border-radius: 10px;
    color: #fff;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
}

#pay-btn:hover {
    transform: translateY(-2px);
    box-shadow: 
        0 8px 30px rgba(153, 69, 255, 0.4),
        0 0 15px rgba(20, 241, 149, 0.3);
}

#pay-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.pay-btn-text {
    display: block;
}

.pay-btn-loading {
    display: none;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

#pay-btn.loading .pay-btn-text {
    display: none;
}

#pay-btn.loading .pay-btn-loading {
    display: flex;
}

.spinner {
    display: inline-block;
    width: 18px;
    height: 18px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top-color: #fff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.pay-note {
    margin: 0;
    font-size: 0.7rem;
    color: #888;
    text-align: center;
}

#wallet-status {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    font-size: 0.7rem;
}

#wallet-status.connected {
    color: #14F195;
    border-color: rgba(20, 241, 149, 0.3);
    background: rgba(20, 241, 149, 0.1);
}

.pay-close-btn {
    padding: 8px 16px;
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: #888;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s;
    align-self: center;
}

.pay-close-btn:hover {
    color: #fff;
    border-color: rgba(255, 255, 255, 0.4);
    background: rgba(255, 255, 255, 0.05);
}

/* Mobile - Stack vertically on small screens */
@media (max-width: 600px) {
    .pay-modal-content.horizontal {
        flex-direction: column;
        gap: 24px;
        padding: 24px 20px;
        max-height: 90vh;
        overflow-y: auto;
    }
    
    .pay-left {
        flex: none;
        width: 100%;
    }
    
    .pay-title {
        font-size: 0.8rem;
    }
    
    .fee-value {
        font-size: 1.5rem;
    }
    
    .pay-reward-item {
        font-size: 0.75rem;
        padding: 8px 12px;
    }
    
    #pay-btn {
        padding: 12px 20px;
        font-size: 0.75rem;
    }
}
.tx-status {
    margin-top: 16px;
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 0.8rem;
    text-align: center;
    animation: statusFadeIn 0.3s ease;
}

@keyframes statusFadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.tx-status.pending {
    background: rgba(251, 191, 36, 0.1);
    border: 1px solid #fbbf24;
    color: #fbbf24;
}

.tx-status.pending::before {
    content: 'â³ ';
}

.tx-status.success {
    background: rgba(20, 241, 149, 0.1);
    border: 1px solid #14F195;
    color: #14F195;
}

.tx-status.success::before {
    content: 'âœ… ';
}

.tx-status.error {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid #ef4444;
    color: #ef4444;
}

.tx-status.error::before {
    content: 'âŒ ';
}

/* ================================
   RESPONSIVE STYLES
   ================================ */

/* Card Fan - Tablet */
@media (max-width: 1100px) {
    .card-fan {
        height: 260px;
    }
    
    .card-fan .char-avatar {
        width: 100px;
        height: 145px;
    }
    
    .card-fan .char-avatar:nth-child(1) { transform: rotate(-24deg) translateX(-160px); }
    .card-fan .char-avatar:nth-child(2) { transform: rotate(-18deg) translateX(-120px); }
    .card-fan .char-avatar:nth-child(3) { transform: rotate(-12deg) translateX(-80px); }
    .card-fan .char-avatar:nth-child(4) { transform: rotate(-6deg) translateX(-40px); }
    .card-fan .char-avatar:nth-child(5) { transform: rotate(0deg) translateX(0px); }
    .card-fan .char-avatar:nth-child(6) { transform: rotate(6deg) translateX(40px); }
    .card-fan .char-avatar:nth-child(7) { transform: rotate(12deg) translateX(80px); }
    .card-fan .char-avatar:nth-child(8) { transform: rotate(18deg) translateX(120px); }
    .card-fan .char-avatar:nth-child(9) { transform: rotate(24deg) translateX(160px); }
    
    .card-fan:hover .char-avatar:nth-child(1) { transform: rotate(-28deg) translateX(-200px) translateY(-5px); }
    .card-fan:hover .char-avatar:nth-child(2) { transform: rotate(-21deg) translateX(-150px) translateY(-5px); }
    .card-fan:hover .char-avatar:nth-child(3) { transform: rotate(-14deg) translateX(-100px) translateY(-5px); }
    .card-fan:hover .char-avatar:nth-child(4) { transform: rotate(-7deg) translateX(-50px) translateY(-5px); }
    .card-fan:hover .char-avatar:nth-child(5) { transform: rotate(0deg) translateX(0px) translateY(-5px); }
    .card-fan:hover .char-avatar:nth-child(6) { transform: rotate(7deg) translateX(50px) translateY(-5px); }
    .card-fan:hover .char-avatar:nth-child(7) { transform: rotate(14deg) translateX(100px) translateY(-5px); }
    .card-fan:hover .char-avatar:nth-child(8) { transform: rotate(21deg) translateX(150px) translateY(-5px); }
    .card-fan:hover .char-avatar:nth-child(9) { transform: rotate(28deg) translateX(200px) translateY(-5px); }
}

/* Tablet */
@media (max-width: 1024px) {
    .battle-layout {
        flex-direction: column;
    }
    
    .battle-sidebar {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        position: static;
    }
    
    .activity-feed,
    .battle-sidebar .rewards-panel {
        flex: 1;
        min-width: 280px;
    }
}

@media (max-width: 900px) {
    .steps {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .character-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* Card Fan - Mobile */
@media (max-width: 768px) {
    .card-fan {
        height: 200px;
    }
    
    .card-fan .char-avatar {
        width: 70px;
        height: 100px;
    }
    
    .card-fan .char-avatar:nth-child(1) { transform: rotate(-20deg) translateX(-110px); }
    .card-fan .char-avatar:nth-child(2) { transform: rotate(-15deg) translateX(-82px); }
    .card-fan .char-avatar:nth-child(3) { transform: rotate(-10deg) translateX(-55px); }
    .card-fan .char-avatar:nth-child(4) { transform: rotate(-5deg) translateX(-27px); }
    .card-fan .char-avatar:nth-child(5) { transform: rotate(0deg) translateX(0px); }
    .card-fan .char-avatar:nth-child(6) { transform: rotate(5deg) translateX(27px); }
    .card-fan .char-avatar:nth-child(7) { transform: rotate(10deg) translateX(55px); }
    .card-fan .char-avatar:nth-child(8) { transform: rotate(15deg) translateX(82px); }
    .card-fan .char-avatar:nth-child(9) { transform: rotate(20deg) translateX(110px); }
    
    .card-fan .char-avatar::after {
        font-size: 0.4rem;
        padding: 4px 8px;
    }

    /* Mobile nav overlay */
    .nav-links {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(10, 10, 15, 0.98);
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 28px;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        padding: 2rem;
        z-index: 1000;
    }

    .nav-links.active {
        opacity: 1;
        visibility: visible;
    }

    .nav-links a {
        display: block;
        font-size: 1.3rem;
        padding: 10px 20px;
        color: var(--text);
    }

    .nav-links .btn-wallet {
        width: 100%;
        max-width: 240px;
        justify-content: center;
        padding: 14px 24px;
        font-size: 0.9rem;
    }

    .nav-links .btn-primary {
        width: 100%;
        max-width: 240px;
        text-align: center;
        padding: 14px 24px;
        display: block;
    }

    .nav-links .music-btn {
        width: 55px;
        height: 55px;
        font-size: 1.4rem;
    }

    .hamburger {
        display: flex;
    }

    nav {
        padding: 12px 16px;
    }

    .logo-img {
        width: 45px;
        height: 45px;
    }

    .logo-text {
        font-size: 0.75rem;
    }

    /* Hero */
    .hero {
        padding: 90px 20px 50px;
    }

    .hero-title {
        font-size: clamp(1.2rem, 5vw, 1.8rem);
    }

    .hero-subtitle {
        font-size: 0.95rem;
        padding: 0 10px;
    }

    .character-preview .char-avatar {
        width: 60px;
    }
    
    .character-preview .char-avatar img {
        height: 80px;
    }

    .ca-container {
        padding: 10px 14px;
        font-size: 0.7rem;
    }

    .ca-address {
        max-width: 120px;
    }

    .cta-buttons {
        flex-direction: column;
        width: 100%;
        max-width: 280px;
    }

    .cta-buttons .btn {
        width: 100%;
    }

    /* Game Section */
    .game-section {
        padding: 40px 16px;
    }

    .section-title {
        font-size: 1rem;
        margin-bottom: 24px;
    }

    .battle-arena {
        height: 360px;
    }

    .sprite-player-back {
        width: 200px;
        height: 200px;
        left: -15px;
        bottom: -25px;
    }

    .sprite-enemy {
        width: 130px;
        height: 130px;
        right: 5%;
        bottom: 70px;
    }

    .hp-box {
        min-width: 120px;
        padding: 8px 10px;
    }

    .hp-box .pokemon-name {
        font-size: 0.7rem;
    }

    .hp-box .level {
        font-size: 0.55rem;
        padding: 2px 5px;
    }

    .hp-box.player {
        bottom: 10px;
        right: 10px;
    }

    .hp-box.enemy {
        top: 10px;
        left: 10px;
    }

    .hp-text {
        font-size: 0.6rem;
    }

    .turn-indicator {
        font-size: 0.5rem;
        padding: 6px 14px;
    }

    .battle-menu {
        grid-template-columns: 1fr;
    }

    .battle-log {
        border-right: none;
        border-bottom: 1px solid rgba(42, 42, 58, 0.8);
        max-height: 80px;
        min-height: 80px;
    }

    .log-entry {
        font-size: 0.6rem;
    }

    .move-grid {
        gap: 6px;
        padding: 10px;
    }

    .move-btn {
        padding: 10px;
    }

    /* Battle Sidebar Mobile */
    .battle-sidebar {
        flex-direction: column;
    }
    
    .activity-feed,
    .battle-sidebar .rewards-panel {
        width: 100%;
    }
    
    .feed-list {
        max-height: 150px;
    }

    /* Mechanics */
    .mechanics-grid {
        grid-template-columns: 1fr;
    }
    
    .tips-grid {
        grid-template-columns: 1fr;
    }
    
    .type-row {
        font-size: 0.65rem;
    }
    
    .mechanic-card {
        padding: 20px 16px;
    }
    
    .mechanic-icon {
        font-size: 2rem;
    }
    
    .mechanic-card h3 {
        font-size: 0.8rem;
    }

    /* How It Works */
    .how-it-works {
        padding: 60px 20px;
    }

    .steps {
        grid-template-columns: 1fr;
        gap: 20px;
        max-width: 400px;
        margin: 0 auto;
    }

    .step {
        padding: 30px 24px;
    }

    .step-icon {
        font-size: 2.5rem;
        margin-bottom: 16px;
    }

    .step-title {
        font-size: 1rem;
    }

    .step-desc {
        font-size: 0.9rem;
    }

    /* Footer */
    footer {
        padding: 24px 16px;
    }

    .social-links {
        flex-direction: column;
        gap: 12px;
        width: 100%;
        max-width: 280px;
    }

    .social-links a {
        width: 100%;
        text-align: center;
        padding: 14px 20px;
    }

    /* Modals */
    .modal-content {
        padding: 20px 16px;
        max-height: 85vh;
        margin: 10px;
    }

    .modal-title {
        font-size: 0.85rem;
        margin-bottom: 20px;
    }

    .character-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }

    .char-card {
        padding: 14px 10px;
    }

    .char-card img {
        width: 70px;
        height: 70px;
    }

    .char-card .name {
        font-size: 0.55rem;
    }

    .char-card .type-badge {
        font-size: 0.5rem;
        padding: 2px 8px;
    }

    .char-card .role {
        font-size: 0.55rem;
    }

    .char-card .description {
        font-size: 0.55rem;
        min-height: 28px;
        margin-bottom: 8px;
    }

    .char-card .stats {
        gap: 4px;
    }

    .char-card .stat {
        padding: 3px 5px;
        font-size: 0.5rem;
    }

    .modal-actions {
        flex-direction: column;
        gap: 10px;
    }

    .modal-actions .btn {
        width: 100%;
    }

    /* Wallet Modal */
    .wallet-modal-content {
        padding: 24px 20px;
        margin: 16px;
    }

    .wallet-modal-title {
        font-size: 0.75rem;
    }

    .wallet-option {
        padding: 12px;
    }

    .wallet-option img {
        width: 32px;
        height: 32px;
    }

    .wallet-option-name {
        font-size: 0.9rem;
    }

    .wallet-option-desc {
        font-size: 0.7rem;
    }

    /* Battle result */
    .battle-result {
        padding: 24px 20px;
        width: 90%;
    }

    .result-title {
        font-size: 1.1rem;
    }

    .result-subtitle {
        font-size: 0.85rem;
    }

    /* Floating elements - reduce on mobile */
    .floating-pill {
        width: 35px;
        height: 35px;
    }

    .orb {
        filter: blur(60px);
        opacity: 0.3;
    }
    
    /* Pay Modal Mobile */
    .pay-modal-content {
        padding: 28px 20px;
        margin: 20px;
        border-radius: 20px;
    }
    
    .pay-icon {
        font-size: 3rem;
    }
    
    .pay-title {
        font-size: 1rem;
    }
    
    .pay-desc {
        font-size: 0.85rem;
    }
    
    .fee-display {
        padding: 20px;
    }
    
    .fee-value {
        font-size: 2rem;
    }
    
    .fee-currency {
        font-size: 0.9rem;
    }
    
    #pay-btn {
        padding: 16px 24px;
        font-size: 0.8rem;
    }
    
    .pay-reward-item {
        font-size: 0.8rem;
        padding: 10px 12px;
    }
    
    .reward-icon {
        font-size: 1.1rem;
    }
}

/* Card Fan - Small Mobile */
@media (max-width: 480px) {
    .card-fan {
        height: 160px;
    }
    
    .card-fan .char-avatar {
        width: 55px;
        height: 80px;
    }
    
    .card-fan .char-avatar:nth-child(1) { transform: rotate(-20deg) translateX(-85px); }
    .card-fan .char-avatar:nth-child(2) { transform: rotate(-15deg) translateX(-63px); }
    .card-fan .char-avatar:nth-child(3) { transform: rotate(-10deg) translateX(-42px); }
    .card-fan .char-avatar:nth-child(4) { transform: rotate(-5deg) translateX(-21px); }
    .card-fan .char-avatar:nth-child(5) { transform: rotate(0deg) translateX(0px); }
    .card-fan .char-avatar:nth-child(6) { transform: rotate(5deg) translateX(21px); }
    .card-fan .char-avatar:nth-child(7) { transform: rotate(10deg) translateX(42px); }
    .card-fan .char-avatar:nth-child(8) { transform: rotate(15deg) translateX(63px); }
    .card-fan .char-avatar:nth-child(9) { transform: rotate(20deg) translateX(85px); }
    
    .biome-grid {
        grid-template-columns: 1fr;
        max-width: 280px;
    }
    
    .results-actions {
        flex-direction: column;
        width: 100%;
        max-width: 250px;
    }
    
    .results-actions .btn {
        width: 100%;
    }
    
    /* Pay Modal Small Mobile */
    .pay-modal-content {
        padding: 24px 16px;
        margin: 10px;
    }
    
    .pay-title {
        font-size: 0.9rem;
    }
    
    .fee-value {
        font-size: 1.8rem;
    }
    
    #pay-btn {
        padding: 14px 20px;
        font-size: 0.75rem;
    }
}

@media (max-width: 380px) {
    nav {
        padding: 10px 12px;
    }

    .logo-text {
        font-size: 0.6rem;
    }

    .logo-img {
        width: 38px;
        height: 38px;
    }

    .nav-links a {
        font-size: 1.1rem;
    }

    .hero-title {
        font-size: 1rem;
    }

    .hero-subtitle {
        font-size: 0.85rem;
    }

    .character-preview .char-avatar {
        width: 50px;
    }
    
    .character-preview .char-avatar img {
        height: 70px;
    }

    .battle-arena {
        height: 320px;
    }

    .sprite-player-back {
        width: 160px;
        height: 160px;
        left: -10px;
        bottom: -20px;
    }

    .sprite-enemy {
        width: 100px;
        height: 100px;
        bottom: 60px;
    }

    .hp-box {
        min-width: 100px;
        padding: 6px 8px;
    }

    .hp-box .pokemon-name {
        font-size: 0.6rem;
    }

    .character-grid {
        grid-template-columns: 1fr;
        max-width: 200px;
        margin: 0 auto 20px;
    }

    .char-card img {
        width: 80px;
        height: 80px;
    }
}
</style>
</head>
<body>
    <!-- Pokemon Style Animated Background -->
    <div class="bg-animation">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="orb orb-4"></div>
        <div class="orb orb-5"></div>
        
        <div class="grid-pattern"></div>
        
        <div class="pixel-stars">
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star large"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star large"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star large"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
            <div class="star medium"></div>
            <div class="star small"></div>
        </div>
        
        <div class="pokeball-particles">
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
            <div class="pokeball"></div>
        </div>
        
        <div class="sparkles">
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
        </div>
        
        <div class="type-symbols">
            <div class="type-symbol">ðŸ”¥</div>
            <div class="type-symbol">ðŸ’§</div>
            <div class="type-symbol">âš¡</div>
            <div class="type-symbol">ðŸƒ</div>
            <div class="type-symbol">ðŸ’œ</div>
            <div class="type-symbol">ðŸ”¥</div>
            <div class="type-symbol">ðŸ’§</div>
            <div class="type-symbol">âš¡</div>
            <div class="type-symbol">ðŸƒ</div>
            <div class="type-symbol">ðŸ’œ</div>
        </div>
        
        <div class="energy-wave"></div>
        <div class="crt-glow"></div>
        <div class="battle-border"></div>
    </div>
    
    <div class="scanlines"></div>

    <!-- Floating Character Pills -->
    <div class="floating-pills">
        <div class="floating-pill"><img src="assets/images/characters/pepe.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/whale.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/cow.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/moodeng.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/catana.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/pepe.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/whale.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/cow.png" alt="" onerror="this.parentElement.style.display='none'"></div>
        <div class="floating-pill"><img src="assets/images/characters/moodeng.png" alt="" onerror="this.parentElement.style.display='none'"></div>
    </div>

    <!-- Navigation -->
    <nav>
        <div class="logo">
            <img src="assets/images/logo.png" alt="PumpFighters Logo" class="logo-img" onerror="this.style.display='none'">
            <span class="logo-text">$PUMPPALS</span>
        </div>
        
        <!-- Hamburger Menu Button -->
        <button class="hamburger" id="hamburger" onclick="toggleMobileMenu()" aria-label="Menu">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
        
        <div class="nav-links" id="nav-links">
            <!-- Add this where you want to show the token balance -->

            <a href="#game">Play</a>
            <a href="#how">How It Works</a>
            <button class="music-btn" id="music-btn" onclick="toggleMusic()">ðŸŽµ</button>
            <button class="btn btn-wallet" id="wallet-btn" onclick="connectWallet()">
                <svg class="solana-logo" width="18" height="18" viewBox="0 0 397.7 311.7" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M64.6 237.9c2.4-2.4 5.7-3.8 9.2-3.8h317.4c5.8 0 8.7 7 4.6 11.1l-62.7 62.7c-2.4 2.4-5.7 3.8-9.2 3.8H6.5c-5.8 0-8.7-7-4.6-11.1l62.7-62.7z" fill="#00FFA3"/>
                    <path d="M64.6 3.8C67.1 1.4 70.4 0 73.8 0h317.4c5.8 0 8.7 7 4.6 11.1l-62.7 62.7c-2.4 2.4-5.7 3.8-9.2 3.8H6.5c-5.8 0-8.7-7-4.6-11.1L64.6 3.8z" fill="#00FFA3"/>
                    <path d="M333.1 120.1c-2.4-2.4-5.7-3.8-9.2-3.8H6.5c-5.8 0-8.7 7-4.6 11.1l62.7 62.7c2.4 2.4 5.7 3.8 9.2 3.8h317.4c5.8 0 8.7-7 4.6-11.1l-62.7-62.7z" fill="#00FFA3"/>
                </svg>
                <span id="wallet-text">Connect Wallet</span>
            </button>
            <a href="#" class="btn btn-primary">Buy $PALS</a>
            <div id="token-balance-display" class="token-balance-display" style="display: none;">
    ðŸ’Ž $PALS: <span id="pumpmon-balance">0</span>
</div>
        </div>
    </nav>

    <!-- Hero -->
    <section class="hero">
        <h1 class="hero-title">
            Battle Memecoins.<br>
            <span class="highlight">Win $PALS.</span>
        </h1>
        
        <p class="hero-subtitle">
            Choose your favorite memecoin character and battle in Pokemon-style combat. 
            Every victory earns you $PALS tokens.
        </p>
<div class="card-fan">
    <div class="char-avatar" data-name="copperinu" onclick="selectAndPlay('copperinu')">
        <img src="assets/images/characters/copperinucard.png" alt="CopperInu">
    </div>
    <div class="char-avatar" data-name="MOLTY" onclick="selectAndPlay('molty')">
        <img src="assets/images/characters/labstercard.png" alt="MOLTY">
    </div>
    <div class="char-avatar" data-name="PEPE" onclick="selectAndPlay('pepe')">
        <img src="assets/images/characters/pepecard.png" alt="PEPE">
    </div>
    <div class="char-avatar" data-name="DICKLET" onclick="selectAndPlay('dicklet')">
        <img src="assets/images/characters/dickletcard.png" alt="DICKLET">
    </div>
    <div class="char-avatar" data-name="WHALE" onclick="selectAndPlay('whale')">
        <img src="assets/images/characters/whalecard.png" alt="WHALE">
    </div>
    <div class="char-avatar" data-name="COW" onclick="selectAndPlay('cow')">
        <img src="assets/images/characters/cowcard.png" alt="COW">
    </div>
    <div class="char-avatar" data-name="MOODENG" onclick="selectAndPlay('moodeng')">
        <img src="assets/images/characters/moodengcard.png" alt="MOODENG">
    </div>
    <div class="char-avatar" data-name="PENGUIN" onclick="selectAndPlay('penguin')">
        <img src="assets/images/characters/panguincard.png" alt="PENGUIN">
    </div>
    <div class="char-avatar" data-name="CATANA" onclick="selectAndPlay('catana')">
        <img src="assets/images/characters/catanacard.png" alt="CATANA">
    </div>
</div>

        <div class="cta-buttons">
            <button class="btn btn-secondary" onclick="scrollToGame()">âš”ï¸ Quick Battle</button>
        </div>
        
        <div class="ca-container">
            <span class="ca-label">CA:</span>
            <span class="ca-address" id="ca-address"></span>
            <button class="ca-copy" onclick="copyCA()">ðŸ“‹</button>
        </div>
    </section>

    <!-- Game Section -->
<div class="game-wrapper">
        <!-- Game Mechanics Section -->
<section class="mechanics-section" id="how-to-play">
    <div class="mechanics-container">
        <h2 class="section-title">ðŸ“– How To <span class="highlight">Play</span></h2>
        
        <div class="mechanics-grid">
            <!-- Basic Rules -->
            <div class="mechanic-card">
                <div class="mechanic-icon">âš”ï¸</div>
                <h3>Battle System</h3>
                <ul>
                    <li>Choose your fighter and battle wild enemies</li>
                    <li>Select moves to attack, heal, or boost stats</li>
                    <li>Reduce enemy HP to 0 to win</li>
                    <li>Faster PokÃ©mon moves first each turn</li>
                </ul>
            </div>
            
            <!-- Type Advantages -->
            <div class="mechanic-card">
                <div class="mechanic-icon">ðŸ”¥</div>
                <h3>Type Advantages</h3>
                <div class="type-chart-mini">
                    <div class="type-row"><span class="type-badge water">WATER</span> â†’ beats â†’ <span class="type-badge fire">FIRE</span> <span class="type-badge rock">ROCK</span></div>
                    <div class="type-row"><span class="type-badge fire">FIRE</span> â†’ beats â†’ <span class="type-badge grass">GRASS</span> <span class="type-badge ice">ICE</span></div>
                    <div class="type-row"><span class="type-badge grass">GRASS</span> â†’ beats â†’ <span class="type-badge water">WATER</span> <span class="type-badge rock">ROCK</span></div>
                    <div class="type-row"><span class="type-badge electric">ELECTRIC</span> â†’ beats â†’ <span class="type-badge water">WATER</span></div>
                    <div class="type-row"><span class="type-badge ice">ICE</span> â†’ beats â†’ <span class="type-badge grass">GRASS</span></div>
                    <div class="type-row"><span class="type-badge psychic">PSYCHIC</span> â†’ beats â†’ <span class="type-badge dark">DARK</span> is immune!</div>
                </div>
            </div>
            
            <!-- Rewards -->
            <div class="mechanic-card">
                <div class="mechanic-icon">ðŸ’°</div>
                <h3>Earn $PALS</h3>
                <ul>
                    <li><span class="highlight">+100 $PALS</span> per win</li>
                    <li><span class="highlight">x2 bonus</span> for beating shiny enemies âœ¨</li>
                    <li><span class="highlight">x1.5 bonus</span> for 5+ win streak ðŸ”¥</li>
                    <li>Connect wallet to track rewards</li>
                    <li>Claim tokens anytime!</li>
                </ul>
            </div>
            
            <!-- Difficulty & Penalties -->
            <div class="mechanic-card warning">
                <div class="mechanic-icon">âš ï¸</div>
                <h3>Risk & Difficulty</h3>
                <ul>
                    <li><span class="danger">-10% tokens</span> when you lose!</li>
                    <li>Enemies get <span class="danger">stronger</span> as you win more</li>
                    <li>Enemy AI targets your weaknesses</li>
                    <li>Win streak resets on loss</li>
                    <li>Choose battles wisely!</li>
                </ul>
            </div>
        </div>
        
        <!-- Quick Tips -->
        <div class="tips-box">
            <h4>ðŸ’¡ Pro Tips</h4>
            <div class="tips-grid">
                <div class="tip">ðŸŽ¯ Use super effective moves for 2x damage</div>
                <div class="tip">ðŸ›¡ï¸ Tanks survive longer but deal less damage</div>
                <div class="tip">âš¡ Speedsters attack first - great for finishing enemies</div>
                <div class="tip">âœ¨ Shiny enemies are rare - worth double rewards!</div>
            </div>
        </div>
        
        <!-- Start Button -->
        <div class="start-battle-cta">
            <p>Ready to earn $PALS?</p>
            <a href="#game" class="btn btn-primary btn-large">âš”ï¸ Start Battle</a>
        </div>
    </div>
</section>
<div class="character-select-section" id="character-select">
    <h3 class="select-title">âš”ï¸ Choose Your Fighter</h3>
    <p class="select-subtitle">Select a character to enter battle</p>
    
    <div class="select-card-fan">
        <div class="select-card" data-char="copperinu" data-type="Steel">
            <img src="assets/images/characters/copperinucard.png" alt="Copper Inu">
            <span class="card-name">Copper Inu</span>
        </div>
        <div class="select-card" data-char="molty" data-type="Water">
            <img src="assets/images/characters/labstercard.png" alt="Molty">
            <span class="card-name">Molty</span>
        </div>
        <div class="select-card" data-char="pepe" data-type="Grass">
            <img src="assets/images/characters/pepecard.png" alt="Pepe">
            <span class="card-name">Pepe</span>
        </div>
        <div class="select-card" data-char="dicklet" data-type="Normal">
            <img src="assets/images/characters/dickletcard.png" alt="Dicklet">
            <span class="card-name">Dicklet</span>
        </div>
        <div class="select-card" data-char="whale" data-type="Water">
            <img src="assets/images/characters/whalecard.png" alt="Whale">
            <span class="card-name">Whale</span>
        </div>
        <div class="select-card" data-char="cow" data-type="Normal">
            <img src="assets/images/characters/cowcard.png" alt="Cow">
            <span class="card-name">Cow</span>
        </div>
        <div class="select-card" data-char="moodeng" data-type="Normal">
            <img src="assets/images/characters/moodengcard.png" alt="Moodeng">
            <span class="card-name">Moodeng</span>
        </div>
        <div class="select-card" data-char="penguin" data-type="Ice">
            <img src="assets/images/characters/panguincard.png" alt="Penguin">
            <span class="card-name">Penguin</span>
        </div>
        <div class="select-card" data-char="catana" data-type="Dark">
            <img src="assets/images/characters/catanacard.png" alt="Catana">
            <span class="card-name">Catana</span>
        </div>
    </div>
    
    <button class="btn btn-primary btn-confirm-select" id="confirm-character" disabled>
        ðŸŽ® Confirm Selection
    </button>
</div>
<!-- Pay to Play Modal -->
<div id="pay-modal">
    <div class="pay-modal-content horizontal">
        <!-- Left Side - Info -->
        <div class="pay-left">
            <span class="pay-icon">ðŸŽ®</span>
            <h2 class="pay-title">Ready to Battle?</h2>
            <div class="fee-display">
                <div class="fee-amount">
                    <span class="fee-value">0.001</span>
                    <span class="fee-currency">SOL</span>
                </div>
                <div class="fee-label">Entry Fee</div>
            </div>
        </div>
        
        <!-- Right Side - Rewards & Button -->
        <div class="pay-right">
            <div class="pay-rewards">
                <div class="pay-reward-item">
                    <span class="reward-icon">ðŸ†</span>
                    <span>Win battles to earn $PALS</span>
                </div>
                <div class="pay-reward-item">
                    <span class="reward-icon">ðŸ”¥</span>
                    <span>Build win streaks for bonuses</span>
                </div>
                <div class="pay-reward-item">
                    <span class="reward-icon">âœ¨</span>
                    <span>Encounter shiny characters</span>
                </div>
            </div>
            
            <button id="pay-btn" onclick="payEntryFee()">
                <span class="pay-btn-text">Pay & Play</span>
                <span class="pay-btn-loading">
                    <span class="spinner"></span> Processing...
                </span>
            </button>
            
            <p class="pay-note">
                <span id="wallet-status">Wallet not connected</span>
            </p>
            
            <button class="pay-close-btn" onclick="closePayModal()">Maybe Later</button>
        </div>
    </div>
</div>
<div class="game-wrapper">
    <section class="game-section" id="game">
        <h2 class="section-title">âš”ï¸ Battle <span class="highlight">Arena</span></h2>
        <!-- New Layout Container -->
        <div class="battle-layout">
    <!-- PAY TO PLAY OVERLAY - Blocks the game -->
    <div class="pay-overlay" id="pay-overlay">
        <div class="pay-overlay-content">
            <span class="pay-overlay-icon">ðŸŽ®</span>
            <h3 class="pay-overlay-title">Pay to Play</h3>
            
            <div class="pay-overlay-fee">
                <span class="pay-fee-value">1000</span>
                <span class="pay-fee-currency">$PALS</span>
            </div>
            
            <div class="pay-overlay-rewards">
                <span>ðŸ† Earn $PALS</span>
                <span>ðŸ”¥ Win Streaks</span>
                <span>âœ¨ Shiny Encounters</span>
            </div>
            
            <button class="pay-overlay-btn" id="pay-overlay-btn" onclick="payEntryFee()">
                <span class="pay-btn-text">ðŸ’° Pay & Play</span>
                <span class="pay-btn-loading">
                    <span class="spinner"></span> Processing...
                </span>
            </button>
            
            <p class="pay-overlay-note">
                <span id="wallet-status">Wallet not connected</span>
            </p>
        </div>
    </div>
    
    <!-- Left Side: Battle Arena -->
    <div class="battle-main">
        <div class="battle-arena" id="battle-arena">
            <!-- Your existing battle arena content -->
            <div class="sun"></div>
            <div class="turn-indicator" id="turn-indicator">YOUR TURN</div>

            <div class="hp-box enemy">
                <div class="hp-header">
                    <span class="pokemon-name" id="enemy-name">WHALE</span>
                    <span class="level">Lv<span id="enemy-level">48</span></span>
                </div>
                <div class="hp-bar-outer">
                    <div class="hp-bar-inner" id="enemy-hp-bar" style="width: 100%"></div>
                </div>
                <div class="status-container" id="enemy-status"></div>
            </div>

            <div class="hp-box player">
                <div class="hp-header">
                    <span class="pokemon-name" id="player-name">PEPE</span>
                    <span class="level">Lv<span id="player-level">50</span></span>
                </div>
                <div class="hp-bar-outer">
                    <div class="hp-bar-inner" id="player-hp-bar" style="width: 100%"></div>
                </div>
                <div class="hp-text"><span id="player-hp">100</span>/<span id="player-max-hp">100</span></div>
                <div class="status-container" id="player-status"></div>
            </div>

            <div class="sprite-player" id="player-sprite">
                <img id="player-img" src="assets/images/characters/pepe.png" alt="Player">
            </div>

            <div class="sprite-player-back" id="player-sprite-back">
                <img id="player-img-back" src="assets/images/characters/peng-back.png" alt="Player Back">
            </div>

            <div class="sprite-enemy" id="enemy-sprite">
                <img id="enemy-img" src="assets/images/characters/whale.png" alt="Enemy">
            </div>

            <div class="battle-intro" id="battle-intro">
                <div class="intro-text" id="intro-text">A wild WHALE appeared!</div>
            </div>

            <div class="battle-result" id="battle-result">
                <div class="result-title" id="result-title">VICTORY!</div>
                <div class="result-subtitle" id="result-subtitle">You earned 500 $PALS!</div>
                <button class="btn btn-primary" onclick="resetBattle()">Battle Again</button>
            </div>
        </div>

        <div class="battle-menu">
            <div class="battle-log" id="battle-log">
                <div class="log-entry system">Choose a move to attack!</div>
            </div>
            <div class="move-grid" id="move-grid">
                <!-- Moves will be inserted here -->
            </div>
        </div>
    </div>
    
    <!-- Right Side: Activity Feed & Rewards -->
    <div class="battle-sidebar">
        <!-- Your existing sidebar content -->
        <div class="activity-feed" id="activity-feed">
            <div class="feed-header">
                <span>ðŸ“¢ Live Activity</span>
                <span class="live-badge">â— LIVE</span>
            </div>
            <div class="feed-list" id="feed-list">
                <div class="feed-item win">
                    <span class="feed-icon">ðŸŽ®</span>
                    <span class="feed-text">Waiting for battles...</span>
                    <span class="feed-time">Now</span>
                </div>
            </div>
        </div>
        
        <div class="rewards-panel" id="rewards-panel">
            <div class="rewards-header">
                <span>ðŸ’° Your Rewards</span>
            </div>
            <div class="rewards-stats">
                <div class="reward-stat">
                    <span class="reward-label">Wins</span>
                    <span class="reward-value" id="total-wins">0</span>
                </div>
                <div class="reward-stat">
                    <span class="reward-label">Losses</span>
                    <span class="reward-value" id="total-losses">0</span>
                </div>
                <div class="reward-stat">
                    <span class="reward-label">Streak</span>
                    <span class="reward-value" id="win-streak">0</span>
                </div>
                <div class="reward-stat">
                    <span class="reward-label">Win Rate</span>
                    <span class="reward-value" id="win-rate">0%</span>
                </div>
            </div>
            <div class="claimable-box">
                <span class="claimable-label">Claimable</span>
                <span class="claimable-amount" id="claimable-tokens">0</span>
                <span class="claimable-currency">$PALS</span>
            </div>
            <button class="btn btn-primary claim-btn" id="claim-btn" onclick="RewardSystem.claim()">
                ðŸ’° Claim $PALS
            </button>
            <div class="total-earned">
                Total earned: <span id="total-earned">0</span> $PALS
            </div>
        </div>
    </div>
    
</div>
    </section>
</div>

    <!-- How It Works -->
    <section class="how-it-works" id="how">
        <div class="how-container">
            <h2 class="section-title">How It <span class="highlight">Works</span></h2>
            
            <div class="steps">
                <div class="step">
                    <span class="step-icon">ðŸŽ®</span>
                    <h3 class="step-title">1. Choose Your Fighter</h3>
                    <p class="step-desc">Pick from 6 iconic memecoin characters, each with unique stats and moves.</p>
                </div>
                <div class="step">
                    <span class="step-icon">âš”ï¸</span>
                    <h3 class="step-title">2. Battle Opponents</h3>
                    <p class="step-desc">Fight in turn-based Pokemon-style combat. Use strategy to defeat enemies.</p>
                </div>
                <div class="step">
                    <span class="step-icon">ðŸ’°</span>
                    <h3 class="step-title">3. Earn $PALS</h3>
                    <p class="step-desc">Win battles to earn $PALS tokens. The more you win, the more you earn.</p>
                </div>
            </div>
        </div>
    </section>

<!-- Admin Panel -->
<section id="admin-panel" style="display: none; padding: 40px 20px; background: rgba(0,0,0,0.95); position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 99999; overflow-y: auto;">
    <div style="max-width: 1000px; margin: 0 auto;">
        <h2 style="color: #ffd93d; font-family: 'Press Start 2P', cursive; text-align: center; margin-bottom: 20px;">ðŸ” ADMIN PANEL</h2>
        
        <div style="display: flex; justify-content: center; gap: 40px; margin-bottom: 20px; flex-wrap: wrap;">
            <div style="text-align: center;">
                <div style="color: #888; font-size: 12px;">PLAYERS</div>
                <div id="admin-total-players" style="color: #fff; font-size: 24px; font-weight: bold;">0</div>
            </div>
            <div style="text-align: center;">
                <div style="color: #888; font-size: 12px;">TOTAL CLAIMABLE</div>
                <div id="admin-total-claimable" style="color: #ffd93d; font-size: 24px; font-weight: bold;">0</div>
            </div>
            <div style="text-align: center;">
                <div style="color: #888; font-size: 12px;">UNPAID</div>
                <div id="admin-unpaid-count" style="color: #ef4444; font-size: 24px; font-weight: bold;">0</div>
            </div>
        </div>
        
        <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;">
            <button onclick="AdminPanel.refresh()" style="padding: 10px 20px; background: #333; color: #fff; border: none; border-radius: 8px; cursor: pointer;">ðŸ”„ Refresh</button>
            <button onclick="AdminPanel.copyAllUnpaid()" style="padding: 10px 20px; background: #333; color: #fff; border: none; border-radius: 8px; cursor: pointer;">ðŸ“‹ Copy Unpaid</button>
            <button onclick="AdminPanel.exportCSV()" style="padding: 10px 20px; background: #ffd93d; color: #000; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">ðŸ“¥ Export CSV</button>
        </div>
        
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; background: rgba(26,26,46,0.9); border-radius: 8px; overflow: hidden;">
                <thead>
                    <tr style="background: rgba(0,0,0,0.5);">
                        <th style="padding: 12px; text-align: left; color: #ffd93d; font-size: 12px;">#</th>
                        <th style="padding: 12px; text-align: left; color: #ffd93d; font-size: 12px;">WALLET</th>
                        <th style="padding: 12px; text-align: left; color: #ffd93d; font-size: 12px;">WINS</th>
                        <th style="padding: 12px; text-align: left; color: #ffd93d; font-size: 12px;">CLAIMABLE</th>
                        <th style="padding: 12px; text-align: left; color: #ffd93d; font-size: 12px;">TOTAL</th>
                        <th style="padding: 12px; text-align: left; color: #ffd93d; font-size: 12px;">LAST PLAYED</th>
                        <th style="padding: 12px; text-align: left; color: #ffd93d; font-size: 12px;">STATUS</th>
                    </tr>
                </thead>
                <tbody id="admin-tbody">
                    <tr><td colspan="7" style="padding: 20px; text-align: center; color: #888;">Loading...</td></tr>
                </tbody>
            </table>
        </div>
        
        <button onclick="AdminPanel.toggle()" style="margin-top: 20px; padding: 12px 24px; background: #ef4444; color: #fff; border: none; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold;">âœ• CLOSE ADMIN PANEL</button>
    </div>
</section>
        <!-- Safari Zone Section -->
<!-- Safari Zone Section -->
<section class="safari-zone" id="safari">
    <div class="safari-container">
        <h2 class="section-title">ðŸŒ´ Enter the <span class="highlight">Safari Zone</span></h2>
        <div class="safari-card">
            <span class="demo-badge">ðŸŽ® DEMO</span>
            <div class="safari-icon">ðŸŽŸï¸</div>
            <div class="safari-info">
                <div class="safari-tokens">1000 <span class="highlight">$PALS</span></div>
                <div class="safari-equals">=</div>
                <div class="safari-reward">1 Entry Ticket</div>
            </div>
            <p class="safari-desc">Explore biomes, encounter rare creatures, and catch them Safari-style!</p>
            <div class="ticket-display">
                ðŸŽŸï¸ Your Tickets: <span class="count" id="ticket-count">1</span>
            </div>
            <button class="btn btn-primary" onclick="openSafari()">ðŸŒ¿ Enter Safari Zone</button>
        </div>
    </div>
</section>

<!-- Safari Zone Game Modal -->
<div class="safari-modal" id="safari-modal">
    <div class="safari-game-container">
        <!-- Header -->
        <div class="safari-header">
            <div class="safari-header-left">
                <span class="safari-biome-name" id="safari-biome-name">ðŸŒ¿ Jungle Zone</span>
            </div>
            <div class="safari-header-right">
                <span class="safari-actions-left">âš¡ <span id="actions-left">10</span> Actions</span>
                <button class="safari-exit-btn" onclick="exitSafari()">âœ• Exit</button>
            </div>
        </div>

        <!-- Main Game Area -->
        <div class="safari-game-area" id="safari-game-area">
            <!-- Biome Selection Screen -->
            <div class="safari-screen" id="biome-select-screen">
                <h3 class="safari-screen-title">Choose Your Biome</h3>
                <div class="biome-grid" id="biome-grid">
                    <!-- Biomes inserted via JS -->
                </div>
            </div>

            <!-- Exploration Screen -->
            <div class="safari-screen hidden" id="explore-screen">
                <div class="safari-environment" id="safari-environment">
                    <div class="safari-grass"></div>
                    <div class="safari-grass"></div>
                    <div class="safari-grass"></div>
                </div>
                <div class="safari-message" id="safari-message">You entered the Safari Zone!</div>
                <button class="btn btn-primary safari-explore-btn" id="explore-btn" onclick="SafariGame.explore()">
                    ðŸ” Explore
                </button>
            </div>


<!-- Encounter Screen -->
<div class="safari-screen hidden" id="encounter-screen">
    <div class="encounter-scene">
        <div class="creature-info-overlay">
            <span class="creature-name" id="encounter-creature-name">???</span>
            <span class="creature-rarity" id="encounter-creature-rarity">Common</span>
            <div class="creature-status" id="creature-status"></div>
        </div>
        <div class="encounter-creature" id="encounter-creature">
            <img id="encounter-creature-img" src="" alt="Wild Creature">
        </div>
    </div>
    
    <div class="encounter-ui-panel">
        <div class="encounter-log" id="encounter-log"></div>
        <div class="encounter-actions">
            <button class="encounter-btn capsule" onclick="SafariGame.throwCapsule()">
                <span class="encounter-btn-icon">ðŸ”´</span>
                <span class="encounter-btn-label">Capsule</span>
                <span class="encounter-btn-count" id="capsule-count">5</span>
            </button>
            <button class="encounter-btn bait" onclick="SafariGame.throwBait()">
                <span class="encounter-btn-icon">ðŸ–</span>
                <span class="encounter-btn-label">Bait</span>
                <span class="encounter-btn-count" id="bait-count">3</span>
            </button>
            <button class="encounter-btn rock" onclick="SafariGame.throwRock()">
                <span class="encounter-btn-icon">ðŸª¨</span>
                <span class="encounter-btn-label">Rock</span>
                <span class="encounter-btn-count" id="rock-count">3</span>
            </button>
            <button class="encounter-btn run" onclick="SafariGame.runAway()">
                <span class="encounter-btn-icon">ðŸƒ</span>
                <span class="encounter-btn-label">Run</span>
            </button>
        </div>
    </div>
    
</div>

            <!-- Results Screen -->
            <div class="safari-screen hidden" id="results-screen">
                <h3 class="safari-screen-title">Safari Run Complete!</h3>
                <div class="results-stats">
                    <div class="result-stat">
                        <span class="result-label">Creatures Caught</span>
                        <span class="result-value" id="result-caught">0</span>
                    </div>
                    <div class="result-stat">
                        <span class="result-label">Creatures Fled</span>
                        <span class="result-value fled" id="result-fled">0</span>
                    </div>
                    <div class="result-stat">
                        <span class="result-label">Rares Found</span>
                        <span class="result-value rare" id="result-rares">0</span>
                    </div>
                </div>
                <div class="results-creatures" id="results-creatures">
                    <!-- Caught creatures shown here -->
                </div>
                <div class="results-actions">
                    <button class="btn btn-secondary" onclick="closeSafari()">Exit</button>
                    <button class="btn btn-primary" onclick="SafariGame.playAgain()">ðŸŽŸï¸ Play Again</button>
                </div>
            </div>
        </div>

        <!-- Inventory Bar -->
        <div class="safari-inventory" id="safari-inventory">
            <div class="inventory-item">
                <span class="inv-icon">ðŸ”´</span>
                <span class="inv-count" id="inv-capsules">5</span>
            </div>
            <div class="inventory-item">
                <span class="inv-icon">ðŸ–</span>
                <span class="inv-count" id="inv-bait">3</span>
            </div>
            <div class="inventory-item">
                <span class="inv-icon">ðŸª¨</span>
                <span class="inv-count" id="inv-rocks">3</span>
            </div>
            <div class="inventory-divider"></div>
            <div class="inventory-item caught">
                <span class="inv-icon">âœ¨</span>
                <span class="inv-count" id="inv-caught">0</span>
            </div>
        </div>
    </div>
</div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="social-links">
                <a href="https://x.com/i/communities/2015567621471789205?fbclid=IwY2xjawPk2j1leHRuA2FlbQIxMABicmlkETFLSmJqV0VzZ0s4QW1FckFpc3J0YwZhcHBfaWQQMjIyMDM5MTc4ODIwMDg5MgABHv4_il_u1SWaUtfb4bJItvSwfJJPtLlckLbSAqst1EgrZEuAkFOCfnvDv33v_aem_YJiGXBPW-19VESya08dFyg" target="_blank">ð• Twitter</a>

            </div>
        </div>
    </footer>

    <!-- Character Selection Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 class="modal-title">Choose Your Fighter</h3>
            <div class="character-grid" id="char-grid">
                <!-- Characters will be inserted here -->
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmSelection()">âš”ï¸ Fight!</button>
            </div>
        </div>
    </div>

    <!-- Wallet Connection Modal -->
    <div class="wallet-modal" id="wallet-modal">
        <div class="wallet-modal-content">
            <h3 class="wallet-modal-title">Connect Wallet</h3>
            <div class="wallet-list" id="wallet-list">
                <!-- Wallet options will be inserted here -->
            </div>
            <button class="wallet-modal-close" onclick="closeWalletModal()">Cancel</button>
        </div>
    </div>

    <script>
    /* ================================
       MOBILE MENU
       ================================ */
    function toggleMobileMenu() {
        const hamburger = document.getElementById('hamburger');
        const navLinks = document.getElementById('nav-links');
        
        hamburger.classList.toggle('active');
        navLinks.classList.toggle('active');
        document.body.style.overflow = navLinks.classList.contains('active') ? 'hidden' : '';
    }

    // Close menu when clicking links
    document.querySelectorAll('.nav-links a, .nav-links .btn').forEach(el => {
        el.addEventListener('click', () => {
            document.getElementById('hamburger').classList.remove('active');
            document.getElementById('nav-links').classList.remove('active');
            document.body.style.overflow = '';
        });
    });

    // Auto-close on resize to desktop
    window.addEventListener('resize', () => {
        if (window.innerWidth > 768) {
            document.getElementById('hamburger').classList.remove('active');
            document.getElementById('nav-links').classList.remove('active');
            document.body.style.overflow = '';
        }
    });

    /* ================================
       REWARD SYSTEM - Google Sheets
       ================================ */
    const RewardSystem = {
        // â¬‡ï¸ PASTE YOUR GOOGLE SCRIPT URL HERE â¬‡ï¸
        SHEET_API: 'https://script.google.com/macros/s/AKfycbyTiaQ3jXDnrofGqg_DgjeCZ9mWRNi8C-oqlZy6HVK07xDewzJQYsL8cG2zB5ghLbwbyw/exec',
        // â¬†ï¸ PASTE YOUR GOOGLE SCRIPT URL HERE â¬†ï¸
        
        // Config
        tokensPerWin: 100,
        shinyBonus: 2,
        streakBonus: 1.5,
        streakThreshold: 5,
        
        // State
        state: {
            wallet: null,
            totalWins: 0,
            totalLosses: 0,
            winStreak: 0,
            bestStreak: 0,
            claimableTokens: 0,
            totalEarned: 0,
            lastPlayed: null
        },
        
        // Initialize
        init() {
            this.load();
            this.updateUI();
            console.log('ðŸŽ® RewardSystem initialized');
        },
        
        // Load from localStorage
        load() {
            const saved = localStorage.getItem('peng_rewards');
            if (saved) {
                try {
                    this.state = { ...this.state, ...JSON.parse(saved) };
                } catch (e) {
                    console.log('Failed to load rewards:', e);
                }
            }
        },
        
        // Save to localStorage
        save() {
            if (WalletSystem.connected && WalletSystem.address) {
                this.state.wallet = WalletSystem.address;
            }
            this.state.lastPlayed = new Date().toISOString();
            localStorage.setItem('peng_rewards', JSON.stringify(this.state));
        },
        
        // Send data to Google Sheets
        async saveToSheet() {
            if (!WalletSystem.connected || !WalletSystem.address) {
                console.log('No wallet connected, skipping sheet save');
                return;
            }
            
            const data = {
                wallet: WalletSystem.address,
                wins: this.state.totalWins,
                claimable: this.state.claimableTokens,
                totalEarned: this.state.totalEarned,
                date: new Date().toLocaleString()
            };
            
            try {
                await fetch(this.SHEET_API, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                console.log('ðŸ“Š Data saved to Google Sheets:', data);
            } catch (error) {
                console.log('Sheet save error:', error);
            }
        },
        
        // Player WON a battle
        onWin(isShiny = false) {
            // Check wallet connection
            if (!WalletSystem.connected) {
                this.showPopup('ðŸ”— Connect wallet to earn $PALS!', 'warning');
                return 0;
            }
            
            // Calculate tokens
            let tokens = this.tokensPerWin;
            let bonusText = [];
            
            // Shiny bonus (2x)
            if (isShiny) {
                tokens *= this.shinyBonus;
                bonusText.push('âœ¨ Shiny 2x!');
            }
            
            // Update streak
            this.state.winStreak++;
            
            // Streak bonus (1.5x after 3 wins)
            if (this.state.winStreak >= this.streakThreshold) {
                tokens *= this.streakBonus;
                bonusText.push(`ðŸ”¥ ${this.state.winStreak} Streak!`);
            }
            
            // Update best streak
            if (this.state.winStreak > this.state.bestStreak) {
                this.state.bestStreak = this.state.winStreak;
            }
            
            // Round tokens
            tokens = Math.floor(tokens);
            
            // Update state
            this.state.totalWins++;
            this.state.claimableTokens += tokens;
            this.state.totalEarned += tokens;
            
            // Save locally and to sheet
            this.save();
            this.saveToSheet();
            this.updateUI();
            
            // Show popup
            let message = `+${tokens} $PALS!`;
            if (bonusText.length > 0) {
                message += '<br><small>' + bonusText.join(' ') + '</small>';
            }
            this.showPopup(message, 'success');
            
            console.log(`ðŸ† WIN! +${tokens} $PALS | Streak: ${this.state.winStreak} | Total: ${this.state.claimableTokens}`);
            
            return tokens;
        },
        
        // Player LOST a battle
onLose() {
    this.state.totalLosses++;
    this.state.winStreak = 0; // Reset streak
    
    // Penalty: Lose 10% of claimable tokens (minimum 50 tokens lost)
    const penalty = Math.max(50, Math.floor(this.state.claimableTokens * 0.10));
    const actualPenalty = Math.min(penalty, this.state.claimableTokens); // Can't go negative
    
    if (this.state.claimableTokens > 0) {
        this.state.claimableTokens -= actualPenalty;
        this.showPopup(`-${actualPenalty} $PALS ðŸ’€`, 'danger');
        console.log(`ðŸ’€ LOSS | -${actualPenalty} $PALS | Remaining: ${this.state.claimableTokens}`);
    }
    
    this.save();
    this.saveToSheet(); // Update Google Sheets
    this.updateUI();
},
        
        // Update UI elements
        updateUI() {
            const updates = {
                'total-wins': this.state.totalWins,
                'total-losses': this.state.totalLosses,
                'win-streak': this.state.winStreak,
                'best-streak': this.state.bestStreak,
                'claimable-tokens': this.state.claimableTokens.toLocaleString(),
                'total-earned': this.state.totalEarned.toLocaleString()
            };
            
            Object.entries(updates).forEach(([id, value]) => {
                const el = document.getElementById(id);
                if (el) el.textContent = value;
            });
            
            // Update win rate
            const winRateEl = document.getElementById('win-rate');
            if (winRateEl) {
                const total = this.state.totalWins + this.state.totalLosses;
                const rate = total > 0 ? Math.round((this.state.totalWins / total) * 100) : 0;
                winRateEl.textContent = rate + '%';
            }
            
            // Update claim button state
            const claimBtn = document.getElementById('claim-btn');
            if (claimBtn) {
                claimBtn.disabled = this.state.claimableTokens <= 0;
            }
        },
        
        // Show popup notification
       showPopup(message, type = 'success') {
    // Remove existing
    const existing = document.querySelector('.reward-popup');
    if (existing) existing.remove();
    
    // Create popup
    const popup = document.createElement('div');
    popup.className = `reward-popup ${type}`;
    popup.innerHTML = message;
    
    // Style based on type
    popup.style.cssText = `
        position: fixed;
        top: 15%;
        left: 50%;
        transform: translateX(-50%);
        padding: 24px 48px;
        border-radius: 16px;
        font-family: 'Press Start 2P', cursive;
        font-size: 1.3rem;
        z-index: 9999;
        animation: popIn 0.3s ease-out;
        box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        text-align: center;
    `;
    
    if (type === 'success') {
        popup.style.background = 'linear-gradient(135deg, #ffd93d 0%, #f97316 100%)';
        popup.style.color = '#000';
    } else if (type === 'danger') {
        popup.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
        popup.style.color = '#fff';
    } else if (type === 'warning') {
        popup.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
        popup.style.color = '#000';
    }
    
    document.body.appendChild(popup);
            
            // Auto remove
            setTimeout(() => {
                popup.classList.add('fade-out');
                setTimeout(() => popup.remove(), 500);
            }, 2500);
        },
        
        // Submit claim request
        claim() {
            if (!WalletSystem.connected) {
                alert('âŒ Please connect your wallet first!');
                return;
            }
            
            if (this.state.claimableTokens <= 0) {
                alert('âŒ No tokens to claim! Win more battles!');
                return;
            }
            
            const wallet = WalletSystem.address;
            const amount = this.state.claimableTokens;
            
            // Save final state to sheet
            this.saveToSheet();
            
            // Show confirmation
            const shortWallet = wallet.slice(0, 6) + '...' + wallet.slice(-6);
            
            alert(
                `âœ… CLAIM REQUEST SUBMITTED!\n\n` +
                `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n` +
                `Wallet: ${shortWallet}\n` +
                `Amount: ${amount.toLocaleString()} $PALS\n` +
                `Total Wins: ${this.state.totalWins}\n` +
                `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n` +
                `Your tokens will be sent within 24-48 hours!\n` +
                `Check your wallet for the airdrop. ðŸŽ‰`
            );
            
            console.log('ðŸ“¤ Claim submitted:', { wallet, amount, wins: this.state.totalWins });
        },
        
        // Reset all progress (for testing)
        reset() {
            if (!confirm('âš ï¸ Reset all progress? This cannot be undone!')) return;
            
            this.state = {
                wallet: null,
                totalWins: 0,
                totalLosses: 0,
                winStreak: 0,
                bestStreak: 0,
                claimableTokens: 0,
                totalEarned: 0,
                lastPlayed: null
            };
            
            localStorage.removeItem('peng_rewards');
            this.updateUI();
            console.log('ðŸ—‘ï¸ Rewards reset');
            alert('Progress reset!');
        }
    };

    /* ================================
       ADMIN PANEL - View All Players
       ================================ */
    const AdminPanel = {
        // Same API URL
        get SHEET_API() { return RewardSystem.SHEET_API; },
        
        // Data
        players: [],
        
        // Secret code to show panel (type "admin" on keyboard)
        secretCode: 'admin',
        inputBuffer: '',
        isVisible: false,
        
        init() {
            // Listen for secret code
            document.addEventListener('keypress', (e) => {
                this.inputBuffer += e.key.toLowerCase();
                
                // Keep only last 10 characters
                if (this.inputBuffer.length > 10) {
                    this.inputBuffer = this.inputBuffer.slice(-10);
                }
                
                // Check for secret code
                if (this.inputBuffer.includes(this.secretCode)) {
                    this.toggle();
                    this.inputBuffer = '';
                }
            });
            
            console.log('ðŸ” AdminPanel ready (type "admin" to access)');
        },
        
        toggle() {
            const section = document.getElementById('admin-panel');
            if (!section) return;
            
            this.isVisible = !this.isVisible;
            section.style.display = this.isVisible ? 'block' : 'none';
            
            if (this.isVisible) {
                section.scrollIntoView({ behavior: 'smooth' });
                this.refresh();
            }
        },
        
        async refresh() {
            const tbody = document.getElementById('admin-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">â³ Loading...</td></tr>';
            
            try {
                const response = await fetch(this.SHEET_API);
                const data = await response.json();
                
                if (Array.isArray(data)) {
                    this.players = data;
                    this.render();
                } else {
                    throw new Error('Invalid data');
                }
            } catch (error) {
                console.error('Admin fetch error:', error);
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; color: #ef4444;">âŒ Failed to load. Check your API URL.</td></tr>';
            }
        },
        
        render() {
            const tbody = document.getElementById('admin-tbody');
            if (!tbody) return;
            
            // Calculate totals
            let totalPlayers = this.players.length;
            let totalClaimable = 0;
            let unpaidCount = 0;
            
            this.players.forEach(p => {
                totalClaimable += Number(p.claimable) || 0;
                if (p.paid !== 'Yes' && p.claimable > 0) unpaidCount++;
            });
            
            // Update summary
            const totalPlayersEl = document.getElementById('admin-total-players');
            const totalClaimableEl = document.getElementById('admin-total-claimable');
            const unpaidCountEl = document.getElementById('admin-unpaid-count');
            
            if (totalPlayersEl) totalPlayersEl.textContent = totalPlayers;
            if (totalClaimableEl) totalClaimableEl.textContent = totalClaimable.toLocaleString();
            if (unpaidCountEl) unpaidCountEl.textContent = unpaidCount;
            
            // Empty state
            if (this.players.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">No players yet</td></tr>';
                return;
            }
            
            // Sort by claimable (highest first)
            const sorted = [...this.players].sort((a, b) => (b.claimable || 0) - (a.claimable || 0));
            
            // Render rows
            tbody.innerHTML = sorted.map((player, i) => {
                const wallet = player.wallet || '';
                const shortWallet = wallet ? `${wallet.slice(0, 6)}...${wallet.slice(-4)}` : 'N/A';
                const isPaid = player.paid === 'Yes';
                const claimable = Number(player.claimable) || 0;
                
                return `
                    <tr class="${isPaid ? 'paid-row' : ''} ${claimable > 0 ? 'has-claimable' : ''}">
                        <td>${i + 1}</td>
                        <td class="wallet-cell">
                            <span title="${wallet}">${shortWallet}</span>
                            <button class="copy-btn" onclick="AdminPanel.copy('${wallet}')" title="Copy full address">ðŸ“‹</button>
                        </td>
                        <td>${player.wins || 0}</td>
                        <td class="claimable-cell">${claimable.toLocaleString()}</td>
                        <td>${(Number(player.totalEarned) || 0).toLocaleString()}</td>
                        <td>${player.lastPlayed || 'N/A'}</td>
                        <td>
                            ${isPaid 
                                ? '<span class="paid-badge">âœ“ Paid</span>' 
                                : `<button class="mark-paid-btn" onclick="AdminPanel.markPaid('${wallet}')">Mark Paid</button>`
                            }
                        </td>
                    </tr>
                `;
            }).join('');
        },
        
        copy(text) {
            navigator.clipboard.writeText(text);
            this.showToast('Copied: ' + text);
        },
        
        markPaid(wallet) {
            const player = this.players.find(p => p.wallet === wallet);
            if (!player) return;
            
            const amount = player.claimable || 0;
            const shortWallet = wallet.slice(0, 8) + '...' + wallet.slice(-4);
            
            if (confirm(`Mark as PAID?\n\nWallet: ${shortWallet}\nAmount: ${amount} $PALS\n\nMake sure you've sent the tokens!`)) {
                this.showToast('âœ“ Marked as paid - Update Google Sheet manually');
            }
        },
        
        showToast(msg) {
            const existing = document.querySelector('.admin-toast');
            if (existing) existing.remove();
            
            const toast = document.createElement('div');
            toast.className = 'admin-toast';
            toast.textContent = msg;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.remove(), 2000);
        },
        
        exportCSV() {
            if (this.players.length === 0) {
                alert('No data to export!');
                return;
            }
            
            const headers = ['Wallet', 'Wins', 'Claimable', 'Total Earned', 'Last Played', 'Paid'];
            const rows = this.players.map(p => [
                p.wallet,
                p.wins,
                p.claimable,
                p.totalEarned,
                p.lastPlayed,
                p.paid
            ]);
            
            const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `PENG_rewards_${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            this.showToast('CSV Downloaded!');
        },
        
        copyAllUnpaid() {
            const unpaid = this.players
                .filter(p => p.paid !== 'Yes' && p.claimable > 0)
                .map(p => `${p.wallet},${p.claimable}`)
                .join('\n');
            
            if (!unpaid) {
                alert('No unpaid claims!');
                return;
            }
            
            navigator.clipboard.writeText(unpaid);
            this.showToast('Copied all unpaid wallets + amounts!');
        }
    };

    /* ================================
       SAFARI ZONE GAME SYSTEM
       ================================ */
    const SafariGame = {
        // Game State
        state: {
            tickets: 1,
            pumpmonBalance: 5000,
            currentBiome: null,
            actionsLeft: 0,
            maxActions: 10,
            inventory: {
                capsules: 5,
                bait: 3,
                rocks: 3
            },
            currentCreature: null,
            creatureModifiers: {
                baitActive: false,
                baitTurns: 0,
                angryActive: false,
                angryTurns: 0
            },
            caughtCreatures: [],
            fledCreatures: 0,
            raresFound: 0,
            isEncounterActive: false
        },

        // Biome Definitions
        biomes: {
            jungle: {
                id: 'jungle',
                name: 'Jungle',
                emoji: 'ðŸŒ¿',
                difficulty: 'easy',
                fleeRateModifier: 1.0,
                rareSpawnChance: 0.15,
                maxActions: 10,
                encounterTable: [
                    { id: 'pepe', weight: 30, rarity: 'common' },
                    { id: 'froggie', weight: 25, rarity: 'common' },
                    { id: 'monke', weight: 20, rarity: 'uncommon' },
                    { id: 'snek', weight: 15, rarity: 'uncommon' },
                    { id: 'jungleking', weight: 8, rarity: 'rare' },
                    { id: 'goldenfrog', weight: 2, rarity: 'epic' }
                ]
            },
            swamp: {
                id: 'swamp',
                name: 'Swamp',
                emoji: 'ðŸŒŠ',
                difficulty: 'medium',
                fleeRateModifier: 0.9,
                rareSpawnChance: 0.2,
                maxActions: 10,
                encounterTable: [
                    { id: 'whale', weight: 25, rarity: 'common' },
                    { id: 'mudfish', weight: 25, rarity: 'common' },
                    { id: 'gator', weight: 20, rarity: 'uncommon' },
                    { id: 'swampthing', weight: 15, rarity: 'uncommon' },
                    { id: 'hydra', weight: 10, rarity: 'rare' },
                    { id: 'swampgod', weight: 5, rarity: 'epic' }
                ]
            },
            volcanic: {
                id: 'volcanic',
                name: 'Volcanic',
                emoji: 'ðŸŒ‹',
                difficulty: 'hard',
                fleeRateModifier: 1.2,
                rareSpawnChance: 0.25,
                maxActions: 8,
                encounterTable: [
                    { id: 'flameling', weight: 30, rarity: 'common' },
                    { id: 'magmite', weight: 25, rarity: 'uncommon' },
                    { id: 'lavabeast', weight: 20, rarity: 'uncommon' },
                    { id: 'phoenix', weight: 15, rarity: 'rare' },
                    { id: 'dragonlord', weight: 8, rarity: 'epic' },
                    { id: 'inferno', weight: 2, rarity: 'legendary' }
                ],
                locked: false
            },
            cosmic: {
                id: 'cosmic',
                name: 'Cosmic',
                emoji: 'ðŸŒŒ',
                difficulty: 'extreme',
                fleeRateModifier: 1.5,
                rareSpawnChance: 0.35,
                maxActions: 6,
                encounterTable: [
                    { id: 'stardust', weight: 25, rarity: 'uncommon' },
                    { id: 'nebula', weight: 25, rarity: 'uncommon' },
                    { id: 'voidwalker', weight: 20, rarity: 'rare' },
                    { id: 'cosmicwhale', weight: 15, rarity: 'rare' },
                    { id: 'galaxian', weight: 10, rarity: 'epic' },
                    { id: 'celestial', weight: 5, rarity: 'legendary' }
                ],
                locked: true
            }
        },

        // Creature Definitions
        creatures: {
            pepe: { name: 'PEPE', image: 'pepe.png', baseCatchRate: 0.4, baseFleeRate: 0.2 },
            froggie: { name: 'FROGGIE', image: 'pepe.png', baseCatchRate: 0.45, baseFleeRate: 0.15 },
            monke: { name: 'MONKE', image: 'moodeng.png', baseCatchRate: 0.3, baseFleeRate: 0.25 },
            snek: { name: 'SNEK', image: 'catana.png', baseCatchRate: 0.35, baseFleeRate: 0.3 },
            jungleking: { name: 'JUNGLE KING', image: 'cow.png', baseCatchRate: 0.2, baseFleeRate: 0.35 },
            goldenfrog: { name: 'GOLDEN FROG', image: 'pepe.png', baseCatchRate: 0.1, baseFleeRate: 0.45 },
            whale: { name: 'WHALE', image: 'whale.png', baseCatchRate: 0.35, baseFleeRate: 0.2 },
            mudfish: { name: 'MUDFISH', image: 'whale.png', baseCatchRate: 0.45, baseFleeRate: 0.15 },
            gator: { name: 'GATOR', image: 'catana.png', baseCatchRate: 0.3, baseFleeRate: 0.3 },
            swampthing: { name: 'SWAMP THING', image: 'moodeng.png', baseCatchRate: 0.25, baseFleeRate: 0.35 },
            hydra: { name: 'HYDRA', image: 'whale.png', baseCatchRate: 0.15, baseFleeRate: 0.4 },
            swampgod: { name: 'SWAMP GOD', image: 'whale.png', baseCatchRate: 0.08, baseFleeRate: 0.5 },
            flameling: { name: 'FLAMELING', image: 'pepe.png', baseCatchRate: 0.35, baseFleeRate: 0.25 },
            magmite: { name: 'MAGMITE', image: 'moodeng.png', baseCatchRate: 0.3, baseFleeRate: 0.3 },
            lavabeast: { name: 'LAVA BEAST', image: 'cow.png', baseCatchRate: 0.25, baseFleeRate: 0.35 },
            phoenix: { name: 'PHOENIX', image: 'pepe.png', baseCatchRate: 0.15, baseFleeRate: 0.45 },
            dragonlord: { name: 'DRAGON LORD', image: 'catana.png', baseCatchRate: 0.08, baseFleeRate: 0.5 },
            inferno: { name: 'INFERNO', image: 'pepe.png', baseCatchRate: 0.05, baseFleeRate: 0.6 },
            stardust: { name: 'STARDUST', image: 'whale.png', baseCatchRate: 0.3, baseFleeRate: 0.3 },
            nebula: { name: 'NEBULA', image: 'moodeng.png', baseCatchRate: 0.25, baseFleeRate: 0.35 },
            voidwalker: { name: 'VOIDWALKER', image: 'catana.png', baseCatchRate: 0.2, baseFleeRate: 0.4 },
            cosmicwhale: { name: 'COSMIC WHALE', image: 'whale.png', baseCatchRate: 0.15, baseFleeRate: 0.45 },
            galaxian: { name: 'GALAXIAN', image: 'pepe.png', baseCatchRate: 0.08, baseFleeRate: 0.55 },
            celestial: { name: 'CELESTIAL', image: 'cow.png', baseCatchRate: 0.03, baseFleeRate: 0.65 }
        },

        init() {
            this.updateTicketDisplay();
        },

        open() {
            if (this.state.tickets <= 0) {
                alert('You need a Safari Ticket! Get 1000 $PALS to enter.');
                return;
            }

            const modal = document.getElementById('safari-modal');
            modal.classList.add('show');
            this.showScreen('biome-select-screen');
            this.renderBiomeSelection();
            AudioSystem.playSound('select');
        },

        close() {
            document.getElementById('safari-modal').classList.remove('show');
            this.resetState();
        },

        showScreen(screenId) {
            document.querySelectorAll('.safari-screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
        },

        renderBiomeSelection() {
            const grid = document.getElementById('biome-grid');
            grid.innerHTML = Object.values(this.biomes).map(biome => `
                <div class="biome-card ${biome.locked ? 'locked' : ''}" onclick="SafariGame.selectBiome('${biome.id}')">
                    <span class="biome-emoji">${biome.emoji}</span>
                    <div class="biome-name">${biome.name}</div>
                    <div class="biome-difficulty ${biome.difficulty}">${biome.locked ? 'ðŸ”’ Locked' : biome.difficulty.toUpperCase()}</div>
                </div>
            `).join('');
        },

        selectBiome(biomeId) {
            const biome = this.biomes[biomeId];
            if (biome.locked) {
                alert('This biome is locked! Complete more runs to unlock.');
                return;
            }

            this.state.tickets--;
            this.updateTicketDisplay();

            this.state.currentBiome = biome;
            this.state.actionsLeft = biome.maxActions;
            this.state.maxActions = biome.maxActions;
            this.state.inventory = { capsules: 5, bait: 3, rocks: 3 };
            this.state.caughtCreatures = [];
            this.state.fledCreatures = 0;
            this.state.raresFound = 0;

            document.getElementById('safari-biome-name').textContent = `${biome.emoji} ${biome.name} Zone`;
            this.updateActionsDisplay();
            this.updateInventoryDisplay();

            this.showScreen('explore-screen');
            this.setMessage(`You entered the ${biome.name}! Look for creatures in the tall grass.`);

            AudioSystem.playSound('select');
        },

        explore() {
            if (this.state.actionsLeft <= 0) {
                this.endRun();
                return;
            }

            this.state.actionsLeft--;
            this.updateActionsDisplay();

            if (Math.random() < 0.7) {
                this.triggerEncounter();
            } else {
                const messages = [
                    'The grass rustles... but nothing appears.',
                    'You hear something in the distance...',
                    'A shadow moves, but disappears.',
                    'The area seems quiet...'
                ];
                this.setMessage(messages[Math.floor(Math.random() * messages.length)]);
                AudioSystem.playSound('select');

                if (this.state.actionsLeft <= 0) {
                    setTimeout(() => this.endRun(), 1500);
                }
            }
        },

        triggerEncounter() {
            const biome = this.state.currentBiome;
            
            const totalWeight = biome.encounterTable.reduce((sum, c) => sum + c.weight, 0);
            let roll = Math.random() * totalWeight;
            let selectedEntry = biome.encounterTable[0];

            for (const entry of biome.encounterTable) {
                roll -= entry.weight;
                if (roll <= 0) {
                    selectedEntry = entry;
                    break;
                }
            }

            const creature = this.creatures[selectedEntry.id];
            this.state.currentCreature = {
                ...creature,
                id: selectedEntry.id,
                rarity: selectedEntry.rarity,
                catchRate: creature.baseCatchRate,
                fleeRate: creature.baseFleeRate * biome.fleeRateModifier
            };

            this.state.creatureModifiers = {
                baitActive: false,
                baitTurns: 0,
                angryActive: false,
                angryTurns: 0
            };
            this.state.isEncounterActive = true;

            if (['rare', 'epic', 'legendary'].includes(selectedEntry.rarity)) {
                this.state.raresFound++;
            }

            document.getElementById('encounter-creature-img').src = `assets/images/characters/${creature.image}`;
            document.getElementById('encounter-creature-name').textContent = creature.name;
            
            const rarityEl = document.getElementById('encounter-creature-rarity');
            rarityEl.textContent = selectedEntry.rarity.toUpperCase();
            rarityEl.className = 'creature-rarity ' + selectedEntry.rarity;

            this.updateEncounterButtons();
            this.clearEncounterLog();
            this.addEncounterLog(`A wild ${creature.name} appeared!`, 'success');

            this.showScreen('encounter-screen');
            AudioSystem.playSound('select');
        },

        throwCapsule() {
            if (!this.state.isEncounterActive || this.state.inventory.capsules <= 0) return;

            this.state.inventory.capsules--;
            this.state.actionsLeft--;
            this.updateActionsDisplay();
            this.updateInventoryDisplay();
            this.updateEncounterButtons();

            const creature = this.state.currentCreature;
            let catchRate = creature.catchRate;

            if (this.state.creatureModifiers.baitActive) {
                catchRate *= 0.7;
            }
            if (this.state.creatureModifiers.angryActive) {
                catchRate *= 1.5;
            }

            this.addEncounterLog('You threw a Capture Capsule!');
            
            const creatureImg = document.getElementById('encounter-creature-img');
            creatureImg.classList.add('shake');

            setTimeout(() => {
                creatureImg.classList.remove('shake');

                if (Math.random() < catchRate) {
                    this.catchCreature();
                } else {
                    this.addEncounterLog('Oh no! It broke free!', 'warning');
                    AudioSystem.playSound('hit');
                    this.checkFlee();
                }
            }, 800);
        },

        throwBait() {
            if (!this.state.isEncounterActive || this.state.inventory.bait <= 0) return;

            this.state.inventory.bait--;
            this.state.actionsLeft--;
            this.updateActionsDisplay();
            this.updateInventoryDisplay();
            this.updateEncounterButtons();

            this.state.creatureModifiers.baitActive = true;
            this.state.creatureModifiers.baitTurns = 3;
            this.state.creatureModifiers.angryActive = false;
            this.state.creatureModifiers.angryTurns = 0;

            this.addEncounterLog('You threw some bait!');
            this.addEncounterLog(`${this.state.currentCreature.name} is eating...`, 'success');
            this.updateCreatureStatus();

            AudioSystem.playSound('select');
            this.decrementModifiers();
        },

        throwRock() {
            if (!this.state.isEncounterActive || this.state.inventory.rocks <= 0) return;

            this.state.inventory.rocks--;
            this.state.actionsLeft--;
            this.updateActionsDisplay();
            this.updateInventoryDisplay();
            this.updateEncounterButtons();

            this.state.creatureModifiers.angryActive = true;
            this.state.creatureModifiers.angryTurns = 3;
            this.state.creatureModifiers.baitActive = false;
            this.state.creatureModifiers.baitTurns = 0;

            this.addEncounterLog('You threw a rock!');
            this.addEncounterLog(`${this.state.currentCreature.name} is angry!`, 'danger');
            this.updateCreatureStatus();

            const creatureImg = document.getElementById('encounter-creature-img');
            creatureImg.classList.add('shake');
            setTimeout(() => creatureImg.classList.remove('shake'), 500);

            AudioSystem.playSound('hit');
            this.checkFlee(true);
        },

        runAway() {
            if (!this.state.isEncounterActive) return;

            this.addEncounterLog('Got away safely!');
            this.state.isEncounterActive = false;

            setTimeout(() => {
                if (this.state.actionsLeft <= 0 || this.state.inventory.capsules <= 0) {
                    this.endRun();
                } else {
                    this.showScreen('explore-screen');
                    this.setMessage('You ran away. Keep exploring!');
                }
            }, 800);
        },

        catchCreature() {
            const creature = this.state.currentCreature;
            this.state.caughtCreatures.push({
                id: creature.id,
                name: creature.name,
                image: creature.image,
                rarity: creature.rarity
            });

            this.addEncounterLog(`Gotcha! ${creature.name} was caught!`, 'success');
            AudioSystem.playSound('victory');

            const creatureImg = document.getElementById('encounter-creature-img');
            creatureImg.classList.add('caught');

            this.state.isEncounterActive = false;
            this.updateInventoryDisplay();

            setTimeout(() => {
                creatureImg.classList.remove('caught');
                if (this.state.actionsLeft <= 0 || this.state.inventory.capsules <= 0) {
                    this.endRun();
                } else {
                    this.showScreen('explore-screen');
                    this.setMessage(`${creature.name} was caught! Keep exploring!`);
                }
            }, 1200);
        },

        checkFlee(angry = false) {
            const creature = this.state.currentCreature;
            let fleeRate = creature.fleeRate;

            if (this.state.creatureModifiers.baitActive) {
                fleeRate *= 0.5;
            }
            if (angry || this.state.creatureModifiers.angryActive) {
                fleeRate *= 1.5;
            }

            if (Math.random() < fleeRate) {
                this.creatureFled();
            } else {
                this.decrementModifiers();
            }
        },

        creatureFled() {
            const creature = this.state.currentCreature;
            this.state.fledCreatures++;
            this.state.isEncounterActive = false;

            this.addEncounterLog(`${creature.name} fled!`, 'danger');
            AudioSystem.playSound('defeat');

            const creatureImg = document.getElementById('encounter-creature-img');
            creatureImg.classList.add('fled');

            setTimeout(() => {
                creatureImg.classList.remove('fled');
                if (this.state.actionsLeft <= 0 || this.state.inventory.capsules <= 0) {
                    this.endRun();
                } else {
                    this.showScreen('explore-screen');
                    this.setMessage(`${creature.name} ran away... Keep looking!`);
                }
            }, 800);
        },

        decrementModifiers() {
            if (this.state.creatureModifiers.baitTurns > 0) {
                this.state.creatureModifiers.baitTurns--;
                if (this.state.creatureModifiers.baitTurns <= 0) {
                    this.state.creatureModifiers.baitActive = false;
                }
            }
            if (this.state.creatureModifiers.angryTurns > 0) {
                this.state.creatureModifiers.angryTurns--;
                if (this.state.creatureModifiers.angryTurns <= 0) {
                    this.state.creatureModifiers.angryActive = false;
                }
            }
            this.updateCreatureStatus();
        },

        endRun() {
            this.showScreen('results-screen');

            document.getElementById('result-caught').textContent = this.state.caughtCreatures.length;
            document.getElementById('result-fled').textContent = this.state.fledCreatures;
            document.getElementById('result-rares').textContent = this.state.raresFound;

            const creaturesContainer = document.getElementById('results-creatures');
            if (this.state.caughtCreatures.length > 0) {
                creaturesContainer.innerHTML = this.state.caughtCreatures.map(c => `
                    <div class="result-creature ${c.rarity}">
                        <img src="assets/images/characters/${c.image}" alt="${c.name}">
                        <div class="name">${c.name}</div>
                    </div>
                `).join('');
            } else {
                creaturesContainer.innerHTML = '<p style="color: var(--text-muted); font-size: 0.8rem;">No creatures caught this run.</p>';
            }

            if (this.state.caughtCreatures.length > 0) {
                AudioSystem.playSound('victory');
            } else {
                AudioSystem.playSound('defeat');
            }
        },

        playAgain() {
            if (this.state.tickets <= 0) {
                alert('You need more tickets! Get 1000 $PALS for each ticket.');
                return;
            }
            this.showScreen('biome-select-screen');
            this.renderBiomeSelection();
        },

        resetState() {
            this.state.currentBiome = null;
            this.state.currentCreature = null;
            this.state.isEncounterActive = false;
            this.state.caughtCreatures = [];
            this.state.fledCreatures = 0;
            this.state.raresFound = 0;
        },

        setMessage(msg) {
            document.getElementById('safari-message').textContent = msg;
        },

        updateActionsDisplay() {
            document.getElementById('actions-left').textContent = this.state.actionsLeft;
        },

        updateInventoryDisplay() {
            document.getElementById('inv-capsules').textContent = this.state.inventory.capsules;
            document.getElementById('inv-bait').textContent = this.state.inventory.bait;
            document.getElementById('inv-rocks').textContent = this.state.inventory.rocks;
            document.getElementById('inv-caught').textContent = this.state.caughtCreatures.length;

            document.getElementById('capsule-count').textContent = this.state.inventory.capsules;
            document.getElementById('bait-count').textContent = this.state.inventory.bait;
            document.getElementById('rock-count').textContent = this.state.inventory.rocks;
        },

        updateEncounterButtons() {
            document.querySelector('.encounter-btn.capsule').disabled = this.state.inventory.capsules <= 0;
            document.querySelector('.encounter-btn.bait').disabled = this.state.inventory.bait <= 0;
            document.querySelector('.encounter-btn.rock').disabled = this.state.inventory.rocks <= 0;
        },

        updateCreatureStatus() {
            const statusEl = document.getElementById('creature-status');
            let html = '';
            if (this.state.creatureModifiers.baitActive) {
                html += '<span class="status-effect bait">ðŸ– Eating</span>';
            }
            if (this.state.creatureModifiers.angryActive) {
                html += '<span class="status-effect angry">ðŸ˜  Angry</span>';
            }
            statusEl.innerHTML = html;
        },

        updateTicketDisplay() {
            const ticketEl = document.getElementById('ticket-count');
            if (ticketEl) ticketEl.textContent = this.state.tickets;
        },

        addEncounterLog(msg, type = '') {
            const log = document.getElementById('encounter-log');
            const entry = document.createElement('div');
            entry.className = 'encounter-log-entry ' + type;
            entry.textContent = '> ' + msg;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        },

        clearEncounterLog() {
            document.getElementById('encounter-log').innerHTML = '';
        }
    };

    function openSafari() { SafariGame.open(); }
    function closeSafari() { SafariGame.close(); }
    function exitSafari() {
        if (SafariGame.state.isEncounterActive || SafariGame.state.actionsLeft > 0) {
            if (confirm('Are you sure? Your progress will be lost!')) {
                SafariGame.endRun();
            }
        } else {
            closeSafari();
        }
    }

    /* ================================
       WALLET SYSTEM
       ================================ */
    const WalletSystem = {
        connected: false,
        address: null,
        balance: 0,
        tokenBalance: 0,
        provider: null,
        
        tokenMint: 'BZz5TeFBaQ4uv5iXFf4S7mX7qzvyFLSbDpjeyzwRpump',
        
        wallets: [
            {
                name: 'Phantom',
                icon: 'assets/images/phantom-logo.png',
                getProvider: () => {
                    if ('phantom' in window) {
                        const provider = window.phantom?.solana;
                        if (provider?.isPhantom) {
                            return provider;
                        }
                    }
                    return null;
                },
                downloadUrl: 'https://phantom.app/'
            },
        ],
        
        init() {
            const savedAddress = localStorage.getItem('walletAddress');
            if (savedAddress) {
                setTimeout(() => this.checkExistingConnection(), 500);
            }
        },
        
        async checkExistingConnection() {
            try {
                const provider = this.wallets[0].getProvider();
                if (provider) {
                    const resp = await provider.connect({ onlyIfTrusted: true });
                    if (resp.publicKey) {
                        this.handleConnection(resp.publicKey.toString(), provider, 'Phantom');
                    }
                }
            } catch (err) {
                console.log('Auto-reconnect failed:', err.message);
                localStorage.removeItem('walletAddress');
                localStorage.removeItem('walletName');
            }
        },
        
        openModal() {
            const modal = document.getElementById('wallet-modal');
            const list = document.getElementById('wallet-list');
            
            list.innerHTML = this.wallets.map(wallet => {
                const provider = wallet.getProvider();
                const isInstalled = !!provider;
                
                return `
                    <div class="wallet-option" onclick="WalletSystem.connectTo('${wallet.name}')">
                        <img src="${wallet.icon}" alt="${wallet.name}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22><rect fill=%22%23AB9FF2%22 width=%2240%22 height=%2240%22 rx=%228%22/><text x=%2250%%22 y=%2255%%22 text-anchor=%22middle%22 fill=%22white%22 font-size=%2218%22>ðŸ‘»</text></svg>'">
                        <div class="wallet-option-info">
                            <div class="wallet-option-name">${wallet.name}</div>
                            <div class="wallet-option-desc">${isInstalled ? 'Click to connect' : 'Click to install'}</div>
                        </div>
                        <span class="wallet-option-status ${isInstalled ? '' : 'not-installed'}">
                            ${isInstalled ? 'Detected' : 'Install'}
                        </span>
                    </div>
                `;
            }).join('');
            
            modal.classList.add('show');
        },
        
        closeModal() {
            document.getElementById('wallet-modal').classList.remove('show');
        },
        
        async connectTo(walletName) {
            const wallet = this.wallets.find(w => w.name === walletName);
            if (!wallet) return;
            
            const provider = wallet.getProvider();
            
            if (!provider) {
                window.open(wallet.downloadUrl, '_blank');
                return;
            }
            
            try {
                const resp = await provider.connect();
                
                if (resp.publicKey) {
                    this.handleConnection(resp.publicKey.toString(), provider, walletName);
                    this.closeModal();
                }
            } catch (err) {
                console.error('Connection error:', err);
                
                if (err.code === 4001) {
                    alert('Connection cancelled. Please approve the connection request in Phantom.');
                } else if (err.code === -32603) {
                    alert('Connection error. Please make sure Phantom is unlocked.');
                } else {
                    alert('Failed to connect: ' + (err.message || 'Unknown error'));
                }
            }
        },
        
        handleConnection(address, provider, walletName) {
            this.connected = true;
            this.address = address;
            this.provider = provider;
            
            localStorage.setItem('walletAddress', address);
            localStorage.setItem('walletName', walletName);
            
            console.log('âœ… Wallet connected:', address);
            
            this.updateUI();
            this.getBalance();
            this.getTokenBalance();
            
            provider.on('disconnect', () => {
                console.log('Wallet disconnected event');
                this.handleDisconnect();
            });
            
            provider.on('accountChanged', (publicKey) => {
                if (publicKey) {
                    console.log('Account changed to:', publicKey.toString());
                    this.address = publicKey.toString();
                    localStorage.setItem('walletAddress', this.address);
                    this.updateUI();
                    this.getBalance();
                    this.getTokenBalance();
                } else {
                    this.handleDisconnect();
                }
            });
        },
        
        async getBalance() {
            if (!this.address) return;
            
            const endpoints = [
                'https://rpc.ankr.com/solana',
                'https://solana-mainnet.g.alchemy.com/v2/demo'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            jsonrpc: '2.0',
                            id: 1,
                            method: 'getBalance',
                            params: [this.address]
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.result?.value !== undefined) {
                        this.balance = (data.result.value / 1e9).toFixed(4);
                        this.updateUI();
                        console.log('ðŸ’° SOL Balance:', this.balance, 'SOL');
                        return;
                    }
                } catch (e) {
                    console.log('RPC failed:', endpoint, e.message);
                    continue;
                }
            }
            
            console.log('Could not fetch SOL balance from any endpoint');
        },
        
        async getTokenBalance() {
            if (!this.address || !this.tokenMint) return;
            
            const endpoints = [
                'https://rpc.ankr.com/solana',
                'https://solana-mainnet.g.alchemy.com/v2/demo'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            jsonrpc: '2.0',
                            id: 1,
                            method: 'getTokenAccountsByOwner',
                            params: [
                                this.address,
                                { mint: this.tokenMint },
                                { encoding: 'jsonParsed' }
                            ]
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.result?.value?.length > 0) {
                        this.tokenBalance = data.result.value[0].account.data.parsed.info.tokenAmount.uiAmount || 0;
                    } else {
                        this.tokenBalance = 0;
                    }
                    
                    console.log('ðŸ’Ž $PALS Balance:', this.tokenBalance);
                    this.updateUI();
                    
                    if (typeof SafariGame !== 'undefined') {
                        SafariGame.state.tickets = Math.floor(this.tokenBalance / 1000);
                        SafariGame.state.pumpmonBalance = this.tokenBalance;
                        SafariGame.updateTicketDisplay();
                    }
                    
                    return this.tokenBalance;
                } catch (e) {
                    console.log('Token RPC failed:', endpoint, e.message);
                    continue;
                }
            }
            
            console.log('Could not fetch token balance from any endpoint');
            return 0;
        },
        
        updateUI() {
            const btn = document.getElementById('wallet-btn');
            const text = document.getElementById('wallet-text');
            
            if (this.connected && this.address) {
                const shortAddress = this.address.slice(0, 4) + '...' + this.address.slice(-4);
                text.innerHTML = `
                    <span class="wallet-address">${shortAddress}</span>
                    ${this.balance ? `<span class="wallet-balance">${this.balance} SOL</span>` : ''}
                `;
                btn.classList.add('connected');
                
                const tokenBalanceEl = document.getElementById('pumpmon-balance');
                if (tokenBalanceEl) {
                    tokenBalanceEl.textContent = this.tokenBalance.toLocaleString();
                }
                
                const tokenDisplayEl = document.getElementById('token-balance-display');
                if (tokenDisplayEl) {
                    tokenDisplayEl.style.display = 'flex';
                }
            } else {
                text.textContent = 'Connect Wallet';
                btn.classList.remove('connected');
                
                const tokenDisplayEl = document.getElementById('token-balance-display');
                if (tokenDisplayEl) {
                    tokenDisplayEl.style.display = 'none';
                }
            }
        },
        
        async showDisconnectOption() {
            if (confirm('Disconnect wallet?')) {
                await this.disconnect();
            }
        },
        
        handleDisconnect() {
            this.connected = false;
            this.address = null;
            this.balance = 0;
            this.tokenBalance = 0;
            this.provider = null;
            
            localStorage.removeItem('walletAddress');
            localStorage.removeItem('walletName');
            
            this.updateUI();
            console.log('Wallet disconnected');
        },
        
        async disconnect() {
            try {
                if (this.provider?.disconnect) {
                    await this.provider.disconnect();
                }
            } catch (e) {
                console.log('Disconnect error:', e);
            }
            
            this.handleDisconnect();
        },
        
        async refreshBalances() {
            if (!this.connected) return;
            await this.getBalance();
            await this.getTokenBalance();
        }
    };

    function connectWallet() {
        if (WalletSystem.connected) {
            WalletSystem.showDisconnectOption();
        } else {
            WalletSystem.openModal();
        }
    }

    function copyCA() {
        const ca = document.getElementById('ca-address').textContent;
        navigator.clipboard.writeText(ca);
        
        const btn = document.querySelector('.ca-copy');
        btn.textContent = 'âœ…';
        setTimeout(() => btn.textContent = 'ðŸ“‹', 1500);
    }

    function closeWalletModal() {
        WalletSystem.closeModal();
    }

    setInterval(() => {
        if (WalletSystem.connected) {
            WalletSystem.refreshBalances();
        }
    }, 30000);

    /* ================================
       AUDIO SYSTEM
       ================================ */
    const AudioSystem = {
        music: null,
        battleMusic: null,
        isMusicPlaying: false,
        currentTrack: 'main',
        
        init() {
            this.music = new Audio('assets/audio/main-theme.mp3');
            this.battleMusic = new Audio('assets/audio/battle-theme.mp3');
            this.music.loop = true;
            this.battleMusic.loop = true;
            this.music.volume = 0.4;
            this.battleMusic.volume = 0.5;
            
            this.tryAutoplay();
        },
        
        tryAutoplay() {
            const playAttempt = this.music.play();
            
            if (playAttempt !== undefined) {
                playAttempt.then(() => {
                    this.isMusicPlaying = true;
                    this.updateButton(true);
                    console.log('Music autoplay started');
                }).catch(() => {
                    console.log('Autoplay blocked, waiting for interaction');
                    
                    const startMusic = () => {
                        this.playMusic();
                        document.removeEventListener('click', startMusic);
                        document.removeEventListener('scroll', startMusic);
                    };
                    
                    document.addEventListener('click', startMusic, { once: true });
                    document.addEventListener('scroll', startMusic, { once: true });
                });
            }
        },
        
        updateButton(isPlaying) {
            const btn = document.getElementById('music-btn');
            if (btn) {
                if (isPlaying) {
                    btn.classList.add('playing');
                    btn.textContent = 'ðŸ”Š';
                } else {
                    btn.classList.remove('playing');
                    btn.textContent = 'ðŸŽµ';
                }
            }
        },
        
        toggleMusic() {
            if (this.isMusicPlaying) {
                this.stopMusic();
            } else {
                this.playMusic();
            }
        },
        
        playMusic() {
            const track = this.currentTrack === 'battle' ? this.battleMusic : this.music;
            track.play().then(() => {
                this.isMusicPlaying = true;
                this.updateButton(true);
            }).catch(e => console.log('Audio play failed:', e));
        },
        
        stopMusic() {
            this.music.pause();
            this.battleMusic.pause();
            this.isMusicPlaying = false;
            this.updateButton(false);
        },
        
        switchTrack(track) {
            if (this.currentTrack === track) return;
            
            const wasPlaying = this.isMusicPlaying;
            this.music.pause();
            this.battleMusic.pause();
            this.music.currentTime = 0;
            this.battleMusic.currentTime = 0;
            this.currentTrack = track;
            
            if (wasPlaying) {
                this.playMusic();
            }
        },
        
        playSound(type) {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);
            
            switch(type) {
                case 'hit':
                    oscillator.frequency.setValueAtTime(200, ctx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                    oscillator.start(ctx.currentTime);
                    oscillator.stop(ctx.currentTime + 0.1);
                    break;
                    
                case 'critical':
                    oscillator.frequency.setValueAtTime(400, ctx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.1);
                    oscillator.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.4, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                    oscillator.start(ctx.currentTime);
                    oscillator.stop(ctx.currentTime + 0.2);
                    break;
                    
                case 'victory':
                    const notes = [523, 659, 784, 1047];
                    notes.forEach((freq, i) => {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0.2, ctx.currentTime + i * 0.15);
                        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.15 + 0.3);
                        osc.start(ctx.currentTime + i * 0.15);
                        osc.stop(ctx.currentTime + i * 0.15 + 0.3);
                    });
                    break;
                    
                case 'defeat':
                    oscillator.frequency.setValueAtTime(300, ctx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.5);
                    gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                    oscillator.start(ctx.currentTime);
                    oscillator.stop(ctx.currentTime + 0.5);
                    break;
                    
                case 'select':
                    oscillator.frequency.setValueAtTime(600, ctx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.05);
                    gainNode.gain.setValueAtTime(0.15, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.05);
                    oscillator.start(ctx.currentTime);
                    oscillator.stop(ctx.currentTime + 0.05);
                    break;
                    
                case 'heal':
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(400, ctx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                    oscillator.start(ctx.currentTime);
                    oscillator.stop(ctx.currentTime + 0.3);
                    break;
            }
        }
    };

    function toggleMusic() {
        AudioSystem.toggleMusic();
    }

    /* ================================
       GAME DATA
       ================================ */
    const TYPE_CHART = {
        water: { fire: 2, water: 0.5, grass: 0.5, electric: 1, normal: 1, psychic: 1, dark: 1, ice: 1, rock: 2 },
        fire: { water: 0.5, fire: 0.5, grass: 2, electric: 1, normal: 1, psychic: 1, dark: 1, ice: 2, rock: 0.5 },
        grass: { water: 2, fire: 0.5, grass: 0.5, electric: 1, normal: 1, psychic: 1, dark: 1, ice: 0.5, rock: 2 },
        electric: { water: 2, fire: 1, grass: 0.5, electric: 0.5, normal: 1, psychic: 1, dark: 1, ice: 1, rock: 1 },
        normal: { water: 1, fire: 1, grass: 1, electric: 1, normal: 1, psychic: 1, dark: 1, ice: 1, rock: 0.5 },
        psychic: { water: 1, fire: 1, grass: 1, electric: 1, normal: 1, psychic: 0.5, dark: 0, ice: 1, rock: 1 },
        dark: { water: 1, fire: 1, grass: 1, electric: 1, normal: 1, psychic: 2, dark: 0.5, ice: 1, rock: 1 },
        ice: { water: 0.5, fire: 0.5, grass: 2, electric: 1, normal: 1, psychic: 1, dark: 1, ice: 0.5, rock: 1 },
        rock: { water: 0.5, fire: 2, grass: 0.5, electric: 1, normal: 1, psychic: 1, dark: 1, ice: 2, rock: 1 }
    };

    const CHARACTERS = {
        copperinu: {
    name: 'COPPERINU',
    type: 'steel',
    hp: 95,
    attack: 110,
    defense: 85,
    speed: 115,
    image: 'copperinu.png',
    description: 'A speedy copper dog with a fierce bite!',
    role: 'Speedster'
},
        molty: {
    name: 'MOLTY',
    type: 'water',
    hp: 115,
    attack: 90,
    defense: 110,
    speed: 55,
    image: 'labster.png',
    description: 'A fierce lobster with crushing claws!',
    role: 'Tank'
},
        pepe: { 
            name: 'PEPE', 
            image: 'pepe.png', 
            hp: 100, 
            attack: 35, 
            defense: 30, 
            speed: 40, 
            type: 'water',
            description: 'The OG memecoin legend. Balanced stats with healing powers.',
            role: 'Balanced'
        },
        whale: { 
            name: 'WHALE', 
            image: 'whale.png', 
            hp: 130, 
            attack: 26, 
            defense: 40, 
            speed: 20, 
            type: 'water',
            description: 'Massive HP pool and crushing defense. Slow but unstoppable.',
            role: 'Tank'
        },
        cow: { 
            name: 'COW', 
            image: 'cow.png', 
            hp: 115, 
            attack: 32, 
            defense: 40, 
            speed: 30, 
            type: 'normal',
            description: 'Sacred bovine with earthquake powers. Well-rounded bruiser.',
            role: 'Bruiser'
        },
        moodeng: { 
            name: 'MOODENG', 
            image: 'moodeng.png', 
            hp: 95, 
            attack: 42, 
            defense: 28, 
            speed: 45, 
            type: 'psychic',
            description: 'Viral hippo with psychic chomps. High attack potential.',
            role: 'Attacker'
        },
        catana: { 
            name: 'CATANA', 
            image: 'catana.png', 
            hp: 82, 
            attack: 48, 
            defense: 22, 
            speed: 58, 
            type: 'dark',
            description: 'Ninja cat assassin. Glass cannon with critical hits.',
            role: 'Assassin'
        },
        dicklet: { 
            name: 'DICKLET', 
            image: 'dicklet.png', 
            hp: 120, 
            attack: 38, 
            defense: 55, 
            speed: 15, 
            type: 'rock',
            description: 'Ancient rock warrior. Extremely tanky with devastating quakes.',
            role: 'Tank'
        },
        penguin: { 
            name: 'PENGUIN', 
            image: 'penguin.png', 
            hp: 88, 
            attack: 45, 
            defense: 32, 
            speed: 50, 
            type: 'ice',
            description: 'Icy evolved form of PEPE. Fast attacker with freezing powers.',
            role: 'Speedster'
        }
    };

    const MOVES = {
copperinu: [
    { name: 'METAL CLAW', type: 'steel', power: 85, accuracy: 80, pp: 15 },
    { name: 'BULLET PUNCH', type: 'steel', power: 40, accuracy: 100, pp: 30, priority: true },
    { name: 'IRON HEAD', type: 'steel', power: 80, accuracy: 80, pp: 10 },
    { name: 'METAL SOUND', type: 'steel', power: 50, accuracy: 100, pp: 20, boost: { attack: 1, defense: 1 } }
],
        molty: [
    { name: 'CRABHAMMER', type: 'water', power: 90, accuracy: 85, pp: 10, highCrit: true },
    { name: 'GUILLOTINE', type: 'normal', power: 80, accuracy: 70, pp: 5 },
    { name: 'IRON DEFENSE', type: 'normal', power: 10, accuracy: 100, pp: 15, boost: { defense: 2 } },
    { name: 'AQUA JET', type: 'water', power: 40, accuracy: 100, pp: 20, priority: true }
],
        pepe: [
            { name: 'WATER GUN', type: 'water', power: 40, accuracy: 100, pp: 25 },
            { name: 'BUBBLE BEAM', type: 'water', power: 65, accuracy: 100, pp: 15, effect: 'speed-down', effectChance: 10 },
            { name: 'MEME MAGIC', type: 'psychic', power: 50, accuracy: 100, pp: 15, effect: 'confuse', effectChance: 10 },
            { name: 'RECOVER', type: 'normal', power: 0, accuracy: 100, pp: 10, heal: 50 }
        ],
        whale: [
            { name: 'SURF', type: 'water', power: 90, accuracy: 80, pp: 15 },
            { name: 'BODY SLAM', type: 'normal', power: 85, accuracy: 100, pp: 15, effect: 'paralyze', effectChance: 30 },
            { name: 'MARKET CRASH', type: 'dark', power: 120, accuracy: 85, pp: 5 },
            { name: 'REST', type: 'normal', power: 0, accuracy: 100, pp: 10, heal: 100, selfSleep: true }
        ],
        cow: [
            { name: 'STOMP', type: 'normal', power: 65, accuracy: 100, pp: 20, effect: 'flinch', effectChance: 30 },
            { name: 'EARTHQUAKE', type: 'normal', power: 100, accuracy: 100, pp: 10 },
            { name: 'MILK DRINK', type: 'normal', power: 0, accuracy: 100, pp: 10, heal: 50 },
            { name: 'ZEN HEADBUTT', type: 'psychic', power: 80, accuracy: 90, pp: 15, effect: 'flinch', effectChance: 20 }
        ],
        moodeng: [
            { name: 'PSYCHIC', type: 'psychic', power: 90, accuracy: 100, pp: 10, effect: 'spdef-down', effectChance: 10 },
            { name: 'CRUNCH', type: 'dark', power: 80, accuracy: 100, pp: 15, effect: 'def-down', effectChance: 20 },
            { name: 'HIPPO CHOMP', type: 'dark', power: 60, accuracy: 100, pp: 25 },
            { name: 'CALM MIND', type: 'psychic', power: 0, accuracy: 100, pp: 20, boost: { attack: 1 } }
        ],
        catana: [
            { name: 'NIGHT SLASH', type: 'dark', power: 70, accuracy: 100, pp: 15, highCrit: true },
            { name: 'SUCKER PUNCH', type: 'dark', power: 70, accuracy: 100, pp: 5, priority: true },
            { name: 'SLASH', type: 'normal', power: 70, accuracy: 100, pp: 20, highCrit: true },
            { name: 'SWORDS DANCE', type: 'normal', power: 0, accuracy: 100, pp: 20, boost: { attack: 2 } }
        ],
        dicklet: [
            { name: 'ROCK THROW', type: 'rock', power: 50, accuracy: 90, pp: 25 },
            { name: 'EARTHQUAKE', type: 'rock', power: 100, accuracy: 100, pp: 10 },
            { name: 'STONE EDGE', type: 'rock', power: 100, accuracy: 80, pp: 5, highCrit: true },
            { name: 'HARDEN', type: 'rock', power: 0, accuracy: 100, pp: 30, boost: { defense: 1 } }
        ],
        penguin: [
            { name: 'ICE BEAM', type: 'ice', power: 90, accuracy: 100, pp: 10, effect: 'freeze', effectChance: 10 },
            { name: 'SURF', type: 'water', power: 90, accuracy: 100, pp: 15 },
            { name: 'BLIZZARD', type: 'ice', power: 110, accuracy: 70, pp: 5, effect: 'freeze', effectChance: 10 },
            { name: 'AQUA RING', type: 'water', power: 0, accuracy: 100, pp: 20, heal: 25 }
        ]
    };

    /* ================================
       GAME STATE
       ================================ */
    let gameState = {
        playerKey: 'pepe',
        enemyKey: 'molty',
        playerHP: 100,
        playerMaxHP: 100,
        enemyHP: 140,
        enemyMaxHP: 130,
        playerLevel: 50,
        enemyLevel: 48,
        isPlayerTurn: true,
        selectedChar: 'pepe',
        moves: [],
        playerStatus: null,
        enemyStatus: null,
        playerShiny: false,
        enemyShiny: false,
        playerBoosts: { attack: 0, defense: 0, speed: 0 },
        enemyBoosts: { attack: 0, defense: 0, speed: 0 },
        turnCount: 0
    };

    /* ================================
       GAME FUNCTIONS
       ================================ */
    function checkBattleBackground() {
        const arena = document.getElementById('battle-arena');
        const bgImage = new Image();
        bgImage.src = 'assets/images/battle-bg.png';
        
        bgImage.onload = () => arena.classList.remove('no-bg');
        bgImage.onerror = () => arena.classList.add('no-bg');
        
        setTimeout(() => {
            if (!bgImage.complete || bgImage.naturalWidth === 0) {
                arena.classList.add('no-bg');
            }
        }, 1000);
    }

    function init() {
        checkBattleBackground();
        renderCharacterGrid();
        initBattle();
    }

    function renderCharacterGrid() {
        const grid = document.getElementById('char-grid');
        grid.innerHTML = '';
        
        Object.entries(CHARACTERS).forEach(([key, char]) => {
            const card = document.createElement('div');
            card.className = `char-card ${key === gameState.selectedChar ? 'selected' : ''}`;
            card.onclick = () => selectChar(key);
            
            const getStatClass = (value, stat) => {
                if (stat === 'hp') return value >= 110 ? 'high' : value >= 95 ? 'medium' : 'low';
                if (stat === 'attack') return value >= 42 ? 'high' : value >= 32 ? 'medium' : 'low';
                if (stat === 'defense') return value >= 40 ? 'high' : value >= 28 ? 'medium' : 'low';
                if (stat === 'speed') return value >= 45 ? 'high' : value >= 30 ? 'medium' : 'low';
                return '';
            };
            
            card.innerHTML = `
                <img src="assets/images/characters/${char.image}" alt="${char.name}">
                <div class="name">${char.name}</div>
                <span class="type-badge ${char.type}">${char.type}</span>
                <div class="role">âš”ï¸ ${char.role}</div>
                <div class="description">${char.description}</div>
                <div class="stats">
                    <div class="stat">
                        <span class="stat-label">HP</span>
                        <span class="stat-value ${getStatClass(char.hp, 'hp')}">${char.hp}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">ATK</span>
                        <span class="stat-value ${getStatClass(char.attack, 'attack')}">${char.attack}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">DEF</span>
                        <span class="stat-value ${getStatClass(char.defense, 'defense')}">${char.defense}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">SPD</span>
                        <span class="stat-value ${getStatClass(char.speed, 'speed')}">${char.speed}</span>
                    </div>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function selectChar(key) {
        gameState.selectedChar = key;
        AudioSystem.playSound('select');
        document.querySelectorAll('.char-card').forEach(c => c.classList.remove('selected'));
        document.querySelector(`.char-card:nth-child(${Object.keys(CHARACTERS).indexOf(key) + 1})`).classList.add('selected');
    }

/* ================================
   SELECT AND PLAY - Direct to Battle
   ================================ */
function selectAndPlay(key) {
    // Convert to lowercase to match CHARACTERS object
    const charKey = key.toLowerCase();
    
    // Check if character exists
    if (!CHARACTERS[charKey]) {
        console.error('Character not found:', charKey);
        alert('Character not found: ' + charKey);
        return;
    }
    
    // Check if moves exist
    if (!MOVES[charKey]) {
        console.error('Moves not found for:', charKey);
        alert('Moves not found for: ' + charKey);
        return;
    }
    
    // Set selected character
    gameState.selectedChar = charKey;
    gameState.playerKey = charKey;
    
    console.log('âœ… Selected character:', charKey);
    
    // Play sound
    if (typeof AudioSystem !== 'undefined' && AudioSystem.playSound) {
        AudioSystem.playSound('select');
    }
    
    // CHECK PAYMENT BEFORE BATTLE
    PayToPlay.checkPayment(() => {
        // Scroll to game and start battle
        scrollToGame();
        
        setTimeout(() => {
            initBattle();
        }, 500);
    });
}
function scrollToGame() {
    const gameSection = document.getElementById('game') || 
                        document.querySelector('.game-section') || 
                        document.querySelector('.battle-arena');
    
    if (gameSection) {
        gameSection.scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
        });
    }
}
function initBattle() {
    // Difficulty scaling - more wins = harder enemies
    const difficultyBonus = Math.min(10, Math.floor(RewardSystem.state.totalWins / 3)); // +1 level per 3 wins, max +10
    
    const playerKey = gameState.playerKey;
    const player = CHARACTERS[playerKey];
    
    const enemyKeys = Object.keys(CHARACTERS).filter(k => k !== playerKey);
    const enemyKey = enemyKeys[Math.floor(Math.random() * enemyKeys.length)];
    const enemy = CHARACTERS[enemyKey];
    
    gameState.enemyKey = enemyKey;
    gameState.playerHP = player.hp;
    gameState.playerMaxHP = player.hp;
    gameState.enemyHP = enemy.hp;
    gameState.enemyMaxHP = enemy.hp;
    gameState.playerLevel = 50;
    gameState.enemyLevel = 50 + Math.floor(Math.random() * 11) + difficultyBonus; // Level 50-60 + bonus from wins!
    gameState.moves = MOVES[playerKey].map(m => ({...m, currentPP: m.pp}));
    
    gameState.playerStatus = null;
    gameState.enemyStatus = null;
    gameState.playerBoosts = { attack: 0, defense: 0, speed: 0 };
    gameState.enemyBoosts = { attack: 0, defense: 0, speed: 0 };
    gameState.turnCount = 0;
    
    gameState.playerShiny = Math.random() < 0.05;
    gameState.enemyShiny = Math.random() < 0.05;
    
    gameState.isPlayerTurn = player.speed >= enemy.speed;
    
    document.getElementById('player-name').textContent = player.name + (gameState.playerShiny ? ' âœ¨' : '');
    document.getElementById('enemy-name').textContent = enemy.name + (gameState.enemyShiny ? ' âœ¨' : '');
    document.getElementById('player-hp').textContent = player.hp;
    document.getElementById('player-max-hp').textContent = player.hp;
    document.getElementById('player-level').textContent = gameState.playerLevel;
    document.getElementById('enemy-level').textContent = gameState.enemyLevel;
    
    document.getElementById('player-img').src = `assets/images/characters/${player.image}`;
    document.getElementById('enemy-img').src = `assets/images/characters/${enemy.image}`;
    
    const backImageName = player.image.replace('.png', '-back.png');
    document.getElementById('player-img-back').src = `assets/images/characters/${backImageName}`;
    document.getElementById('player-img-back').onerror = function() {
        this.src = `assets/images/characters/${player.image}`;
    };
    
    const playerSprite = document.getElementById('player-sprite');
    const playerSpriteBack = document.getElementById('player-sprite-back');
    const enemySprite = document.getElementById('enemy-sprite');
    playerSprite.classList.toggle('shiny', gameState.playerShiny);
    playerSpriteBack.classList.toggle('shiny', gameState.playerShiny);
    enemySprite.classList.toggle('shiny', gameState.enemyShiny);
    
    playerSprite.style.opacity = '1';
    playerSprite.style.transform = '';
    playerSpriteBack.style.opacity = '1';
    playerSpriteBack.style.transform = '';
    enemySprite.style.opacity = '1';
    enemySprite.style.transform = '';
    
    updateHPBars();
    updateStatusDisplay();
    updateTurnIndicator();
    renderMoves();
    clearLog();
    
    showBattleIntro(enemy);
    
    const battleResult = document.getElementById('battle-result');
    battleResult.style.display = 'none';
    battleResult.classList.remove('show');
}
    function showBattleIntro(enemy) {
        const intro = document.getElementById('battle-intro');
        const text = document.getElementById('intro-text');
        
        intro.classList.remove('hide');
        intro.style.animation = 'none';
        intro.offsetHeight;
        intro.style.animation = 'introFade 2.5s ease-out forwards';
        
        const shinyText = gameState.enemyShiny ? '<span class="shiny-name">âœ¨ SHINY ' + enemy.name + ' âœ¨</span>' : enemy.name;
        text.innerHTML = `A wild ${shinyText} appeared!`;
        
        setTimeout(() => {
            intro.classList.add('hide');
            addLog(`A wild ${enemy.name} appeared!`, 'system');
            if (gameState.enemyShiny) addLog(`It's shiny! âœ¨`, 'info');
            addLog(`Go! ${CHARACTERS[gameState.playerKey].name}!`, 'system');
            if (gameState.playerShiny) addLog(`Your ${CHARACTERS[gameState.playerKey].name} is shiny! âœ¨`, 'info');
            
            if (!gameState.isPlayerTurn) {
                addLog(`${enemy.name} is faster!`, 'enemy');
                setTimeout(() => enemyTurn(), 1000);
            }
        }, 2500);
    }
    
    function updateTurnIndicator() {
        const indicator = document.getElementById('turn-indicator');
        indicator.textContent = gameState.isPlayerTurn ? 'YOUR TURN' : 'ENEMY TURN';
        indicator.className = 'turn-indicator' + (gameState.isPlayerTurn ? '' : ' enemy');
    }
    
    function updateStatusDisplay() {
        const playerStatus = document.getElementById('player-status');
        const enemyStatus = document.getElementById('enemy-status');
        
        const statusNames = { par: 'PAR', brn: 'BRN', psn: 'PSN', slp: 'SLP', frz: 'FRZ' };
        
        playerStatus.innerHTML = gameState.playerStatus 
            ? `<span class="status-badge status-${gameState.playerStatus}">${statusNames[gameState.playerStatus]}</span>` 
            : '';
        enemyStatus.innerHTML = gameState.enemyStatus 
            ? `<span class="status-badge status-${gameState.enemyStatus}">${statusNames[gameState.enemyStatus]}</span>` 
            : '';
    }

    function renderMoves() {
        const grid = document.getElementById('move-grid');
        grid.innerHTML = '';
        
        const typeColors = {
            water: '#3b82f6',
            electric: '#fbbf24',
            fire: '#ef4444',
            normal: '#a3a3a3',
            dark: '#374151',
            psychic: '#ec4899',
            grass: '#22c55e',
            ice: '#67e8f9',
            rock: '#a8a29e'
        };
        
        gameState.moves.forEach((move, i) => {
            const btn = document.createElement('button');
            btn.className = 'move-btn';
            btn.disabled = !gameState.isPlayerTurn || move.currentPP <= 0;
            btn.onclick = () => useMove(i);
            
            const typeColor = typeColors[move.type] || '#a3a3a3';
            const textColor = move.type === 'electric' || move.type === 'ice' ? '#000' : '#fff';
            
            btn.innerHTML = `
                <div style="font-weight: 600; font-size: 0.8rem; margin-bottom: 6px; color: #fff;">${move.name}</div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 0.6rem; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; font-weight: 600; background: ${typeColor}; color: ${textColor};">${move.type.toUpperCase()}</span>
                    <span style="font-size: 0.7rem; color: #888;">PP ${move.currentPP}/${move.pp}</span>
                </div>
            `;
            grid.appendChild(btn);
        });
    }

    function useMove(index) {
        if (!gameState.isPlayerTurn) return;
        
        const move = gameState.moves[index];
        if (move.currentPP <= 0) return;
        
        move.currentPP--;
        gameState.isPlayerTurn = false;
        updateTurnIndicator();
        AudioSystem.playSound('select');
        
        const player = CHARACTERS[gameState.playerKey];
        const enemy = CHARACTERS[gameState.enemyKey];
        
        if (gameState.playerStatus === 'par' && Math.random() < 0.25) {
            addLog(`${player.name} is paralyzed! It can't move!`, 'info');
            setTimeout(() => enemyTurn(), 1000);
            return;
        }
        
        if (gameState.playerStatus === 'slp') {
            if (Math.random() < 0.33) {
                gameState.playerStatus = null;
                updateStatusDisplay();
                addLog(`${player.name} woke up!`, 'info');
            } else {
                addLog(`${player.name} is fast asleep!`, 'info');
                setTimeout(() => enemyTurn(), 1000);
                return;
            }
        }
        
        addLog(`${player.name} used ${move.name}!`);
        
        const playerSpriteBack = document.getElementById('player-sprite-back');
        playerSpriteBack.classList.add('attacking');
        setTimeout(() => playerSpriteBack.classList.remove('attacking'), 400);
        
        setTimeout(() => {
            if (move.accuracy && Math.random() * 100 > move.accuracy) {
                addLog(`${player.name}'s attack missed!`, 'info');
                AudioSystem.playSound('select');
                showDamageNumber('MISS', 'enemy', true);
                setTimeout(() => enemyTurn(), 1000);
                return;
            }
            
            if (move.heal) {
                const healAmount = Math.floor(gameState.playerMaxHP * (move.heal / 100));
                gameState.playerHP = Math.min(gameState.playerMaxHP, gameState.playerHP + healAmount);
                addLog(`${player.name} recovered ${healAmount} HP!`, 'info');
                AudioSystem.playSound('heal');
                showDamageNumber(`+${healAmount}`, 'player', false, true);
                
                if (move.selfSleep) {
                    gameState.playerStatus = 'slp';
                    updateStatusDisplay();
                    addLog(`${player.name} fell asleep!`, 'info');
                }
                
                updateHPBars();
                setTimeout(() => enemyTurn(), 1000);
                return;
            }
            
            if (move.boost) {
                Object.entries(move.boost).forEach(([stat, amount]) => {
                    gameState.playerBoosts[stat] = Math.min(6, gameState.playerBoosts[stat] + amount);
                    const sharpText = amount >= 2 ? ' sharply' : '';
                    addLog(`${player.name}'s ${stat} rose${sharpText}!`, 'info');
                });
                AudioSystem.playSound('heal');
                setTimeout(() => enemyTurn(), 1000);
                return;
            }
            
            const result = calculateDamage(move, player, enemy, true);
            gameState.enemyHP = Math.max(0, gameState.enemyHP - result.damage);
            
            showDamageNumber(result.damage, 'enemy', result.isCritical);
            
            if (result.effectiveness > 1) {
                addLog("It's super effective!", 'info');
                showEffectivenessPopup('super');
                AudioSystem.playSound('critical');
            } else if (result.effectiveness < 1 && result.effectiveness > 0) {
                addLog("It's not very effective...", 'info');
                showEffectivenessPopup('not-very');
            } else if (result.effectiveness === 0) {
                addLog(`It doesn't affect ${enemy.name}...`, 'info');
                showEffectivenessPopup('immune');
            }
            
            if (result.isCritical) {
                addLog(`Critical hit! Dealt ${result.damage} damage!`);
                AudioSystem.playSound('critical');
                screenShake();
            } else {
                addLog(`Dealt ${result.damage} damage!`);
                AudioSystem.playSound('hit');
            }
            
            if (move.effect && move.effectChance && Math.random() * 100 < move.effectChance) {
                applyStatus('enemy', move.effect);
            }
            
            const enemySprite = document.getElementById('enemy-sprite');
            enemySprite.classList.add('damaged');
            setTimeout(() => enemySprite.classList.remove('damaged'), 400);
            
            updateHPBars();
            renderMoves();
            
            if (gameState.enemyHP <= 0) {
                endBattle(true);
            } else {
                setTimeout(enemyTurn, 1000);
            }
        }, 300);
    }

    function enemyTurn() {
    const enemy = CHARACTERS[gameState.enemyKey];
    const player = CHARACTERS[gameState.playerKey];
    const enemyMoves = MOVES[gameState.enemyKey];
    
    gameState.turnCount++;
    
    // Status damage
    if (gameState.enemyStatus === 'brn' || gameState.enemyStatus === 'psn') {
        const statusDamage = Math.floor(gameState.enemyMaxHP / 16);
        gameState.enemyHP = Math.max(0, gameState.enemyHP - statusDamage);
        const statusName = gameState.enemyStatus === 'brn' ? 'burn' : 'poison';
        addLog(`${enemy.name} was hurt by ${statusName}!`, 'info');
        updateHPBars();
        
        if (gameState.enemyHP <= 0) {
            endBattle(true);
            return;
        }
    }
    
    // Paralysis check
    if (gameState.enemyStatus === 'par' && Math.random() < 0.25) {
        addLog(`${enemy.name} is paralyzed! It can't move!`, 'enemy');
        endEnemyTurn();
        return;
    }
    
    // Sleep check
    if (gameState.enemyStatus === 'slp') {
        if (Math.random() < 0.33) {
            gameState.enemyStatus = null;
            updateStatusDisplay();
            addLog(`${enemy.name} woke up!`, 'enemy');
        } else {
            addLog(`${enemy.name} is fast asleep!`, 'enemy');
            endEnemyTurn();
            return;
        }
    }

    /* ================================
   AUTO CARD SHUFFLE SYSTEM
   ================================ */
const CardShuffler = {
    cardFan: null,
    shuffleInterval: null,
    shuffleTypes: ['wave-shuffle', 'flip-shuffle', 'scatter-shuffle'],
    currentIndex: 0,
    intervalTime: 5000, // Shuffle every 5 seconds
    isEnabled: true,
    
    init() {
        this.cardFan = document.querySelector('.card-fan');
        if (!this.cardFan) return;
        
        // Store original transforms for each card
        this.storeOriginalTransforms();
        
        // Start auto shuffle
        this.startAutoShuffle();
        
        // Pause on hover
        this.cardFan.addEventListener('mouseenter', () => this.pause());
        this.cardFan.addEventListener('mouseleave', () => this.resume());
        
        console.log('ðŸŽ´ Card Shuffler initialized');
    },
    
    storeOriginalTransforms() {
        const cards = this.cardFan.querySelectorAll('.char-avatar');
        cards.forEach((card, index) => {
            const style = window.getComputedStyle(card);
            card.style.setProperty('--original-transform', style.transform);
        });
    },
    
    shuffle(type = null) {
        if (!this.cardFan || !this.isEnabled) return;
        
        // Remove any existing shuffle class
        this.shuffleTypes.forEach(t => this.cardFan.classList.remove(t));
        
        // Pick shuffle type (random or specified)
        const shuffleType = type || this.shuffleTypes[Math.floor(Math.random() * this.shuffleTypes.length)];
        
        // Add shuffle class
        this.cardFan.classList.add(shuffleType);
        
        // Play sound if available
        if (typeof AudioSystem !== 'undefined' && AudioSystem.playSound) {
            AudioSystem.playSound('select');
        }
        
        // Remove class after animation
        setTimeout(() => {
            this.cardFan.classList.remove(shuffleType);
        }, 2000);
    },
    
    startAutoShuffle() {
        if (this.shuffleInterval) clearInterval(this.shuffleInterval);
        
        // Initial shuffle after 2 seconds
        setTimeout(() => this.shuffle(), 2000);
        
        // Then shuffle at regular intervals
        this.shuffleInterval = setInterval(() => {
            this.shuffle();
        }, this.intervalTime);
    },
    
    stopAutoShuffle() {
        if (this.shuffleInterval) {
            clearInterval(this.shuffleInterval);
            this.shuffleInterval = null;
        }
    },
    
    pause() {
        this.isEnabled = false;
    },
    
    resume() {
        this.isEnabled = true;
    },
    
    setInterval(ms) {
        this.intervalTime = ms;
        this.startAutoShuffle();
    }
};

// Initialize on DOM ready
document.addEventListener('DOMContentLoaded', () => {
    CardShuffler.init();
});
    
    // ========== SMART AI ==========
    let move;
    
    // Priority 1: Heal if low HP (30% or less)
    const healMoves = enemyMoves.filter(m => m.heal);
    if (gameState.enemyHP < gameState.enemyMaxHP * 0.3 && healMoves.length > 0 && Math.random() < 0.8) {
        move = healMoves[0];
    }
    // Priority 2: Boost if first few turns
    else if (gameState.turnCount <= 2) {
        const boostMoves = enemyMoves.filter(m => m.boost);
        if (boostMoves.length > 0 && Math.random() < 0.5) {
            move = boostMoves[0];
        }
    }
    
    // Priority 3: Use super effective moves (90% chance)
    if (!move) {
        const superMoves = enemyMoves.filter(m => m.power && getTypeEffectiveness(m.type, player.type) > 1);
        if (superMoves.length > 0 && Math.random() < 0.9) {
            // Pick highest power super effective move
            move = superMoves.reduce((best, m) => (m.power || 0) > (best.power || 0) ? m : best);
        }
    }
    
    // Priority 4: Finish off low HP player with strongest move
    if (!move && gameState.playerHP < gameState.playerMaxHP * 0.25) {
        move = enemyMoves.filter(m => m.power).reduce((best, m) => (m.power || 0) > (best.power || 0) ? m : best);
    }
    
    // Priority 5: Use high power moves more often
    if (!move) {
        const attackMoves = enemyMoves.filter(m => m.power);
        if (attackMoves.length > 0) {
            // Weight towards higher power moves
            const weighted = attackMoves.sort((a, b) => b.power - a.power);
            const roll = Math.random();
            if (roll < 0.5) {
                move = weighted[0]; // 50% strongest
            } else if (roll < 0.8 && weighted.length > 1) {
                move = weighted[1]; // 30% second strongest
            } else {
                move = weighted[Math.floor(Math.random() * weighted.length)];
            }
        }
    }
    
    // Fallback: random move
    if (!move) {
        move = enemyMoves[Math.floor(Math.random() * enemyMoves.length)];
    }
    
    addLog(`${enemy.name} used ${move.name}!`, 'enemy');
    
    const enemySprite = document.getElementById('enemy-sprite');
    enemySprite.classList.add('attacking');
    setTimeout(() => enemySprite.classList.remove('attacking'), 400);
    
    setTimeout(() => {
        // Accuracy check
        if (move.accuracy && Math.random() * 100 > move.accuracy) {
            addLog(`${enemy.name}'s attack missed!`, 'enemy');
            showDamageNumber('MISS', 'player', true);
            endEnemyTurn();
            return;
        }
        
        // Healing move
        if (move.heal) {
            const healAmount = Math.floor(gameState.enemyMaxHP * (move.heal / 100));
            gameState.enemyHP = Math.min(gameState.enemyMaxHP, gameState.enemyHP + healAmount);
            addLog(`${enemy.name} recovered health!`, 'enemy');
            AudioSystem.playSound('heal');
            updateHPBars();
            endEnemyTurn();
            return;
        }
        
        // Boost move
        if (move.boost) {
            Object.entries(move.boost).forEach(([stat, amount]) => {
                gameState.enemyBoosts[stat] = Math.min(6, gameState.enemyBoosts[stat] + amount);
            });
            addLog(`${enemy.name}'s stats rose!`, 'enemy');
            endEnemyTurn();
            return;
        }
        
        // Damage calculation
        const result = calculateDamage(move, enemy, player, false);
        gameState.playerHP = Math.max(0, gameState.playerHP - result.damage);
        
        showDamageNumber(result.damage, 'player', result.isCritical);
        
        if (result.effectiveness > 1) {
            addLog("It's super effective!", 'enemy');
        } else if (result.effectiveness < 1 && result.effectiveness > 0) {
            addLog("It's not very effective...", 'enemy');
        }
        
        if (result.isCritical) {
            addLog(`Critical hit! Took ${result.damage} damage!`, 'enemy');
            AudioSystem.playSound('critical');
            screenShake();
        } else {
            addLog(`Took ${result.damage} damage!`, 'enemy');
            AudioSystem.playSound('hit');
        }
        
        // Apply status effects
        if (move.effect && move.effectChance && Math.random() * 100 < move.effectChance) {
            applyStatus('player', move.effect);
        }
        
        const playerSpriteBack = document.getElementById('player-sprite-back');
        playerSpriteBack.classList.add('damaged');
        setTimeout(() => playerSpriteBack.classList.remove('damaged'), 400);
        
        updateHPBars();
        
        if (gameState.playerHP <= 0) {
            endBattle(false);
        } else {
            endEnemyTurn();
        }
    }, 300);
}
    
    function endEnemyTurn() {
        if (gameState.playerStatus === 'brn' || gameState.playerStatus === 'psn') {
            const statusDamage = Math.floor(gameState.playerMaxHP / 16);
            gameState.playerHP = Math.max(0, gameState.playerHP - statusDamage);
            const statusName = gameState.playerStatus === 'brn' ? 'burn' : 'poison';
            addLog(`${CHARACTERS[gameState.playerKey].name} was hurt by ${statusName}!`, 'info');
            updateHPBars();
            
            if (gameState.playerHP <= 0) {
                endBattle(false);
                return;
            }
        }
        
        gameState.isPlayerTurn = true;
        updateTurnIndicator();
        renderMoves();
    }
    
    function getTypeEffectiveness(moveType, defenderType) {
        if (TYPE_CHART[moveType] && TYPE_CHART[moveType][defenderType] !== undefined) {
            return TYPE_CHART[moveType][defenderType];
        }
        return 1;
    }
    
    function applyStatus(target, status) {
        if (status === 'paralyze') status = 'par';
        if (status === 'freeze') status = 'frz';
        
        if (target === 'player' && !gameState.playerStatus) {
            gameState.playerStatus = status;
            const statusNames = { par: 'paralyzed', brn: 'burned', psn: 'poisoned', slp: 'fell asleep', frz: 'frozen' };
            addLog(`${CHARACTERS[gameState.playerKey].name} was ${statusNames[status]}!`, 'info');
            AudioSystem.playSound('select');
        } else if (target === 'enemy' && !gameState.enemyStatus) {
            gameState.enemyStatus = status;
            const statusNames = { par: 'paralyzed', brn: 'burned', psn: 'poisoned', slp: 'fell asleep', frz: 'frozen' };
            addLog(`${CHARACTERS[gameState.enemyKey].name} was ${statusNames[status]}!`, 'info');
            AudioSystem.playSound('select');
        }
        updateStatusDisplay();
    }

    function calculateDamage(move, attacker, defender, isPlayer) {
        const level = isPlayer ? gameState.playerLevel : gameState.enemyLevel;
        const attackBoost = isPlayer ? gameState.playerBoosts.attack : gameState.enemyBoosts.attack;
        const defenseBoost = isPlayer ? gameState.enemyBoosts.defense : gameState.playerBoosts.defense;
        
        const atkMultiplier = [0.25, 0.28, 0.33, 0.4, 0.5, 0.67, 1, 1.5, 2, 2.5, 3, 3.5, 4][attackBoost + 6];
        const defMultiplier = [0.25, 0.28, 0.33, 0.4, 0.5, 0.67, 1, 1.5, 2, 2.5, 3, 3.5, 4][defenseBoost + 6];
        
        const attack = attacker.attack * atkMultiplier;
        const defense = defender.defense * defMultiplier;
        
        let damage = Math.floor(((2 * level / 5 + 2) * move.power * attack / defense) / 50 + 2);
        
        if (move.type === attacker.type) {
            damage = Math.floor(damage * 1.5);
        }
        
        const effectiveness = getTypeEffectiveness(move.type, defender.type);
        damage = Math.floor(damage * effectiveness);
        
        // Enemy crits more, player crits less
const baseCrit = isPlayer ? 0.05 : 0.12; // Player 5%, Enemy 12%
const critChance = move.highCrit ? 0.25 : baseCrit;
        const isCritical = Math.random() < critChance;
        if (isCritical) {
            damage = Math.floor(damage * 1.5);
        }
        
        damage = Math.floor(damage * (0.85 + Math.random() * 0.15));
        
        const attackerStatus = isPlayer ? gameState.playerStatus : gameState.enemyStatus;
        if (attackerStatus === 'brn') {
            damage = Math.floor(damage * 0.5);
        }
        
        return { damage: Math.max(1, damage), isCritical, effectiveness };
    }
    
    function showDamageNumber(value, target, isCritical = false, isHeal = false) {
        const arena = document.getElementById('battle-arena');
        const num = document.createElement('div');
        num.className = 'damage-number' + (isCritical ? ' critical' : '') + (isHeal ? ' heal' : '') + (value === 'MISS' ? ' miss' : '');
        num.textContent = isHeal ? value : (value === 'MISS' ? 'MISS' : '-' + value);
        
        if (target === 'enemy') {
            num.style.right = '15%';
            num.style.top = '180px';
        } else {
            num.style.left = '15%';
            num.style.bottom = '200px';
        }
        
        arena.appendChild(num);
        setTimeout(() => num.remove(), 1200);
    }
    
    function showEffectivenessPopup(type) {
        const arena = document.getElementById('battle-arena');
        const popup = document.createElement('div');
        popup.className = 'effectiveness-popup ' + type;
        popup.textContent = type === 'super' ? "It's super effective!" : type === 'not-very' ? "Not very effective..." : "No effect!";
        arena.appendChild(popup);
        setTimeout(() => popup.remove(), 1500);
    }

    function updateHPBars() {
        const playerPercent = (gameState.playerHP / gameState.playerMaxHP) * 100;
        const enemyPercent = (gameState.enemyHP / gameState.enemyMaxHP) * 100;
        
        const playerBar = document.getElementById('player-hp-bar');
        const enemyBar = document.getElementById('enemy-hp-bar');
        
        playerBar.style.width = Math.max(0, playerPercent) + '%';
        enemyBar.style.width = Math.max(0, enemyPercent) + '%';
        
        playerBar.className = 'hp-bar-inner' + (playerPercent <= 20 ? ' low' : playerPercent <= 50 ? ' medium' : '');
        enemyBar.className = 'hp-bar-inner' + (enemyPercent <= 20 ? ' low' : enemyPercent <= 50 ? ' medium' : '');
        
        document.getElementById('player-hp').textContent = Math.max(0, gameState.playerHP);
    }

    // â¬‡ï¸ UPDATED endBattle FUNCTION - Now integrates with RewardSystem â¬‡ï¸
    function endBattle(won) {
        const result = document.getElementById('battle-result');
        const player = CHARACTERS[gameState.playerKey];
        const enemy = CHARACTERS[gameState.enemyKey];
        
        if (won) {
            // Award tokens via RewardSystem
            const tokensEarned = RewardSystem.onWin(gameState.enemyShiny);
            
            const baseExp = Math.floor(enemy.hp * gameState.enemyLevel / 7);
            const expGain = Math.floor(baseExp * (gameState.enemyShiny ? 1.5 : 1));
            
            document.getElementById('result-title').textContent = 'VICTORY!';
            document.getElementById('result-subtitle').innerHTML = `
                ${player.name} gained ${expGain} EXP!<br>
                <span style="color: var(--primary)">+${tokensEarned} $PALS</span>
                ${gameState.enemyShiny ? '<br><span style="color: #ec4899">âœ¨ Shiny bonus!</span>' : ''}
                ${RewardSystem.state.winStreak >= 3 ? '<br><span style="color: #22c55e">ðŸ”¥ ' + RewardSystem.state.winStreak + ' Win Streak!</span>' : ''}
            `;
            
            const enemySprite = document.getElementById('enemy-sprite');
            enemySprite.style.transition = 'all 0.5s';
            enemySprite.style.opacity = '0';
            enemySprite.style.transform = 'translateY(30px)';
            
            AudioSystem.playSound('victory');
        } else {
            // Track loss via RewardSystem
            RewardSystem.onLose();
            
            document.getElementById('result-title').textContent = 'DEFEATED';
            document.getElementById('result-subtitle').textContent = 'Try again!';
            
            const playerSpriteBack = document.getElementById('player-sprite-back');
            playerSpriteBack.style.transition = 'all 0.5s';
            playerSpriteBack.style.opacity = '0';
            playerSpriteBack.style.transform = 'translateY(30px) rotate(10deg)';
            
            AudioSystem.playSound('defeat');
        }
        
        setTimeout(() => {
            result.style.display = 'block';
            result.classList.add('show');
        }, 600);
    }

    function resetBattle() {
        const result = document.getElementById('battle-result');
        result.style.display = 'none';
        result.classList.remove('show');
        initBattle();
    }

    function addLog(text, type = '') {
        const log = document.getElementById('battle-log');
        const entry = document.createElement('div');
        entry.className = 'log-entry ' + type;
        entry.textContent = '> ' + text;
        log.appendChild(entry);
        log.scrollTop = log.scrollHeight;
    }

    function clearLog() {
        document.getElementById('battle-log').innerHTML = '';
    }

    function screenShake() {
        const arena = document.getElementById('battle-arena');
        arena.classList.add('shake');
        setTimeout(() => arena.classList.remove('shake'), 300);
    }

    function openModal() {
        renderCharacterGrid();
        const modal = document.getElementById('modal');
        modal.style.display = 'flex';
        modal.style.visibility = 'visible';
        modal.classList.add('show');
    }

    function closeModal() {
        const modal = document.getElementById('modal');
        modal.style.display = 'none';
        modal.style.visibility = 'hidden';
        modal.classList.remove('show');
    }

    function confirmSelection() {
        gameState.playerKey = gameState.selectedChar;
        closeModal();
        initBattle();
        scrollToGame();
    }

    function scrollToGame() {
        document.getElementById('game').scrollIntoView({ behavior: 'smooth' });
    }

    function shuffleCards() {
        const preview = document.querySelector('.character-preview');
        const cards = Array.from(preview.children);
        
        preview.classList.add('shuffling');
        
        setTimeout(() => {
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                preview.appendChild(cards[j]);
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
            
            preview.classList.remove('shuffling');
        }, 800);
    }

    setInterval(shuffleCards, 5000);
    setTimeout(shuffleCards, 1500);

    /* ================================
       INITIALIZATION
       ================================ */
    document.addEventListener('DOMContentLoaded', () => {
        WalletSystem.init();
        AudioSystem.init();
        SafariGame.init();
        RewardSystem.init();
        AdminPanel.init();
        init();
        
        // Switch music on scroll
        let lastSection = 'main';
        window.addEventListener('scroll', () => {
            const gameSection = document.getElementById('game');
            const rect = gameSection.getBoundingClientRect();
            const inGame = rect.top < window.innerHeight * 0.5 && rect.bottom > window.innerHeight * 0.5;
            
            if (inGame && lastSection !== 'battle') {
                lastSection = 'battle';
                AudioSystem.switchTrack('battle');
            } else if (!inGame && lastSection !== 'main') {
                lastSection = 'main';
                AudioSystem.switchTrack('main');
            }
        });
    });

// ================================
// PAY TO PLAY SYSTEM
// ================================

const PayToPlay = {
    ENTRY_FEE: 1000,
    TOKEN_MINT: 'BZz5TeFBaQ4uv5iXFf4S7mX7qzvyFLSbDpjeyzwRpump',
    TOKEN_DECIMALS: 6,
    TREASURY_WALLET: 'Bb7sK2Fzo22KXg83nq9uLRk5pW9eyVdJH32xo3XLd7Bn',
    hasPaid: false,

    // Will be set dynamically
    TOKEN_PROGRAM_ID: null,
    ASSOCIATED_TOKEN_PROGRAM_ID: 'ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL',

    init() {
        this.hasPaid = sessionStorage.getItem('pumpmon_paid') === 'true';
        this.updateUI();
        
        if (this.hasPaid) {
            CharacterSelect.show();
        }
    },

    updateUI() {
        const overlay = document.getElementById('pay-overlay');
        if (overlay) {
            if (this.hasPaid) {
                overlay.classList.add('hidden');
            } else {
                overlay.classList.remove('hidden');
            }
        }
        this.updateWalletStatus();
    },

    updateWalletStatus() {
        const statusEl = document.getElementById('wallet-status');
        if (!statusEl) return;
        
        if (window.solana && window.solana.isConnected) {
            const addr = window.solana.publicKey.toString();
            statusEl.textContent = addr.slice(0, 4) + '...' + addr.slice(-4);
            statusEl.classList.add('connected');
        } else {
            statusEl.textContent = 'Wallet not connected';
            statusEl.classList.remove('connected');
        }
    },

    async getATA(mint, owner, tokenProgramId) {
        const [ata] = await solanaWeb3.PublicKey.findProgramAddress(
            [
                owner.toBytes(),
                new solanaWeb3.PublicKey(tokenProgramId).toBytes(),
                mint.toBytes(),
            ],
            new solanaWeb3.PublicKey(this.ASSOCIATED_TOKEN_PROGRAM_ID)
        );
        return ata;
    },

    createATAInstruction(payer, ata, owner, mint, tokenProgramId) {
        const keys = [
            { pubkey: payer, isSigner: true, isWritable: true },
            { pubkey: ata, isSigner: false, isWritable: true },
            { pubkey: owner, isSigner: false, isWritable: false },
            { pubkey: mint, isSigner: false, isWritable: false },
            { pubkey: solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false },
            { pubkey: new solanaWeb3.PublicKey(tokenProgramId), isSigner: false, isWritable: false },
        ];

        return new solanaWeb3.TransactionInstruction({
            keys,
            programId: new solanaWeb3.PublicKey(this.ASSOCIATED_TOKEN_PROGRAM_ID),
            data: new Uint8Array([]),
        });
    },

    createTransferInstruction(source, destination, owner, amount, tokenProgramId) {
        const keys = [
            { pubkey: source, isSigner: false, isWritable: true },
            { pubkey: destination, isSigner: false, isWritable: true },
            { pubkey: owner, isSigner: true, isWritable: false },
        ];

        const data = new Uint8Array(9);
        data[0] = 3;

        const bigAmount = BigInt(amount);
        for (let i = 0; i < 8; i++) {
            data[1 + i] = Number((bigAmount >> BigInt(i * 8)) & BigInt(0xff));
        }

        return new solanaWeb3.TransactionInstruction({
            keys,
            programId: new solanaWeb3.PublicKey(tokenProgramId),
            data,
        });
    },

    async payEntryFee() {
        const btn = document.getElementById('pay-overlay-btn');
        btn.classList.add('loading');
        btn.disabled = true;

        try {
            if (!window.solana || !window.solana.isPhantom) {
                alert('Please install Phantom wallet!');
                throw new Error('Phantom not found');
            }

            const resp = await window.solana.connect();
            this.updateWalletStatus();

            const connection = new solanaWeb3.Connection(
                'https://mainnet.helius-rpc.com/?api-key=ce44879d-2d2b-45bb-9e24-d83b16d4eb1f',
                'confirmed'
            );

            const mintPubkey = new solanaWeb3.PublicKey(this.TOKEN_MINT);
            const treasuryPubkey = new solanaWeb3.PublicKey(this.TREASURY_WALLET);
            const senderPubkey = resp.publicKey;

            // ðŸ” AUTO-DETECT TOKEN PROGRAM FROM MINT ACCOUNT
            const mintAccount = await connection.getAccountInfo(mintPubkey);
            if (!mintAccount) {
                throw new Error('Token mint not found');
            }
            const tokenProgramId = mintAccount.owner.toString();
            console.log('Token Program:', tokenProgramId);

            // Get ATAs using detected program
            const senderATA = await this.getATA(mintPubkey, senderPubkey, tokenProgramId);
            const treasuryATA = await this.getATA(mintPubkey, treasuryPubkey, tokenProgramId);

            console.log('Sender ATA:', senderATA.toString());
            console.log('Treasury ATA:', treasuryATA.toString());

            const transaction = new solanaWeb3.Transaction();

            // Check if treasury token account exists
            const treasuryAccount = await connection.getAccountInfo(treasuryATA);
            if (!treasuryAccount) {
                console.log('Creating treasury ATA...');
                transaction.add(
                    this.createATAInstruction(senderPubkey, treasuryATA, treasuryPubkey, mintPubkey, tokenProgramId)
                );
            }

            // Add transfer
            const amount = this.ENTRY_FEE * Math.pow(10, this.TOKEN_DECIMALS);
            transaction.add(
                this.createTransferInstruction(senderATA, treasuryATA, senderPubkey, amount, tokenProgramId)
            );

            transaction.feePayer = senderPubkey;
            const { blockhash, lastValidBlockHeight } = await connection.getLatestBlockhash('finalized');
            transaction.recentBlockhash = blockhash;

            const signed = await window.solana.signTransaction(transaction);
            
            const signature = await connection.sendRawTransaction(signed.serialize(), {
                skipPreflight: false,
                maxRetries: 5,
                preflightCommitment: 'confirmed'
            });

            console.log('Transaction sent:', signature);

            const confirmation = await connection.confirmTransaction({
                signature,
                blockhash,
                lastValidBlockHeight
            }, 'confirmed');

            if (confirmation.value.err) {
                throw new Error('Transaction failed: ' + JSON.stringify(confirmation.value.err));
            }

            console.log('Payment successful:', signature);

            this.hasPaid = true;
            sessionStorage.setItem('pumpmon_paid', 'true');
            this.updateUI();

            CharacterSelect.show();

            alert('âœ… Payment successful! Choose your fighter!');

        } catch (error) {
            console.error('Payment failed:', error);
            alert('Payment failed: ' + error.message);
        } finally {
            btn.classList.remove('loading');
            btn.disabled = false;
        }
    },

    reset() {
        this.hasPaid = false;
        sessionStorage.removeItem('pumpmon_paid');
        CharacterSelect.hide();
        this.updateUI();
    }
};

function payEntryFee() {
    PayToPlay.payEntryFee();
}

// Character Selection System
const CharacterSelect = {
    selectedChar: null,
    
    init() {
        document.querySelectorAll('.select-card').forEach(card => {
            card.addEventListener('click', () => this.selectCard(card));
        });
        
        const confirmBtn = document.getElementById('confirm-character');
        if (confirmBtn) {
            confirmBtn.addEventListener('click', () => this.confirmSelection());
        }
    },
    
    show() {
        const section = document.getElementById('character-select');
        if (section) {
            section.classList.add('show');
        }
    },
    
    hide() {
        const section = document.getElementById('character-select');
        if (section) {
            section.classList.remove('show');
        }
    },
    
    selectCard(card) {
        document.querySelectorAll('.select-card').forEach(c => {
            c.classList.remove('selected');
        });
        
        card.classList.add('selected');
        this.selectedChar = card.dataset.char;
        
        const confirmBtn = document.getElementById('confirm-character');
        if (confirmBtn) {
            confirmBtn.disabled = false;
        }
        
        if (typeof AudioSystem !== 'undefined') {
            AudioSystem.playSound('select');
        }
        
        console.log('Selected:', this.selectedChar);
    },
    
    confirmSelection() {
        if (!this.selectedChar) return;
        
        console.log('Starting battle with:', this.selectedChar);
        
        // Set player character
        gameState.selectedChar = this.selectedChar;
        gameState.playerKey = this.selectedChar;
        
        // Play sound
        if (typeof AudioSystem !== 'undefined') {
            AudioSystem.playSound('select');
        }
        
        // Scroll to battle
        const gameSection = document.getElementById('game');
        if (gameSection) {
            gameSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // Start battle
        setTimeout(() => {
            initBattle();
        }, 500);
    }
};

// Initialize both systems
document.addEventListener('DOMContentLoaded', () => {
    CharacterSelect.init();
    PayToPlay.init();
});
</script>
</body>
</html>